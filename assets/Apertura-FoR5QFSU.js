import{j as e,a as S,u as k,r as x,S as P}from"./index-DaOhVVWd.js";import{u as T}from"./useAuthentication-Dn9EKM7N.js";import{P as A}from"./PageTransition-Couod70-.js";const M="_aperturaContainer_o4gcz_1",z="_fadeIn_o4gcz_1",L="_header_o4gcz_11",$="_backButton_o4gcz_34",O="_alert_o4gcz_61",F="_alertSuccess_o4gcz_71",H="_alertDanger_o4gcz_77",q="_alertWarning_o4gcz_83",D="_closeButton_o4gcz_89",W="_contentGrid_o4gcz_103",X="_formCard_o4gcz_109",J="_listCard_o4gcz_109",G="_cardHeader_o4gcz_122",R="_cardBody_o4gcz_151",V="_formGroup_o4gcz_155",Y="_selectField_o4gcz_167",I="_submitButton_o4gcz_184",Q="_emptyState_o4gcz_212",U="_emptyMessage_o4gcz_225",K="_tableContainer_o4gcz_231",Z="_table_o4gcz_231",ee="_actionButtons_o4gcz_261",te="_assignButton_o4gcz_266",re="_deleteButton_o4gcz_266",r={aperturaContainer:M,fadeIn:z,header:L,backButton:$,alert:O,alertSuccess:F,alertDanger:H,alertWarning:q,closeButton:D,contentGrid:W,formCard:X,listCard:J,cardHeader:G,cardBody:R,formGroup:V,selectField:Y,submitButton:I,emptyState:Q,emptyMessage:U,tableContainer:K,table:Z,actionButtons:ee,assignButton:te,deleteButton:re},se=({mensaje:t,onClose:a})=>t.texto?e.jsxs("div",{className:`${r.alert} ${r[`alert${t.tipo.charAt(0).toUpperCase()+t.tipo.slice(1)}`]}`,children:[t.texto,e.jsx("button",{className:r.closeButton,onClick:a,children:"×"})]}):null,oe=({title:t,backUrl:a="/dashboard",icon:p})=>{const d=S(),u=e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("rect",{x:"3",y:"11",width:"18",height:"11",rx:"2",ry:"2"}),e.jsx("path",{d:"M7 11V7a5 5 0 0 1 10 0v4"})]});return e.jsxs("div",{className:r.header,children:[e.jsxs("h2",{children:[p||u,t]}),e.jsxs("button",{className:r.backButton,onClick:()=>d(a),children:[e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("line",{x1:"19",y1:"12",x2:"5",y2:"12"}),e.jsx("polyline",{points:"12 19 5 12 12 5"})]}),"Volver"]})]})},ae=t=>{if(!t)return"";const a=t.split("T")[0].split("-");return a.length===3?`${a[2]}/${a[1]}/${a[0]}`:t},ne=({cuestionarios:t,periodos:a,cuestionarioSeleccionado:p,periodoSeleccionado:d,onCuestionarioChange:u,onPeriodoChange:c,onSubmit:f,formatearFecha:j})=>{const g=j||ae;return e.jsxs("div",{className:r.formCard,children:[e.jsx("div",{className:r.cardHeader,children:e.jsx("h3",{children:"Programar Apertura"})}),e.jsx("div",{className:r.cardBody,children:e.jsxs("form",{onSubmit:f,children:[e.jsxs("div",{className:r.formGroup,children:[e.jsx("label",{htmlFor:"cuestionario_id",children:"Cuestionario"}),e.jsxs("select",{id:"cuestionario_id",value:p,onChange:i=>u(i.target.value),required:!0,className:r.selectField,children:[e.jsx("option",{value:"",children:"Seleccionar cuestionario"}),t.map(i=>e.jsxs("option",{value:i.id,children:[i.titulo," - ",i.programa_nombre]},i.id))]})]}),e.jsxs("div",{className:r.formGroup,children:[e.jsx("label",{htmlFor:"periodo_id",children:"Periodo"}),e.jsxs("select",{id:"periodo_id",value:d,onChange:i=>c(i.target.value),required:!0,className:r.selectField,children:[e.jsx("option",{value:"",children:"Seleccionar periodo"}),a.map(i=>e.jsxs("option",{value:i.id,children:[i.nombre," (",g(i.fecha_inicio)," - ",g(i.fecha_fin),")"]},i.id))]})]}),e.jsxs("button",{type:"submit",className:r.submitButton,children:[e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("rect",{x:"3",y:"11",width:"18",height:"11",rx:"2",ry:"2"}),e.jsx("path",{d:"M7 11V7a5 5 0 0 1 10 0v4"})]}),"Abrir Cuestionario"]})]})})]})},ie=()=>e.jsxs("div",{className:r.emptyState,children:[e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"36",height:"36",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("circle",{cx:"12",cy:"12",r:"10"}),e.jsx("line",{x1:"12",y1:"8",x2:"12",y2:"12"}),e.jsx("line",{x1:"12",y1:"16",x2:"12.01",y2:"16"})]}),e.jsx("p",{className:r.emptyMessage,children:"No hay cuestionarios abiertos actualmente."})]}),ce=t=>{if(!t)return"";const a=t.split("T")[0].split("-");return a.length===3?`${a[2]}/${a[1]}/${a[0]}`:t},le=({aperturas:t,onEliminarApertura:a,formatearFecha:p})=>{const d=S(),u=p||ce;return e.jsxs("div",{className:r.listCard,children:[e.jsx("div",{className:r.cardHeader,children:e.jsxs("h3",{children:[e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("line",{x1:"8",y1:"6",x2:"21",y2:"6"}),e.jsx("line",{x1:"8",y1:"12",x2:"21",y2:"12"}),e.jsx("line",{x1:"8",y1:"18",x2:"21",y2:"18"}),e.jsx("line",{x1:"3",y1:"6",x2:"3.01",y2:"6"}),e.jsx("line",{x1:"3",y1:"12",x2:"3.01",y2:"12"}),e.jsx("line",{x1:"3",y1:"18",x2:"3.01",y2:"18"})]}),"Cuestionarios Abiertos"]})}),e.jsx("div",{className:r.cardBody,children:t.length===0?e.jsx(ie,{}):e.jsx("div",{className:r.tableContainer,children:e.jsxs("table",{className:r.table,children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Cuestionario"}),e.jsx("th",{children:"Programa"}),e.jsx("th",{children:"Periodo"}),e.jsx("th",{children:"Fechas"}),e.jsx("th",{children:"Acciones"})]})}),e.jsx("tbody",{children:t.map(c=>e.jsxs("tr",{children:[e.jsx("td",{children:c.titulo}),e.jsx("td",{children:c.programa_nombre}),e.jsx("td",{children:c.periodo_nombre}),e.jsxs("td",{children:[u(c.fecha_inicio)," - ",u(c.fecha_fin)]}),e.jsx("td",{children:e.jsxs("div",{className:r.actionButtons,children:[e.jsx("button",{className:r.assignButton,onClick:()=>d(`/asignacion/${c.id}`),title:"Asignar a estudiantes",children:e.jsx("i",{className:"fas fa-user-plus"})}),e.jsx("button",{className:r.deleteButton,onClick:()=>a(c.id),title:"Eliminar apertura",children:e.jsx("i",{className:"fas fa-trash"})})]})})]},c.id))})]})})})]})},pe=()=>{const{user:t}=T(),[a]=k(),[p,d]=x.useState([]),[u,c]=x.useState([]),[f,j]=x.useState([]),[g,i]=x.useState(""),[w,y]=x.useState(""),[b,m]=x.useState({texto:"",tipo:""});x.useEffect(()=>{if(!t?.id)return;let o=!0;return(async()=>{try{const n=await fetch(`http://localhost/cuestionario-api/api/apertura_api.php?usuario_id=${t.id}`,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json","X-Requested-With":"XMLHttpRequest"},credentials:"include",body:JSON.stringify({action:"get_data",usuario_id:t.id})});if(!n.ok)throw new Error(`HTTP error! status: ${n.status}`);const l=await n.json();if(!o)return;if(l.success){d(l.cuestionarios||[]),c(l.periodos||[]),j(l.aperturas||[]);const h=a.get("cuestionario");h&&i(h)}else throw new Error(l.error||"Error al cargar los datos")}catch(n){if(!o)return;console.error("Error al cargar datos:",n),m({texto:n instanceof Error?n.message:"Error al cargar los datos",tipo:"danger"})}})(),()=>{o=!1}},[t?.id,a]);const v=async()=>{try{const o=await fetch(`http://localhost/cuestionario-api/api/apertura_api.php?usuario_id=${t?.id}`,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json","X-Requested-With":"XMLHttpRequest"},credentials:"include",body:JSON.stringify({action:"get_data",usuario_id:t?.id})});if(!o.ok)throw new Error(`HTTP error! status: ${o.status}`);const s=await o.json();if(s.success)d(s.cuestionarios||[]),c(s.periodos||[]),j(s.aperturas||[]);else throw new Error(s.error||"Error al cargar los datos")}catch(o){console.error("Error al recargar datos:",o),m({texto:o instanceof Error?o.message:"Error al recargar los datos",tipo:"danger"})}},B=async o=>{if(o.preventDefault(),!g||!w){_("Debe seleccionar un cuestionario y un periodo","warning");return}try{const s=await fetch("http://localhost/cuestionario-api/api/apertura_api.php",{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json","X-Requested-With":"XMLHttpRequest"},credentials:"include",body:JSON.stringify({accion:"crear_apertura",usuario_id:t?.id,cuestionario_id:g,periodo_id:w})});if(!s.ok){const h=await s.text();throw h.includes("<")||h.includes("<!DOCTYPE")?new Error("El servidor devolvió HTML en lugar de JSON. Verifica que MySQL esté ejecutándose en XAMPP."):new Error(`Error en la respuesta del servidor: ${s.status}`)}const n=await s.text();if(n.includes("<")||n.includes("<!DOCTYPE"))throw new Error("El servidor devolvió HTML en lugar de JSON. Verifica que MySQL esté ejecutándose en XAMPP.");const l=JSON.parse(n);if(!l.success)throw new Error(l.error||"Error al crear la apertura");_("Apertura creada correctamente","success"),i(""),y(""),v()}catch(s){console.error("Error al crear apertura:",s),_(s instanceof Error?s.message:"Error al crear la apertura","danger")}},N=async o=>{P.fire({title:"¿Está seguro?",text:"Esta acción eliminará todas las asignaciones asociadas a este cuestionario.",icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",cancelButtonColor:"#3085d6",confirmButtonText:"Sí, eliminar",cancelButtonText:"Cancelar"}).then(async s=>{if(s.isConfirmed)try{const n=await fetch("http://localhost/cuestionario-api/api/apertura_api.php",{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json","X-Requested-With":"XMLHttpRequest"},credentials:"include",body:JSON.stringify({accion:"eliminar_apertura",usuario_id:t?.id,apertura_id:o})});if(!n.ok){const E=await n.text();throw E.includes("<")||E.includes("<!DOCTYPE")?new Error("El servidor devolvió HTML en lugar de JSON. Verifica que MySQL esté ejecutándose en XAMPP."):new Error("Ya existe un estudiante asignado")}const l=await n.text();if(l.includes("<")||l.includes("<!DOCTYPE"))throw new Error("El servidor devolvió HTML en lugar de JSON. Verifica que MySQL esté ejecutándose en XAMPP.");const h=JSON.parse(l);if(!h.success)throw new Error(h.error||"Error al eliminar la apertura");_("La apertura ha sido eliminada correctamente","success"),v()}catch(n){console.error("Error al eliminar apertura:",n),_(n instanceof Error?n.message:"Error al eliminar la apertura","danger")}})},_=(o,s)=>{m({texto:o,tipo:s}),setTimeout(()=>{m({texto:"",tipo:""})},5e3)},C=o=>{if(!o)return"";const s=o.split("T")[0].split("-");return s.length===3?`${s[2]}/${s[1]}/${s[0]}`:o};return e.jsx(A,{children:e.jsxs("div",{className:r.aperturaContainer,children:[e.jsx(oe,{title:"Apertura de Cuestionarios"}),e.jsx(se,{mensaje:b,onClose:()=>m({texto:"",tipo:""})}),e.jsxs("div",{className:r.contentGrid,children:[e.jsx(ne,{cuestionarios:p,periodos:u,cuestionarioSeleccionado:g,periodoSeleccionado:w,onCuestionarioChange:i,onPeriodoChange:y,onSubmit:B,formatearFecha:C}),e.jsx(le,{aperturas:f,onEliminarApertura:N,formatearFecha:C})]})]})})};export{pe as default};
