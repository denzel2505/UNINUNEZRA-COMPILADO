import{j as e,R as je,r as v,a as V,d as de,S as A,b as te,A as re}from"./index-DAGB5OzC.js";import{C as ve,u as Ne}from"./index.esm-CUP7e7LG.js";import{P as le}from"./PageTransition-DfyYbGk4.js";import{read as we,utils as Ce}from"./xlsx-DLvP5s0v.js";const Se=()=>e.jsx("div",{className:"card border-0 mb-4",style:{background:"linear-gradient(135deg, #00a19b 0%, #008f89 100%)",color:"white",borderRadius:"12px",boxShadow:"0 4px 15px rgba(0,0,0,0.03)",position:"relative",overflow:"hidden"},children:e.jsx("div",{className:"card-body p-4",children:e.jsx("h1",{className:"mb-0 text-white text-center",style:{fontSize:"2rem",fontWeight:"700"},children:"Crear Cuestionario"})})}),Ee=({puntajeTotal:t,puntajeMaximo:o,programaSeleccionado:p,mostrarDetallePuntaje:c,onToggleDetalle:x,onCerrarDetalle:m})=>{const i=t/o*100,y=t===o?"perfecto":t>o?"excedido":t>=o*.5?"medio":"bajo",h=()=>{switch(y){case"perfecto":return"linear-gradient(135deg, #27ae60, #229954)";case"excedido":return"linear-gradient(135deg, #8e44ad, #7d3c98)";case"medio":return"linear-gradient(135deg, #f39c12, #e67e22)";default:return"linear-gradient(135deg, #e74c3c, #c0392b)"}},k=()=>{switch(y){case"perfecto":return"bg-success";case"excedido":return"bg-purple";case"medio":return"bg-warning text-dark";default:return"bg-danger"}},n=()=>{switch(y){case"excedido":return"Excedido";case"perfecto":return"Perfecto";case"medio":return"Parcial";default:return"Bajo"}};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"d-none d-lg-block",style:{position:"fixed",bottom:30,right:30,zIndex:1e3},children:[e.jsxs("div",{className:"d-flex flex-column align-items-center justify-content-center rounded-circle",style:{width:80,height:80,background:h(),color:"white",boxShadow:"0 4px 20px rgba(0,0,0,0.15)",cursor:"pointer",transition:"all 0.3s ease"},onClick:x,onMouseOver:r=>{r.currentTarget.style.transform="scale(1.1)",r.currentTarget.style.boxShadow="0 6px 25px rgba(0,0,0,0.2)"},onMouseOut:r=>{r.currentTarget.style.transform="scale(1)",r.currentTarget.style.boxShadow="0 4px 20px rgba(0,0,0,0.15)"},children:[e.jsx("span",{style:{fontSize:"1.4rem",fontWeight:"bold",lineHeight:1},children:t%1===0?t.toFixed(0):t.toFixed(1)}),e.jsxs("span",{style:{fontSize:"0.7rem",opacity:.9,lineHeight:1},children:["Máx: ",o]})]}),c&&e.jsx("div",{className:"position-absolute",style:{bottom:100,right:0,width:280},children:e.jsxs("div",{className:"card border-0 shadow-lg",children:[e.jsxs("div",{className:"card-header d-flex justify-content-between align-items-center",style:{background:"linear-gradient(135deg, #f8f9fa, #e9ecef)",borderBottom:"1px solid #e2e8f0"},children:[e.jsx("h6",{className:"mb-0",style:{color:"#2c3e50",fontWeight:600},children:"Detalles del Puntaje"}),e.jsx("button",{type:"button",className:"btn-close",onClick:m,"aria-label":"Cerrar"})]}),e.jsxs("div",{className:"card-body p-3",children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-2 p-2 bg-light rounded",children:[e.jsx("span",{style:{fontWeight:500,color:"#2c3e50",fontSize:"0.9rem"},children:"Actual:"}),e.jsx("span",{style:{fontWeight:600,color:"#34495e",fontSize:"0.9rem"},children:t%1===0?t.toFixed(0):t.toFixed(1)})]}),e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-2 p-2 bg-light rounded",children:[e.jsx("span",{style:{fontWeight:500,color:"#2c3e50",fontSize:"0.9rem"},children:"Máximo:"}),e.jsx("span",{style:{fontWeight:600,color:"#34495e",fontSize:"0.9rem"},children:o})]}),e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-2 p-2 bg-light rounded",children:[e.jsx("span",{style:{fontWeight:500,color:"#2c3e50",fontSize:"0.9rem"},children:"Porcentaje:"}),e.jsxs("span",{style:{fontWeight:600,color:"#34495e",fontSize:"0.9rem"},children:[i.toFixed(1),"%"]})]}),e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-3 p-2 bg-light rounded",children:[e.jsx("span",{style:{fontWeight:500,color:"#2c3e50",fontSize:"0.9rem"},children:"Estado:"}),e.jsx("span",{className:`badge ${k()}`,style:{fontSize:"0.8rem",fontWeight:600},children:n()})]}),p&&e.jsx("div",{className:"text-center pt-2 border-top",children:e.jsxs("small",{style:{color:"#7f8c8d",fontStyle:"italic"},children:["Programa: ",p.nivel_nombre]})})]})]})})]}),e.jsx("div",{className:"d-block d-lg-none w-100",children:e.jsxs("div",{className:"card border-0 shadow-sm",children:[e.jsx("div",{className:"card-header",style:{background:"linear-gradient(135deg, #f8f9fa, #e9ecef)"},children:e.jsx("h6",{className:"mb-0",style:{color:"#2c3e50",fontWeight:600},children:"Detalles del Puntaje"})}),e.jsxs("div",{className:"card-body p-3",children:[e.jsxs("div",{className:"row g-2",children:[e.jsx("div",{className:"col-6",children:e.jsxs("div",{className:"p-2 bg-light rounded d-flex justify-content-between",children:[e.jsx("span",{children:"Actual:"}),e.jsx("strong",{children:t%1===0?t.toFixed(0):t.toFixed(1)})]})}),e.jsx("div",{className:"col-6",children:e.jsxs("div",{className:"p-2 bg-light rounded d-flex justify-content-between",children:[e.jsx("span",{children:"Máximo:"}),e.jsx("strong",{children:o})]})}),e.jsx("div",{className:"col-6",children:e.jsxs("div",{className:"p-2 bg-light rounded d-flex justify-content-between",children:[e.jsx("span",{children:"%:"}),e.jsxs("strong",{children:[i.toFixed(1),"%"]})]})}),e.jsx("div",{className:"col-6",children:e.jsxs("div",{className:"p-2 bg-light rounded d-flex justify-content-between",children:[e.jsx("span",{children:"Estado:"}),e.jsx("span",{className:`badge ${k()}`,children:n()})]})})]}),p&&e.jsx("div",{className:"text-center pt-2",children:e.jsxs("small",{style:{color:"#7f8c8d"},children:["Programa: ",p.nivel_nombre]})})]})]})})]})},Pe=({programas:t,register:o,control:p,errors:c,puntajeMaximo:x,programaDisabled:m=!1})=>e.jsxs("div",{className:"row g-3 mb-3 pb-3",children:[e.jsx("div",{className:"col-12 col-md-6",children:e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:`form-label ${c?.titulo?"text-danger fw-semibold":""}`,style:{color:c?.titulo?void 0:"#2c3e50",fontWeight:"500",fontSize:"0.9rem"},children:"Título *"}),e.jsx("input",{type:"text",...o("titulo",{required:"El título es requerido"}),"aria-invalid":!!c?.titulo,className:`form-control ${c?.titulo?"is-invalid":""}`,placeholder:"Título del cuestionario *",style:{fontSize:"0.9rem"}}),c?.titulo&&e.jsx("div",{className:"invalid-feedback",role:"alert",style:{color:"#dc3545",fontWeight:600},children:String(c.titulo?.message||"Campo requerido")})]})}),e.jsx("div",{className:"col-12 col-md-6",children:e.jsxs("div",{className:"mb-3",children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[e.jsx("label",{className:`form-label ${c?.programaId?"text-danger fw-semibold":""}`,style:{color:c?.programaId?void 0:"#2c3e50",fontWeight:"500",fontSize:"0.9rem"},children:"Programa *"}),!c?.programaId&&typeof x=="number"&&x>0&&e.jsxs("small",{className:"text-muted ms-2",children:[e.jsx("i",{className:"fas fa-gauge-high me-1","aria-hidden":"true"}),"Puntaje máximo para este programa: ",e.jsx("strong",{children:x})]})]}),e.jsx("select",{...o("programaId",{required:"El programa es requerido"}),"aria-invalid":!!c?.programaId,className:`form-select ${c?.programaId?"is-invalid":""}`,disabled:m,style:{fontSize:"0.9rem",backgroundColor:m?"#f8f9fa":"white",cursor:m?"not-allowed":"pointer",opacity:m?.7:1},children:m&&t.length===1?e.jsxs("option",{value:t[0].id,children:[t[0].nombre,t[0].nivel_nombre?` - ${t[0].nivel_nombre}`:"",t[0].campus_nombre?` - ${t[0].campus_nombre}`:"",!t[0].nivel_nombre||!t[0].campus_nombre?" (Información incompleta)":""]}):e.jsxs(e.Fragment,{children:[e.jsx("option",{value:"",children:"Seleccione un programa"}),t.map(i=>e.jsxs("option",{value:i.id,children:[i.nombre,i.nivel_nombre?` - ${i.nivel_nombre}`:"",i.campus_nombre?` - ${i.campus_nombre}`:"",!i.nivel_nombre||!i.campus_nombre?" (Información incompleta)":""]},i.id))]})}),c?.programaId&&e.jsx("div",{className:"invalid-feedback",role:"alert",style:{color:"#dc3545",fontWeight:600},children:String(c.programaId?.message||"Campo requerido")}),m&&t.length===1&&e.jsxs("small",{className:"text-muted",children:[e.jsx("i",{className:"fas fa-lock me-1"}),"Solo puedes crear cuestionarios para tu programa asignado: ",e.jsx("strong",{children:t[0].nombre}),(!t[0].nivel_nombre||!t[0].campus_nombre)&&e.jsx("span",{className:"text-warning",children:" ⚠️ Información del programa incompleta (nivel y campus no disponibles)"})]}),!m&&t.length===1&&e.jsxs("small",{className:"text-muted",children:[e.jsx("i",{className:"fas fa-info-circle me-1"}),"Solo puedes crear cuestionarios para tu programa asignado: ",e.jsx("strong",{children:t[0].nombre}),(!t[0].nivel_nombre||!t[0].campus_nombre)&&e.jsx("span",{className:"text-warning",children:" ⚠️ Información del programa incompleta (nivel y campus no disponibles)"})]}),!m&&t.length>1&&e.jsxs("small",{className:"text-muted",children:[e.jsx("i",{className:"fas fa-info-circle me-1"}),"Puedes crear cuestionarios para cualquier programa disponible"]})]})}),e.jsx("div",{className:"col-12",children:e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:`form-label ${c?.descripcion?"text-danger fw-semibold":""}`,style:{color:c?.descripcion?void 0:"#2c3e50",fontWeight:"500",fontSize:"0.9rem"},children:"Descripción *"}),e.jsx(ve,{name:"descripcion",control:p,rules:{required:"La descripción es requerida"},render:({field:i})=>e.jsx("div",{className:c?.descripcion?"is-invalid":"",children:e.jsx("textarea",{className:`form-control ${c?.descripcion?"is-invalid":""}`,placeholder:"Descripción del cuestionario *",rows:5,value:i.value||"",onChange:i.onChange})})}),c?.descripcion&&e.jsx("div",{className:"invalid-feedback",role:"alert",style:{color:"#dc3545",fontWeight:600},children:String(c.descripcion?.message||"Campo requerido")})]})}),e.jsxs("div",{className:"col-12",children:[e.jsxs("div",{className:"mb-2 d-flex align-items-center justify-content-between",children:[e.jsx("label",{className:"form-label mb-0",style:{color:"#2c3e50",fontWeight:500,fontSize:"0.9rem"},children:"Tiempo límite"}),e.jsx("small",{className:"text-muted",children:"Formato HH:MM:SS · por defecto 00:40:00"})]}),e.jsxs("div",{className:"d-flex align-items-center gap-2 border rounded p-3",style:{background:"#f9fafb",borderColor:"#e2e8f0"},children:[e.jsxs("div",{className:"d-flex flex-column align-items-center",style:{minWidth:90},children:[e.jsx("small",{className:"text-muted mb-1",children:"horas"}),e.jsx("input",{type:"number",min:0,max:23,...o("tiempoHoras",{required:"El tiempo es requerido",valueAsNumber:!0,min:0,max:23}),className:`form-control text-center ${c?.tiempoHoras?"is-invalid":""}`,style:{width:80}})]}),e.jsx("div",{className:"fs-4",children:":"}),e.jsxs("div",{className:"d-flex flex-column align-items-center",style:{minWidth:90},children:[e.jsx("small",{className:"text-muted mb-1",children:"minutos"}),e.jsx("input",{type:"number",min:0,max:59,...o("tiempoMinutos",{required:"El tiempo es requerido",valueAsNumber:!0,min:0,max:59}),className:`form-control text-center ${c?.tiempoMinutos?"is-invalid":""}`,style:{width:80}})]}),e.jsx("div",{className:"fs-4",children:":"}),e.jsxs("div",{className:"d-flex flex-column align-items-center",style:{minWidth:90},children:[e.jsx("small",{className:"text-muted mb-1",children:"segundos"}),e.jsx("input",{type:"number",min:0,max:59,...o("tiempoSegundos",{required:"El tiempo es requerido",valueAsNumber:!0,min:0,max:59}),className:`form-control text-center ${c?.tiempoSegundos?"is-invalid":""}`,style:{width:80}})]})]}),(c?.tiempoHoras||c?.tiempoMinutos||c?.tiempoSegundos)&&e.jsx("div",{className:"mt-2",role:"alert",style:{color:"#dc3545",fontWeight:600},children:String(c?.tiempoHoras?.message||c?.tiempoMinutos?.message||c?.tiempoSegundos?.message||"El tiempo es requerido")})]})]}),ae=({imagen:t,onImagenChange:o,onEliminarImagen:p,onDragOver:c,onDrop:x,placeholder:m,inputId:i,className:y=""})=>e.jsxs("div",{className:y,children:[e.jsx("div",{className:`border-2 border-dashed rounded p-3 text-center cursor-pointer transition-all ${t?"border-success bg-light":"border-secondary bg-light"}`,style:{minHeight:"100px",display:"flex",alignItems:"center",justifyContent:"center",transition:"all 0.3s ease"},onDragOver:c,onDrop:x,onClick:()=>document.getElementById(i)?.click(),onMouseOver:h=>{h.currentTarget.style.borderColor="#d35400",h.currentTarget.style.backgroundColor="#fff3e0",h.currentTarget.style.transform="scale(1.02)",h.currentTarget.style.boxShadow="0 4px 12px rgba(211, 84, 0, 0.3)"},onMouseOut:h=>{h.currentTarget.style.borderColor=t?"#28a745":"#6c757d",h.currentTarget.style.backgroundColor="#f8f9fa",h.currentTarget.style.transform="scale(1)",h.currentTarget.style.boxShadow="none"},children:t?e.jsxs("div",{className:"w-100 d-flex align-items-center justify-content-center",children:[e.jsx("img",{src:URL.createObjectURL(t),alt:m,className:"img-fluid rounded",style:{maxHeight:"100px",objectFit:"contain"}}),e.jsx("button",{type:"button",title:"Eliminar imagen",onClick:h=>{h.stopPropagation(),p()},className:"btn btn-danger btn-sm ms-2 d-flex mb-auto",style:{width:"24px",height:"24px",padding:"0",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"1rem"},children:e.jsx("i",{className:"fas fa-times"})})]}):e.jsxs("div",{className:"d-flex flex-column align-items-center gap-2",children:[e.jsx("i",{className:"fas fa-image",style:{fontSize:"1.5rem",color:"#bdc3c7"}}),e.jsx("span",{style:{fontSize:"0.9rem",fontWeight:"500",color:"#7f8c8d"},children:m}),e.jsx("small",{style:{fontSize:"0.75rem",color:"#95a5a6"},children:"Formatos aceptados: JPG, PNG, GIF (máx. 2MB)"})]})}),e.jsx("input",{id:i,type:"file",onChange:h=>o(h.target.files),accept:"image/jpeg,image/png,image/gif",style:{display:"none"}})]}),ce=({opciones:t,preguntaIndex:o,orientacion:p=1,opcionCorrecta:c,onOpcionChange:x,onCorrectaChange:m,onAgregarOpcion:i,onEliminarOpcion:y,onImagenOpcionChange:h,onEliminarImagenOpcion:k,onDragOver:n,onDrop:r})=>{const s=p===0;return e.jsxs("div",{className:"mt-3 ",children:[e.jsx("h5",{style:{color:"#2c3e50",marginBottom:"1rem",fontSize:"1rem"},children:"Opciones de respuesta*"}),e.jsx("p",{style:{fontSize:"0.875rem",color:"#6c757d",marginBottom:"1rem",fontStyle:"italic"},children:"Selecciona la opción correcta marcando el circulo"}),e.jsx("div",{className:s?"ms-md-auto":"",style:s?{maxWidth:560}:void 0,children:t.map((a,g)=>e.jsxs(je.Fragment,{children:[e.jsxs("div",{className:"mb-3 p-2 rounded-3",style:{backgroundColor:"transparent"},children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-2",children:[e.jsxs("div",{className:"d-flex align-items-center gap-2",children:[e.jsxs("label",{className:"mb-0",style:{color:"#2c3e50",fontSize:"0.9rem",fontWeight:500},children:["Opción de respuesta ",g+1]}),t.length>2&&e.jsx("button",{type:"button",title:"Eliminar opción",onClick:()=>y(g),className:"text-danger border-0 bg-transparent text-decoration-underline",style:{fontSize:"0.8rem"},children:"Quitar opción"})]}),e.jsxs("div",{className:"d-flex align-items-center gap-2",children:[e.jsx("label",{htmlFor:`correcta-${o}-${g}`,className:"mb-0",style:{fontSize:"0.85rem",color:"#6c757d"},children:"Marcar opción como correcta"}),e.jsx("input",{type:"radio",name:`correcta-${o}`,checked:c===g,onChange:()=>m(g),required:!0,id:`correcta-${o}-${g}`,style:{width:"18px",height:"18px",cursor:"pointer"}})]})]}),e.jsx("div",{className:"d-flex align-items-center gap-2 mb-2",children:e.jsx("input",{type:"text",value:a.texto,onChange:R=>x(g,R.target.value),required:!0,className:"form-control",placeholder:`Opción ${g+1}`,style:{fontSize:"0.85rem"}})}),e.jsx("div",{className:"mt-2",style:{minHeight:"80px"},children:e.jsx(ae,{imagen:a.imagen,onImagenChange:R=>h(g,R),onEliminarImagen:()=>k(g),onDragOver:n,onDrop:R=>r(R,g),placeholder:`Imagen para opción ${g+1} (opcional)`,inputId:`opcion-img-${o}-${g}`,className:""})})]}),g<t.length-1&&e.jsx("div",{className:"my-3",style:{height:"1px",backgroundColor:"#eceff1"}})]},g))}),e.jsxs("button",{type:"button",onClick:i,className:"btn btn-outline-secondary w-100 py-2",style:{borderColor:"#e67e22",color:"#e67e22",fontWeight:"500",fontSize:"0.85rem",transition:"all 0.3s ease",boxShadow:"0 2px 4px rgba(0,0,0,0.03)"},onMouseOver:a=>{a.currentTarget.style.backgroundColor="#e67e22",a.currentTarget.style.color="white",a.currentTarget.style.transform="translateY(-1px)",a.currentTarget.style.boxShadow="0 4px 8px rgba(230, 126, 34, 0.3)"},onMouseOut:a=>{a.currentTarget.style.backgroundColor="transparent",a.currentTarget.style.color="#e67e22",a.currentTarget.style.transform="translateY(0)",a.currentTarget.style.boxShadow="0 2px 4px rgba(0,0,0,0.03)"},children:[e.jsx("i",{className:"fas fa-plus me-2"})," Agregar Opción"]})]})},Oe=({pregunta:t,preguntaIndex:o,onEliminarPregunta:p,onActualizarPregunta:c,onActualizarPeso:x,onActualizarOrientacion:m,onActualizarOpcion:i,onAgregarOpcion:y,onEliminarOpcion:h,onImagenPreguntaChange:k,onEliminarImagenPregunta:n,onImagenOpcionChange:r,onEliminarImagenOpcion:s,onDragOver:a,onDropPregunta:g,onDropOpcion:R,allCollapsed:z=null})=>{const[T,N]=v.useState(!1);v.useEffect(()=>{z!=null&&N(z)},[z]);const[u,d]=v.useState(t.peso===0?"":String(t.peso));return v.useEffect(()=>{d(t.peso===0?"":String(t.peso))},[t.peso]),e.jsxs("div",{className:"mb-3 p-3 border rounded bg-white",style:{borderColor:"#e9ecef"},children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-3",children:[e.jsxs("div",{className:"d-flex align-items-center gap-3",children:[e.jsxs("h5",{className:"mb-0",style:{color:"",fontSize:"1.1rem"},children:["Pregunta ",o+1]}),e.jsx("button",{type:"button",onClick:p,className:"text-danger border-0 bg-transparent text-decoration-underline fs-6",style:{fontSize:"0.85rem"},children:"Quitar pregunta"})]}),e.jsxs("div",{className:"d-flex align-items-end gap-2",children:[e.jsxs("div",{style:{width:"100px"},children:[e.jsx("label",{className:"form-label mb-1 small",children:"Orientación"}),e.jsxs("select",{value:t.orientacion!==void 0?t.orientacion:1,onChange:l=>{m(Number(l.target.value))},className:"form-select form-select-sm",style:{height:"34px",borderRadius:"6px"},children:[e.jsx("option",{value:1,children:"Vertical"}),e.jsx("option",{value:0,children:"Horizontal"})]})]}),e.jsxs("div",{style:{width:"100px",padding:"0px"},children:[e.jsx("label",{className:"form-label mb-1 small",children:"Peso"}),e.jsx("input",{type:"number",value:u,onChange:l=>d(l.target.value),onBlur:l=>x(l.target.value),placeholder:"0.00",min:"0.01",step:"0.01",className:"form-control form-control-sm text-center",style:{height:"31px",paddingTop:"0",paddingBottom:"0",borderRadius:"6px"}})]}),e.jsx("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>N(l=>!l),title:T?"Expandir":"Contraer",style:{height:"34px",width:"31px",padding:0,display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx("i",{className:`fas ${T?"fa-chevron-down":"fa-chevron-up"}`})})]})]}),!T&&e.jsx(e.Fragment,{children:t.orientacion===0?e.jsxs("div",{className:"row g-3 d-flex align-items-center",children:[e.jsx("div",{className:"col-12 col-md-6 d-flex h-100",children:e.jsxs("div",{className:"mx-auto my-2 my-md-0 d-flex flex-column justify-content-center w-100",style:{maxWidth:560},children:[e.jsxs("div",{className:"mb-3",children:[e.jsxs("label",{className:"form-label mb-1 small",children:["Texto Pregunta ",o+1]}),e.jsx("textarea",{value:t.texto,onChange:l=>c("texto",l.target.value),required:!0,className:"form-control",placeholder:"Texto de la pregunta *",style:{fontSize:"0.9rem"}})]}),e.jsx(ae,{imagen:t.imagen,onImagenChange:k,onEliminarImagen:n,onDragOver:a,onDrop:l=>g(l),placeholder:"Haga clic para seleccionar una imagen",inputId:`pregunta-img-${o}`})]})}),e.jsx("div",{className:"col-12 col-md-6",children:e.jsx(ce,{opciones:t.opciones,preguntaIndex:o,orientacion:t.orientacion,opcionCorrecta:t.correcta,onOpcionChange:i,onCorrectaChange:l=>c("correcta",l),onAgregarOpcion:y,onEliminarOpcion:h,onImagenOpcionChange:r,onEliminarImagenOpcion:s,onDragOver:a,onDrop:R})})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"row g-3",children:[e.jsx("div",{className:"col-12 col-md-8",children:e.jsxs("div",{className:"mb-3",children:[e.jsxs("label",{className:"form-label mb-1 small",children:["Texto Pregunta ",o+1]}),e.jsx("textarea",{value:t.texto,onChange:l=>c("texto",l.target.value),required:!0,className:"form-control",placeholder:"Texto de la pregunta *",style:{fontSize:"0.9rem"}})]})}),e.jsx("div",{className:"col-12 col-md-4",children:e.jsx(ae,{imagen:t.imagen,onImagenChange:k,onEliminarImagen:n,onDragOver:a,onDrop:l=>g(l),placeholder:"Haga clic para seleccionar una imagen",inputId:`pregunta-img-${o}`})})]}),e.jsx(ce,{opciones:t.opciones,preguntaIndex:o,orientacion:t.orientacion,opcionCorrecta:t.correcta,onOpcionChange:i,onCorrectaChange:l=>c("correcta",l),onAgregarOpcion:y,onEliminarOpcion:h,onImagenOpcionChange:r,onEliminarImagenOpcion:s,onDragOver:a,onDrop:R})]})})]})},Te=({puntajeTotal:t,puntajeMaximo:o,onSubmit:p})=>{const c=V(),x=Math.abs(t-o)>=.01,m=()=>Math.abs(t-o)>=.01?t>o?`No puedes guardar: Puntaje excedido (${t%1===0?t.toFixed(0):t.toFixed(2)}/${o})`:`No puedes guardar: Puntaje insuficiente (${t%1===0?t.toFixed(0):t.toFixed(2)}/${o})`:"Puntaje correcto - Listo para crear";return e.jsxs("div",{className:"d-flex gap-3 mt-4 pt-3 border-top",children:[e.jsxs("button",{type:"submit",className:`btn flex-grow-1 py-2 ${x?"btn-secondary":"btn-outline-secondary"}`,disabled:x,onClick:i=>{i.preventDefault(),p(i)},title:m(),style:{borderColor:"#00a19B",color:x?"#6c757d":"#00a19B",fontWeight:"500",transition:"all 0.3s ease",boxShadow:"0 2px 4px rgba(0,0,0,0.03)"},onMouseOver:i=>{x||(i.currentTarget.style.backgroundColor="#00a19B",i.currentTarget.style.color="white",i.currentTarget.style.transform="translateY(-2px)",i.currentTarget.style.boxShadow="0 8px 30px rgba(0,0,0,0.06)")},onMouseOut:i=>{x||(i.currentTarget.style.backgroundColor="transparent",i.currentTarget.style.color="#00a19B",i.currentTarget.style.transform="translateY(0)",i.currentTarget.style.boxShadow="0 2px 4px rgba(0,0,0,0.03)")},children:[e.jsx("i",{className:"fas fa-save me-2"})," Guardar Cuestionario"]}),e.jsxs("button",{type:"button",onClick:()=>c("/dashboard"),className:"btn btn-outline-secondary py-2",style:{borderColor:"#6c757d",color:"#6c757d",fontWeight:"500",transition:"all 0.3s ease",boxShadow:"0 2px 4px rgba(0,0,0,0.03)"},onMouseOver:i=>{i.currentTarget.style.backgroundColor="#6c757d",i.currentTarget.style.color="white",i.currentTarget.style.transform="translateY(-2px)",i.currentTarget.style.boxShadow="0 8px 30px rgba(0,0,0,0.06)"},onMouseOut:i=>{i.currentTarget.style.backgroundColor="transparent",i.currentTarget.style.color="#6c757d",i.currentTarget.style.transform="translateY(0)",i.currentTarget.style.boxShadow="0 2px 4px rgba(0,0,0,0.03)"},children:[e.jsx("i",{className:"fas fa-times me-2"})," Cancelar"]})]})},Ae=()=>{const[t,o]=v.useState(null),[p,c]=v.useState(!0),x=V(),m=v.useContext(de),i=v.useRef(!1),y=v.useCallback(async()=>{try{if(!m||!m.user)throw new Error("No hay datos de usuario");if(!m.user.id)throw new Error("Usuario sin ID válido");o(m.user)}catch{await A.fire({icon:"error",title:"No autorizado",text:"Debe iniciar sesión para crear un cuestionario"}),x("/login")}finally{c(!1)}},[x,m]);return v.useEffect(()=>{i.current||(i.current=!0,y())},[y]),{usuario:t,loading:p,isAuthenticated:!!t}},ke=t=>{const[o,p]=v.useState([]),[c,x]=v.useState(!0),m=V(),i=v.useRef(!1),y=r=>{if(!r)return 100;switch(r.toLowerCase()){case"técnico":case"tecnico":return 50;case"tecnológico":case"tecnologico":return 75;case"universitario":case"profesional":return 100;case"especialización":case"especializacion":return 120;case"maestría":case"maestria":return 150;case"doctorado":return 200;default:return 100}},h=v.useCallback(async()=>{try{x(!0);const r=await te.get(re.programas.base);if(!r.data)throw new Error("Respuesta vacía del servidor");if(typeof r.data!="object")throw new Error(`Respuesta del servidor no es un objeto válido. Tipo recibido: ${typeof r.data}`);if(r.data.error)throw new Error(`Error del servidor: ${r.data.error}`);if(r.data.success===!1)throw new Error(`Operación fallida: ${r.data.message||"Error desconocido"}`);let s=r.data;if(Array.isArray(r.data)&&(s={programas:r.data,success:!0}),s.success&&Array.isArray(s.programas)){let a=s.programas;t&&(a=s.programas.filter(g=>g.id===t)),p(a)}else if(s.success&&s.data&&s.data.programas&&Array.isArray(s.data.programas)){let a=s.data.programas;t&&(a=s.data.programas.filter(g=>g.id===t)),p(a)}else if(s.success&&s.data&&s.data.programa&&Array.isArray(s.data.programa)){let a=s.data.programa;p(a)}else if(s.success&&s.data)if(Array.isArray(s.data)){let a=s.data;t&&(a=s.data.filter(g=>g.id===t)),p(a)}else console.warn("⚠️ La API devolvió success pero data no es un array:",s.data),p([]);else{console.warn("⚠️ Estructura de respuesta inesperada, intentando extraer programas...");let a=[];Array.isArray(r.data)?a=r.data:r.data.data&&Array.isArray(r.data.data)?a=r.data.data:r.data.programas&&Array.isArray(r.data.programas)?a=r.data.programas:r.data.data&&r.data.data.programas&&Array.isArray(r.data.data.programas)&&(a=r.data.data.programas),t&&a.length>0&&(a=a.filter(g=>g.id===t)),a.length,p(a)}}catch(r){if(console.error("Error al cargar programas:",r),r?.response?.status===401){await A.fire({icon:"error",title:"No autorizado",text:"Debe iniciar sesión para crear un cuestionario"}),m("/login-docente");return}const s=r?.response?.data?.message||r?.message||"Error de conexión al cargar programas";A.fire("Error",s,"error"),p([])}finally{x(!1)}},[t,m]),k=r=>{if(!o||!Array.isArray(o)){console.warn("⚠️ No hay programas disponibles o no es un array válido");return}return o.find(s=>s.id.toString()===r)},n=r=>{const s=k(r);return s?.nivel_puntaje_maximo||y(s?.nivel_nombre)};return v.useEffect(()=>{i.current||(i.current=!0,h())},[h]),{programas:o,loading:c,cargarProgramas:h,obtenerProgramaPorId:k,obtenerPuntajeMaximo:n,obtenerPuntajeMaximoPorDefecto:y}},Re=()=>{const[t,o]=v.useState([]),p=u=>u.type.startsWith("image/")?u.size>2*1024*1024?(A.fire("Error","La imagen no debe exceder 2MB","error"),!1):!0:(A.fire("Error","El archivo debe ser una imagen (JPEG, PNG o GIF)","error"),!1),c=()=>{const u={texto:"",opciones:[{texto:"",imagen:null},{texto:"",imagen:null},{texto:"",imagen:null},{texto:"",imagen:null}],correcta:null,peso:0,imagen:null,orientacion:1};o(d=>[...d,u])},x=u=>{o(d=>{const l=[...d];return l.splice(u,1),l})},m=(u,d,l)=>{o(f=>{const j=[...f];return j[u][d]=l,j})},i=(u,d)=>{o(l=>{const f=[...l],j=parseFloat(d);return f[u].peso=isNaN(j)||d===""?0:Math.max(.01,j),f})},y=(u,d)=>{o(l=>{const f=[...l];return f[u].orientacion=d,f})},h=(u,d,l)=>{o(f=>f.map((j,C)=>{if(C!==u)return j;const S=j.opciones.map((_,I)=>I===d?{..._,texto:l}:_);return{...j,opciones:S}}))},k=u=>{o(d=>d.map((l,f)=>f!==u?l:{...l,opciones:[...l.opciones,{texto:"",imagen:null}]}))},n=(u,d)=>{o(l=>l.map((f,j)=>{if(j!==u)return f;if(f.opciones.length<=1)return A.fire("Aviso","Debe haber al menos 2 opciones por pregunta","info"),f;const C=f.opciones.filter((_,I)=>I!==d);let S=f.correcta;return S===d?S=null:S!==null&&S>d&&(S=S-1),{...f,opciones:C,correcta:S}}))},r=(u,d)=>{if(d&&d.length>0){const l=d[0];p(l)&&o(f=>f.map((j,C)=>C===u?{...j,imagen:l}:j))}},s=(u,d,l)=>{if(l&&l.length>0){const f=l[0];p(f)&&o(j=>j.map((C,S)=>{if(S!==u)return C;const _=C.opciones.map((I,M)=>M===d?{...I,imagen:f}:I);return{...C,opciones:_}}))}};return{preguntas:t,setPreguntas:o,agregarPregunta:c,eliminarPregunta:x,actualizarPregunta:m,actualizarPeso:i,actualizarOrientacion:y,actualizarOpcion:h,agregarOpcion:k,eliminarOpcion:n,manejarImagenPregunta:r,manejarImagenOpcion:s,eliminarImagenOpcion:(u,d)=>{o(l=>l.map((f,j)=>{if(j!==u)return f;const C=f.opciones.map((S,_)=>_===d?{...S,imagen:null}:S);return{...f,opciones:C}}))},handleDragOver:u=>{u.preventDefault(),u.stopPropagation()},handleDrop:(u,d,l,f)=>{u.preventDefault(),u.stopPropagation();const j=u.dataTransfer.files;d==="pregunta"?r(l,j):d==="opcion"&&f!==void 0&&s(l,f,j)},calcularPuntajeTotal:()=>t.reduce((u,d)=>u+(d.peso||0),0),tieneImagenes:()=>t.some(u=>u.imagen!==null||u.opciones.some(d=>d.imagen!==null)),inicializar:()=>{t.length===0&&c()},validarImagen:p}},ze=()=>{const[t,o]=v.useState(!1),p=V(),c=v.useContext(de),x=async(n,r)=>n===0?(await A.fire({icon:"warning",title:"Puntaje requerido",text:"Debe asignar pesos a las preguntas. El puntaje total no puede ser 0."}),!1):Math.abs(n-r)>=.01?(n>r?await A.fire({icon:"error",title:"No se puede crear el cuestionario",text:`El puntaje total (${n%1===0?n.toFixed(0):n.toFixed(2)}) excede el máximo permitido (${r}). Debe ajustar los pesos de las preguntas.`,confirmButtonText:"Entendido",allowOutsideClick:!1,allowEscapeKey:!1}):await A.fire({icon:"warning",title:"No se puede crear el cuestionario",text:`El puntaje total debe ser exactamente ${r}. Actual: ${n%1===0?n.toFixed(0):n.toFixed(2)}. Debe ajustar los pesos de las preguntas.`,confirmButtonText:"Entendido",allowOutsideClick:!1,allowEscapeKey:!1}),!1):!0,m=(n,r,s)=>{const a={};return(!n||!n.trim())&&(a.titulo="El título es requerido"),(!r||!r.trim())&&(a.descripcion="La descripción es requerida"),s||(a.programa="Debe seleccionar un programa"),a},i=async n=>{const r=n?.data??n;if(r?.success){await A.fire({icon:"success",title:"¡Éxito!",text:r?.message||"Operación realizada correctamente",allowOutsideClick:!1,allowEscapeKey:!1,confirmButtonText:"OK"});const a=r?.cuestionario_id??r?.data?.cuestionario_id;p(a?`/ver/${a}`:"/dashboard");return}const s=r?.debug_message||r?.error||r?.message||"Error al crear el cuestionario";throw new Error(s)},y=n=>new Promise((r,s)=>{const a=new FileReader;a.onload=()=>r(a.result),a.onerror=s,a.readAsDataURL(n)}),h=async n=>{const r=[];for(let s=0;s<n.length;s++){const a=n[s],g=a.opciones.map(N=>({texto:(N.texto||"").trim(),_file:N.imagen})).filter(N=>N.texto.length>0||N._file),R=(a.texto||"").trim(),z=typeof a.correcta=="number"?a.correcta:-1,T={texto_pregunta:R,peso:a.peso,correcta:z,orientacion:a.orientacion,opciones:g.map(({texto:N})=>({texto:N}))};if(a.imagen){const N=await y(a.imagen);T.imagen_base64=N,T.nombre_imagen_pregunta=a.imagen.name}T.opciones=await Promise.all(a.opciones.map(async N=>{const u={texto:(N.texto||"").trim()};return N.imagen&&(u.imagen_base64=await y(N.imagen),u.nombre_imagen_opcion=N.imagen.name),u})),r.push(T)}return r};return{loading:t,submitForm:async(n,r,s,a,g,R,z,T,N,u,d)=>{try{o(!0);const l=m(n,r,s);if(Object.keys(l).length>0){T(l),await A.fire({icon:"error",title:"Error de validación",text:"Por favor, complete todos los campos requeridos",allowOutsideClick:!1,allowEscapeKey:!1});return}if(T({}),!await x(g,R))return;if(!(c?.user?.id||(()=>{try{return JSON.parse(localStorage.getItem("user")||"{}")?.id}catch{return}})()))throw new Error("Debe iniciar sesión para crear un cuestionario");const C=E=>String(Math.max(0,Math.trunc(E))).padStart(2,"0"),S=`${C(N)}:${C(Math.min(59,u))}:${C(Math.min(59,d))}`,_={titulo:n,descripcion:r,programa_id:Number(s),tiempo_limite:S};console.log("📝 Descripción HTML enviada al backend:",r);const M=(await te.post(re.cuestionario.crear,_))?.data,H=M?.data?.cuestionario_id??M?.cuestionario_id;if(!M?.success||!H){const E=M?.error||M?.message||"No se pudo crear el cuestionario";throw new Error(E)}const D=await h(a);if(D.some(E=>!E.texto_pregunta))throw new Error("Todas las preguntas deben tener texto");if(D.some(E=>E.opciones.length<2))throw new Error("Cada pregunta debe tener al menos 2 opciones con texto");if(D.some(E=>E.correcta<0||E.correcta>=E.opciones.length))throw new Error("Cada pregunta debe tener una opción correcta válida");let L;try{L=await te.post(re.cuestionario.anexarPreguntas(H),{preguntas:D})}catch(E){console.error("Error en anexarPreguntas:",E),console.error("Response data:",E?.response?.data),console.error("Response status:",E?.response?.status);const J=E?.response?.data?.error||E?.response?.data?.message||E?.message;throw new Error(J||"Error al anexar preguntas y opciones")}await i(L)}catch(l){console.error("Error completo:",l),await A.fire({icon:"error",title:"Error",text:l.message||"Error al crear el cuestionario",allowOutsideClick:!1,allowEscapeKey:!1}),(l.message||"").includes("iniciar sesión")&&p("/login-docente")}finally{o(!1)}},validarPuntaje:x,validarCampos:m,procesarRespuesta:i}},_e=({onImport:t})=>{const o=v.useRef(null),p=()=>{o.current?.click()},c=()=>{const n="/form-template.xlsx",r=document.createElement("a");r.href=n,r.download="form-template.xlsx",document.body.appendChild(r),r.click(),r.remove()},x=n=>n?.toString().trim().replace(/:$/,"").toUpperCase(),m=(n,r)=>{const s={};for(const[a,g]of Object.entries(n))s[x(a)]=g;for(const a of r){const g=s[x(a)];if(g!==void 0)return g}},i=n=>{if(n==null||n==="")return NaN;const r=String(n).replace(/,/g,"."),s=parseFloat(r);return Number.isFinite(s)?s:NaN},y=n=>{if(n==null||n==="")return{value:null,converted:!1};const r=String(n).trim(),s=r.toUpperCase();if(["A","B","C","D"].includes(s))return{value:s.charCodeAt(0)-65,converted:!0};const a=i(r);if(!Number.isFinite(a))return{value:null,converted:!1};const g=Math.trunc(a);return g>=1&&g<=4?{value:g-1,converted:!0}:g>=0&&g<=3?{value:g,converted:!1}:{value:null,converted:!1}},h=async n=>{try{const r=await n.arrayBuffer(),s=we(r,{type:"array"}),a=s.SheetNames[0],g=s.Sheets[a],R=Ce.sheet_to_json(g);let z=0;const T=R.map(d=>{const l=m(d,["PREGUNTA","PREGUNTA:"]);if(!l)return null;const f=m(d,["PESO PREGUNTA","PESO","PESO:","PESO PREGUNTA:"]),j=m(d,["CORRECTA","CORRECTA:","RESPUESTA CORRECTA","RESPUESTA CORRECTA:","OPCION CORRECTA","OPCION CORRECTA:","OPCIÓN CORRECTA","OPCIÓN CORRECTA:","CORRECTA (0-3)","CORRECTA (1-4)","CORRECTA 0-3","CORRECTA 1-4"]),C=y(j);C.converted&&z++;const S=[{texto:m(d,["OPCION 1","OPCION 1:"]),imagen_opcion:m(d,["IMAGEN OPCION 1","IMAGEN OPCION 1:"])},{texto:m(d,["OPCION 2","OPCION 2:"]),imagen_opcion:m(d,["IMAGEN OPCION 2","IMAGEN OPCION 2:"])},{texto:m(d,["OPCION 3","OPCION 3:"]),imagen_opcion:m(d,["IMAGEN OPCION 3","IMAGEN OPCION 3:"])},{texto:m(d,["OPCION 4","OPCION 4:"]),imagen_opcion:m(d,["IMAGEN OPCION 4","IMAGEN OPCION 4:"])}];return{texto:l,peso:Number.isFinite(i(f))?i(f):0,imagen_pregunta:m(d,["IMAGEN PREGUNTA","IMAGEN PREGUNTA:"]),imagen_pregunta_nombre:m(d,["IMAGEN NOMBRE","IMAGEN NOMBRE:"]),correcta:C.value,opciones:S}}).filter(Boolean);t&&t({preguntas:T});const u=z>0?`Se insertaron ${T.length} pregunta(s). Se convirtieron ${z} respuesta(s) correcta(s) al formato 0–3 (desde 1–4 o A–D).`:`Se insertaron ${T.length} pregunta(s) en el formulario.`;await A.fire({icon:"success",title:"Plantilla importada",text:u,timer:2600,showConfirmButton:!1})}catch(r){console.error(r),await A.fire({icon:"error",title:"Error al procesar el Excel",text:"Verifica que el archivo coincida con la plantilla y vuelva a intentarlo."})}},k=async n=>{const r=n.target.files?.[0];if(r){if(!/\.xlsx?$/.test(r.name.toLowerCase())){await A.fire({icon:"warning",title:"Formato no soportado",text:"Selecciona un archivo .xlsx o .xls"}),n.target.value="";return}await h(r),n.target.value=""}};return e.jsxs(e.Fragment,{children:[e.jsx("input",{ref:o,type:"file",accept:".xlsx,.xls",style:{display:"none"},onChange:k}),e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-4 w-100 gap-3",children:[e.jsxs("button",{type:"button",onClick:p,className:"btn d-flex align-items-center justify-content-center flex-grow-1",style:{backgroundColor:"#28a745",color:"#fff",border:"none",borderRadius:"12px",padding:"16px 24px",fontSize:"1rem",fontWeight:"600",gap:"12px",boxShadow:"0 4px 15px rgba(40, 167, 69, 0.3)",transition:"all 0.3s cubic-bezier(0.4, 0, 0.2, 1)",minHeight:"56px",position:"relative",overflow:"hidden"},onMouseEnter:n=>{n.currentTarget.style.backgroundColor="#218838",n.currentTarget.style.transform="translateY(-2px)",n.currentTarget.style.boxShadow="0 8px 25px rgba(40, 167, 69, 0.4)"},onMouseLeave:n=>{n.currentTarget.style.backgroundColor="#28a745",n.currentTarget.style.transform="translateY(0)",n.currentTarget.style.boxShadow="0 4px 15px rgba(40, 167, 69, 0.3)"},title:"Cargar plantilla Excel",children:[e.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",width:"24px",height:"24px",backgroundColor:"rgba(255, 255, 255, 0.2)",borderRadius:"6px",padding:"4px"},children:e.jsx("i",{className:"fas fa-file-excel",style:{fontSize:"14px"}})}),e.jsx("span",{children:"Importar Plantilla Excel"})]}),e.jsxs("button",{type:"button",onClick:c,className:"btn d-flex align-items-center justify-content-center",style:{backgroundColor:"#0d6efd",color:"#fff",border:"none",borderRadius:"12px",padding:"16px 24px",fontSize:"1rem",fontWeight:"600",gap:"12px",boxShadow:"0 4px 15px rgba(13, 110, 253, 0.3)",transition:"all 0.3s cubic-bezier(0.4, 0, 0.2, 1)",minHeight:"56px",position:"relative",overflow:"hidden",minWidth:"200px"},onMouseEnter:n=>{n.currentTarget.style.backgroundColor="#0b5ed7",n.currentTarget.style.transform="translateY(-2px)",n.currentTarget.style.boxShadow="0 8px 25px rgba(13, 110, 253, 0.4)"},onMouseLeave:n=>{n.currentTarget.style.backgroundColor="#0d6efd",n.currentTarget.style.transform="translateY(0)",n.currentTarget.style.boxShadow="0 4px 15px rgba(13, 110, 253, 0.3)"},title:"Descargar plantilla Excel",children:[e.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",width:"24px",height:"24px",backgroundColor:"rgba(255, 255, 255, 0.2)",borderRadius:"6px",padding:"4px"},children:e.jsx("i",{className:"fas fa-download",style:{fontSize:"14px"}})}),e.jsx("span",{children:"Descargar Plantilla"})]})]})]})},De=()=>{const[t,o]=v.useState(""),[,p]=v.useState({}),[c,x]=v.useState(!0),{usuario:m,loading:i,isAuthenticated:y}=Ae(),{programas:h,loading:k,obtenerProgramaPorId:n,obtenerPuntajeMaximo:r}=ke(m?.programa_id),{preguntas:s,setPreguntas:a,agregarPregunta:g,eliminarPregunta:R,actualizarPregunta:z,actualizarPeso:T,actualizarOrientacion:N,actualizarOpcion:u,agregarOpcion:d,eliminarOpcion:l,manejarImagenPregunta:f,manejarImagenOpcion:j,eliminarImagenOpcion:C,handleDragOver:S,handleDrop:_,calcularPuntajeTotal:I,tieneImagenes:M,inicializar:H}=Re(),{loading:D,submitForm:L}=ze(),{register:E,handleSubmit:J,formState:{errors:me},setValue:ne,watch:ue,control:ge}=Ne({mode:"onChange",defaultValues:{titulo:"",programaId:"",tiempoHoras:0,tiempoMinutos:40,tiempoSegundos:0}}),Q=I(),pe=n(t),q=r(t);v.useEffect(()=>{y&&s.length===0&&H()},[y,s.length,H]),v.useEffect(()=>{if(!m?.programa_id)return;const b=String(m.programa_id);o(b),ne("programaId",b)},[m?.programa_id,ne]);const Z=ue("programaId");v.useEffect(()=>{Z!==void 0&&o(Z||"")},[Z]);const se=J(async b=>{await L(b.titulo,b.descripcion,b.programaId,s,Q,q,M(),p,b.tiempoHoras,b.tiempoMinutos,b.tiempoSegundos)}),fe=()=>{x(b=>!b)},xe=async b=>{try{const P=async(O,B)=>{try{if(!O||typeof O!="string"||!(O.startsWith("http://")||O.startsWith("https://")||O.startsWith("data:")))return null;const Y=$=>{try{const K=new URL($),W=K.hostname.toLowerCase();if(W==="imgur.com"||W.endsWith(".imgur.com")){const ie=K.pathname.replace(/^\//,"").split(/[.#?]/)[0];return ie?[".jpg",".png",".jpeg",".webp"].map(ye=>`https://i.imgur.com/${ie}${ye}`):[$]}return[$]}catch{return[$]}},ee=O.startsWith("data:")?[O]:Y(O);let G=null;for(const $ of ee)try{if(G=await fetch($,{mode:$.startsWith("data:")?"no-cors":"cors"}),G&&G.ok){O=$;break}}catch{}if(!G||!G.ok)return null;const U=await G.blob(),oe=B&&typeof B=="string"&&B.trim()!==""?B:"imagen_"+Date.now(),he=($,K)=>{const W=$.toLowerCase();return W.endsWith(".png")?"image/png":W.endsWith(".jpg")||W.endsWith(".jpeg")?"image/jpeg":W.endsWith(".webp")?"image/webp":W.endsWith(".gif")?"image/gif":K},be=U.type&&U.type.startsWith("image/")?U.type:he(oe||String(O),"image/jpeg");return new File([U],oe,{type:be})}catch{return null}},w=b?.preguntas||[],F=await Promise.all(w.map(async O=>{const B=await P(O.imagen_pregunta,O.imagen_pregunta_nombre),X=await Promise.all((O.opciones||[]).map(async(Y,ee)=>({texto:Y.texto??"",imagen:await P(Y.imagen_opcion,`opcion_${ee+1}.png`)})));return{texto:O.texto??"",opciones:X,correcta:Number.isFinite(O.correcta)?Math.min(Math.max(Math.trunc(O.correcta),0),Math.max(0,X.length-1)):null,peso:Number.isFinite(O.peso)?O.peso:0,imagen:B,orientacion:1}}));if(F.length===0){await A.fire({icon:"warning",title:"Archivo sin preguntas",text:"No se encontraron preguntas válidas en la plantilla."});return}a(F),await A.fire({icon:"success",title:"Importación completa",text:`Se importaron ${F.length} pregunta(s).`,timer:1800,showConfirmButton:!1})}catch{await A.fire({icon:"error",title:"Error al importar",text:"No se pudieron importar las preguntas. Verifica la plantilla."})}};return i||k||D?e.jsx(le,{children:e.jsx("div",{className:"container-fluid py-3",style:{backgroundColor:"#f8f9fa",minHeight:"100vh"},children:e.jsx("div",{className:"row justify-content-center",children:e.jsx("div",{className:"col-12 col-xl-10",children:e.jsx("div",{className:"d-flex align-items-center justify-content-center",style:{minHeight:"70vh"},children:e.jsx("div",{className:"text-center",children:e.jsx("h2",{style:{color:"#0f172a",fontSize:"1.5rem",marginBottom:"1rem"},children:"Cargando..."})})})})})})}):e.jsx(le,{children:e.jsx("div",{className:"container-fluid py-3",style:{backgroundColor:"#f8f9fa",minHeight:"100vh"},children:e.jsx("div",{className:"row justify-content-center",children:e.jsxs("div",{className:"col-12 col-xl-10",children:[e.jsx(Se,{}),e.jsx(_e,{onImport:xe}),e.jsxs("form",{onSubmit:b=>{b.preventDefault(),se()},encType:"multipart/form-data",children:[e.jsx("div",{className:"card border-0 shadow-sm mb-4",children:e.jsxs("div",{className:"card-body p-4",children:[e.jsx("h3",{className:"mb-3",style:{color:"#2c3e50",fontSize:"1.4rem"},children:"Información básica"}),e.jsx(Pe,{programas:h,register:E,control:ge,errors:me,puntajeMaximo:q,programaDisabled:!!m?.programa_id})]})}),e.jsx(Ee,{puntajeTotal:Q,puntajeMaximo:q,programaSeleccionado:pe,mostrarDetallePuntaje:c,onToggleDetalle:fe,onCerrarDetalle:()=>x(!1)}),e.jsx("div",{className:"card border-0 shadow-sm",children:e.jsxs("div",{className:"card-body p-4",children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-3",children:[e.jsx("h3",{className:"mb-0",style:{color:"#2c3e50",fontSize:"1.4rem"},children:"Preguntas *"}),e.jsxs("small",{className:"text-muted",children:[s.length," ",s.length===1?"pregunta":"preguntas"]})]}),s.map((b,P)=>e.jsx(Oe,{pregunta:b,preguntaIndex:P,allCollapsed:!0,onEliminarPregunta:()=>R(P),onActualizarPregunta:(w,F)=>z(P,w,F),onActualizarPeso:w=>T(P,w),onActualizarOrientacion:w=>N(P,w),onActualizarOpcion:(w,F)=>u(P,w,F),onAgregarOpcion:()=>d(P),onEliminarOpcion:w=>l(P,w),onImagenPreguntaChange:w=>f(P,w),onEliminarImagenPregunta:()=>z(P,"imagen",null),onImagenOpcionChange:(w,F)=>j(P,w,F),onEliminarImagenOpcion:w=>C(P,w),onDragOver:S,onDropPregunta:w=>_(w,"pregunta",P),onDropOpcion:(w,F)=>_(w,"opcion",P,F)},P)),e.jsxs("button",{type:"button",onClick:g,className:"btn btn-outline-secondary w-100 py-3",style:{borderColor:"#00a19B",color:"#00a19B",fontWeight:"500",fontSize:"1rem",transition:"all 0.3s ease",boxShadow:"0 2px 4px rgba(0,0,0,0.03)"},onMouseOver:b=>{b.currentTarget.style.backgroundColor="#00a19B",b.currentTarget.style.color="white",b.currentTarget.style.transform="translateY(-2px)",b.currentTarget.style.boxShadow="0 8px 30px rgba(0,0,0,0.06)"},onMouseOut:b=>{b.currentTarget.style.backgroundColor="transparent",b.currentTarget.style.color="#00a19B",b.currentTarget.style.transform="translateY(0)",b.currentTarget.style.boxShadow="0 2px 4px rgba(0,0,0,0.03)"},children:[e.jsx("i",{className:"fas fa-plus me-2"})," Agregar Nueva Pregunta"]})]})}),e.jsx(Te,{puntajeTotal:Q,puntajeMaximo:q,onSubmit:()=>se()})]})]})})})})};export{De as default};
