const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-D_5yPiNa.js","assets/index-DOfXxLhv.css"])))=>i.map(i=>d[i]);
import{g as K,f as V,a as H,r as d,j as e,b as w,A as N,S as G,_ as X}from"./index-D_5yPiNa.js";import{P as L}from"./PageTransition-DiW9MPnf.js";import{f as O,j as D,n as W,x as Q,A as Y,B as Z,i as P,C as J,D as q,t as U,b as ee,s as oe}from"./index-BCRNc57j.js";import"./iconBase-DP8UkxFN.js";var ae=V();const re=K(ae),se=({cuestionario:s})=>{const g=H(),[m,l]=d.useState(!1),[c,b]=d.useState(!1),h=d.useRef(null),x=d.useRef(null),n=()=>l(!0),t=()=>l(!1),p=async()=>{try{b(!0),await w.post(N.estudiante.refresh)}catch(u){console.warn("[CuestionarioEstudianteCard] refresh token falló, continuando de todas formas",u)}finally{b(!1),l(!1),g(`/realizar-cuestionario/${s.cuestionario_id}`)}};return d.useEffect(()=>{if(!m)return;const u=y=>{y.key==="Escape"&&(y.preventDefault(),t()),y.key==="Enter"&&(y.preventDefault(),h.current?.click())},f=window.setTimeout(()=>h.current?.focus(),0);return document.addEventListener("keydown",u),document.body.style.overflow="hidden",()=>{window.clearTimeout(f),document.removeEventListener("keydown",u),document.body.style.overflow=""}},[m]),e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"border-bottom bg-white",children:e.jsx("div",{className:"p-3",children:e.jsxs("div",{className:"d-flex align-items-center justify-content-between gap-3 w-100 h-100 quizRowResponsive",children:[e.jsxs("div",{className:"flex-grow-1 d-flex flex-column gap-1",children:[e.jsx("div",{className:"d-flex align-items-center justify-content-between gap-2 mb-1",children:e.jsx("h4",{className:"mb-0 text-dark fw-semibold h6",children:s.titulo})}),e.jsx("div",{className:"d-flex gap-4 flex-wrap",children:e.jsxs("div",{className:"d-flex flex-column gap-1",style:{minWidth:"160px"},children:[e.jsxs("div",{className:"d-flex align-items-center gap-2 text-dark small",children:[e.jsx(O,{style:{color:"#64748b",width:"16px",textAlign:"center"}}),e.jsx("strong",{children:"Programa:"})," ",s.programa_nombre?s.programa_nombre:"No disponible"]}),e.jsxs("div",{className:"d-flex align-items-center gap-2 text-dark small",children:[e.jsx(D,{style:{color:"#64748b",width:"16px",textAlign:"center"}}),e.jsx("strong",{children:"Fechas:"})," ",s.fecha_inicio," - ",s.fecha_fin]})]})})]}),e.jsxs("div",{className:"d-flex flex-column align-items-end justify-content-center quizRowRight",style:{minWidth:"120px",flexShrink:0,gap:"16px"},children:[e.jsxs("div",{className:"d-flex align-items-center gap-2 text-dark small",style:{width:"100%",textAlign:"center",paddingRight:0},children:[e.jsx(D,{style:{color:"#64748b",width:"14px",textAlign:"center",flexShrink:0}}),e.jsx("strong",{children:"Periodo:"})," ",s.periodo_nombre]}),s.estado==="disponible"&&e.jsxs("button",{className:"btn btn-outline-secondary btn-sm d-inline-flex align-items-center gap-2 fw-semibold",onClick:n,children:["Ir al cuestionario ",e.jsx(W,{})]}),s.estado==="completado"&&e.jsxs("button",{className:"btn btn-outline-secondary btn-sm d-inline-flex align-items-center gap-2 fw-semibold",onClick:()=>g(`/resultado/${s.cuestionario_id}`),children:["Ver resultado ",e.jsx(W,{})]})]})]})})}),m&&re.createPortal(e.jsx("div",{className:"modalOverlay",onClick:t,"aria-hidden":!m,children:e.jsxs("div",{ref:x,className:"modalContent",role:"dialog","aria-modal":"true","aria-labelledby":`modal-title-${s.cuestionario_id}`,onClick:u=>u.stopPropagation(),children:[e.jsxs("div",{className:"modalHeader",children:[e.jsxs("h3",{id:`modal-title-${s.cuestionario_id}`,className:"d-flex align-items-center gap-2",children:[e.jsx(Q,{})," ",s.titulo]}),e.jsx("button",{className:"modalCloseButton","aria-label":"Cerrar",onClick:t,children:"✕"})]}),e.jsxs("div",{className:"modalBody",children:[e.jsx("p",{className:"modalDescription",children:s.descripcion||"Sin descripción"}),e.jsxs("div",{className:"modalInfo",children:[e.jsxs("div",{className:"modalInfoRow",children:[e.jsx(O,{}),e.jsxs("span",{children:[e.jsx("strong",{children:"Programa:"})," ",s.programa_nombre?s.programa_nombre:"No disponible"]})]}),e.jsxs("div",{className:"modalInfoRow",children:[e.jsx(D,{}),e.jsxs("span",{children:[e.jsx("strong",{children:"Periodo:"})," ",s.periodo_nombre]})]}),e.jsxs("div",{className:"modalInfoRow",children:[e.jsx(Y,{}),e.jsxs("span",{children:[e.jsx("strong",{children:"Fechas:"})," ",s.fecha_inicio," - ",s.fecha_fin]})]})]})]}),e.jsxs("div",{className:"modalActions",children:[e.jsxs("button",{ref:h,type:"button",className:"modalConfirmButton",onClick:p,disabled:c,children:[e.jsx(Z,{})," ",c?"Preparando…":"Realizarlo"]}),e.jsx("button",{type:"button",className:"modalCancelButton",onClick:t,children:"Cancelar"})]})]})}),document.body)]})},F=[{key:"disponibles",label:"Disponibles",icon:P},{key:"completados",label:"Completados",icon:J},{key:"programados",label:"Programados",icon:q},{key:"expirados",label:"Expirados",icon:U}],ne=({activeTab:s,onTabChange:g,counts:m})=>{const[l,c]=d.useState(!1),b=d.useRef(null),h=F.find(n=>n.key===s)||F[0],x=h?.icon??P;return d.useEffect(()=>{if(!l)return;const n=f=>{const y=f;b.current&&y&&!b.current.contains(y)&&c(!1)},t=f=>n(f.target),p=f=>n(f.target),u=f=>{f.key==="Escape"&&c(!1)};return document.addEventListener("mousedown",t),document.addEventListener("touchstart",p,{passive:!0}),document.addEventListener("keydown",u),()=>{document.removeEventListener("mousedown",t),document.removeEventListener("touchstart",p),document.removeEventListener("keydown",u)}},[l]),e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"d-block d-sm-none",children:e.jsxs("div",{className:"mobileDropdown",ref:b,children:[e.jsxs("button",{type:"button",className:"dropdownToggleCustom",onClick:()=>c(n=>!n),"aria-haspopup":"listbox","aria-expanded":l,children:[e.jsxs("span",{className:"d-flex align-items-center gap-2",children:[e.jsx(x,{size:16}),e.jsx("strong",{children:h?.label})]}),e.jsx("span",{className:"chevron",children:"▾"})]}),l&&e.jsx("ul",{className:"dropdownMenuCustom",role:"listbox",children:F.map(n=>{const t=n.icon,p=n.key===s;return e.jsx("li",{children:e.jsxs("button",{type:"button",className:`dropdownItemCustom ${p?"active":""}`,onClick:()=>{g(n.key),c(!1)},role:"option","aria-selected":p,children:[e.jsxs("span",{className:"d-flex align-items-center gap-2",children:[e.jsx(t,{size:16}),n.label]}),e.jsx("span",{className:"badgeCount",children:m[n.key]})]})},n.key)})})]})}),e.jsx("ul",{className:"nav nav-pills nav-fill gap-2 p-0 d-none d-sm-flex",style:{overflowX:"auto"},children:F.map(n=>{const t=s===n.key,p=n.icon,u="nav-link d-flex align-items-center justify-content-between rounded-3 px-3 py-2",f={backgroundColor:"#00a19B",border:"1px solid #00c7bf",color:"#ffffff"},y={backgroundColor:"#f1f5f9",border:"1px solid #e2e8f0",color:"#000000"};return e.jsx("li",{className:"nav-item",style:{minWidth:"160px"},children:e.jsxs("button",{className:`${u} ${t?"active":""}`,style:t?f:y,onClick:()=>g(n.key),children:[e.jsxs("span",{className:"d-flex align-items-center gap-2 text-capitalize",style:{fontSize:"0.9rem"},children:[e.jsx(p,{size:14}),n.label]}),e.jsx("span",{className:"badge bg-white text-dark rounded-pill",style:{backgroundColor:"#ffffff",border:"1px solid rgba(0,0,0,0.1)",minWidth:"28px",display:"inline-flex",alignItems:"center",justifyContent:"center",fontWeight:700},children:m[n.key]})]})},n.key)})})]})},$={disponibles:{icon:P,titulo:"No hay cuestionarios disponibles",mensaje:"No tienes cuestionarios pendientes en este momento.",color:"#22c55e"},completados:{icon:J,titulo:"No hay cuestionarios completados",mensaje:"Aún no has completado ningún cuestionario.",color:"#0ea5e9"},programados:{icon:D,titulo:"No hay cuestionarios programados",mensaje:"No tienes cuestionarios programados por ahora.",color:"#ff7f1d"},expirados:{icon:U,titulo:"No hay cuestionarios expirados",mensaje:"No tienes cuestionarios expirados.",color:"#ef4444"},cerrados:{icon:ee,titulo:"No hay cuestionarios cerrados",mensaje:"No tienes cuestionarios cerrados.",color:"#ff7f1d"}},te=({tipo:s})=>{const g=$[s]||$.disponibles,m=g.icon;return e.jsxs("div",{className:"text-center p-5 bg-white rounded shadow-sm",style:{color:"#ff7f1d",animation:"fadeIn 0.6s ease"},children:[e.jsx("div",{className:"mb-3",style:{fontSize:"4rem",marginBottom:"1rem",opacity:.85,animation:"pulse 2s infinite",color:"#ff7f1d"},children:e.jsx(m,{size:64,color:"#ff7f1d"})}),e.jsx("div",{className:"fw-semibold mb-2",style:{fontSize:"1.5rem",marginBottom:"0.5rem",color:"#0f172a"},children:g.titulo}),e.jsx("div",{style:{fontSize:"1rem",lineHeight:"1.5",maxWidth:"400px",margin:"0 auto"},children:g.mensaje})]})},M=async()=>{await w.post(N.estudiante.logout);try{localStorage.clear(),sessionStorage.clear()}catch{}};function ie(){const[s,g]=d.useState(!1),[m,l]=d.useState("Invitado"),c=d.useRef(""),b=d.useRef(!1),h=d.useRef(!1),[x,n]=d.useState({disponibles:[],completados:[],programados:[],expirados:[],cerrados:[]}),[t,p]=d.useState("disponibles");d.useEffect(()=>{b.current||(b.current=!0,u())},[]);const u=async()=>{try{const S=localStorage.getItem("token"),r=(await w.post(N.estudiante.verify,{token:S}))?.data,I=localStorage.getItem("user");let C={};try{C=I?JSON.parse(I):{}}catch{}const R=r?.nombres??r?.user?.nombres??r?.data?.nombres??r?.data?.user?.nombres??r?.estudiante?.nombres??r?.data?.estudiante?.nombres??C?.nombres,B=r?.apellidos??r?.user?.apellidos??r?.data?.apellidos??r?.data?.user?.apellidos??r?.estudiante?.apellidos??r?.data?.estudiante?.apellidos??C?.apellidos,A=[R,B].filter(Boolean).join(" ").trim()||r?.nombre||r?.user?.nombre||r?.data?.nombre||r?.data?.user?.nombre||r?.estudiante?.nombre||r?.data?.estudiante?.nombre||r?.nombre_completo||r?.user?.nombre_completo||C?.nombre||(typeof r=="string"?r:void 0)||"Invitado";console.log("[verify] response:",r),console.log("[verify] nombre:",A),l(A);const E=r?.programa_id??r?.data?.programa_id??r?.estudiante?.programa_id??r?.user?.programa_id??r?.data?.user?.programa_id??(()=>{try{return JSON.parse(localStorage.getItem("user")||"{}")?.programa_id}catch{return}})();if(E)try{const v=(await w.get(N.programas.byId(E)))?.data,j=v?.data?.programa?.nombre??v?.programa?.nombre??v?.nombre??v?.programa_nombre??v?.data?.nombre??v?.data?.programa_nombre??"";j&&(c.current=String(j),console.log("[verify] programa_nombre:",c.current))}catch(_){console.warn("[verify] no se pudo obtener programa por id:",_)}}catch(S){console.error("Error al verificar sesión:",S);try{const i=JSON.parse(localStorage.getItem("user")||"{}"),r=[i?.nombres,i?.apellidos].filter(Boolean).join(" ").trim()||i?.nombre;l(r||"Invitado"),i?.programa_nombre&&(c.current=String(i.programa_nombre))}catch{l("Invitado")}}f()},f=async()=>{if(h.current){console.log("[cargarCuestionarios] ya hay una carga en curso, se omite");return}h.current=!0,g(!0);try{const i=(await w.get(N.estudiante.cuestionarioDisponibles))?.data;console.log("[disponibles] raw:",i);const r=Array.isArray(i?.cuestionarios)?i.cuestionarios:Array.isArray(i?.data?.cuestionarios)?i.data.cuestionarios:Array.isArray(i?.disponibles)?i.disponibles:Array.isArray(i?.data?.disponibles)?i.data.disponibles:Array.isArray(i)?i:[];console.log("[disponibles] parsed length:",r.length);const I=r.map(a=>({cuestionario_id:a?.cuestionario_id??a?.id??a?.cuestionarioId??0,titulo:a?.titulo??a?.nombre??a?.title??"Sin título",descripcion:a?.descripcion??a?.description??"",creador_nombre:a?.creador_nombre??a?.docente_nombre??a?.autor??a?.d_nombre??"",programa_nombre:a?.programa_nombre??a?.programa??a?.programa_estudiante??a?.programaAsignado??a?.nombre_programa??c.current??"",periodo_nombre:a?.periodo_nombre??a?.periodo??a?.periodo_nombre_corto??a?.periodoNombre??"",fecha_inicio:a?.fecha_inicio??a?.inicio??a?.fechaInicio??a?.apertura_inicio??a?.inicio_apertura??a?.fecha_apertura??a?.fechaApertura??a?.fecha_inicio_periodo??a?.start_date??"",fecha_fin:a?.fecha_fin??a?.fin??a?.fechaFin??a?.apertura_fin??a?.fin_apertura??a?.fecha_cierre??a?.fechaCierre??a?.fecha_fin_periodo??a?.end_date??"",activo:a?.activo??1,asignacion_id:a?.asignacion_id??a?.asignacionId??0,estado:a?.estado??"disponible"}));let C=[],R=[],B=[];try{const[a,A,E]=await Promise.all([w.get(N.estudiante.cuestionarioCompletados).catch(()=>null),w.get(N.estudiante.cuestionarioProgramados).catch(()=>null),w.get(N.estudiante.cuestionarioExpirados).catch(()=>null)]),_=a?.data;a?console.log("[completados] raw:",_):console.warn("[completados] respuesta nula/errónea");const v=Array.isArray(_?.cuestionarios_completados)?_.cuestionarios_completados:Array.isArray(_?.data?.cuestionarios_completados)?_.data.cuestionarios_completados:Array.isArray(_)?_:[];console.log("[completados] parsed length:",v.length),C=v.map(o=>({cuestionario_id:o?.cuestionario_id??o?.id??0,titulo:o?.titulo??o?.nombre??"Sin título",descripcion:o?.descripcion??"",creador_nombre:o?.creador_nombre??o?.docente_nombre??o?.autor??"",programa_nombre:o?.programa_nombre??o?.programa??o?.programa_estudiante??o?.programaAsignado??o?.nombre_programa??c.current??"",periodo_nombre:o?.periodo??o?.periodo_nombre??"",fecha_inicio:o?.fecha_inicio??o?.inicio??o?.fechaInicio??"",fecha_fin:o?.fecha_fin??o?.fin??o?.fechaFin??"",activo:o?.activo??0,asignacion_id:o?.asignacion_id??0,estado:"completado"}));const j=A?.data;A?console.log("[programados] raw:",j):console.warn("[programados] respuesta nula/errónea");const T=Array.isArray(j?.cuestionarios_programados)?j.cuestionarios_programados:Array.isArray(j?.data?.cuestionarios_programados)?j.data.cuestionarios_programados:Array.isArray(j)?j:[];console.log("[programados] parsed length:",T.length),R=T.map(o=>({cuestionario_id:o?.cuestionario_id??o?.id??0,titulo:o?.titulo??o?.nombre??"Sin título",descripcion:o?.descripcion??"",creador_nombre:o?.creador_nombre??o?.docente_nombre??o?.autor??"",programa_nombre:o?.programa_nombre??o?.programa??o?.programa_estudiante??o?.programaAsignado??o?.nombre_programa??c.current??"",periodo_nombre:o?.periodo??o?.periodo_nombre??"",fecha_inicio:o?.fecha_inicio??o?.inicio??o?.fechaInicio??"",fecha_fin:o?.fecha_fin??o?.fin??o?.fechaFin??"",activo:o?.activo??1,asignacion_id:o?.asignacion_id??0,estado:"programado"}));const k=E?.data;E?console.log("[expirados] raw:",k):console.warn("[expirados] respuesta nula/errónea");const z=Array.isArray(k?.cuestionarios_expirados)?k.cuestionarios_expirados:Array.isArray(k?.data?.cuestionarios_expirados)?k.data.cuestionarios_expirados:Array.isArray(k)?k:[];console.log("[expirados] parsed length:",z.length),B=z.map(o=>({cuestionario_id:o?.cuestionario_id??o?.id??0,titulo:o?.titulo??o?.nombre??"Sin título",descripcion:o?.descripcion??"",creador_nombre:o?.creador_nombre??o?.docente_nombre??o?.autor??"",programa_nombre:o?.programa_nombre??o?.programa??o?.programa_estudiante??o?.programaAsignado??o?.nombre_programa??c.current??"",periodo_nombre:o?.periodo??o?.periodo_nombre??"",fecha_inicio:o?.fecha_inicio??o?.inicio??o?.fechaInicio??"",fecha_fin:o?.fecha_fin??o?.fin??o?.fechaFin??"",activo:o?.activo??0,asignacion_id:o?.asignacion_id??0,estado:"expirado"}))}catch(a){console.warn("[cargarCuestionarios] error en cargas secundarias:",a)}n({disponibles:I,completados:C,programados:R,expirados:B,cerrados:[]});return}catch(S){const i=S?.response?.status;if(i===401||i===403){const r=localStorage.getItem("rol");if(localStorage.removeItem("token"),localStorage.removeItem("user"),localStorage.removeItem("rol"),r==="2"){try{await G.fire({icon:"warning",title:"Sesión iniciada en otro dispositivo",text:"Tu sesión de estudiante fue cerrada aquí porque se inició en otro dispositivo o pestaña.",confirmButtonText:"Entendido"})}catch{}window.location.href="/login-estudiante";return}}n({disponibles:[],completados:[],programados:[],expirados:[],cerrados:[]})}finally{g(!1),h.current=!1}},y={disponibles:x.disponibles.length,completados:x.completados.length,programados:x.programados.length,expirados:x.expirados.length,cerrados:x.cerrados.length};return{isLoading:s,estudianteNombre:m,cuestionarios:x,activeTab:t,setActiveTab:p,counts:y}}const pe=()=>{const{isLoading:s,estudianteNombre:g,cuestionarios:m,activeTab:l,setActiveTab:c,counts:b}=ie(),h=H(),x=async()=>{try{const t=(await X(async()=>{const{default:u}=await import("./index-D_5yPiNa.js").then(f=>f.s);return{default:u}},__vite__mapDeps([0,1]))).default;if((await t.fire({title:"¿Cerrar sesión?",text:"Se cerrará tu sesión actual.",icon:"warning",showCancelButton:!0,confirmButtonText:"Sí, cerrar sesión",cancelButtonText:"Cancelar",reverseButtons:!0,confirmButtonColor:"#d33",cancelButtonColor:"#3085d6"})).isConfirmed){await M();try{localStorage.clear(),sessionStorage.clear()}catch{}await t.fire({title:"Sesión cerrada",text:"Has salido correctamente.",icon:"success",timer:1500,showConfirmButton:!1}),h("/login-estudiante",{replace:!0})}}catch{if(window.confirm("¿Deseas cerrar sesión?")){M();try{localStorage.clear(),sessionStorage.clear()}catch{}h("/login-estudiante",{replace:!0})}}},n=()=>{if(s)return e.jsxs("div",{className:"d-flex flex-column align-items-center justify-content-center p-5",children:[e.jsx("div",{className:"spinner-border text-primary mb-3",role:"status","aria-live":"polite","aria-busy":"true",children:e.jsx("span",{className:"visually-hidden",children:"Cargando..."})}),e.jsx("p",{className:"text-muted mb-0",children:"Cargando cuestionarios..."})]});const t=m[l]||[];return t.length===0?e.jsx(te,{tipo:l}):e.jsx("div",{className:"d-flex flex-column gap-3 w-100",children:t.map(p=>e.jsx(se,{cuestionario:p},p.cuestionario_id))})};return s&&m.disponibles.length===0&&m.completados.length===0?e.jsx(L,{children:e.jsx("div",{className:"min-vh-100 d-flex align-items-center justify-content-center bg-light-subtle",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"spinner-border text-primary mb-3",role:"status","aria-live":"polite","aria-busy":"true",children:e.jsx("span",{className:"visually-hidden",children:"Cargando..."})}),e.jsx("p",{className:"text-muted mb-0",children:"Cargando..."})]})})}):e.jsx(L,{children:e.jsx("div",{className:"container-fluid py-3 bg-light",style:{minHeight:"100vh"},children:e.jsx("div",{className:"row justify-content-center",children:e.jsxs("div",{className:"col-12 col-xl-10",children:[e.jsx("div",{className:"card border-0 mb-4 shadow-sm rounded-3",style:{background:"linear-gradient(135deg, #00a19b 0%, #008f89 100%)"},children:e.jsx("div",{className:"card-body text-white",children:e.jsxs("div",{className:"d-flex flex-column flex-md-row justify-content-between align-items-start align-items-md-center gap-3",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"mb-1 fw-bold dashboardTitle",style:{color:"#ffffff"},children:"Dashboard de Estudiante"}),e.jsxs("p",{className:"mb-0 opacity-75 dashboardEstudiante",children:["Bienvenido/a, ",g||"Cargando..."]})]}),e.jsxs("button",{onClick:x,className:"btn d-flex align-items-center gap-2 logoutButtonResponsive",style:{backgroundColor:"#ff7f1d",borderColor:"#ff7f1d",color:"#ffffff"},children:[e.jsx(oe,{}),"Cerrar Sesión"]})]})})}),e.jsxs("div",{className:"mb-0",children:[e.jsx("div",{className:"mb-3 tabsWrapper",children:e.jsx(ne,{activeTab:l,onTabChange:t=>c(t),counts:b})}),n()]})]})})})})};export{pe as default};
