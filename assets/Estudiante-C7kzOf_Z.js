const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-W0ZSjH-A.js","assets/index-DOfXxLhv.css"])))=>i.map(i=>d[i]);
import{a as W,r as d,j as e,b as v,A as N,S as J,_ as U}from"./index-W0ZSjH-A.js";import{P as D}from"./PageTransition-DHV3GPNa.js";import{f as L,j as F,n as z,A as K,B as V,C as G,i as T,D as $,E as X,u as H,b as Q,t as Y}from"./index-DfAB-zHd.js";import{R as Z}from"./index-DgPlSjkG.js";import"./iconBase-BFfBqceE.js";const q=({cuestionario:s})=>{const g=W(),[m,c]=d.useState(!1),[l,b]=d.useState(!1),h=d.useRef(null),x=d.useRef(null),n=()=>c(!0),t=()=>c(!1),u=async()=>{try{b(!0),await v.post(N.estudiante.refresh)}catch(p){console.warn("[CuestionarioEstudianteCard] refresh token falló, continuando de todas formas",p)}finally{b(!1),c(!1),g(`/realizar-cuestionario/${s.cuestionario_id}`)}};return d.useEffect(()=>{if(!m)return;const p=y=>{y.key==="Escape"&&(y.preventDefault(),t()),y.key==="Enter"&&(y.preventDefault(),h.current?.click())},f=window.setTimeout(()=>h.current?.focus(),0);return document.addEventListener("keydown",p),document.body.style.overflow="hidden",()=>{window.clearTimeout(f),document.removeEventListener("keydown",p),document.body.style.overflow=""}},[m]),e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"border-bottom bg-white",children:e.jsx("div",{className:"p-3",children:e.jsxs("div",{className:"d-flex align-items-center justify-content-between gap-3 w-100 h-100 quizRowResponsive",children:[e.jsxs("div",{className:"flex-grow-1 d-flex flex-column gap-1",children:[e.jsx("div",{className:"d-flex align-items-center justify-content-between gap-2 mb-1",children:e.jsx("h4",{className:"mb-0 text-dark fw-semibold h6",children:s.titulo})}),e.jsx("div",{className:"d-flex gap-4 flex-wrap",children:e.jsxs("div",{className:"d-flex flex-column gap-1",style:{minWidth:"160px"},children:[e.jsxs("div",{className:"d-flex align-items-center gap-2 text-dark small",children:[e.jsx(L,{style:{color:"#64748b",width:"16px",textAlign:"center"}}),e.jsx("strong",{children:"Programa:"})," ",s.programa_nombre?s.programa_nombre:"No disponible"]}),e.jsxs("div",{className:"d-flex align-items-center gap-2 text-dark small",children:[e.jsx(F,{style:{color:"#64748b",width:"16px",textAlign:"center"}}),e.jsx("strong",{children:"Fechas:"})," ",s.fecha_inicio," - ",s.fecha_fin]})]})})]}),e.jsxs("div",{className:"d-flex flex-column align-items-end justify-content-center quizRowRight",style:{minWidth:"120px",flexShrink:0,gap:"16px"},children:[e.jsxs("div",{className:"d-flex align-items-center gap-2 text-dark small",style:{width:"100%",textAlign:"center",paddingRight:0},children:[e.jsx(F,{style:{color:"#64748b",width:"14px",textAlign:"center",flexShrink:0}}),e.jsx("strong",{children:"Periodo:"})," ",s.periodo_nombre]}),s.estado==="disponible"&&e.jsxs("button",{className:"btn btn-outline-secondary btn-sm d-inline-flex align-items-center gap-2 fw-semibold",onClick:n,children:["Ir al cuestionario ",e.jsx(z,{})]}),s.estado==="completado"&&e.jsxs("button",{className:"btn btn-outline-secondary btn-sm d-inline-flex align-items-center gap-2 fw-semibold",onClick:()=>g(`/resultado/${s.cuestionario_id}`),children:["Ver resultado ",e.jsx(z,{})]})]})]})})}),m&&Z.createPortal(e.jsx("div",{className:"modalOverlay",onClick:t,"aria-hidden":!m,children:e.jsxs("div",{ref:x,className:"modalContent",role:"dialog","aria-modal":"true","aria-labelledby":`modal-title-${s.cuestionario_id}`,onClick:p=>p.stopPropagation(),children:[e.jsxs("div",{className:"modalHeader",children:[e.jsxs("h3",{id:`modal-title-${s.cuestionario_id}`,className:"d-flex align-items-center gap-2",children:[e.jsx(K,{})," ",s.titulo]}),e.jsx("button",{className:"modalCloseButton","aria-label":"Cerrar",onClick:t,children:"✕"})]}),e.jsxs("div",{className:"modalBody",children:[e.jsx("div",{className:"modalDescription",dangerouslySetInnerHTML:{__html:s.descripcion||"Sin descripción"}}),e.jsxs("div",{className:"modalInfo",children:[e.jsxs("div",{className:"modalInfoRow",children:[e.jsx(L,{}),e.jsxs("span",{children:[e.jsx("strong",{children:"Programa:"})," ",s.programa_nombre?s.programa_nombre:"No disponible"]})]}),e.jsxs("div",{className:"modalInfoRow",children:[e.jsx(F,{}),e.jsxs("span",{children:[e.jsx("strong",{children:"Periodo:"})," ",s.periodo_nombre]})]}),e.jsxs("div",{className:"modalInfoRow",children:[e.jsx(V,{}),e.jsxs("span",{children:[e.jsx("strong",{children:"Fechas:"})," ",s.fecha_inicio," - ",s.fecha_fin]})]})]})]}),e.jsxs("div",{className:"modalActions",children:[e.jsxs("button",{ref:h,type:"button",className:"modalConfirmButton",onClick:u,disabled:l,children:[e.jsx(G,{})," ",l?"Preparando…":"Realizarlo"]}),e.jsx("button",{type:"button",className:"modalCancelButton",onClick:t,children:"Cancelar"})]})]})}),document.body)]})},P=[{key:"disponibles",label:"Disponibles",icon:T},{key:"completados",label:"Completados",icon:$},{key:"programados",label:"Programados",icon:X},{key:"expirados",label:"Expirados",icon:H}],ee=({activeTab:s,onTabChange:g,counts:m})=>{const[c,l]=d.useState(!1),b=d.useRef(null),h=P.find(n=>n.key===s)||P[0],x=h?.icon??T;return d.useEffect(()=>{if(!c)return;const n=f=>{const y=f;b.current&&y&&!b.current.contains(y)&&l(!1)},t=f=>n(f.target),u=f=>n(f.target),p=f=>{f.key==="Escape"&&l(!1)};return document.addEventListener("mousedown",t),document.addEventListener("touchstart",u,{passive:!0}),document.addEventListener("keydown",p),()=>{document.removeEventListener("mousedown",t),document.removeEventListener("touchstart",u),document.removeEventListener("keydown",p)}},[c]),e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"d-block d-sm-none",children:e.jsxs("div",{className:"mobileDropdown",ref:b,children:[e.jsxs("button",{type:"button",className:"dropdownToggleCustom",onClick:()=>l(n=>!n),"aria-haspopup":"listbox","aria-expanded":c,children:[e.jsxs("span",{className:"d-flex align-items-center gap-2",children:[e.jsx(x,{size:16}),e.jsx("strong",{children:h?.label})]}),e.jsx("span",{className:"chevron",children:"▾"})]}),c&&e.jsx("ul",{className:"dropdownMenuCustom",role:"listbox",children:P.map(n=>{const t=n.icon,u=n.key===s;return e.jsx("li",{children:e.jsxs("button",{type:"button",className:`dropdownItemCustom ${u?"active":""}`,onClick:()=>{g(n.key),l(!1)},role:"option","aria-selected":u,children:[e.jsxs("span",{className:"d-flex align-items-center gap-2",children:[e.jsx(t,{size:16}),n.label]}),e.jsx("span",{className:"badgeCount",children:m[n.key]})]})},n.key)})})]})}),e.jsx("ul",{className:"nav nav-pills nav-fill gap-2 p-0 d-none d-sm-flex",style:{overflowX:"auto"},children:P.map(n=>{const t=s===n.key,u=n.icon,p="nav-link d-flex align-items-center justify-content-between rounded-3 px-3 py-2",f={backgroundColor:"#00a19B",border:"1px solid #00c7bf",color:"#ffffff"},y={backgroundColor:"#f1f5f9",border:"1px solid #e2e8f0",color:"#000000"};return e.jsx("li",{className:"nav-item",style:{minWidth:"160px"},children:e.jsxs("button",{className:`${p} ${t?"active":""}`,style:t?f:y,onClick:()=>g(n.key),children:[e.jsxs("span",{className:"d-flex align-items-center gap-2 text-capitalize",style:{fontSize:"0.9rem"},children:[e.jsx(u,{size:14}),n.label]}),e.jsx("span",{className:"badge bg-white text-dark rounded-pill",style:{backgroundColor:"#ffffff",border:"1px solid rgba(0,0,0,0.1)",minWidth:"28px",display:"inline-flex",alignItems:"center",justifyContent:"center",fontWeight:700},children:m[n.key]})]})},n.key)})})]})},O={disponibles:{icon:T,titulo:"No hay cuestionarios disponibles",mensaje:"No tienes cuestionarios pendientes en este momento.",color:"#22c55e"},completados:{icon:$,titulo:"No hay cuestionarios completados",mensaje:"Aún no has completado ningún cuestionario.",color:"#0ea5e9"},programados:{icon:F,titulo:"No hay cuestionarios programados",mensaje:"No tienes cuestionarios programados por ahora.",color:"#ff7f1d"},expirados:{icon:H,titulo:"No hay cuestionarios expirados",mensaje:"No tienes cuestionarios expirados.",color:"#ef4444"},cerrados:{icon:Q,titulo:"No hay cuestionarios cerrados",mensaje:"No tienes cuestionarios cerrados.",color:"#ff7f1d"}},ae=({tipo:s})=>{const g=O[s]||O.disponibles,m=g.icon;return e.jsxs("div",{className:"text-center p-5 bg-white rounded shadow-sm",style:{color:"#ff7f1d",animation:"fadeIn 0.6s ease"},children:[e.jsx("div",{className:"mb-3",style:{fontSize:"4rem",marginBottom:"1rem",opacity:.85,animation:"pulse 2s infinite",color:"#ff7f1d"},children:e.jsx(m,{size:64,color:"#ff7f1d"})}),e.jsx("div",{className:"fw-semibold mb-2",style:{fontSize:"1.5rem",marginBottom:"0.5rem",color:"#0f172a"},children:g.titulo}),e.jsx("div",{style:{fontSize:"1rem",lineHeight:"1.5",maxWidth:"400px",margin:"0 auto"},children:g.mensaje})]})},M=async()=>{await v.post(N.estudiante.logout);try{localStorage.clear(),sessionStorage.clear()}catch{}};function oe(){const[s,g]=d.useState(!1),[m,c]=d.useState("Invitado"),l=d.useRef(""),b=d.useRef(!1),h=d.useRef(!1),[x,n]=d.useState({disponibles:[],completados:[],programados:[],expirados:[],cerrados:[]}),[t,u]=d.useState("disponibles");d.useEffect(()=>{b.current||(b.current=!0,p())},[]);const p=async()=>{try{const k=localStorage.getItem("token"),r=(await v.post(N.estudiante.verify,{token:k}))?.data,E=localStorage.getItem("user");let w={};try{w=E?JSON.parse(E):{}}catch{}const I=r?.nombres??r?.user?.nombres??r?.data?.nombres??r?.data?.user?.nombres??r?.estudiante?.nombres??r?.data?.estudiante?.nombres??w?.nombres,R=r?.apellidos??r?.user?.apellidos??r?.data?.apellidos??r?.data?.user?.apellidos??r?.estudiante?.apellidos??r?.data?.estudiante?.apellidos??w?.apellidos,B=[I,R].filter(Boolean).join(" ").trim()||r?.nombre||r?.user?.nombre||r?.data?.nombre||r?.data?.user?.nombre||r?.estudiante?.nombre||r?.data?.estudiante?.nombre||r?.nombre_completo||r?.user?.nombre_completo||w?.nombre||(typeof r=="string"?r:void 0)||"Invitado";c(B);const A=r?.programa_id??r?.data?.programa_id??r?.estudiante?.programa_id??r?.user?.programa_id??r?.data?.user?.programa_id??(()=>{try{return JSON.parse(localStorage.getItem("user")||"{}")?.programa_id}catch{return}})();if(A)try{const C=(await v.get(N.programas.byId(A)))?.data,j=C?.data?.programa?.nombre??C?.programa?.nombre??C?.nombre??C?.programa_nombre??C?.data?.nombre??C?.data?.programa_nombre??"";j&&(l.current=String(j))}catch(_){console.warn("[verify] no se pudo obtener programa por id:",_)}}catch(k){console.error("Error al verificar sesión:",k);try{const i=JSON.parse(localStorage.getItem("user")||"{}"),r=[i?.nombres,i?.apellidos].filter(Boolean).join(" ").trim()||i?.nombre;c(r||"Invitado"),i?.programa_nombre&&(l.current=String(i.programa_nombre))}catch{c("Invitado")}}f()},f=async()=>{if(!h.current){h.current=!0,g(!0);try{const i=(await v.get(N.estudiante.cuestionarioDisponibles))?.data,E=(Array.isArray(i?.cuestionarios)?i.cuestionarios:Array.isArray(i?.data?.cuestionarios)?i.data.cuestionarios:Array.isArray(i?.disponibles)?i.disponibles:Array.isArray(i?.data?.disponibles)?i.data.disponibles:Array.isArray(i)?i:[]).map(o=>({cuestionario_id:o?.cuestionario_id??o?.id??o?.cuestionarioId??0,titulo:o?.titulo??o?.nombre??o?.title??"Sin título",descripcion:o?.descripcion??o?.description??"",creador_nombre:o?.creador_nombre??o?.docente_nombre??o?.autor??o?.d_nombre??"",programa_nombre:o?.programa_nombre??o?.programa??o?.programa_estudiante??o?.programaAsignado??o?.nombre_programa??l.current??"",periodo_nombre:o?.periodo_nombre??o?.periodo??o?.periodo_nombre_corto??o?.periodoNombre??"",fecha_inicio:o?.fecha_inicio??o?.inicio??o?.fechaInicio??o?.apertura_inicio??o?.inicio_apertura??o?.fecha_apertura??o?.fechaApertura??o?.fecha_inicio_periodo??o?.start_date??"",fecha_fin:o?.fecha_fin??o?.fin??o?.fechaFin??o?.apertura_fin??o?.fin_apertura??o?.fecha_cierre??o?.fechaCierre??o?.fecha_fin_periodo??o?.end_date??"",activo:o?.activo??1,asignacion_id:o?.asignacion_id??o?.asignacionId??0,estado:o?.estado??"disponible"}));let w=[],I=[],R=[];try{const[o,B,A]=await Promise.all([v.get(N.estudiante.cuestionarioCompletados).catch(()=>null),v.get(N.estudiante.cuestionarioProgramados).catch(()=>null),v.get(N.estudiante.cuestionarioExpirados).catch(()=>null)]),_=o?.data;o||console.warn("[completados] respuesta nula/errónea"),w=(Array.isArray(_?.cuestionarios_completados)?_.cuestionarios_completados:Array.isArray(_?.data?.cuestionarios_completados)?_.data.cuestionarios_completados:Array.isArray(_)?_:[]).map(a=>({cuestionario_id:a?.cuestionario_id??a?.id??0,titulo:a?.titulo??a?.nombre??"Sin título",descripcion:a?.descripcion??"",creador_nombre:a?.creador_nombre??a?.docente_nombre??a?.autor??"",programa_nombre:a?.programa_nombre??a?.programa??a?.programa_estudiante??a?.programaAsignado??a?.nombre_programa??l.current??"",periodo_nombre:a?.periodo??a?.periodo_nombre??"",fecha_inicio:a?.fecha_inicio??a?.inicio??a?.fechaInicio??"",fecha_fin:a?.fecha_fin??a?.fin??a?.fechaFin??"",activo:a?.activo??0,asignacion_id:a?.asignacion_id??0,estado:"completado"}));const j=B?.data;B||console.warn("[programados] respuesta nula/errónea"),I=(Array.isArray(j?.cuestionarios_programados)?j.cuestionarios_programados:Array.isArray(j?.data?.cuestionarios_programados)?j.data.cuestionarios_programados:Array.isArray(j)?j:[]).map(a=>({cuestionario_id:a?.cuestionario_id??a?.id??0,titulo:a?.titulo??a?.nombre??"Sin título",descripcion:a?.descripcion??"",creador_nombre:a?.creador_nombre??a?.docente_nombre??a?.autor??"",programa_nombre:a?.programa_nombre??a?.programa??a?.programa_estudiante??a?.programaAsignado??a?.nombre_programa??l.current??"",periodo_nombre:a?.periodo??a?.periodo_nombre??"",fecha_inicio:a?.fecha_inicio??a?.inicio??a?.fechaInicio??"",fecha_fin:a?.fecha_fin??a?.fin??a?.fechaFin??"",activo:a?.activo??1,asignacion_id:a?.asignacion_id??0,estado:"programado"}));const S=A?.data;A||console.warn("[expirados] respuesta nula/errónea"),R=(Array.isArray(S?.cuestionarios_expirados)?S.cuestionarios_expirados:Array.isArray(S?.data?.cuestionarios_expirados)?S.data.cuestionarios_expirados:Array.isArray(S)?S:[]).map(a=>({cuestionario_id:a?.cuestionario_id??a?.id??0,titulo:a?.titulo??a?.nombre??"Sin título",descripcion:a?.descripcion??"",creador_nombre:a?.creador_nombre??a?.docente_nombre??a?.autor??"",programa_nombre:a?.programa_nombre??a?.programa??a?.programa_estudiante??a?.programaAsignado??a?.nombre_programa??l.current??"",periodo_nombre:a?.periodo??a?.periodo_nombre??"",fecha_inicio:a?.fecha_inicio??a?.inicio??a?.fechaInicio??"",fecha_fin:a?.fecha_fin??a?.fin??a?.fechaFin??"",activo:a?.activo??0,asignacion_id:a?.asignacion_id??0,estado:"expirado"}))}catch(o){console.warn("[cargarCuestionarios] error en cargas secundarias:",o)}n({disponibles:E,completados:w,programados:I,expirados:R,cerrados:[]});return}catch(k){const i=k?.response?.status;if(i===401||i===403){const r=localStorage.getItem("rol");if(localStorage.removeItem("token"),localStorage.removeItem("user"),localStorage.removeItem("rol"),r==="2"){try{await J.fire({icon:"warning",title:"Sesión iniciada en otro dispositivo",text:"Tu sesión de estudiante fue cerrada aquí porque se inició en otro dispositivo o pestaña.",confirmButtonText:"Entendido"})}catch{}window.location.href="/login-estudiante";return}}n({disponibles:[],completados:[],programados:[],expirados:[],cerrados:[]})}finally{g(!1),h.current=!1}}},y={disponibles:x.disponibles.length,completados:x.completados.length,programados:x.programados.length,expirados:x.expirados.length,cerrados:x.cerrados.length};return{isLoading:s,estudianteNombre:m,cuestionarios:x,activeTab:t,setActiveTab:u,counts:y}}const de=()=>{const{isLoading:s,estudianteNombre:g,cuestionarios:m,activeTab:c,setActiveTab:l,counts:b}=oe(),h=W(),x=async()=>{try{const t=(await U(async()=>{const{default:p}=await import("./index-W0ZSjH-A.js").then(f=>f.s);return{default:p}},__vite__mapDeps([0,1]))).default;if((await t.fire({title:"¿Cerrar sesión?",text:"Se cerrará tu sesión actual.",icon:"warning",showCancelButton:!0,confirmButtonText:"Sí, cerrar sesión",cancelButtonText:"Cancelar",reverseButtons:!0,confirmButtonColor:"#d33",cancelButtonColor:"#3085d6"})).isConfirmed){await M();try{localStorage.clear(),sessionStorage.clear()}catch{}await t.fire({title:"Sesión cerrada",text:"Has salido correctamente.",icon:"success",timer:1500,showConfirmButton:!1}),h("/login-estudiante",{replace:!0})}}catch{if(window.confirm("¿Deseas cerrar sesión?")){M();try{localStorage.clear(),sessionStorage.clear()}catch{}h("/login-estudiante",{replace:!0})}}},n=()=>{if(s)return e.jsxs("div",{className:"d-flex flex-column align-items-center justify-content-center p-5",children:[e.jsx("div",{className:"spinner-border text-primary mb-3",role:"status","aria-live":"polite","aria-busy":"true",children:e.jsx("span",{className:"visually-hidden",children:"Cargando..."})}),e.jsx("p",{className:"text-muted mb-0",children:"Cargando cuestionarios..."})]});const t=m[c]||[];return t.length===0?e.jsx(ae,{tipo:c}):e.jsx("div",{className:"d-flex flex-column gap-3 w-100",children:t.map(u=>e.jsx(q,{cuestionario:u},u.cuestionario_id))})};return s&&m.disponibles.length===0&&m.completados.length===0?e.jsx(D,{children:e.jsx("div",{className:"min-vh-100 d-flex align-items-center justify-content-center bg-light-subtle",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"spinner-border text-primary mb-3",role:"status","aria-live":"polite","aria-busy":"true",children:e.jsx("span",{className:"visually-hidden",children:"Cargando..."})}),e.jsx("p",{className:"text-muted mb-0",children:"Cargando..."})]})})}):e.jsx(D,{children:e.jsx("div",{className:"container-fluid py-3 bg-light",style:{minHeight:"100vh"},children:e.jsx("div",{className:"row justify-content-center",children:e.jsxs("div",{className:"col-12 col-xl-10",children:[e.jsx("div",{className:"card border-0 mb-4 shadow-sm rounded-3",style:{background:"linear-gradient(135deg, #00a19b 0%, #008f89 100%)"},children:e.jsx("div",{className:"card-body text-white",children:e.jsxs("div",{className:"d-flex flex-column flex-md-row justify-content-between align-items-start align-items-md-center gap-3",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"mb-1 fw-bold dashboardTitle",style:{color:"#ffffff"},children:"Dashboard de Estudiante"}),e.jsxs("p",{className:"mb-0 opacity-75 dashboardEstudiante",children:["Bienvenido/a, ",g||"Cargando..."]})]}),e.jsxs("button",{onClick:x,className:"btn d-flex align-items-center gap-2 logoutButtonResponsive",style:{backgroundColor:"#ff7f1d",borderColor:"#ff7f1d",color:"#ffffff"},children:[e.jsx(Y,{}),"Cerrar Sesión"]})]})})}),e.jsxs("div",{className:"mb-0",children:[e.jsx("div",{className:"mb-3 tabsWrapper",children:e.jsx(ee,{activeTab:c,onTabChange:t=>l(t),counts:b})}),n()]})]})})})})};export{de as default};
