const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-4_f5pIIv.js","assets/index-DOfXxLhv.css"])))=>i.map(i=>d[i]);
import{g as G,h as K,a as H,r as m,j as e,c as N,A as w,S as V,_ as X}from"./index-4_f5pIIv.js";import{P as L}from"./PageTransition-BlxOQiVy.js";import{f as z,i as B,o as O,B as Q,C as Y,D as Z,x as M,E as J,G as D,H as q,j as T,v as U,b as ee,u as oe}from"./index-O__zhACk.js";import"./iconBase-BPqFUofc.js";var ae=K();const re=G(ae),se=({cuestionario:s})=>{const f=H(),[p,l]=m.useState(!1),[d,h]=m.useState(!1),g=m.useRef(null),b=m.useRef(null),t=()=>l(!0),n=()=>l(!1),u=async()=>{try{h(!0),await N.post(w.estudiante.refresh)}catch(x){console.warn("[CuestionarioEstudianteCard] refresh token falló, continuando de todas formas",x)}finally{h(!1),l(!1),f(`/realizar-cuestionario/${s.cuestionario_id}`)}};m.useEffect(()=>{if(!p)return;const x=i=>{i.key==="Escape"&&(i.preventDefault(),n()),i.key==="Enter"&&(i.preventDefault(),g.current?.click())},v=window.setTimeout(()=>g.current?.focus(),0);return document.addEventListener("keydown",x),document.body.style.overflow="hidden",()=>{window.clearTimeout(v),document.removeEventListener("keydown",x),document.body.style.overflow=""}},[p]);const y={disponible:{color:"#0d6efd",border:"4px solid #00a19b",icon:e.jsx(q,{style:{color:"#00a19b"}}),label:"Disponible"},completado:{color:"#198754",border:"4px solid #198754",icon:e.jsx(D,{style:{color:"#198754"}}),label:"Completado"},programado:{color:"#ffc107",border:"4px solid #ffc107",icon:e.jsx(J,{style:{color:"#ffc107"}}),label:"Programado"},expirado:{color:"#dc3545",border:"4px solid #dc3545",icon:e.jsx(M,{style:{color:"#dc3545"}}),label:"Expirado"},cerrado:{color:"#6c757d",border:"4px solid #6c757d",icon:e.jsx(M,{style:{color:"#6c757d"}}),label:"Cerrado"}},c=y[s.estado]||y.disponible;return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"border-bottom bg-white",style:{borderLeft:c.border},children:e.jsx("div",{className:"p-3",children:e.jsxs("div",{className:"d-flex align-items-center justify-content-between gap-3 w-100 h-100 quizRowResponsive",children:[e.jsxs("div",{className:"flex-grow-1 d-flex flex-column gap-1",children:[e.jsx("div",{className:"d-flex align-items-center justify-content-between gap-2 mb-1",children:e.jsxs("h4",{className:"mb-0 text-dark fw-semibold h6 d-flex align-items-center gap-2",children:[e.jsx("span",{"aria-hidden":!0,title:c.label,children:c.icon}),s.titulo]})}),e.jsx("div",{className:"d-flex gap-4 flex-wrap",children:e.jsxs("div",{className:"d-flex flex-column gap-1",style:{minWidth:"160px"},children:[e.jsxs("div",{className:"d-flex align-items-center gap-2 text-dark small",children:[e.jsx(z,{style:{color:"#64748b",width:"16px",textAlign:"center"}}),e.jsx("strong",{children:"Programa:"})," ",s.programa_nombre?s.programa_nombre:"No disponible"]}),e.jsxs("div",{className:"d-flex align-items-center gap-2 text-dark small",children:[e.jsx(B,{style:{color:"#64748b",width:"16px",textAlign:"center"}}),e.jsx("strong",{children:"Fechas:"})," ",s.fecha_inicio," - ",s.fecha_fin]})]})})]}),e.jsxs("div",{className:"d-flex flex-column align-items-end justify-content-center quizRowRight",style:{minWidth:"120px",flexShrink:0,gap:"16px"},children:[e.jsxs("div",{className:"d-flex align-items-center gap-2 text-dark small",style:{width:"100%",textAlign:"center",paddingRight:0},children:[e.jsx(B,{style:{color:"#64748b",width:"14px",textAlign:"center",flexShrink:0}}),e.jsx("strong",{children:"Periodo:"})," ",s.periodo_nombre]}),s.estado==="disponible"&&e.jsxs("button",{className:"btn btn-outline-secondary btn-sm d-inline-flex align-items-center gap-2 fw-semibold",onClick:t,children:["Ir al cuestionario ",e.jsx(O,{})]}),s.estado==="completado"&&e.jsxs("button",{className:"btn btn-outline-secondary btn-sm d-inline-flex align-items-center gap-2 fw-semibold",onClick:()=>f(`/resultado/${s.cuestionario_id}`),children:["Ver resultado ",e.jsx(O,{})]})]})]})})}),p&&re.createPortal(e.jsx("div",{className:"modalOverlay",onClick:n,"aria-hidden":!p,children:e.jsxs("div",{ref:b,className:"modalContent",role:"dialog","aria-modal":"true","aria-labelledby":`modal-title-${s.cuestionario_id}`,onClick:x=>x.stopPropagation(),children:[e.jsxs("div",{className:"modalHeader",children:[e.jsxs("h3",{id:`modal-title-${s.cuestionario_id}`,className:"d-flex align-items-center gap-2",children:[e.jsx(Q,{})," ",s.titulo]}),e.jsx("button",{className:"modalCloseButton","aria-label":"Cerrar",onClick:n,children:"✕"})]}),e.jsxs("div",{className:"modalBody",children:[e.jsx("div",{className:"modalDescription",dangerouslySetInnerHTML:{__html:s.descripcion||"Sin descripción"}}),e.jsxs("div",{className:"modalInfo",children:[e.jsxs("div",{className:"modalInfoRow",children:[e.jsx(z,{}),e.jsxs("span",{children:[e.jsx("strong",{children:"Programa:"})," ",s.programa_nombre?s.programa_nombre:"No disponible"]})]}),e.jsxs("div",{className:"modalInfoRow",children:[e.jsx(B,{}),e.jsxs("span",{children:[e.jsx("strong",{children:"Periodo:"})," ",s.periodo_nombre]})]}),e.jsxs("div",{className:"modalInfoRow",children:[e.jsx(Y,{}),e.jsxs("span",{children:[e.jsx("strong",{children:"Fechas:"})," ",s.fecha_inicio," - ",s.fecha_fin]})]})]})]}),e.jsxs("div",{className:"modalActions",children:[e.jsxs("button",{ref:g,type:"button",className:"modalConfirmButton",onClick:u,disabled:d,children:[e.jsx(Z,{})," ",d?"Preparando…":"Realizarlo"]}),e.jsx("button",{type:"button",className:"modalCancelButton",onClick:n,children:"Cancelar"})]})]})}),document.body)]})},P=[{key:"disponibles",label:"Disponibles",icon:T},{key:"completados",label:"Completados",icon:D},{key:"programados",label:"Programados",icon:J},{key:"expirados",label:"Expirados",icon:U}],te=({activeTab:s,onTabChange:f,counts:p})=>{const[l,d]=m.useState(!1),h=m.useRef(null),g=P.find(t=>t.key===s)||P[0],b=g?.icon??T;return m.useEffect(()=>{if(!l)return;const t=c=>{const x=c;h.current&&x&&!h.current.contains(x)&&d(!1)},n=c=>t(c.target),u=c=>t(c.target),y=c=>{c.key==="Escape"&&d(!1)};return document.addEventListener("mousedown",n),document.addEventListener("touchstart",u,{passive:!0}),document.addEventListener("keydown",y),()=>{document.removeEventListener("mousedown",n),document.removeEventListener("touchstart",u),document.removeEventListener("keydown",y)}},[l]),e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"d-block d-sm-none",children:e.jsxs("div",{className:"mobileDropdown",ref:h,children:[e.jsxs("button",{type:"button",className:"dropdownToggleCustom",onClick:()=>d(t=>!t),"aria-haspopup":"listbox","aria-expanded":l,children:[e.jsxs("span",{className:"d-flex align-items-center gap-2",children:[e.jsx(b,{size:16}),e.jsx("strong",{children:g?.label})]}),e.jsx("span",{className:"chevron",children:"▾"})]}),l&&e.jsx("ul",{className:"dropdownMenuCustom",role:"listbox",children:P.map(t=>{const n=t.icon,u=t.key===s;return e.jsx("li",{children:e.jsxs("button",{type:"button",className:`dropdownItemCustom ${u?"active":""}`,onClick:()=>{f(t.key),d(!1)},role:"option","aria-selected":u,children:[e.jsxs("span",{className:"d-flex align-items-center gap-2",children:[e.jsx(n,{size:16}),t.label]}),e.jsx("span",{className:"badgeCount",children:p[t.key]})]})},t.key)})})]})}),e.jsx("ul",{className:"nav nav-pills nav-fill gap-2 p-0 d-none d-sm-flex",style:{overflowX:"auto"},children:P.map(t=>{const n=s===t.key,u=t.icon,y="nav-link d-flex align-items-center justify-content-between rounded-3 px-3 py-2",c={backgroundColor:"#00a19B",border:"1px solid #00c7bf",color:"#ffffff"},x={backgroundColor:"#f1f5f9",border:"1px solid #e2e8f0",color:"#000000"};return e.jsx("li",{className:"nav-item",style:{minWidth:"160px"},children:e.jsxs("button",{className:`${y} ${n?"active":""}`,style:n?c:x,onClick:()=>f(t.key),children:[e.jsxs("span",{className:"d-flex align-items-center gap-2 text-capitalize",style:{fontSize:"0.9rem"},children:[e.jsx(u,{size:14}),t.label]}),e.jsx("span",{className:"badge bg-white text-dark rounded-pill",style:{backgroundColor:"#ffffff",border:"1px solid rgba(0,0,0,0.1)",minWidth:"28px",display:"inline-flex",alignItems:"center",justifyContent:"center",fontWeight:700},children:p[t.key]})]})},t.key)})})]})},W={disponibles:{icon:T,titulo:"No hay cuestionarios disponibles",mensaje:"No tienes cuestionarios pendientes en este momento.",color:"#22c55e"},completados:{icon:D,titulo:"No hay cuestionarios completados",mensaje:"Aún no has completado ningún cuestionario.",color:"#0ea5e9"},programados:{icon:B,titulo:"No hay cuestionarios programados",mensaje:"No tienes cuestionarios programados por ahora.",color:"#ff7f1d"},expirados:{icon:U,titulo:"No hay cuestionarios expirados",mensaje:"No tienes cuestionarios expirados.",color:"#ef4444"},cerrados:{icon:ee,titulo:"No hay cuestionarios cerrados",mensaje:"No tienes cuestionarios cerrados.",color:"#ff7f1d"}},ie=({tipo:s})=>{const f=W[s]||W.disponibles,p=f.icon;return e.jsxs("div",{className:"text-center p-5 bg-white rounded shadow-sm",style:{color:"#ff7f1d",animation:"fadeIn 0.6s ease"},children:[e.jsx("div",{className:"mb-3",style:{fontSize:"4rem",marginBottom:"1rem",opacity:.85,animation:"pulse 2s infinite",color:"#ff7f1d"},children:e.jsx(p,{size:64,color:"#ff7f1d"})}),e.jsx("div",{className:"fw-semibold mb-2",style:{fontSize:"1.5rem",marginBottom:"0.5rem",color:"#0f172a"},children:f.titulo}),e.jsx("div",{style:{fontSize:"1rem",lineHeight:"1.5",maxWidth:"400px",margin:"0 auto"},children:f.mensaje})]})},$=async()=>{await N.post(w.estudiante.logout);try{localStorage.clear(),sessionStorage.clear()}catch{}};function ne(){const[s,f]=m.useState(!1),[p,l]=m.useState("Invitado"),d=m.useRef(""),h=m.useRef(!1),g=m.useRef(!1),[b,t]=m.useState({disponibles:[],completados:[],programados:[],expirados:[],cerrados:[]}),[n,u]=m.useState("disponibles");m.useEffect(()=>{h.current||(h.current=!0,y())},[]);const y=async()=>{try{const v=localStorage.getItem("token"),r=(await N.post(w.estudiante.verify,{token:v}))?.data,E=localStorage.getItem("user");let C={};try{C=E?JSON.parse(E):{}}catch{}const I=r?.nombres??r?.user?.nombres??r?.data?.nombres??r?.data?.user?.nombres??r?.estudiante?.nombres??r?.data?.estudiante?.nombres??C?.nombres,R=r?.apellidos??r?.user?.apellidos??r?.data?.apellidos??r?.data?.user?.apellidos??r?.estudiante?.apellidos??r?.data?.estudiante?.apellidos??C?.apellidos,F=[I,R].filter(Boolean).join(" ").trim()||r?.nombre||r?.user?.nombre||r?.data?.nombre||r?.data?.user?.nombre||r?.estudiante?.nombre||r?.data?.estudiante?.nombre||r?.nombre_completo||r?.user?.nombre_completo||C?.nombre||(typeof r=="string"?r:void 0)||"Invitado";l(F);const A=r?.programa_id??r?.data?.programa_id??r?.estudiante?.programa_id??r?.user?.programa_id??r?.data?.user?.programa_id??(()=>{try{return JSON.parse(localStorage.getItem("user")||"{}")?.programa_id}catch{return}})();if(A)try{const S=(await N.get(w.programas.byId(A)))?.data,j=S?.data?.programa?.nombre??S?.programa?.nombre??S?.nombre??S?.programa_nombre??S?.data?.nombre??S?.data?.programa_nombre??"";j&&(d.current=String(j))}catch(_){console.warn("[verify] no se pudo obtener programa por id:",_)}}catch(v){console.error("Error al verificar sesión:",v);try{const i=JSON.parse(localStorage.getItem("user")||"{}"),r=[i?.nombres,i?.apellidos].filter(Boolean).join(" ").trim()||i?.nombre;l(r||"Invitado"),i?.programa_nombre&&(d.current=String(i.programa_nombre))}catch{l("Invitado")}}c()},c=async()=>{if(!g.current){g.current=!0,f(!0);try{const i=(await N.get(w.estudiante.cuestionarioDisponibles))?.data,E=(Array.isArray(i?.cuestionarios)?i.cuestionarios:Array.isArray(i?.data?.cuestionarios)?i.data.cuestionarios:Array.isArray(i?.disponibles)?i.disponibles:Array.isArray(i?.data?.disponibles)?i.data.disponibles:Array.isArray(i)?i:[]).map(a=>({cuestionario_id:a?.cuestionario_id??a?.id??a?.cuestionarioId??0,titulo:a?.titulo??a?.nombre??a?.title??"Sin título",descripcion:a?.descripcion??a?.description??"",creador_nombre:a?.creador_nombre??a?.docente_nombre??a?.autor??a?.d_nombre??"",programa_nombre:a?.programa_nombre??a?.programa??a?.programa_estudiante??a?.programaAsignado??a?.nombre_programa??d.current??"",periodo_nombre:a?.periodo_nombre??a?.periodo??a?.periodo_nombre_corto??a?.periodoNombre??"",fecha_inicio:a?.fecha_inicio??a?.inicio??a?.fechaInicio??a?.apertura_inicio??a?.inicio_apertura??a?.fecha_apertura??a?.fechaApertura??a?.fecha_inicio_periodo??a?.start_date??"",fecha_fin:a?.fecha_fin??a?.fin??a?.fechaFin??a?.apertura_fin??a?.fin_apertura??a?.fecha_cierre??a?.fechaCierre??a?.fecha_fin_periodo??a?.end_date??"",activo:a?.activo??1,asignacion_id:a?.asignacion_id??a?.asignacionId??0,estado:a?.estado??"disponible"}));let C=[],I=[],R=[];try{const[a,F,A]=await Promise.all([N.get(w.estudiante.cuestionarioCompletados).catch(()=>null),N.get(w.estudiante.cuestionarioProgramados).catch(()=>null),N.get(w.estudiante.cuestionarioExpirados).catch(()=>null)]),_=a?.data;a||console.warn("[completados] respuesta nula/errónea"),C=(Array.isArray(_?.cuestionarios_completados)?_.cuestionarios_completados:Array.isArray(_?.data?.cuestionarios_completados)?_.data.cuestionarios_completados:Array.isArray(_)?_:[]).map(o=>({cuestionario_id:o?.cuestionario_id??o?.id??0,titulo:o?.titulo??o?.nombre??"Sin título",descripcion:o?.descripcion??"",creador_nombre:o?.creador_nombre??o?.docente_nombre??o?.autor??"",programa_nombre:o?.programa_nombre??o?.programa??o?.programa_estudiante??o?.programaAsignado??o?.nombre_programa??d.current??"",periodo_nombre:o?.periodo??o?.periodo_nombre??"",fecha_inicio:o?.fecha_inicio??o?.inicio??o?.fechaInicio??"",fecha_fin:o?.fecha_fin??o?.fin??o?.fechaFin??"",activo:o?.activo??0,asignacion_id:o?.asignacion_id??0,estado:"completado"}));const j=F?.data;F||console.warn("[programados] respuesta nula/errónea"),I=(Array.isArray(j?.cuestionarios_programados)?j.cuestionarios_programados:Array.isArray(j?.data?.cuestionarios_programados)?j.data.cuestionarios_programados:Array.isArray(j)?j:[]).map(o=>({cuestionario_id:o?.cuestionario_id??o?.id??0,titulo:o?.titulo??o?.nombre??"Sin título",descripcion:o?.descripcion??"",creador_nombre:o?.creador_nombre??o?.docente_nombre??o?.autor??"",programa_nombre:o?.programa_nombre??o?.programa??o?.programa_estudiante??o?.programaAsignado??o?.nombre_programa??d.current??"",periodo_nombre:o?.periodo??o?.periodo_nombre??"",fecha_inicio:o?.fecha_inicio??o?.inicio??o?.fechaInicio??"",fecha_fin:o?.fecha_fin??o?.fin??o?.fechaFin??"",activo:o?.activo??1,asignacion_id:o?.asignacion_id??0,estado:"programado"}));const k=A?.data;A||console.warn("[expirados] respuesta nula/errónea"),R=(Array.isArray(k?.cuestionarios_expirados)?k.cuestionarios_expirados:Array.isArray(k?.data?.cuestionarios_expirados)?k.data.cuestionarios_expirados:Array.isArray(k)?k:[]).map(o=>({cuestionario_id:o?.cuestionario_id??o?.id??0,titulo:o?.titulo??o?.nombre??"Sin título",descripcion:o?.descripcion??"",creador_nombre:o?.creador_nombre??o?.docente_nombre??o?.autor??"",programa_nombre:o?.programa_nombre??o?.programa??o?.programa_estudiante??o?.programaAsignado??o?.nombre_programa??d.current??"",periodo_nombre:o?.periodo??o?.periodo_nombre??"",fecha_inicio:o?.fecha_inicio??o?.inicio??o?.fechaInicio??"",fecha_fin:o?.fecha_fin??o?.fin??o?.fechaFin??"",activo:o?.activo??0,asignacion_id:o?.asignacion_id??0,estado:"expirado"}))}catch(a){console.warn("[cargarCuestionarios] error en cargas secundarias:",a)}t({disponibles:E,completados:C,programados:I,expirados:R,cerrados:[]});return}catch(v){const i=v?.response?.status;if(i===401||i===403){const r=localStorage.getItem("rol");if(localStorage.removeItem("token"),localStorage.removeItem("user"),localStorage.removeItem("rol"),r==="2"){try{await V.fire({icon:"warning",title:"Sesión iniciada en otro dispositivo",text:"Tu sesión de estudiante fue cerrada aquí porque se inició en otro dispositivo o pestaña.",confirmButtonText:"Entendido"})}catch{}window.location.href="/login-estudiante";return}}t({disponibles:[],completados:[],programados:[],expirados:[],cerrados:[]})}finally{f(!1),g.current=!1}}},x={disponibles:b.disponibles.length,completados:b.completados.length,programados:b.programados.length,expirados:b.expirados.length,cerrados:b.cerrados.length};return{isLoading:s,estudianteNombre:p,cuestionarios:b,activeTab:n,setActiveTab:u,counts:x}}const fe=()=>{const{isLoading:s,estudianteNombre:f,cuestionarios:p,activeTab:l,setActiveTab:d,counts:h}=ne(),g=H(),b=async()=>{try{const n=(await X(async()=>{const{default:y}=await import("./index-4_f5pIIv.js").then(c=>c.s);return{default:y}},__vite__mapDeps([0,1]))).default;if((await n.fire({title:"¿Cerrar sesión?",text:"Se cerrará tu sesión actual.",icon:"warning",showCancelButton:!0,confirmButtonText:"Sí, cerrar sesión",cancelButtonText:"Cancelar",reverseButtons:!0,confirmButtonColor:"#d33",cancelButtonColor:"#3085d6"})).isConfirmed){await $();try{localStorage.clear(),sessionStorage.clear()}catch{}await n.fire({title:"Sesión cerrada",text:"Has salido correctamente.",icon:"success",timer:1500,showConfirmButton:!1}),g("/login-estudiante",{replace:!0})}}catch{if(window.confirm("¿Deseas cerrar sesión?")){$();try{localStorage.clear(),sessionStorage.clear()}catch{}g("/login-estudiante",{replace:!0})}}},t=()=>{if(s)return e.jsxs("div",{className:"d-flex flex-column align-items-center justify-content-center p-5",children:[e.jsx("div",{className:"spinner-border text-primary mb-3",role:"status","aria-live":"polite","aria-busy":"true",children:e.jsx("span",{className:"visually-hidden",children:"Cargando..."})}),e.jsx("p",{className:"text-muted mb-0",children:"Cargando cuestionarios..."})]});const n=p[l]||[];return n.length===0?e.jsx(ie,{tipo:l}):e.jsx("div",{className:"d-flex flex-column gap-3 w-100",children:n.map(u=>e.jsx(se,{cuestionario:u},u.cuestionario_id))})};return s&&p.disponibles.length===0&&p.completados.length===0?e.jsx(L,{children:e.jsx("div",{className:"min-vh-100 d-flex align-items-center justify-content-center bg-light-subtle",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"spinner-border text-primary mb-3",role:"status","aria-live":"polite","aria-busy":"true",children:e.jsx("span",{className:"visually-hidden",children:"Cargando..."})}),e.jsx("p",{className:"text-muted mb-0",children:"Cargando..."})]})})}):e.jsx(L,{children:e.jsx("div",{className:"container-fluid py-3 bg-light",style:{minHeight:"100vh"},children:e.jsx("div",{className:"row justify-content-center",children:e.jsxs("div",{className:"col-12 col-xl-10",children:[e.jsx("div",{className:"card border-0 mb-4 shadow-sm rounded-3",style:{background:"linear-gradient(135deg, #00a19b 0%, #008f89 100%)"},children:e.jsx("div",{className:"card-body text-white",children:e.jsxs("div",{className:"d-flex flex-column flex-md-row justify-content-between align-items-start align-items-md-center gap-3",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"mb-1 fw-bold dashboardTitle",style:{color:"#ffffff"},children:"Dashboard de Estudiante"}),e.jsxs("p",{className:"mb-0 opacity-75 dashboardEstudiante",children:["Bienvenido/a, ",f||"Cargando..."]})]}),e.jsxs("button",{onClick:b,className:"btn d-flex align-items-center gap-2 logoutButtonResponsive",style:{backgroundColor:"#ff7f1d",borderColor:"#ff7f1d",color:"#ffffff"},children:[e.jsx(oe,{}),"Cerrar Sesión"]})]})})}),e.jsxs("div",{className:"mb-0",children:[e.jsx("div",{className:"mb-3 tabsWrapper",children:e.jsx(te,{activeTab:l,onTabChange:n=>d(n),counts:h})}),t()]})]})})})})};export{fe as default};
