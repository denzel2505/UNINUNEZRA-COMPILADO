const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-DaOhVVWd.js","assets/index-DnAkjZSW.css"])))=>i.map(i=>d[i]);
import{g as J,f as G,a as W,r as p,j as e,b as N,A as w,_ as V}from"./index-DaOhVVWd.js";import{P as D}from"./PageTransition-Couod70-.js";import{f as T,j as B,n as z,y as K,B as X,C as Q,D as Y,i as $,E as H,G as Z,t as M,b as q,s as ee}from"./index-B8Flq_4W.js";import"./iconBase-Cr-ff6zs.js";var ae=G();const oe=J(ae),re=({cuestionario:r})=>{const l=W(),[d,i]=p.useState(!1),t=p.useRef(null),x=p.useRef(null),g=()=>i(!0),c=()=>i(!1),_=()=>{i(!1),l(`/realizar-cuestionario/${r.cuestionario_id}`)},m=r?.creador_nombre||r?.docente_nombre||r?.autor||r?.docente||r?.d_nombre||"";return p.useEffect(()=>{if(!d)return;const f=y=>{y.key==="Escape"&&(y.preventDefault(),c()),y.key==="Enter"&&(y.preventDefault(),t.current?.click())},C=window.setTimeout(()=>t.current?.focus(),0);return document.addEventListener("keydown",f),document.body.style.overflow="hidden",()=>{window.clearTimeout(C),document.removeEventListener("keydown",f),document.body.style.overflow=""}},[d]),e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"border-bottom bg-white",children:e.jsx("div",{className:"p-3",children:e.jsxs("div",{className:"d-flex align-items-center justify-content-between gap-3 w-100 h-100",children:[e.jsxs("div",{className:"flex-grow-1 d-flex flex-column gap-1",children:[e.jsx("div",{className:"d-flex align-items-center justify-content-between gap-2 mb-1",children:e.jsx("h4",{className:"mb-0 text-dark fw-semibold h6",children:r.titulo})}),e.jsx("div",{className:"d-flex gap-4 flex-wrap",children:e.jsxs("div",{className:"d-flex flex-column gap-1",style:{minWidth:"160px"},children:[e.jsxs("div",{className:"d-flex align-items-center gap-2 text-dark small",children:[e.jsx(T,{style:{color:"#64748b",width:"16px",textAlign:"center"}}),e.jsx("strong",{children:"Programa:"})," ",r.programa_nombre?r.programa_nombre:"No disponible"]}),e.jsxs("div",{className:"d-flex align-items-center gap-2 text-dark small",children:[e.jsx(B,{style:{color:"#64748b",width:"16px",textAlign:"center"}}),e.jsx("strong",{children:"Fechas:"})," ",r.fecha_inicio," - ",r.fecha_fin]})]})})]}),e.jsxs("div",{className:"d-flex flex-column align-items-end justify-content-center",style:{minWidth:"120px",flexShrink:0,gap:"6px"},children:[e.jsxs("div",{className:"d-flex align-items-center gap-2 text-dark small",style:{justifyContent:"center",width:"100%",textAlign:"center",paddingRight:0},children:[e.jsx(B,{style:{color:"#64748b",width:"14px",textAlign:"center",flexShrink:0}}),e.jsx("strong",{children:"Periodo:"})," ",r.periodo_nombre]}),r.estado==="disponible"&&e.jsxs("button",{className:"btn btn-outline-secondary btn-sm d-inline-flex align-items-center gap-2 fw-semibold",onClick:g,children:["Ir al cuestionario ",e.jsx(z,{})]}),r.estado==="completado"&&e.jsxs("button",{className:"btn btn-outline-secondary btn-sm d-inline-flex align-items-center gap-2 fw-semibold",onClick:()=>l(`/resultado/${r.cuestionario_id}`),children:["Ver resultado ",e.jsx(z,{})]})]})]})})}),d&&oe.createPortal(e.jsx("div",{className:"modalOverlay",onClick:c,"aria-hidden":!d,children:e.jsxs("div",{ref:x,className:"modalContent",role:"dialog","aria-modal":"true","aria-labelledby":`modal-title-${r.cuestionario_id}`,onClick:f=>f.stopPropagation(),children:[e.jsxs("div",{className:"modalHeader",children:[e.jsxs("h3",{id:`modal-title-${r.cuestionario_id}`,className:"d-flex align-items-center gap-2",children:[e.jsx(K,{})," ",r.titulo]}),e.jsx("button",{className:"modalCloseButton","aria-label":"Cerrar",onClick:c,children:"✕"})]}),e.jsxs("div",{className:"modalBody",children:[e.jsx("p",{className:"modalDescription",children:r.descripcion||"Sin descripción"}),e.jsxs("div",{className:"modalInfo",children:[e.jsxs("div",{className:"modalInfoRow",children:[e.jsx(T,{}),e.jsxs("span",{children:[e.jsx("strong",{children:"Programa:"})," ",r.programa_nombre?r.programa_nombre:"No disponible"]})]}),e.jsxs("div",{className:"modalInfoRow",children:[e.jsx(B,{}),e.jsxs("span",{children:[e.jsx("strong",{children:"Periodo:"})," ",r.periodo_nombre]})]}),e.jsxs("div",{className:"modalInfoRow",children:[e.jsx(X,{}),e.jsxs("span",{children:[e.jsx("strong",{children:"Fechas:"})," ",r.fecha_inicio," - ",r.fecha_fin]})]}),e.jsxs("div",{className:"modalInfoRow",children:[e.jsx(Q,{}),e.jsxs("span",{children:[e.jsx("strong",{children:"Docente:"})," ",m||"No disponible"]})]})]})]}),e.jsxs("div",{className:"modalActions",children:[e.jsxs("button",{ref:t,type:"button",className:"modalConfirmButton",onClick:_,children:[e.jsx(Y,{})," Ir a realizarlo"]}),e.jsx("button",{type:"button",className:"modalCancelButton",onClick:c,children:"Cancelar"})]})]})}),document.body)]})},se=[{key:"disponibles",label:"Disponibles",icon:$},{key:"completados",label:"Completados",icon:H},{key:"programados",label:"Programados",icon:Z},{key:"expirados",label:"Expirados",icon:M}],ie=({activeTab:r,onTabChange:l,counts:d})=>e.jsx("ul",{className:"nav nav-pills nav-fill gap-2 p-0",style:{overflowX:"auto"},children:se.map(i=>{const t=r===i.key,x=i.icon,g="nav-link d-flex align-items-center justify-content-between rounded-3 px-3 py-2",c={backgroundColor:"#00a19B",border:"1px solid #00c7bf",color:"#ffffff"},_={backgroundColor:"#f1f5f9",border:"1px solid #e2e8f0",color:"#000000"};return e.jsx("li",{className:"nav-item",style:{minWidth:"160px"},children:e.jsxs("button",{className:`${g} ${t?"active":""}`,style:t?c:_,onClick:()=>l(i.key),children:[e.jsxs("span",{className:"d-flex align-items-center gap-2 text-capitalize",style:{fontSize:"0.9rem"},children:[e.jsx(x,{size:14}),i.label]}),e.jsx("span",{className:"badge bg-white text-dark rounded-pill",style:{backgroundColor:"#ffffff",border:"1px solid rgba(0,0,0,0.1)",minWidth:"28px",display:"inline-flex",alignItems:"center",justifyContent:"center",fontWeight:700},children:d[i.key]})]})},i.key)})}),O={disponibles:{icon:$,titulo:"No hay cuestionarios disponibles",mensaje:"No tienes cuestionarios pendientes en este momento.",color:"#22c55e"},completados:{icon:H,titulo:"No hay cuestionarios completados",mensaje:"Aún no has completado ningún cuestionario.",color:"#0ea5e9"},programados:{icon:B,titulo:"No hay cuestionarios programados",mensaje:"No tienes cuestionarios programados por ahora.",color:"#f59e0b"},expirados:{icon:M,titulo:"No hay cuestionarios expirados",mensaje:"No tienes cuestionarios expirados.",color:"#ef4444"},cerrados:{icon:q,titulo:"No hay cuestionarios cerrados",mensaje:"No tienes cuestionarios cerrados.",color:"#64748b"}},ne=({tipo:r})=>{const l=O[r]||O.disponibles,d=l.icon;return e.jsxs("div",{className:"text-center p-5 bg-white rounded shadow-sm",style:{color:"#64748b",animation:"fadeIn 0.6s ease"},children:[e.jsx("div",{className:"mb-3",style:{fontSize:"4rem",marginBottom:"1rem",opacity:.5,animation:"pulse 2s infinite",color:l.color},children:e.jsx(d,{size:64})}),e.jsx("div",{className:"fw-semibold mb-2",style:{fontSize:"1.5rem",marginBottom:"0.5rem",color:"#0f172a"},children:l.titulo}),e.jsx("div",{style:{fontSize:"1rem",lineHeight:"1.5",maxWidth:"400px",margin:"0 auto"},children:l.mensaje})]})},L=async()=>{await N.post(w.estudiante.logout);try{localStorage.clear(),sessionStorage.clear()}catch{}};function te(){const[r,l]=p.useState(!1),[d,i]=p.useState("Invitado"),t=p.useRef(""),x=p.useRef(!1),g=p.useRef(!1),[c,_]=p.useState({disponibles:[],completados:[],programados:[],expirados:[],cerrados:[]}),[m,f]=p.useState("disponibles");p.useEffect(()=>{x.current||(x.current=!0,C())},[]);const C=async()=>{try{const A=localStorage.getItem("token"),s=(await N.post(w.estudiante.verify,{token:A}))?.data,I=localStorage.getItem("user");let j={};try{j=I?JSON.parse(I):{}}catch{}const E=s?.nombres??s?.user?.nombres??s?.data?.nombres??s?.data?.user?.nombres??s?.estudiante?.nombres??s?.data?.estudiante?.nombres??j?.nombres,F=s?.apellidos??s?.user?.apellidos??s?.data?.apellidos??s?.data?.user?.apellidos??s?.estudiante?.apellidos??s?.data?.estudiante?.apellidos??j?.apellidos,S=[E,F].filter(Boolean).join(" ").trim()||s?.nombre||s?.user?.nombre||s?.data?.nombre||s?.data?.user?.nombre||s?.estudiante?.nombre||s?.data?.estudiante?.nombre||s?.nombre_completo||s?.user?.nombre_completo||j?.nombre||(typeof s=="string"?s:void 0)||"Invitado";console.log("[verify] response:",s),console.log("[verify] nombre:",S),i(S);const k=s?.programa_id??s?.data?.programa_id??s?.estudiante?.programa_id??s?.user?.programa_id??s?.data?.user?.programa_id??(()=>{try{return JSON.parse(localStorage.getItem("user")||"{}")?.programa_id}catch{return}})();if(k)try{const h=(await N.get(w.programas.byId(k)))?.data,b=h?.data?.programa?.nombre??h?.programa?.nombre??h?.nombre??h?.programa_nombre??h?.data?.nombre??h?.data?.programa_nombre??"";b&&(t.current=String(b),console.log("[verify] programa_nombre:",t.current))}catch(u){console.warn("[verify] no se pudo obtener programa por id:",u)}}catch(A){console.error("Error al verificar sesión:",A);try{const n=JSON.parse(localStorage.getItem("user")||"{}"),s=[n?.nombres,n?.apellidos].filter(Boolean).join(" ").trim()||n?.nombre;i(s||"Invitado"),n?.programa_nombre&&(t.current=String(n.programa_nombre))}catch{i("Invitado")}}y()},y=async()=>{if(g.current){console.log("[cargarCuestionarios] ya hay una carga en curso, se omite");return}g.current=!0,l(!0);try{const n=(await N.get(w.estudiante.cuestionarioDisponibles))?.data;console.log("[disponibles] raw:",n);const s=Array.isArray(n?.cuestionarios)?n.cuestionarios:Array.isArray(n?.data?.cuestionarios)?n.data.cuestionarios:Array.isArray(n?.disponibles)?n.disponibles:Array.isArray(n?.data?.disponibles)?n.data.disponibles:Array.isArray(n)?n:[];console.log("[disponibles] parsed length:",s.length);const I=s.map(o=>({cuestionario_id:o?.cuestionario_id??o?.id??o?.cuestionarioId??0,titulo:o?.titulo??o?.nombre??o?.title??"Sin título",descripcion:o?.descripcion??o?.description??"",creador_nombre:o?.creador_nombre??o?.docente_nombre??o?.autor??o?.d_nombre??"",programa_nombre:o?.programa_nombre??o?.programa??o?.programa_estudiante??o?.programaAsignado??o?.nombre_programa??t.current??"",periodo_nombre:o?.periodo_nombre??o?.periodo??o?.periodo_nombre_corto??o?.periodoNombre??"",fecha_inicio:o?.fecha_inicio??o?.inicio??o?.fechaInicio??o?.apertura_inicio??o?.inicio_apertura??o?.fecha_apertura??o?.fechaApertura??o?.fecha_inicio_periodo??o?.start_date??"",fecha_fin:o?.fecha_fin??o?.fin??o?.fechaFin??o?.apertura_fin??o?.fin_apertura??o?.fecha_cierre??o?.fechaCierre??o?.fecha_fin_periodo??o?.end_date??"",activo:o?.activo??1,asignacion_id:o?.asignacion_id??o?.asignacionId??0,estado:o?.estado??"disponible"}));let j=[],E=[],F=[];try{const[o,S,k]=await Promise.all([N.get(w.estudiante.cuestionarioCompletados).catch(()=>null),N.get(w.estudiante.cuestionarioProgramados).catch(()=>null),N.get(w.estudiante.cuestionarioExpirados).catch(()=>null)]),u=o?.data;o?console.log("[completados] raw:",u):console.warn("[completados] respuesta nula/errónea");const h=Array.isArray(u?.cuestionarios_completados)?u.cuestionarios_completados:Array.isArray(u?.data?.cuestionarios_completados)?u.data.cuestionarios_completados:Array.isArray(u)?u:[];console.log("[completados] parsed length:",h.length),j=h.map(a=>({cuestionario_id:a?.cuestionario_id??a?.id??0,titulo:a?.titulo??a?.nombre??"Sin título",descripcion:a?.descripcion??"",creador_nombre:a?.creador_nombre??a?.docente_nombre??a?.autor??"",programa_nombre:a?.programa_nombre??a?.programa??a?.programa_estudiante??a?.programaAsignado??a?.nombre_programa??t.current??"",periodo_nombre:a?.periodo??a?.periodo_nombre??"",fecha_inicio:a?.fecha_inicio??a?.inicio??a?.fechaInicio??"",fecha_fin:a?.fecha_fin??a?.fin??a?.fechaFin??"",activo:a?.activo??0,asignacion_id:a?.asignacion_id??0,estado:"completado"}));const b=S?.data;S?console.log("[programados] raw:",b):console.warn("[programados] respuesta nula/errónea");const R=Array.isArray(b?.cuestionarios_programados)?b.cuestionarios_programados:Array.isArray(b?.data?.cuestionarios_programados)?b.data.cuestionarios_programados:Array.isArray(b)?b:[];console.log("[programados] parsed length:",R.length),E=R.map(a=>({cuestionario_id:a?.cuestionario_id??a?.id??0,titulo:a?.titulo??a?.nombre??"Sin título",descripcion:a?.descripcion??"",creador_nombre:a?.creador_nombre??a?.docente_nombre??a?.autor??"",programa_nombre:a?.programa_nombre??a?.programa??a?.programa_estudiante??a?.programaAsignado??a?.nombre_programa??t.current??"",periodo_nombre:a?.periodo??a?.periodo_nombre??"",fecha_inicio:a?.fecha_inicio??a?.inicio??a?.fechaInicio??"",fecha_fin:a?.fecha_fin??a?.fin??a?.fechaFin??"",activo:a?.activo??1,asignacion_id:a?.asignacion_id??0,estado:"programado"}));const v=k?.data;k?console.log("[expirados] raw:",v):console.warn("[expirados] respuesta nula/errónea");const P=Array.isArray(v?.cuestionarios_expirados)?v.cuestionarios_expirados:Array.isArray(v?.data?.cuestionarios_expirados)?v.data.cuestionarios_expirados:Array.isArray(v)?v:[];console.log("[expirados] parsed length:",P.length),F=P.map(a=>({cuestionario_id:a?.cuestionario_id??a?.id??0,titulo:a?.titulo??a?.nombre??"Sin título",descripcion:a?.descripcion??"",creador_nombre:a?.creador_nombre??a?.docente_nombre??a?.autor??"",programa_nombre:a?.programa_nombre??a?.programa??a?.programa_estudiante??a?.programaAsignado??a?.nombre_programa??t.current??"",periodo_nombre:a?.periodo??a?.periodo_nombre??"",fecha_inicio:a?.fecha_inicio??a?.inicio??a?.fechaInicio??"",fecha_fin:a?.fecha_fin??a?.fin??a?.fechaFin??"",activo:a?.activo??0,asignacion_id:a?.asignacion_id??0,estado:"expirado"}))}catch(o){console.warn("[cargarCuestionarios] error en cargas secundarias:",o)}_({disponibles:I,completados:j,programados:E,expirados:F,cerrados:[]});return}catch{_({disponibles:[],completados:[],programados:[],expirados:[],cerrados:[]})}finally{l(!1),g.current=!1}},U={disponibles:c.disponibles.length,completados:c.completados.length,programados:c.programados.length,expirados:c.expirados.length,cerrados:c.cerrados.length};return{isLoading:r,estudianteNombre:d,cuestionarios:c,activeTab:m,setActiveTab:f,counts:U}}const pe=()=>{const{isLoading:r,estudianteNombre:l,cuestionarios:d,activeTab:i,setActiveTab:t,counts:x}=te(),g=W(),c=async()=>{try{const m=(await V(async()=>{const{default:C}=await import("./index-DaOhVVWd.js").then(y=>y.s);return{default:C}},__vite__mapDeps([0,1]))).default;if((await m.fire({title:"¿Cerrar sesión?",text:"Se cerrará tu sesión actual.",icon:"warning",showCancelButton:!0,confirmButtonText:"Sí, cerrar sesión",cancelButtonText:"Cancelar",reverseButtons:!0,confirmButtonColor:"#d33",cancelButtonColor:"#3085d6"})).isConfirmed){await L();try{localStorage.clear(),sessionStorage.clear()}catch{}await m.fire({title:"Sesión cerrada",text:"Has salido correctamente.",icon:"success",timer:1500,showConfirmButton:!1}),g("/login-estudiante",{replace:!0})}}catch{if(window.confirm("¿Deseas cerrar sesión?")){L();try{localStorage.clear(),sessionStorage.clear()}catch{}g("/login-estudiante",{replace:!0})}}},_=()=>{if(r)return e.jsxs("div",{className:"d-flex flex-column align-items-center justify-content-center p-5",children:[e.jsx("div",{className:"spinner-border text-primary mb-3",role:"status","aria-live":"polite","aria-busy":"true",children:e.jsx("span",{className:"visually-hidden",children:"Cargando..."})}),e.jsx("p",{className:"text-muted mb-0",children:"Cargando cuestionarios..."})]});const m=d[i]||[];return m.length===0?e.jsx(ne,{tipo:i}):e.jsx("div",{className:"d-flex flex-column gap-0 w-100",children:m.map(f=>e.jsx(re,{cuestionario:f},f.cuestionario_id))})};return r&&d.disponibles.length===0&&d.completados.length===0?e.jsx(D,{children:e.jsx("div",{className:"min-vh-100 d-flex align-items-center justify-content-center bg-light-subtle",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"spinner-border text-primary mb-3",role:"status","aria-live":"polite","aria-busy":"true",children:e.jsx("span",{className:"visually-hidden",children:"Cargando..."})}),e.jsx("p",{className:"text-muted mb-0",children:"Cargando..."})]})})}):e.jsx(D,{children:e.jsx("div",{className:"container-fluid py-3 bg-light",style:{minHeight:"100vh"},children:e.jsx("div",{className:"row justify-content-center",children:e.jsxs("div",{className:"col-12 col-xl-10",children:[e.jsx("div",{className:"card border-0 mb-4 shadow-sm rounded-3",style:{background:"linear-gradient(135deg, #00a19b 0%, #008f89 100%)"},children:e.jsx("div",{className:"card-body text-white",children:e.jsxs("div",{className:"d-flex flex-column flex-md-row justify-content-between align-items-start align-items-md-center gap-3",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"mb-1 fw-bold h3",style:{color:"#ffffff"},children:"Dashboard de Estudiante"}),e.jsxs("p",{className:"mb-0 opacity-75",children:["Bienvenido/a, ",l||"Cargando..."]})]}),e.jsxs("button",{onClick:c,className:"btn d-flex align-items-center gap-2",style:{backgroundColor:"#ff7f1d",borderColor:"#ff7f1d",color:"#ffffff"},children:[e.jsx(ee,{}),"Cerrar Sesión"]})]})})}),e.jsxs("div",{className:"mb-0",children:[e.jsx("div",{className:"mb-3",children:e.jsx(ie,{activeTab:i,onTabChange:m=>t(m),counts:x})}),_()]})]})})})})};export{pe as default};
