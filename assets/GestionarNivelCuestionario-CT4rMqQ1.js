import{j as e,r as c,A,b as w,a as F,c as P,u as S,e as E}from"./index-W0ZSjH-A.js";import{P as L}from"./PageTransition-DHV3GPNa.js";import{m as k,b as g,N as M}from"./index-DfAB-zHd.js";import"./iconBase-BFfBqceE.js";const D=({title:n,onBack:r})=>e.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[e.jsx("h2",{className:"m-0",children:n}),e.jsxs("button",{className:"btn btn-secondary",onClick:r,children:[e.jsx(k,{className:"me-2"})," Regresar"]})]}),$=({descripcion:n,abreviatura:r,cuestionarioId:o,programaId:l,programaNombre:i,onDescripcionChange:u,onAbreviaturaChange:m})=>e.jsxs("div",{className:"row border-bottom mb-4 p-4",children:[e.jsxs("div",{className:"col-12 col-md-6 mt-3",children:[e.jsx("label",{htmlFor:"descripcion",className:"form-label",children:"Descripcion*"}),e.jsx("textarea",{id:"descripcion",className:"form-control",value:n,onChange:s=>u(s.target.value),rows:4,placeholder:"Describe el nivel..."})]}),e.jsxs("div",{className:"col-12 col-md-6 mt-3",children:[e.jsx("label",{htmlFor:"abreviatura",className:"form-label",children:"Abreviatura*"}),e.jsx("input",{type:"text",id:"abreviatura",className:"form-control",value:r,maxLength:3,onChange:s=>m(s.target.value.toUpperCase().slice(0,3)),placeholder:"Ej: RA1, RA2..."})]}),e.jsxs("div",{className:"col-12 col-md-6 mt-3",children:[e.jsxs("label",{htmlFor:"cuestionarioId",className:"form-label",children:["Cuestionario ID ",e.jsx(g,{})]}),e.jsx("div",{className:"input-group",children:e.jsx("input",{type:"text",id:"cuestionarioId",className:"form-control bg-light",value:o,disabled:!0,"aria-label":"Cuestionario Id"})})]}),e.jsxs("div",{className:"col-12 col-md-6 mt-3",children:[e.jsxs("label",{htmlFor:"programaId",className:"form-label",children:["Programa ID: ",e.jsx("b",{children:i||"No especificado"})," ",e.jsx(g,{})]}),e.jsx("div",{className:"input-group",children:e.jsx("input",{type:"text",id:"programaId",className:"form-control bg-light",value:l,disabled:!0,"aria-label":"Programa"})})]})]}),T=({levels:n,onChange:r,onAddLevel:o,maxScore:l=100})=>{const i=(s,a)=>{const t=n.map((d,x)=>x===s?{...d,...a}:d);r(t)},u=s=>{const a=n.filter((t,d)=>d!==s);r(a)},m=s=>{const{min:a,max:t}=s;return a==null||t==null?"Completa mínimo y máximo":a<0||t<0?"Valores >= 0":a>l||t>l?`El valor debe estar entre 0 y ${l}`:a>t?"Mínimo no puede ser mayor que máximo":null};return e.jsxs("div",{className:"row",children:[e.jsxs("h3",{className:"mb-3",children:["Indicadores ",e.jsxs("small",{className:"text-muted",children:["(Puntaje máximo: ",l,")"]})]}),e.jsxs("div",{className:"col-12",children:[n.map((s,a)=>e.jsx("div",{className:"mb-3 pb-3 border-bottom",children:e.jsxs("div",{className:"row align-items-end g-2",children:[e.jsx("div",{className:"col-12 col-md-3",children:e.jsx("label",{className:"form-label",children:s.name})}),e.jsxs("div",{className:"col-6 col-md-3",children:[e.jsx("label",{className:"form-label",htmlFor:`min-${a}`,children:"Mínimo"}),e.jsx("input",{id:`min-${a}`,className:"form-control",type:"number",min:0,max:l,value:typeof s.min=="number"?String(s.min):"",onChange:t=>i(a,{min:t.target.value===""?void 0:Number(t.target.value)})})]}),e.jsxs("div",{className:"col-6 col-md-3",children:[e.jsx("label",{className:"form-label",htmlFor:`max-${a}`,children:"Máximo"}),e.jsx("input",{id:`max-${a}`,className:"form-control",type:"number",min:0,max:l,value:typeof s.max=="number"?String(s.max):"",onChange:t=>i(a,{max:t.target.value===""?void 0:Number(t.target.value)})})]}),e.jsx("div",{className:"col-12 col-md-3 d-flex gap-2 mt-2 mt-md-0",children:e.jsxs("button",{type:"button",className:"btn btn-outline-danger",onClick:()=>u(a),children:[e.jsx(M,{className:"me-1"})," Eliminar"]})}),m(s)&&e.jsx("div",{className:"col-12",children:e.jsx("small",{className:"text-danger",children:m(s)})})]})},a)),e.jsx("button",{type:"button",className:"btn btn-outline-secondary",onClick:o,children:"Agregar Nivel"})]})]})},_=({onSave:n,saving:r=!1,disabled:o=!1})=>e.jsx("div",{className:"row mt-4 mb-2 justify-content-end w-100",children:e.jsx("div",{className:"col-auto",children:e.jsx("button",{style:{width:"150px"},className:"btn btn-secondary p-2",onClick:n,disabled:r||o,children:r?"Guardando...":"Guardar"})})});function G(n){const[r,o]=c.useState(100),[l,i]=c.useState(!1),[u,m]=c.useState(null),s=c.useCallback(async()=>{if(n)try{i(!0),m(null);const a=A.programas.byId(n),x=(await w.get(a)).data?.data?.programa,b=Array.isArray(x)?x?.[0]?.nivel_puntaje_maximo:x?.nivel_puntaje_maximo,h=Number(b);!Number.isNaN(h)&&typeof h=="number"&&h>0?o(h):o(100)}catch(a){m(a?.message||(a?.response?.status?`HTTP ${a.response.status}`:"Error desconocido")),o(100)}finally{i(!1)}},[n]);return c.useEffect(()=>{s()},[s]),{maxScore:r,loading:l,error:u,refresh:s}}const H=()=>{const n=F(),r=P(),[o]=S(),l=E(),i=r.state?.cuestionarioId??o.get("cuestionarioId")??l.id??"",u=r.state?.programaId??o.get("programaId")??"",m=r.state?.programaNombre,s=r.state?.cuestionarioTitulo??o.get("titulo")??void 0,[a,t]=c.useState(""),[d,x]=c.useState(""),[b,h]=c.useState([{name:"Nivel 1"},{name:"Nivel 2"},{name:"Nivel 3"},{name:"Nivel 4"}]),{maxScore:p}=G(u),y=()=>{h(j=>[...j,{name:`Nivel ${j.length+1}`}])},C=()=>{},f=c.useMemo(()=>b.length?b.every(j=>{const{min:N,max:v}=j;return!(N==null||v==null||N<0||v<0||N>p||v>p||N>v)}):!1,[b,p]),I=c.useMemo(()=>{const j=a.trim().length>0,N=d.trim().length>0;return j&&N&&f},[a,d,f]);return e.jsx(L,{children:e.jsxs("div",{children:[e.jsx(D,{title:"Gestionar Nivel Cuestionario",onBack:()=>n("/dashboard")}),e.jsx("div",{className:"card shadow-sm mt-4",children:e.jsxs("div",{className:"card-body",children:[e.jsxs("h3",{children:["Cuestionario: ",e.jsx("span",{children:s||(i?`ID ${i}`:"Sin título")})]}),e.jsx($,{descripcion:a,abreviatura:d,cuestionarioId:i,programaId:u,programaNombre:m,onDescripcionChange:t,onAbreviaturaChange:x}),e.jsx(T,{levels:b,onChange:h,onAddLevel:y,maxScore:p}),e.jsx(_,{onSave:C,disabled:!I})]})})]})})};export{H as default};
