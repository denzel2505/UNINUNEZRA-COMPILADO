import{u as j,a as g,r as x,R as N,j as e,b as v,S as l}from"./index-bvBplxLg.js";import{P as y}from"./PageTransition-h2g6dWVb.js";import{u as w}from"./useAuthentication-z-U2jEO4.js";import{f as E,a as S,g as A,e as C,F as I}from"./index-CU0cwZ_L.js";import{u as k}from"./index.esm-C1a3o1sh.js";import"./iconBase-BtrJDtBd.js";const V=()=>{const[o]=j(),{register:d,handleSubmit:p,formState:{errors:t,isSubmitting:c}}=k({defaultValues:{email:"",documento:""}}),r=g(),{isAuthenticated:m,user:u,studentLogin:h}=w();x.useEffect(()=>{const a="recaptcha-script";if(!document.getElementById(a)){const s=document.createElement("script");s.id=a,s.src=N,s.async=!0,s.defer=!0,document.body.appendChild(s)}},[]),x.useEffect(()=>{const a=o.get("id");if(a){r(`/realizar-cuestionario/${a}`);return}m&&u?.rol==="estudiante"&&window.location.pathname!=="/estudiante"&&r("/estudiante")},[m,u,r,o]);const b=async a=>{try{const s=window?.grecaptcha?.getResponse?.()||"";if(!s){await l.fire({icon:"warning",title:"Verificación requerida",text:"Por favor completa el reCAPTCHA antes de continuar."});return}const i=o.get("id"),n=i?`/realizar-cuestionario/${i}`:"/estudiante";typeof h=="function"?await h(a.email,a.documento,s,n):r(n)}catch(s){const i=s?.response?.status,n=s?.response?.data?.message||s?.response?.data?.error||s?.message;if(i===409||i===423||/ya\s*ha(z|s)\s*iniciado\s*ses[ií]on/i.test(n||"")){await l.fire({icon:"info",title:"Sesión ya iniciada",text:"Ya has iniciado sesión con este usuario en otro dispositivo o pestaña.",confirmButtonText:"Entendido"});return}const f=n||"No se pudo iniciar sesión";await l.fire({icon:"warning",title:"Error de Acceso",text:f,confirmButtonText:"Entendido"})}};return e.jsx(y,{children:e.jsxs("div",{className:"min-vh-100 d-flex align-items-center justify-content-center bg-white py-4",children:[e.jsx("div",{className:"d-none d-md-block",style:{position:"fixed",top:64,right:24,zIndex:1050},children:e.jsx("a",{href:"/elige-rol",className:"btn btn-sm student-back-button",children:"⟵ Volver a selección de rol"})}),e.jsx("div",{className:"container-fluid px-3 px-md-4",children:e.jsx("div",{className:"row justify-content-center",children:e.jsx("div",{className:"col-12 col-lg-10 col-xl-8",children:e.jsxs("div",{className:"row g-3 g-md-4",children:[e.jsx("div",{className:"col-12 d-flex d-md-none mb-4 justify-content-end",children:e.jsx("a",{href:"/elige-rol",className:"btn btn-sm student-back-button",children:"⟵ Volver a selección de rol"})}),e.jsx("div",{className:"col-12",style:{maxWidth:420,width:"100%",margin:"0 auto"},children:e.jsxs("div",{className:"card shadow-lg border-0 h-100",children:[e.jsxs("div",{className:"card-header text-white text-center py-3 student-login-header",children:[e.jsx("div",{className:"mb-2",children:e.jsx("div",{className:"bg-white bg-opacity-25 rounded-circle d-inline-flex align-items-center justify-content-center",style:{width:"50px",height:"50px"},children:e.jsx(E,{size:20})})}),e.jsx("h4",{className:"mb-0 fw-bold",children:"Acceso Estudiantes"}),e.jsx("p",{className:"mb-0 opacity-75 small",children:"Ingresa tus credenciales institucionales"})]}),e.jsxs("div",{className:"card-body p-3 p-md-4 p-lg-5",children:[e.jsxs("form",{onSubmit:p(b),children:[e.jsxs("div",{className:"mb-3",children:[e.jsxs("label",{className:"form-label fw-semibold small",children:[e.jsx(S,{className:"me-2"}),"Correo Electrónico Institucional"]}),e.jsx("input",{type:"email",className:`form-control ${t.email?"is-invalid":""}`,disabled:c,...d("email",{required:"El correo es requerido",pattern:{value:/^[^\s@]+@[^\s@]+\.[^\s@]+$/,message:"Ingrese un correo válido"}}),placeholder:"ejemplo@email.com"}),t.email&&e.jsx("div",{className:"invalid-feedback d-block small",children:t.email.message})]}),e.jsxs("div",{className:"mb-3",children:[e.jsxs("label",{className:"form-label fw-semibold small",children:[e.jsx(A,{className:"me-2"}),"Documento de Identidad"]}),e.jsx("input",{type:"text",className:`form-control ${t.documento?"is-invalid":""}`,disabled:c,...d("documento",{required:"El documento es requerido",minLength:{value:4,message:"Mínimo 4 caracteres"}}),placeholder:"Ingresa tu número de documento"}),t.documento&&e.jsx("div",{className:"invalid-feedback d-block small",children:t.documento.message})]}),e.jsx("div",{className:"mb-3",children:e.jsx("div",{className:"g-recaptcha","data-sitekey":v})}),e.jsx("div",{className:"mb-3",children:e.jsx("button",{type:"submit",className:"btn w-100 border-0 student-login-button",disabled:c,children:c?e.jsxs(e.Fragment,{children:[e.jsx(C,{className:"me-2 fa-spin"}),"Validando..."]}):e.jsxs(e.Fragment,{children:[e.jsx(I,{className:"me-2"}),"Iniciar Sesión"]})})})]}),e.jsxs("div",{className:"text-center mt-3 pt-3 border-top",children:[e.jsx("p",{className:"mb-2 text-muted small",children:"¿Problemas para acceder?"}),e.jsx("p",{className:"text-muted small mb-0",children:"Contacta a tu docente para obtener tus credenciales"})]})]})]})})]})})})})]})})};export{V as default};
