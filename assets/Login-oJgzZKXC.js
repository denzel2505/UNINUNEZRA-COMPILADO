import{S as n,u as w,a as y,r as d,R as S,j as e,b as E}from"./index-bvBplxLg.js";import{u as C}from"./useAuthentication-z-U2jEO4.js";import{F as k,a as A,b as u,c as I,d as P,e as F}from"./index-CU0cwZ_L.js";import{u as R}from"./index.esm-C1a3o1sh.js";import"./iconBase-BtrJDtBd.js";const L=(l,i=1e3)=>{n.fire({title:"Cargando...",html:"Por favor espere",timer:i,timerProgressBar:!0,didOpen:()=>{n.showLoading()},allowOutsideClick:!1,allowEscapeKey:!1,allowEnterKey:!1}).then(()=>{window.location.href=l})},V=()=>{const[l]=w(),i=y(),t=l.get("id"),{register:m,handleSubmit:p,formState:{errors:r,isSubmitting:c}}=R({defaultValues:{email:"",password:""}}),[o,f]=d.useState(!1),{login:b,isAuthenticated:h,checkSession:x,user:g}=C();d.useEffect(()=>{const s="recaptcha-script";if(!document.getElementById(s)){const a=document.createElement("script");a.id=s,a.src=S,a.async=!0,a.defer=!0,document.body.appendChild(a)}},[]);const j=()=>{try{const s=window?.grecaptcha;return s?s.getResponse():""}catch{return""}},N=()=>{try{const s=window?.grecaptcha;s&&s.reset()}catch{}};d.useEffect(()=>{(async()=>{if(await x(),h){if(t){i(`/realizar-cuestionario/${t}`);return}localStorage.getItem("rol")==="2"||g?.rol==="estudiante"?i("/estudiante"):i("/dashboard")}})()},[h,t,i,x]);const v=async s=>{try{const a=j();if(!a){await n.fire({icon:"warning",title:"Verificación requerida",text:"Por favor completa el reCAPTCHA antes de continuar."});return}await b(s.email,s.password,a,t?`/realizar-cuestionario/${t}`:void 0),t||(await n.fire({icon:"success",title:"¡Bienvenido!",text:"Inicio de sesión exitoso",timer:2e3,showConfirmButton:!1}),L("/dashboard",2e3))}catch{}finally{N()}};return e.jsxs("div",{className:"min-vh-100 d-flex align-items-center justify-content-center w-100 bg-white py-4",children:[e.jsx("div",{className:"d-none d-md-block",style:{position:"fixed",top:64,right:24,zIndex:1050},children:e.jsx("a",{href:"/elige-rol",className:"btn btn-outline-secondary btn-sm",children:"⟵ Volver a selección de rol"})}),e.jsx("div",{className:"container-fluid px-3 px-md-4",children:e.jsx("div",{className:"row justify-content-center",children:e.jsx("div",{className:"col-12 col-lg-10 col-xl-8",children:e.jsxs("div",{className:"row g-3 g-md-4",children:[e.jsx("div",{className:"col-12 d-flex d-md-none mb-4 justify-content-end",children:e.jsx("a",{href:"/elige-rol",className:"btn btn-outline-secondary btn-sm",children:"⟵ Volver a selección de rol"})}),e.jsx("div",{className:"col-12",style:{maxWidth:420,width:"100%",margin:"0 auto"},children:e.jsxs("div",{className:"card shadow-lg border-0 h-100",children:[e.jsxs("div",{className:"card-header bg-primary text-white text-center py-3 login-header",children:[e.jsx("div",{className:"mb-2",children:e.jsx("div",{className:"bg-white bg-opacity-25 rounded-circle d-inline-flex align-items-center justify-content-center",style:{width:"50px",height:"50px"},children:e.jsx(k,{size:20})})}),e.jsx("h4",{className:"mb-0 fw-bold",children:"Iniciar Sesión"}),e.jsx("p",{className:"mb-0 opacity-75 small",children:"Accede a tu cuenta"})]}),e.jsxs("div",{className:"card-body p-3 p-md-4 p-lg-5",children:[e.jsxs("form",{onSubmit:p(v),children:[e.jsxs("div",{className:"mb-3",children:[e.jsxs("label",{className:"form-label fw-semibold small",children:[e.jsx(A,{className:"me-2"}),"Correo electrónico"]}),e.jsx("input",{type:"email",className:`form-control ${r.email?"is-invalid":""}`,placeholder:"email@dominio.com",disabled:c,...m("email",{required:"El correo electrónico es requerido",pattern:{value:/^[^\s@]+@[^\s@]+\.[^\s@]+$/,message:"Ingrese un correo electrónico válido"}})}),r.email&&e.jsx("div",{className:"invalid-feedback d-block small",children:r.email.message})]}),e.jsxs("div",{className:"mb-3",children:[e.jsxs("label",{className:"form-label fw-semibold small",children:[e.jsx(u,{className:"me-2"}),"Contraseña"]}),e.jsxs("div",{className:"input-group",children:[e.jsx("input",{type:o?"text":"password",className:`form-control ${r.password?"is-invalid":""}`,placeholder:"••••••••",disabled:c,...m("password",{required:"La contraseña es requerida",minLength:{value:6,message:"La contraseña debe tener al menos 6 caracteres"}})}),e.jsx("button",{type:"button",className:"btn btn-outline-secondary",onClick:()=>f(!o),disabled:c,children:o?e.jsx(I,{}):e.jsx(P,{})})]}),r.password&&e.jsx("div",{className:"invalid-feedback d-block small",children:r.password.message})]}),e.jsx("div",{className:"mb-3",children:e.jsx("div",{className:"g-recaptcha","data-sitekey":E})}),e.jsx("div",{className:"mb-3",children:e.jsx("button",{type:"submit",className:"btn w-100 border-0 login-button",disabled:c,children:c?e.jsxs(e.Fragment,{children:[e.jsx(F,{className:"me-2 fa-spin"}),"Iniciando sesión..."]}):e.jsxs(e.Fragment,{children:[e.jsx(u,{className:"me-2"}),"Iniciar sesión"]})})}),e.jsx("div",{className:"text-center mb-3",children:e.jsxs("div",{className:"d-flex align-items-center justify-content-center",children:[e.jsx("hr",{className:"flex-grow-1"}),e.jsx("span",{className:"px-2 text-muted small",children:"o"}),e.jsx("hr",{className:"flex-grow-1"})]})})]}),e.jsxs("div",{className:"text-center mt-3 pt-3 border-top",children:[e.jsx("p",{className:"mb-2 text-muted small",children:"¿No tienes cuenta?"}),e.jsx("a",{onClick:()=>i("/registro-docente"),className:"btn btn-outline-secondary btn-sm4 d-inline-flex align-items-center gap-2 fw-semibold",children:"Regístrate aquí"})]}),t&&e.jsx("div",{className:"alert alert-info mt-3 mb-0 py-2",children:e.jsxs("small",{children:[e.jsx("strong",{children:"Nota:"})," Serás redirigido al cuestionario después del inicio de sesión."]})})]})]})})]})})})})]})};export{V as default};
