import{r as c,b as y,A as N,S as h,j as e}from"./index-DaOhVVWd.js";import{j as B,x as F}from"./index-B8Flq_4W.js";import"./iconBase-Cr-ff6zs.js";const D=()=>{const[n,d]=c.useState([]),[s,p]=c.useState([]),[g,v]=c.useState(!1),u=()=>{try{const a=localStorage.getItem("user")||localStorage.getItem("usuario");if(!a)return;const o=JSON.parse(a),i=o?.id??o?.user?.id;return typeof i=="number"||typeof i=="string"?String(i):void 0}catch{return}},m=c.useRef(!1),P=c.useCallback(async()=>{if(!m.current){m.current=!0;try{v(!0);const a=u(),o=a?{usuario_id:a}:void 0,[i,f]=await Promise.all([y.get(N.periodo.base,{params:o}),y.get(N.periodo.inactive,{params:o})]);console.debug("[usePeriodos] activosResp.data =",i?.data),console.debug("[usePeriodos] inactivosResp.data =",f?.data);const k=r=>{if(!r)return[];if(Array.isArray(r))return r;if(Array.isArray(r?.periodos))return r.periodos;if(Array.isArray(r?.data))return r.data;if(Array.isArray(r?.data?.data))return r.data.data;if(Array.isArray(r?.data?.items))return r.data.items;if(Array.isArray(r?.result))return r.result;if(Array.isArray(r?.items))return r.items;for(const l of Object.keys(r)){const t=r[l];if(Array.isArray(t)&&t.length>0&&typeof t[0]=="object"&&"nombre"in t[0]&&("fecha_inicio"in t[0]||"fechaFin"in t[0]))return t;if(t&&typeof t=="object")for(const j of Object.keys(t)){const b=t[j];if(Array.isArray(b)&&b.length>0&&typeof b[0]=="object"&&"nombre"in b[0]&&("fecha_inicio"in b[0]||"fechaFin"in b[0]))return b}}return[]},A=k(i?.data),x=k(f?.data);d(Array.isArray(A)?A:[]),p(Array.isArray(x)?x:[])}catch(a){console.error("Error cargarPeriodos:",a),await h.fire({icon:"error",title:"Error",text:a?.message||"Error al cargar los periodos"})}finally{v(!1)}}},[]),w=c.useCallback(async a=>{const o=u(),i=o?{...a,usuario_id:o}:{...a};return(await y.post(N.periodo.create,i))?.data},[]),_=c.useCallback(async(a,o)=>{const i=u(),f=i?{...o,usuario_id:i}:{...o};return(await y.put(N.periodo.byId(a),f))?.data},[]),I=c.useCallback(async a=>{const o=u(),i=o?{usuario_id:o}:void 0;return(await y.delete(N.periodo.byId(a),{params:i}))?.data},[]),C=c.useCallback(async a=>{const o=u(),i=o?{usuario_id:o}:{};return(await y.delete(N.periodo.deactivate(a),{params:i}))?.data},[]),S=c.useCallback(async a=>{const o=u(),i=o?{usuario_id:o}:{};return(await y.post(N.periodo.activate(a),{params:i}))?.data},[]);return{periodos:n,periodosInactivos:s,loading:g,setPeriodos:d,setPeriodosInactivos:p,cargarPeriodos:P,crearPeriodo:w,actualizarPeriodo:_,eliminarPeriodo:I,desactivarPeriodo:C,activarPeriodo:S}},T=({onCreate:n})=>e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-4",children:[e.jsxs("h2",{className:"mb-0 d-flex align-items-center",style:{color:"#1e293b"},children:[e.jsx(B,{className:"me-2",style:{color:"#3b82f6"}}),"Períodos"]}),e.jsxs("button",{onClick:n,className:"btn btn-outline-secondary d-inline-flex align-items-center gap-2 fw-semibold",style:{borderColor:"#00a19B",color:"#00a19B"},children:[e.jsx(F,{}),e.jsx("span",{children:"Crear Período"})]})]}),M=({periodos:n,onDeactivate:d})=>e.jsxs("div",{className:"card shadow-sm border mb-4",style:{backgroundColor:"#ffffff",border:"1px solid rgba(59, 130, 246, 0.1)",marginBottom:"1.5rem"},children:[e.jsxs("div",{className:"card-header d-flex align-items-center justify-content-between",style:{background:"linear-gradient(135deg, #3b82f6 0%, #2563eb 100%)",color:"white"},children:[e.jsx("h5",{className:"mb-0",children:"Períodos Existentes"}),e.jsx("span",{className:"badge bg-light text-dark",children:n.length})]}),e.jsx("div",{className:"card-body p-0",children:n.length===0?e.jsx("div",{className:"text-center py-5",children:e.jsx("p",{className:"text-muted mb-0",children:"No hay períodos registrados."})}):e.jsx("div",{className:"table-responsive",children:e.jsxs("table",{className:"table table-borderless mb-0 align-middle",children:[e.jsx("thead",{className:"table-light",children:e.jsxs("tr",{children:[e.jsx("th",{className:"border-0 px-3 py-3 text-center",children:"Nombre"}),e.jsx("th",{className:"border-0 px-3 py-3 text-center",children:"Inicio"}),e.jsx("th",{className:"border-0 px-3 py-3 text-center",children:"Fin"}),e.jsx("th",{className:"border-0 px-3 py-3 text-center",children:"Aperturas"}),e.jsx("th",{className:"border-0 px-3 py-3 text-center",children:"Acciones"})]})}),e.jsx("tbody",{children:n.map(s=>e.jsxs("tr",{className:"border-bottom",style:{backgroundColor:"#ffffff"},children:[e.jsx("td",{className:"px-3 py-3 text-center",children:e.jsx("span",{className:"fw-bold",style:{color:"#1e293b"},children:s.nombre})}),e.jsx("td",{className:"px-3 py-3 text-center",children:e.jsx("span",{className:"text-muted",children:s.fecha_inicio})}),e.jsx("td",{className:"px-3 py-3 text-center",children:e.jsx("span",{className:"text-muted",children:s.fecha_fin})}),e.jsx("td",{className:"px-3 py-3 text-center",children:e.jsx("span",{className:"badge bg-light text-dark",children:s.total_aperturas})}),e.jsx("td",{className:"px-3 py-3 text-center",children:e.jsx("button",{className:"btn btn-outline-danger w-30 d-inline-flex align-items-center justify-content-center gap-2 fw-semibold",onClick:()=>d(s.id,s.nombre,s.aperturas_activas),children:"Desactivar"})})]},s.id))})]})})})]}),R=({periodos:n,onActivate:d})=>e.jsxs("div",{className:"card shadow-sm border",style:{backgroundColor:"#ffffff",border:"1px solid rgba(108, 117, 125, 0.1)",marginBottom:"1.5rem"},children:[e.jsxs("div",{className:"card-header d-flex align-items-center justify-content-between",style:{background:"linear-gradient(135deg, #6c757d 0%, #495057 100%)",color:"white"},children:[e.jsx("h5",{className:"mb-0",children:"Períodos Inactivos"}),e.jsx("span",{className:"badge bg-light text-dark",children:n.length})]}),e.jsx("div",{className:"card-body p-0",children:n.length===0?e.jsx("div",{className:"text-center py-5",children:e.jsx("p",{className:"text-muted mb-0",children:"No hay períodos inactivos."})}):e.jsx("div",{className:"table-responsive",children:e.jsxs("table",{className:"table table-borderless mb-0 align-middle",children:[e.jsx("thead",{className:"table-light",children:e.jsxs("tr",{children:[e.jsx("th",{className:"border-0 px-3 py-3 text-center",children:"Nombre"}),e.jsx("th",{className:"border-0 px-3 py-3 text-center",children:"Inicio"}),e.jsx("th",{className:"border-0 px-3 py-3 text-center",children:"Fin"}),e.jsx("th",{className:"border-0 px-3 py-3 text-center",children:"Aperturas"}),e.jsx("th",{className:"border-0 px-3 py-3 text-center",children:"Acciones"})]})}),e.jsx("tbody",{children:n.map(s=>e.jsxs("tr",{className:"border-bottom",style:{backgroundColor:"#ffffff"},children:[e.jsx("td",{className:"px-3 py-3 text-center",children:e.jsx("span",{className:"fw-bold",style:{color:"#1e293b"},children:s.nombre})}),e.jsx("td",{className:"px-3 py-3 text-center",children:e.jsx("span",{className:"text-muted",children:s.fecha_inicio})}),e.jsx("td",{className:"px-3 py-3 text-center",children:e.jsx("span",{className:"text-muted",children:s.fecha_fin})}),e.jsx("td",{className:"px-3 py-3 text-center",children:e.jsx("span",{className:"badge bg-light text-dark",children:s.total_aperturas})}),e.jsx("td",{className:"px-3 py-3 text-center",children:e.jsx("button",{onClick:()=>d(s.id,s.nombre),className:"btn btn-outline-success w-30 d-inline-flex align-items-center justify-content-center gap-2 fw-semibold",children:"Activar"})})]},s.id))})]})})})]}),L=({open:n,inicial:d,title:s,isLoading:p,onClose:g,onSubmit:v})=>{const u=c.useRef(null);return n?e.jsx("div",{className:"modal d-block",tabIndex:-1,role:"dialog",onClick:m=>{m.target===m.currentTarget&&g()},style:{backgroundColor:"rgba(0, 0, 0, 0.6)"},children:e.jsx("div",{className:"modal-dialog modal-dialog-centered",role:"document",children:e.jsxs("div",{className:"modal-content",children:[e.jsxs("div",{className:"modal-header periodo-modal-header text-white",children:[e.jsxs("h5",{className:"modal-title d-inline-flex align-items-center gap-2 mb-0",children:[e.jsx(B,{}),s]}),e.jsx("button",{type:"button",className:"btn-close btn-close-white","aria-label":"Close",onClick:g})]}),e.jsx("div",{className:"modal-body",children:e.jsxs("form",{ref:u,onSubmit:m=>{m.preventDefault(),u.current&&v(u.current)},children:[e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{htmlFor:"nombre",className:"form-label fw-bold",children:"Nombre del Período *"}),e.jsx("input",{placeholder:"Ejemplo: 2025-G",maxLength:6,type:"text",id:"nombre",name:"nombre",defaultValue:d?.nombre||"",required:!0,className:"form-control"})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{htmlFor:"fecha_inicio",className:"form-label fw-bold",children:"Fecha de Inicio *"}),e.jsx("input",{type:"date",id:"fecha_inicio",name:"fecha_inicio",defaultValue:d?.fecha_inicio||"",required:!0,className:"form-control"})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{htmlFor:"fecha_fin",className:"form-label fw-bold",children:"Fecha de Fin *"}),e.jsx("input",{type:"date",id:"fecha_fin",name:"fecha_fin",defaultValue:d?.fecha_fin||"",required:!0,className:"form-control"})]}),e.jsxs("div",{className:"modal-footer",children:[e.jsx("button",{type:"button",className:"btn btn-sbtn btn-outline-danger w-45 d-inline-flex align-items-center justify-content-center gap-2 fw-semiboldecondary",onClick:g,children:"Cancelar"}),e.jsx("button",{type:"submit",className:"btn btn-outline-secondary d-inline-flex align-items-center gap-2 fw-semibold",style:{borderColor:"#00a19B",color:"#00a19B"},disabled:p,children:p?e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"fas fa-spinner fa-spin"})," ","Guardando..."]}):e.jsxs(e.Fragment,{children:[e.jsx(F,{})," ","Guardar"]})})]})]})})]})})}):null},V=()=>{const{periodos:n,periodosInactivos:d,cargarPeriodos:s,crearPeriodo:p,actualizarPeriodo:g,desactivarPeriodo:v,activarPeriodo:u}=D(),[m,P]=c.useState(null),[w,_]=c.useState(null),[I,C]=c.useState(!1),[S,a]=c.useState(!1);c.useEffect(()=>{s()},[]),c.useEffect(()=>{console.debug("[PeriodoManage] periodos.length =",n.length,n)},[n]),c.useEffect(()=>{console.debug("[PeriodoManage] periodosInactivos.length =",d.length,d)},[d]);const o=()=>{P(null),a(!0)},i=()=>{a(!1),P(null)},f=async x=>{C(!0);const r=new FormData(x);try{const l={nombre:String(r.get("nombre")||""),fecha_inicio:String(r.get("fecha_inicio")||""),fecha_fin:String(r.get("fecha_fin")||"")},t=m?await g(m.id,l):await p(l);if(await new Promise(j=>setTimeout(j,500)),t.success)h.fire({icon:"success",title:"¡Éxito!",text:t.message,timer:1500,showConfirmButton:!1}),P(null),a(!1),s();else throw new Error(t.error||"Error al procesar la solicitud")}catch(l){console.error("Error:",l),h.fire({icon:"error",title:"Error",text:l instanceof Error?l.message:"Error al procesar la solicitud"})}finally{C(!1)}},k=async(x,r,l)=>{try{let t='No puede desactivar el periodo <strong> "'+r+'"</strong>',j="";if(l>0){j=`<div style="background: #fff3cd; border: 1px solid #ffecb5; padding: 10px; border-radius: 4px; margin: 10px 0;">
          <strong>Advertencia:</strong> Este periodo tiene ${l} aperturas activas. 
          Debe desactivar todas las aperturas primero antes de poder desactivar este periodo.
        </div>`,await h.fire({title:"No se puede desactivar",html:`${t}<br>${j}`,icon:"warning",showCancelButton:!1,confirmButtonText:"Ok"});return}if((await h.fire({title:"¿Desactivar Periodo?",html:`¿Está seguro que desea desactivar el periodo <strong>${r}</strong>?`,icon:"warning",showCancelButton:!0,cancelButtonText:"Cancelar",confirmButtonText:"Desactivar"})).isConfirmed){const E=await v(x);if(E.success)h.fire({icon:"success",title:"¡Desactivado!",text:E.message,timer:1500,showConfirmButton:!1}),s();else throw new Error(E.error||"Error al desactivar el periodo")}}catch(t){console.error("Error:",t),h.fire({icon:"error",title:"Error",text:t instanceof Error?t.message:"Error al desactivar el periodo"})}},A=async(x,r)=>{try{if((await h.fire({title:"¿Activar Periodo?",html:`¿Está seguro que desea activar el periodo <strong>${r}</strong>?`,icon:"question",showCancelButton:!0,cancelButtonText:"Cancelar",confirmButtonText:"Ok"})).isConfirmed){const t=await u(x);if(t.success)h.fire({icon:"success",title:"¡Activado!",text:t.message,timer:1500,showConfirmButton:!1}),s();else throw new Error(t.error||"Error al activar el periodo")}}catch(l){console.error("Error:",l),h.fire({icon:"error",title:"Error",text:l instanceof Error?l.message:"Error al activar el periodo"})}};return e.jsxs("div",{className:"container-fluid py-4 bg-white min-vh-100",children:[e.jsx("div",{className:"row",children:e.jsxs("div",{className:"col-12",children:[e.jsx(T,{onCreate:o}),w&&e.jsxs("div",{className:`alert alert-${w.tipo==="success"?"success":w.tipo==="danger"?"danger":"warning"} alert-dismissible fade show`,role:"alert",children:[w.texto,e.jsx("button",{type:"button",className:"btn-close",onClick:()=>_(null)})]}),e.jsx(M,{periodos:n,onDeactivate:k}),e.jsx(R,{periodos:d,onActivate:A})]})}),e.jsx(L,{open:S,title:m?"Editar Período":"Crear Nuevo Período",inicial:m?{nombre:m.nombre,fecha_inicio:m.fecha_inicio,fecha_fin:m.fecha_fin}:void 0,isLoading:I,onClose:i,onSubmit:x=>f(x)})]})};export{V as default};
