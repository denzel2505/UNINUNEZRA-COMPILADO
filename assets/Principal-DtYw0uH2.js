import{r as a,b as M,A as P,S as h,j as e,a as H,d as Z}from"./index-DMCNFzKN.js";import{P as ee}from"./PageTransition-BtYAuUMO.js";import{u as X}from"./useAuthentication-BPIDln6A.js";import{d as G,u as V,v as K,w as U,x as Y,i as se,y as re,z as te}from"./index-3Pp9WEVo.js";import{F as ae,a as oe}from"./index-z02uUzJu.js";import"./iconBase-D9d8KM2X.js";const ie="_modalOverlay_u46p0_2",ne="_modalContent_u46p0_26",le="_modalHeader_u46p0_49",ce="_closeButton_u46p0_67",de="_modalBody_u46p0_86",ue="_loading_u46p0_91",me="_spinner_u46p0_100",xe="_formGroup_u46p0_115",pe="_cuestionarioInfo_u46p0_128",fe="_cuestionarioCard_u46p0_132",he="_cuestionarioId_u46p0_153",be="_loadingCuestionario_u46p0_163",ge="_selectField_u46p0_173",ye="_modalFooter_u46p0_196",je="_cancelButton_u46p0_205",Ne="_submitButton_u46p0_206",u={modalOverlay:ie,modalContent:ne,modalHeader:le,closeButton:ce,modalBody:de,loading:ue,spinner:me,formGroup:xe,cuestionarioInfo:pe,cuestionarioCard:fe,cuestionarioId:he,loadingCuestionario:be,selectField:ge,modalFooter:ye,cancelButton:je,submitButton:Ne},ve=({isOpen:o,onClose:t,cuestionarioId:c,cuestionarioTitulo:b,onSuccess:l})=>{const{user:g}=X(),[_,m]=a.useState([]),[x,p]=a.useState(""),[v,s]=a.useState(!1);a.useEffect(()=>{o&&g?.id&&i()},[o,g?.id]);const i=async()=>{try{s(!0);const r=await M.get(P.aperturas.periodosActivos),n=r?.data?.data??r?.data,B=Array.isArray(n?.periodos)?n.periodos:Array.isArray(r?.data)?r?.data:[];m(B)}catch(r){console.error("Error al cargar datos:",r),h.fire({icon:"error",title:"Error",text:r instanceof Error?r.message:"Error al cargar los datos"})}finally{s(!1)}},d=async r=>{if(r.preventDefault(),!x){h.fire({icon:"warning",title:"Campo requerido",text:"Por favor selecciona un periodo"});return}if(!c){h.fire({icon:"error",title:"Error",text:"No se pudo cargar la información del cuestionario"});return}try{s(!0);const n=await M.post(P.aperturas.crear,{cuestionario_id:Number(c),periodo_id:Number(x),usuario_id:g?.id}),B=n?.data?.data??n?.data;h.fire({icon:"success",title:"¡Éxito!",text:B?.message||"Apertura creada correctamente",timer:1500,showConfirmButton:!1}),p(""),l?.(),t()}catch(n){console.error("Error al crear apertura:",n);const B=n?.response?.status,I=n?.response?.data?.message||n?.response?.data?.error;B===409?h.fire({icon:"warning",title:"Conflicto",text:I||"Ya existe una apertura para este cuestionario en el período seleccionado"}):h.fire({icon:"error",title:"Error",text:I||(n instanceof Error?n.message:"Error al crear la apertura")})}finally{s(!1)}},N=r=>{if(!r)return"";const n=r.split("T")[0].split("-");return n.length===3?`${n[2]}/${n[1]}/${n[0]}`:r},E=r=>{r.target===r.currentTarget&&t()};return o?e.jsx("div",{className:u.modalOverlay,onClick:E,children:e.jsxs("div",{className:u.modalContent,children:[e.jsxs("div",{className:u.modalHeader,children:[e.jsxs("h3",{children:[e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("rect",{x:"3",y:"4",width:"18",height:"18",rx:"2",ry:"2"}),e.jsx("line",{x1:"16",y1:"2",x2:"16",y2:"6"}),e.jsx("line",{x1:"8",y1:"2",x2:"8",y2:"6"}),e.jsx("line",{x1:"3",y1:"10",x2:"21",y2:"10"})]}),"Abrir Cuestionario"]}),e.jsx("button",{onClick:t,className:u.closeButton,type:"button",children:e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),e.jsx("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]})})]}),e.jsx("div",{className:u.modalBody,children:v?e.jsxs("div",{className:u.loading,children:[e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:u.spinner,children:[e.jsx("circle",{cx:"12",cy:"12",r:"10"}),e.jsx("path",{d:"M12 6v6l4 2"})]}),e.jsx("p",{children:"Cargando..."})]}):e.jsxs("form",{onSubmit:d,children:[e.jsxs("div",{className:u.formGroup,children:[e.jsx("label",{children:"Cuestionario Seleccionado"}),c?e.jsx("div",{className:u.cuestionarioInfo,children:e.jsxs("div",{className:u.cuestionarioCard,children:[e.jsx("h4",{children:b||"Cuestionario"}),e.jsxs("span",{className:u.cuestionarioId,children:["ID: ",c]})]})}):e.jsx("div",{className:u.loadingCuestionario,children:e.jsx("span",{children:"Cargando información del cuestionario..."})})]}),e.jsxs("div",{className:u.formGroup,children:[e.jsx("label",{htmlFor:"periodo_id",children:"Período"}),e.jsxs("select",{id:"periodo_id",value:x,onChange:r=>p(r.target.value),required:!0,className:u.selectField,children:[e.jsx("option",{value:"",children:"Seleccionar período"}),_.map(r=>e.jsxs("option",{value:r.id,children:[r.nombre," (",N(r.fecha_inicio)," - ",N(r.fecha_fin),")"]},r.id))]})]}),e.jsxs("div",{className:u.modalFooter,children:[e.jsx("button",{type:"button",onClick:t,className:u.cancelButton,children:"Cancelar"}),e.jsx("button",{type:"submit",className:u.submitButton,disabled:v||!c,children:v?"Creando...":"Crear Apertura"})]})]})})]})}):null},Ce=({cuestionarios:o,tipo:t,onAperturaClick:c,onCerrarApertura:b})=>{const l=H(),g=s=>{if(!s)return null;const i=String(s).trim(),d=i.match(/^(\d{4})-(\d{2})-(\d{2})(?:[ T](\d{2}):(\d{2})(?::(\d{2}))?)?$/);if(!d)return new Date(i.replace(" ","T"));const[N,E,r,n,B="0",I="0",$="0"]=d;return new Date(+E,+r-1,+n,+B,+I,+$)},_=s=>{if(!s)return"No especificado";const i=g(s);return!i||isNaN(i.getTime())?"No especificado":i.toLocaleDateString("es-ES",{year:"numeric",month:"short",day:"numeric"})},m=(s,i)=>{const d=new Date,N=g(s),E=g(i);return N&&d<N?{available:!1,status:"programado"}:E&&d>E?{available:!1,status:"expirado"}:{available:!0,status:"disponible"}},[x,p]=a.useState(null),v=a.useRef(null);return a.useEffect(()=>{const s=i=>{i.target.closest(".row-actions-container")||p(null)};return document.addEventListener("click",s),()=>document.removeEventListener("click",s)},[]),e.jsx("div",{className:"card border-0",children:e.jsx("div",{className:"card-body p-0",children:e.jsx("div",{className:"table-responsive quizzes-table-responsive",style:{overflowX:"auto",overflowY:"visible"},children:e.jsxs("table",{className:"table table-borderless mb-0",children:[e.jsx("thead",{className:"table-light",children:e.jsxs("tr",{children:[e.jsx("th",{className:"border-0 px-3 py-3 text-center",children:e.jsxs("div",{className:"d-flex align-items-center justify-content-center",children:[e.jsx("i",{className:"fas fa-file-alt me-2"}),"Cuestionario"]})}),e.jsx("th",{className:"border-0 px-3 py-3 text-center",children:e.jsxs("div",{className:"d-flex align-items-center justify-content-center",children:[e.jsx("i",{className:"fas fa-graduation-cap me-2"}),"Programa"]})}),t==="abiertos"&&e.jsx("th",{className:"border-0 px-3 py-3 text-center",children:e.jsxs("div",{className:"d-flex align-items-center justify-content-center",children:[e.jsx("i",{className:"fas fa-calendar me-2"}),"Periodo"]})}),t==="abiertos"&&e.jsx("th",{className:"border-0 px-3 py-3 text-center",children:e.jsxs("div",{className:"d-flex align-items-center justify-content-center",children:[e.jsx("i",{className:"fas fa-play me-2"}),"Inicio"]})}),t==="abiertos"&&e.jsx("th",{className:"border-0 px-3 py-3 text-center",children:e.jsxs("div",{className:"d-flex align-items-center justify-content-center",children:[e.jsx("i",{className:"fas fa-stop me-2"}),"Fin"]})}),e.jsx("th",{className:"border-0 px-3 py-3 text-center",children:e.jsxs("div",{className:"d-flex align-items-center justify-content-center",children:[e.jsx("i",{className:"fas fa-cogs me-2"}),"Acciones"]})})]})}),e.jsx("tbody",{children:o.map(s=>{const i=t==="abiertos"?m(s.fecha_inicio,s.fecha_fin):null;return e.jsxs("tr",{className:"border-bottom",children:[e.jsx("td",{className:"px-3 py-3 text-center",children:e.jsxs("div",{className:"d-flex flex-column align-items-center",children:[e.jsx("h6",{className:"mb-1 fw-bold text-primary text-truncate",style:{maxWidth:"200px"},title:s.titulo||"Sin título",children:s.titulo||"Sin título"}),e.jsx("p",{className:"mb-1 text-muted small text-truncate",style:{maxWidth:"200px"},title:s.descripcion||"Sin descripción",children:s.descripcion||"Sin descripción"}),t==="abiertos"&&e.jsx("span",{className:`badge rounded-pill ${i?.status==="disponible"?"bg-info bg-opacity-10 text-info":i?.status==="expirado"?"bg-danger bg-opacity-10 text-danger":"bg-warning bg-opacity-10 text-warning"}`,children:i?.status==="programado"?"Programado":i?.status==="expirado"?"Expirado":"Disponible"})]})}),e.jsx("td",{className:"px-3 py-3 text-center",children:e.jsx("span",{className:"badge bg-info bg-opacity-10 text-info rounded-pill text-truncate",style:{maxWidth:"150px"},title:s.programa_nombre||"No especificado",children:s.programa_nombre||"No especificado"})}),t==="abiertos"&&e.jsx("td",{className:"px-3 py-3 text-center",children:e.jsx("span",{className:"badge bg-secondary bg-opacity-10 text-secondary rounded-pill text-truncate",style:{maxWidth:"120px"},title:s.periodo_nombre||"No especificado",children:s.periodo_nombre||"No especificado"})}),t==="abiertos"&&e.jsx("td",{className:"px-3 py-3 text-center",children:e.jsx("small",{className:"text-muted d-block",children:_(s.fecha_inicio)})}),t==="abiertos"&&e.jsx("td",{className:"px-3 py-3 text-center",children:e.jsx("small",{className:"text-muted d-block",children:_(s.fecha_fin)})}),e.jsxs("td",{className:"px-3 py-3 text-center",children:[e.jsxs("div",{className:"d-none d-md-inline-flex gap-2 align-items-center justify-content-center",children:[e.jsxs("button",{onClick:()=>l(`/ver/${t==="abiertos"&&s.cuestionario_id||s.id}`),className:"btn btn-outline-secondary btn-sm",title:"Ver cuestionario",style:{borderColor:"#2c3e50",color:"#ffffff"},children:[e.jsx(G,{className:"me-1"}),"Ver"]}),t==="mis"&&e.jsxs("button",{onClick:()=>c?.(s.id,s.titulo),className:"btn btn-outline-secondary btn-sm",title:"Crear apertura",style:{borderColor:"#2c3e50",color:"#ffffff"},children:[e.jsx(V,{className:"me-1"}),"Apertura"]}),t==="abiertos"&&e.jsxs("button",{onClick:()=>b?.(s.apertura_id||s.id,s.titulo||"Este cuestionario"),className:"btn btn-outline-danger btn-sm",title:"Cerrar apertura",children:[e.jsx(K,{className:"me-1"}),"Cerrar"]})]}),e.jsxs("div",{className:"position-relative d-inline-flex row-actions-container d-md-none ms-1",ref:v,children:[e.jsx("button",{className:"btn btn-link text-decoration-none border-0 p-1 d-inline-flex align-items-center",onClick:d=>{d.stopPropagation(),p(N=>N===(s.apertura_id||s.id)?null:s.apertura_id||s.id||s.id)},"aria-haspopup":"true","aria-expanded":x===(s.apertura_id||s.id),title:"Acciones",style:{color:"#2c3e50"},children:e.jsx(ae,{size:18})}),x===(s.apertura_id||s.id)&&e.jsxs("div",{className:"dropdown-menu show",style:{position:"absolute",right:0,bottom:"100%",marginBottom:"0.25rem",display:"block",minWidth:"10rem",boxShadow:"0 10px 25px rgba(0,0,0,.08)",borderRadius:"12px",zIndex:2050},children:[e.jsxs("button",{className:"dropdown-item d-flex align-items-center gap-2",onClick:()=>{const d=t==="abiertos"&&s.cuestionario_id||s.id;l(`/ver/${d}`),p(null)},children:[e.jsx(G,{})," Ver"]}),t==="mis"&&e.jsxs("button",{className:"dropdown-item d-flex align-items-center gap-2",onClick:()=>{c?.(s.id,s.titulo),p(null)},children:[e.jsx(V,{})," Apertura"]}),t==="abiertos"&&e.jsxs("button",{className:"dropdown-item d-flex align-items-center gap-2",onClick:()=>{const d=s.apertura_id||s.id;b?.(d,s.titulo||"Este cuestionario"),p(null)},children:[e.jsx(K,{})," Cerrar"]})]})]})]})]},t==="abiertos"&&s.apertura_id||s.id)})})]})})})})},we=({activeTab:o,onTabChange:t})=>{const c=H(),[b,l]=a.useState(!1),g=a.useRef(null),_=a.useRef(null);return a.useEffect(()=>{const m=x=>{const p=x.target,v=g.current?.contains(p),s=_.current?.contains(p);!v&&!s&&l(!1)};return document.addEventListener("click",m),()=>document.removeEventListener("click",m)},[]),e.jsxs("div",{className:"d-flex justify-content-between align-items-center",style:{margin:"0",padding:"0"},children:[e.jsxs("div",{className:"d-flex justify-content-between",children:[e.jsxs("div",{className:"d-flex tabs-scroll",children:[e.jsxs("button",{className:`btn btn-link tab-link text-decoration-none border-0 rounded-0 px-4 py-3 ${o==="mis"?"border-bottom border-2":"text-muted"}`,onClick:()=>t("mis"),"data-tab":"mis",style:{margin:"0",color:"#ffffff",borderBottomColor:o==="mis"?"#3b82f6":"transparent",fontWeight:"500"},children:[e.jsx("i",{className:"fas fa-file-alt me-3"}),"Mis Cuestionarios"]}),e.jsxs("button",{className:`btn btn-link tab-link text-decoration-none border-0 rounded-0 px-4 py-3 ${o==="abiertos"?"border-bottom border-2":"text-muted"}`,onClick:()=>t("abiertos"),"data-tab":"abiertos",style:{margin:"0",color:"#ffffff",borderBottomColor:o==="abiertos"?"#3b82f6":"transparent",fontWeight:"500"},children:[e.jsx("i",{className:"fas fa-calendar-check me-3"}),"Cuestionarios Abiertos"]})]}),e.jsxs("div",{className:"position-relative d-inline-flex d-md-none ms-2",ref:_,children:[e.jsx("button",{className:"btn btn-link text-decoration-none border-0 px-3 py-3 d-inline-flex align-items-center mobile-actions-btn",onClick:()=>l(m=>!m),"aria-expanded":b,"aria-haspopup":"true",style:{color:"#ffffff",backgroundColor:"#e67e22",borderRadius:"8px"},title:"Acciones",children:e.jsx(oe,{size:18})}),b&&e.jsxs("div",{className:"dropdown-menu show",style:{position:"absolute",right:0,top:"100%",marginTop:"0.25rem",display:"block"},children:[e.jsxs("button",{className:"dropdown-item d-flex align-items-center gap-2",onClick:()=>{l(!1),c("/crear-cuestionario")},children:[e.jsx(U,{})," Crear Cuestionario"]}),e.jsxs("button",{className:"dropdown-item d-flex align-items-center gap-2",onClick:()=>{const m=`${window.location.origin}/login-estudiante`;navigator.clipboard.writeText(m).then(()=>{l(!1),h.fire({title:"¡Link copiado!",text:"El link del estudiante ha sido copiado al portapapeles",icon:"success",confirmButtonColor:"#22c55e",timer:2e3,showConfirmButton:!1})}).catch(()=>{l(!1),h.fire({title:"Error",text:"No se pudo copiar el link al portapapeles",icon:"error",confirmButtonColor:"#ef4444"})})},children:[e.jsx(Y,{})," Copiar Link Estudiante"]})]})]})]}),e.jsx("div",{className:"d-flex align-items-center",ref:g,children:e.jsxs("div",{className:"d-none d-md-inline-flex gap-2",children:[e.jsxs("button",{className:"btn btn-outline-secondary btn-sm4 d-inline-flex align-items-center gap-2 fw-semibold",onClick:()=>c("/crear-cuestionario"),style:{borderColor:"#00a19B",color:"#00a19B"},children:[e.jsx(U,{className:"me-2"}),"Crear Cuestionario"]}),e.jsxs("button",{className:"btn btn-outline-secondary btn-sm4 d-inline-flex align-items-center gap-2 fw-semibold",onClick:()=>{const m=`${window.location.origin}/login-estudiante`;navigator.clipboard.writeText(m).then(()=>{h.fire({title:"¡Link copiado!",text:"El link del estudiante ha sido copiado al portapapeles",icon:"success",confirmButtonColor:"#22c55e",timer:2e3,showConfirmButton:!1})}).catch(()=>{h.fire({title:"Error",text:"No se pudo copiar el link al portapapeles",icon:"error",confirmButtonColor:"#ef4444"})})},style:{borderColor:"#00a19B",color:"#00a19B"},children:[e.jsx(Y,{className:"me-2"}),"Copiar Link Estudiante"]})]})})]})},_e="_crearBtn_almqh_580",Ae="_emptyMessage_almqh_1273",z={crearBtn:_e,"animate-spin":"_animate-spin_almqh_718",emptyMessage:Ae},ke=({tipo:o})=>{const t=H();return o==="mis"?e.jsxs("div",{className:z.emptyMessage,children:[e.jsx("p",{children:"No has creado ningún cuestionario aún."}),e.jsxs("button",{onClick:()=>t("/crear-cuestionario"),className:z.crearBtn,style:{maxWidth:"250px",margin:"1rem auto 0"},children:[e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("line",{x1:"12",y1:"5",x2:"12",y2:"19"}),e.jsx("line",{x1:"5",y1:"12",x2:"19",y2:"12"})]}),"Crear mi primer cuestionario"]})]}):e.jsx("div",{className:z.emptyMessage,children:e.jsx("p",{children:"No hay cuestionarios abiertos."})})},Ee=()=>e.jsxs("div",{className:z.emptyMessage,children:[e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:z["animate-spin"],children:[e.jsx("circle",{cx:"12",cy:"12",r:"10"}),e.jsx("path",{d:"M12 6v6l4 2"})]}),e.jsx("p",{children:"Cargando..."})]});function Be({userId:o}){const[t,c]=a.useState([]),[b,l]=a.useState([]),[g,_]=a.useState("mis"),[m,x]=a.useState(!1),[p,v]=a.useState(!1),[s,i]=a.useState(),[d,N]=a.useState(),[E,r]=a.useState(0),[n,B]=a.useState(0),$=a.useContext(Z)?.user,T=$?.programa_id,R=a.useCallback(async()=>{if(o){x(!0);try{const[A,f]=await Promise.all([M.get(P.cuestionario.base),M.get(P.programas.base).catch(()=>({data:[]}))]),C=A.data,y=Array.isArray(C)?C:Array.isArray(C?.mis_cuestionarios)?C.mis_cuestionarios:Array.isArray(C?.cuestionarios)?C.cuestionarios:Array.isArray(C?.data?.cuestionarios)?C.data.cuestionarios:Array.isArray(C?.data)?C.data:[],j=f?.data?.data??f?.data,L=Array.isArray(j?.programas)?j.programas:Array.isArray(j?.programa)?j.programa:Array.isArray(f?.data)?f?.data:[],W=new Map;L.forEach(k=>{k?.id&&k?.nombre&&W.set(Number(k.id),String(k.nombre))});const S=y.map(k=>({...k,programa_nombre:k.programa_nombre||W.get(Number(k.id_programa))||k.programa||"No especificado"})),F=T?S.filter(k=>k.id_programa===T):S;c(F);const w=(await M.get(P.cuestionario.abiertos)).data,Q=Array.isArray(w)?w:Array.isArray(w?.cuestionarios_abiertos)?w.cuestionarios_abiertos:Array.isArray(w?.abiertos)?w.abiertos:Array.isArray(w?.data?.cuestionarios_abiertos)?w.data.cuestionarios_abiertos:Array.isArray(w?.data?.cuestionarios)?w.data.cuestionarios:Array.isArray(w?.data)?w.data:[];l(Q)}catch(A){console.error("Error al cargar cuestionarios:",A),c([]),l([])}finally{x(!1)}}},[o,T]),D=a.useCallback(async()=>{if(o)try{const f=(await M.get(P.estudiante.base).catch(L=>{if(L?.response?.status===404)return{data:{estudiantes:[]}};throw L}))?.data,y=[Array.isArray(f?.estudiantes)?f?.estudiantes:void 0,Array.isArray(f?.data?.estudiantes)?f?.data?.estudiantes:void 0,Array.isArray(f)?f:void 0].filter(Boolean)[0]||[];let j=y;if(T){const L=["id_programa","programa_id","idPrograma","programaId"];y.some(S=>L.some(F=>S?.[F]!=null))&&(j=y.filter(S=>L.some(F=>Number(S?.[F])===Number(T))))}r(j.length),B(0)}catch(A){console.error("Error al cargar estadísticas:",A),r(0),B(0)}},[o,T]),O=a.useRef(!1);a.useEffect(()=>{!o||O.current||(O.current=!0,R(),D())},[o,R,D]);const J=(A,f)=>{i(A),N(f),v(!0)},q=()=>{v(!1),i(void 0),N(void 0)};return{misCuestionarios:t,abiertos:b,activeTab:g,loading:m,modalAperturaOpen:p,selectedCuestionarioId:s,selectedCuestionarioTitulo:d,totalEstudiantes:E,respuestasPendientes:n,setActiveTab:_,handleAperturaClick:J,handleModalClose:q,handleModalSuccess:()=>{R(),q()},handleCerrarApertura:async(A,f)=>{try{const j=(await M.get(P.asignacion.obtener($?.id||"me")).catch(()=>({data:{asignaciones:[]}})))?.data,S=([Array.isArray(j?.asignaciones)?j?.asignaciones:void 0,Array.isArray(j?.data?.asignaciones)?j?.data?.asignaciones:void 0,Array.isArray(j)?j:void 0].filter(Boolean)[0]||[]).filter(F=>Number(F?.id_apertura)===Number(A)).length;if(S>0){await h.fire({icon:"warning",title:"No se puede cerrar la apertura",text:`Esta apertura tiene ${S} asignación(es) activa(s). Elimine las asignaciones antes de cerrar la apertura.`,confirmButtonColor:"#f59e0b"});return}}catch(y){console.error("Error verificando asignaciones antes de cerrar:",y),await h.fire({icon:"error",title:"Error",text:"No se pudo verificar las asignaciones. Inténtalo nuevamente."});return}if((await h.fire({title:"¿Cerrar apertura?",text:`¿Estás seguro de que deseas cerrar la apertura del cuestionario "${f}"? Los estudiantes no podrán realizar este cuestionario una vez cerrado.`,icon:"warning",showCancelButton:!0,confirmButtonColor:"#ef4444",cancelButtonColor:"#6b7280",confirmButtonText:"Sí, cerrar",cancelButtonText:"Cancelar"})).isConfirmed)try{x(!0);const y=await M.delete(`/aperturas/${A}`);if(y.data.success)await h.fire({title:"¡Apertura cerrada!",text:"La apertura ha sido cerrada exitosamente.",icon:"success",confirmButtonColor:"#22c55e"}),await R();else throw new Error(y.data.error||"Error al cerrar la apertura")}catch(y){console.error("Error al cerrar apertura:",y),await h.fire({title:"Error",text:y.message||"Error de conexión al cerrar la apertura",icon:"error",confirmButtonColor:"#ef4444"})}finally{x(!1)}},cargarCuestionarios:R,cargarEstadisticas:D}}const We=()=>{const{user:o,isAuthenticated:t}=X(),{misCuestionarios:c,abiertos:b,activeTab:l,loading:g,modalAperturaOpen:_,selectedCuestionarioId:m,selectedCuestionarioTitulo:x,totalEstudiantes:p,setActiveTab:v,handleAperturaClick:s,handleModalClose:i,handleModalSuccess:d,handleCerrarApertura:N}=Be({userId:o?.id}),E=()=>{if(g)return e.jsx(Ee,{});if(!o)return e.jsx("div",{className:"text-center text-muted",children:"No hay usuario autenticado"});const r=l==="mis"?c:b;return r.length===0?e.jsx(ke,{tipo:l}):e.jsx(Ce,{cuestionarios:r,tipo:l,onAperturaClick:l==="mis"?s:void 0,onCerrarApertura:l==="abiertos"?N:void 0})};return t?e.jsx(ee,{children:e.jsxs("div",{className:"d-flex flex-column",style:{marginTop:"0",paddingTop:"0",backgroundColor:"white",minHeight:"100vh"},children:[e.jsxs("div",{className:"container-fluid d-flex flex-column",style:{margin:"0",padding:"20px"},children:[e.jsxs("div",{className:"row g-4 mb-4",children:[e.jsx("div",{className:"col-12 col-sm-6 col-md-4",children:e.jsx("div",{className:"card border-0 shadow-sm cursor-pointer h-100",title:"Cuestionarios que has creado",style:{cursor:"pointer",backgroundColor:"#ffffff",border:"1px solid rgba(34, 197, 94, 0.1)"},children:e.jsxs("div",{className:"card-body d-flex align-items-center justify-content-between py-4",children:[e.jsx("div",{className:"rounded-circle d-flex align-items-center justify-content-center",style:{width:"80px",height:"80px",backgroundColor:"rgba(34, 197, 94, 0.1)"},children:e.jsx(se,{style:{color:"#22c55e"},size:32})}),e.jsxs("div",{className:"d-flex flex-column text-end",children:[e.jsx("h4",{className:"mb-1 fw-bold",style:{color:"#ffffff",fontSize:"2rem"},children:c.length}),e.jsx("p",{className:"text-muted mb-0 small",children:"Mis Cuestionarios"})]})]})})}),e.jsx("div",{className:"col-12 col-sm-6 col-md-4",children:e.jsx("div",{className:"card border-0 shadow-sm cursor-pointer h-100",title:"Cuestionarios abiertos para resolver",style:{cursor:"pointer",backgroundColor:"#ffffff",border:"1px solid rgba(59, 130, 246, 0.1)"},children:e.jsxs("div",{className:"card-body d-flex align-items-center justify-content-between py-4",children:[e.jsx("div",{className:"rounded-circle d-flex align-items-center justify-content-center",style:{width:"80px",height:"80px",backgroundColor:"rgba(59, 130, 246, 0.1)"},children:e.jsx(re,{className:"mb-1",style:{color:"#3b82f6"},size:32})}),e.jsxs("div",{className:"d-flex flex-column text-end",children:[e.jsx("h4",{className:"mb-1 fw-bold",style:{color:"#ffffff",fontSize:"2rem"},children:b.length}),e.jsx("p",{className:"text-muted mb-0 small",children:"Cuestionarios Abiertos"})]})]})})}),e.jsx("div",{className:"col-12 col-sm-12 col-md-4",children:e.jsx("div",{className:"card border-0 shadow-sm cursor-pointer h-100",title:"Estudiantes del programa",style:{cursor:"pointer",backgroundColor:"#ffffff",border:"1px solid rgba(245, 158, 11, 0.1)"},children:e.jsxs("div",{className:"card-body d-flex align-items-center justify-content-between py-4",children:[e.jsx("div",{className:"rounded-circle d-flex align-items-center justify-content-center",style:{width:"80px",height:"80px",backgroundColor:"rgba(245, 158, 11, 0.1)"},children:e.jsx(te,{style:{color:"#f59e0b"},size:32})}),e.jsxs("div",{className:"d-flex flex-column text-end",children:[e.jsx("h4",{className:"mb-1 fw-bold",style:{color:"#f59e0b",fontSize:"2rem"},children:p}),e.jsx("p",{className:"text-muted mb-0 small",children:"Estudiantes"})]})]})})})]}),e.jsx("div",{className:"row g-4 mb-4"}),e.jsx("div",{className:"row flex-grow-1",style:{margin:"0"},children:e.jsx("div",{className:"col-12 d-flex flex-column",children:e.jsxs("div",{className:"card border-0 shadow-sm flex-grow-1 d-flex flex-column",style:{backgroundColor:"#ffffff",border:"1px solid rgba(59, 130, 246, 0.1)"},children:[e.jsx("div",{className:"card-header border-0 py-3",style:{backgroundColor:"transparent"},children:e.jsx(we,{activeTab:l,onTabChange:v,misCuestionariosCount:c.length,abiertosCount:b.length})}),e.jsx("div",{className:"card-body p-0 flex-grow-1 d-flex flex-column",children:E()})]})})})]}),e.jsx(ve,{isOpen:_,onClose:i,cuestionarioId:m,cuestionarioTitulo:x,onSuccess:d})]})}):e.jsx("div",{style:{minHeight:"100vh",display:"flex",justifyContent:"center",alignItems:"center",backgroundColor:"#f8f9fa"},children:e.jsxs("div",{className:"text-center",children:[e.jsx("h3",{children:"No estás autenticado"}),e.jsx("p",{children:"Redirigiendo al login..."})]})})};export{We as default};
