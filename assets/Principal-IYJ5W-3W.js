import{r as a,b as M,A as F,S as E,j as e,a as H,d as Q}from"./index-W0ZSjH-A.js";import{P as Z}from"./PageTransition-DHV3GPNa.js";import{u as Y}from"./useAuthentication-MUtYQDm0.js";import{d as G,v as V,w as K,x as U,i as ee,y as se,z as re}from"./index-DfAB-zHd.js";import{F as te,a as ae}from"./index-BNBGvJyH.js";import"./iconBase-BFfBqceE.js";const oe="_modalOverlay_zzmsl_3",ie="_modalContent_zzmsl_51",ne="_modalHeader_zzmsl_97",le="_closeButton_zzmsl_133",ce="_modalBody_zzmsl_171",de="_loading_zzmsl_181",me="_spinner_zzmsl_199",ue="_formGroup_zzmsl_229",xe="_cuestionarioInfo_zzmsl_255",fe="_cuestionarioCard_zzmsl_263",pe="_loadingCuestionario_zzmsl_325",he="_selectField_zzmsl_345",be="_modalFooter_zzmsl_391",ge="_cancelButton_zzmsl_409",ye="_submitButton_zzmsl_411",x={modalOverlay:oe,modalContent:ie,modalHeader:ne,closeButton:le,modalBody:ce,loading:de,spinner:me,formGroup:ue,cuestionarioInfo:xe,cuestionarioCard:fe,loadingCuestionario:pe,selectField:he,modalFooter:be,cancelButton:ge,submitButton:ye},je=({isOpen:o,onClose:t,cuestionarioId:d,cuestionarioTitulo:h,onSuccess:c})=>{const{user:b}=Y(),[_,N]=a.useState([]),[f,u]=a.useState(""),[v,s]=a.useState(!1);a.useEffect(()=>{o&&b?.id&&n()},[o,b?.id]);const n=async()=>{try{s(!0);const r=await M.get(F.aperturas.periodosActivos),l=r?.data?.data??r?.data,z=Array.isArray(l?.periodos)?l.periodos:Array.isArray(r?.data)?r?.data:[];N(z)}catch(r){E.fire({icon:"error",title:"Error",text:r instanceof Error?r.message:"Error al cargar los datos"})}finally{s(!1)}},i=async r=>{if(r.preventDefault(),!f){E.fire({icon:"warning",title:"Campo requerido",text:"Por favor selecciona un periodo"});return}if(!d){E.fire({icon:"error",title:"Error",text:"No se pudo cargar la información del cuestionario"});return}try{s(!0);const l=await M.post(F.aperturas.crear,{cuestionario_id:Number(d),periodo_id:Number(f),usuario_id:b?.id}),z=l?.data?.data??l?.data;E.fire({icon:"success",title:"¡Éxito!",text:z?.message||"Apertura creada correctamente",timer:1500,showConfirmButton:!1}),u(""),c?.(),t()}catch(l){const z=l?.response?.status,T=l?.response?.data?.message||l?.response?.data?.error;z===409?E.fire({icon:"warning",title:"Conflicto",text:T||"Ya existe una apertura para este cuestionario en el período seleccionado"}):E.fire({icon:"error",title:"Error",text:T||(l instanceof Error?l.message:"Error al crear la apertura")})}finally{s(!1)}},m=r=>{if(!r)return"";const l=r.split("T")[0].split("-");return l.length===3?`${l[2]}/${l[1]}/${l[0]}`:r},g=r=>{r.target===r.currentTarget&&t()};return o?e.jsx("div",{className:x.modalOverlay,onClick:g,children:e.jsxs("div",{className:x.modalContent,children:[e.jsxs("div",{className:x.modalHeader,children:[e.jsxs("h3",{children:[e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("rect",{x:"3",y:"4",width:"18",height:"18",rx:"2",ry:"2"}),e.jsx("line",{x1:"16",y1:"2",x2:"16",y2:"6"}),e.jsx("line",{x1:"8",y1:"2",x2:"8",y2:"6"}),e.jsx("line",{x1:"3",y1:"10",x2:"21",y2:"10"})]}),"Abrir Cuestionario"]}),e.jsx("button",{onClick:t,className:x.closeButton,type:"button",children:e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),e.jsx("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]})})]}),e.jsx("div",{className:x.modalBody,children:v?e.jsxs("div",{className:x.loading,children:[e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:x.spinner,children:[e.jsx("circle",{cx:"12",cy:"12",r:"10"}),e.jsx("path",{d:"M12 6v6l4 2"})]}),e.jsx("p",{children:"Cargando..."})]}):e.jsxs("form",{onSubmit:i,children:[e.jsxs("div",{className:x.formGroup,children:[e.jsx("label",{children:"Cuestionario Seleccionado"}),d?e.jsx("div",{className:x.cuestionarioInfo,children:e.jsx("div",{className:x.cuestionarioCard,children:e.jsx("h4",{children:h||"Cuestionario"})})}):e.jsx("div",{className:x.loadingCuestionario,children:e.jsx("span",{children:"Cargando información del cuestionario..."})})]}),e.jsxs("div",{className:x.formGroup,children:[e.jsx("label",{htmlFor:"periodo_id",children:"Período"}),e.jsxs("select",{id:"periodo_id",value:f,onChange:r=>u(r.target.value),required:!0,className:x.selectField,children:[e.jsx("option",{value:"",children:"Seleccionar período"}),_.map(r=>e.jsxs("option",{value:r.id,children:[r.nombre," (",m(r.fecha_inicio)," - ",m(r.fecha_fin),")"]},r.id))]})]}),e.jsxs("div",{className:x.modalFooter,children:[e.jsx("button",{type:"submit",className:x.submitButton,disabled:v||!d,children:v?"Creando...":"Crear Apertura"}),e.jsx("button",{type:"button",onClick:t,className:x.cancelButton,children:"Cancelar"})]})]})})]})}):null},Ne=({cuestionarios:o,tipo:t,onAperturaClick:d,onCerrarApertura:h})=>{const c=H(),b=s=>{if(!s)return null;const n=String(s).trim(),i=n.match(/^(\d{4})-(\d{2})-(\d{2})(?:[ T](\d{2}):(\d{2})(?::(\d{2}))?)?$/);if(!i)return new Date(n.replace(" ","T"));const[m,g,r,l,z="0",T="0",$="0"]=i;return new Date(+g,+r-1,+l,+z,+T,+$)},_=s=>{if(!s)return"No especificado";const n=b(s);return!n||isNaN(n.getTime())?"No especificado":n.toLocaleDateString("es-ES",{year:"numeric",month:"short",day:"numeric"})},N=(s,n)=>{const i=new Date,m=b(s),g=b(n);return m&&i<m?{available:!1,status:"programado"}:g&&i>g?{available:!1,status:"expirado"}:{available:!0,status:"disponible"}},[f,u]=a.useState(null),v=a.useRef(null);return a.useEffect(()=>{const s=n=>{n.target.closest(".row-actions-container")||u(null)};return document.addEventListener("click",s),()=>document.removeEventListener("click",s)},[]),e.jsx("div",{className:"card border-0",children:e.jsx("div",{className:"card-body p-0",children:e.jsx("div",{className:"table-responsive quizzes-table-responsive",style:{overflowX:"auto",overflowY:"visible"},children:e.jsxs("table",{className:"table table-borderless mb-0",children:[e.jsx("thead",{className:"table-light",children:e.jsxs("tr",{children:[e.jsx("th",{className:"border-0 px-3 py-3 text-center",children:e.jsxs("div",{className:"d-flex align-items-center justify-content-center",children:[e.jsx("i",{className:"fas fa-file-alt me-2"}),"Cuestionario"]})}),e.jsx("th",{className:"border-0 px-3 py-3 text-center",children:e.jsxs("div",{className:"d-flex align-items-center justify-content-center",children:[e.jsx("i",{className:"fas fa-graduation-cap me-2"}),"Programa"]})}),t==="abiertos"&&e.jsx("th",{className:"border-0 px-3 py-3 text-center",children:e.jsxs("div",{className:"d-flex align-items-center justify-content-center",children:[e.jsx("i",{className:"fas fa-calendar me-2"}),"Periodo"]})}),t==="abiertos"&&e.jsx("th",{className:"border-0 px-3 py-3 text-center",children:e.jsxs("div",{className:"d-flex align-items-center justify-content-center",children:[e.jsx("i",{className:"fas fa-play me-2"}),"Inicio"]})}),t==="abiertos"&&e.jsx("th",{className:"border-0 px-3 py-3 text-center",children:e.jsxs("div",{className:"d-flex align-items-center justify-content-center",children:[e.jsx("i",{className:"fas fa-stop me-2"}),"Fin"]})}),e.jsx("th",{className:"border-0 px-3 py-3 text-center",children:e.jsxs("div",{className:"d-flex align-items-center justify-content-center",children:[e.jsx("i",{className:"fas fa-cogs me-2"}),"Acciones"]})})]})}),e.jsx("tbody",{children:o.map(s=>{const n=t==="abiertos"?N(s.fecha_inicio,s.fecha_fin):null;return e.jsxs("tr",{className:"border-bottom",children:[e.jsx("td",{className:"px-3 py-3 text-center",children:e.jsxs("div",{className:"d-flex flex-column align-items-center",children:[e.jsx("h6",{className:"mb-1 fw-bold text-primary text-truncate",style:{maxWidth:"200px"},title:s.titulo||"Sin título",children:s.titulo||"Sin título"}),e.jsx("p",{className:"mb-1 text-muted small text-truncate",style:{maxWidth:"200px"},title:s.descripcion||"Sin descripción",children:s.descripcion||"Sin descripción"}),t==="abiertos"&&e.jsx("span",{className:`badge rounded-pill ${n?.status==="disponible"?"bg-info bg-opacity-10 text-info":n?.status==="expirado"?"bg-danger bg-opacity-10 text-danger":"bg-warning bg-opacity-10 text-warning"}`,children:n?.status==="programado"?"Programado":n?.status==="expirado"?"Expirado":"Disponible"})]})}),e.jsx("td",{className:"px-3 py-3 text-center",children:e.jsx("span",{className:"badge bg-info bg-opacity-10 text-info rounded-pill text-truncate",style:{maxWidth:"150px"},title:s.programa_nombre||"No especificado",children:s.programa_nombre||"No especificado"})}),t==="abiertos"&&e.jsx("td",{className:"px-3 py-3 text-center",children:e.jsx("span",{className:"badge bg-secondary bg-opacity-10 text-secondary rounded-pill text-truncate",style:{maxWidth:"120px"},title:s.periodo_nombre||"No especificado",children:s.periodo_nombre||"No especificado"})}),t==="abiertos"&&e.jsx("td",{className:"px-3 py-3 text-center",children:e.jsx("small",{className:"text-muted d-block",children:_(s.fecha_inicio)})}),t==="abiertos"&&e.jsx("td",{className:"px-3 py-3 text-center",children:e.jsx("small",{className:"text-muted d-block",children:_(s.fecha_fin)})}),e.jsxs("td",{className:"px-3 py-3 text-center",children:[e.jsxs("div",{className:"d-none d-md-inline-flex gap-2 align-items-center justify-content-center",children:[e.jsxs("button",{onClick:()=>c(`/ver/${t==="abiertos"&&s.cuestionario_id||s.id}`),className:"btn btn-outline-secondary btn-sm",title:"Ver cuestionario",style:{borderColor:"#2c3e50",color:"#ffffff"},children:[e.jsx(G,{className:"me-1"}),"Ver"]}),t==="mis"&&e.jsxs("button",{onClick:()=>d?.(s.id,s.titulo),className:"btn btn-outline-secondary btn-sm",title:"Crear apertura",style:{borderColor:"#2c3e50",color:"#ffffff"},children:[e.jsx(V,{className:"me-1"}),"Apertura"]}),e.jsxs("button",{onClick:()=>{const i=t==="abiertos"&&s.cuestionario_id||s.id,m=s.id_programa,g=s.programa_nombre,r=s.titulo;c(`/gestionar-nivel-cuestionario/${i}`,{state:{cuestionarioId:i,programaId:m,programaNombre:g,cuestionarioTitulo:r}})},className:"btn btn-outline-secondary btn-sm",title:"Gestionar niveles",style:{borderColor:"#2c3e50",color:"#ffffff"},children:[e.jsx("i",{className:"fas fa-edit"}),"Niveles"]}),t==="abiertos"&&e.jsxs("button",{onClick:()=>h?.(s.apertura_id||s.id,s.titulo||"Este cuestionario"),className:"btn btn-outline-danger btn-sm",title:"Cerrar apertura",children:[e.jsx(K,{className:"me-1"}),"Cerrar"]})]}),e.jsxs("div",{className:"position-relative d-inline-flex row-actions-container d-md-none ms-1",ref:v,children:[e.jsx("button",{className:"btn btn-link text-decoration-none border-0 p-1 d-inline-flex align-items-center",onClick:i=>{i.stopPropagation(),u(m=>m===(s.apertura_id||s.id)?null:s.apertura_id||s.id||s.id)},"aria-haspopup":"true","aria-expanded":f===(s.apertura_id||s.id),title:"Acciones",style:{color:"#2c3e50"},children:e.jsx(te,{size:18})}),f===(s.apertura_id||s.id)&&e.jsxs("div",{className:"dropdown-menu show",style:{position:"absolute",right:0,bottom:"100%",marginBottom:"0.25rem",display:"block",minWidth:"10rem",boxShadow:"0 10px 25px rgba(0,0,0,.08)",borderRadius:"12px",zIndex:2050},children:[e.jsxs("button",{className:"dropdown-item d-flex align-items-center gap-2",onClick:()=>{const i=t==="abiertos"&&s.cuestionario_id||s.id;c(`/ver/${i}`),u(null)},children:[e.jsx(G,{})," Ver"]}),t==="mis"&&e.jsxs("button",{className:"dropdown-item d-flex align-items-center gap-2",onClick:()=>{d?.(s.id,s.titulo),u(null)},children:[e.jsx(V,{})," Apertura"]}),e.jsxs("button",{className:"dropdown-item d-flex align-items-center gap-2",onClick:()=>{const i=t==="abiertos"&&s.cuestionario_id||s.id,m=s.id_programa,g=s.programa_nombre,r=s.titulo;c(`/gestionar-nivel-cuestionario/${i}`,{state:{cuestionarioId:i,programaId:m,programaNombre:g,cuestionarioTitulo:r}}),u(null)},children:[e.jsx("i",{className:"fas fa-edit"})," Niveles"]}),t==="abiertos"&&e.jsxs("button",{className:"dropdown-item d-flex align-items-center gap-2",onClick:()=>{const i=s.apertura_id||s.id;h?.(i,s.titulo||"Este cuestionario"),u(null)},children:[e.jsx(K,{})," Cerrar"]})]})]})]})]},t==="abiertos"&&s.apertura_id||s.id)})})]})})})})},ve=({activeTab:o,onTabChange:t})=>{const d=H(),[h,c]=a.useState(!1),b=a.useRef(null),_=a.useRef(null);return a.useEffect(()=>{const N=f=>{const u=f.target,v=b.current?.contains(u),s=_.current?.contains(u);!v&&!s&&c(!1)};return document.addEventListener("click",N),()=>document.removeEventListener("click",N)},[]),e.jsxs("div",{className:"d-flex justify-content-between align-items-center",style:{margin:"0",padding:"0"},children:[e.jsxs("div",{className:"d-flex justify-content-between",children:[e.jsxs("div",{className:"d-flex tabs-scroll",children:[e.jsxs("button",{className:`btn btn-link tab-link text-decoration-none border-0 rounded-0 px-4 py-3 ${o==="mis"?"border-bottom border-2":"text-muted"}`,onClick:()=>t("mis"),"data-tab":"mis",style:{margin:"0",color:"#ffffff",borderBottomColor:o==="mis"?"#3b82f6":"transparent",fontWeight:"500"},children:[e.jsx("i",{className:"fas fa-file-alt me-3"}),"Mis Cuestionarios"]}),e.jsxs("button",{className:`btn btn-link tab-link text-decoration-none border-0 rounded-0 px-4 py-3 ${o==="abiertos"?"border-bottom border-2":"text-muted"}`,onClick:()=>t("abiertos"),"data-tab":"abiertos",style:{margin:"0",color:"#ffffff",borderBottomColor:o==="abiertos"?"#3b82f6":"transparent",fontWeight:"500"},children:[e.jsx("i",{className:"fas fa-calendar-check me-3"}),"Cuestionarios Abiertos"]})]}),e.jsxs("div",{className:"position-relative d-inline-flex d-md-none ms-2",ref:_,children:[e.jsx("button",{className:"btn btn-link text-decoration-none border-0 px-3 py-3 d-inline-flex align-items-center mobile-actions-btn",onClick:()=>c(N=>!N),"aria-expanded":h,"aria-haspopup":"true",style:{color:"#ffffff",backgroundColor:"#e67e22",borderRadius:"8px"},title:"Acciones",children:e.jsx(ae,{size:18})}),h&&e.jsx("div",{className:"dropdown-menu show",style:{position:"absolute",right:0,top:"100%",marginTop:"0.25rem",display:"block"},children:e.jsxs("button",{className:"dropdown-item d-flex align-items-center gap-2",onClick:()=>{c(!1),d("/crear-cuestionario")},children:[e.jsx(U,{})," Crear Cuestionario"]})})]})]}),e.jsx("div",{className:"d-flex align-items-center",ref:b,children:e.jsx("div",{className:"d-none d-md-inline-flex gap-2",children:e.jsxs("button",{className:"btn btn-outline-secondary btn-sm4 d-inline-flex align-items-center gap-2 fw-semibold",onClick:()=>d("/crear-cuestionario"),style:{borderColor:"#00a19B",color:"#00a19B"},children:[e.jsx(U,{className:"me-2"}),"Crear Cuestionario"]})})})]})},Ce="_crearBtn_almqh_580",we="_emptyMessage_almqh_1273",R={crearBtn:Ce,"animate-spin":"_animate-spin_almqh_718",emptyMessage:we},_e=({tipo:o})=>{const t=H();return o==="mis"?e.jsxs("div",{className:R.emptyMessage,children:[e.jsx("p",{children:"No has creado ningún cuestionario aún."}),e.jsxs("button",{onClick:()=>t("/crear-cuestionario"),className:R.crearBtn,style:{maxWidth:"250px",margin:"1rem auto 0"},children:[e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("line",{x1:"12",y1:"5",x2:"12",y2:"19"}),e.jsx("line",{x1:"5",y1:"12",x2:"19",y2:"12"})]}),"Crear mi primer cuestionario"]})]}):e.jsx("div",{className:R.emptyMessage,children:e.jsx("p",{children:"No hay cuestionarios abiertos."})})},Ae=()=>e.jsxs("div",{className:R.emptyMessage,children:[e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:R["animate-spin"],children:[e.jsx("circle",{cx:"12",cy:"12",r:"10"}),e.jsx("path",{d:"M12 6v6l4 2"})]}),e.jsx("p",{children:"Cargando..."})]});function ke({userId:o}){const[t,d]=a.useState([]),[h,c]=a.useState([]),[b,_]=a.useState("mis"),[N,f]=a.useState(!1),[u,v]=a.useState(!1),[s,n]=a.useState(),[i,m]=a.useState(),[g,r]=a.useState(0),[l,z]=a.useState(0),$=a.useContext(Q)?.user,L=$?.programa_id,I=a.useCallback(async()=>{if(o){f(!0);try{const[A,p]=await Promise.all([M.get(F.cuestionario.base),M.get(F.programas.base).catch(()=>({data:[]}))]),C=A.data,y=Array.isArray(C)?C:Array.isArray(C?.mis_cuestionarios)?C.mis_cuestionarios:Array.isArray(C?.cuestionarios)?C.cuestionarios:Array.isArray(C?.data?.cuestionarios)?C.data.cuestionarios:Array.isArray(C?.data)?C.data:[],j=p?.data?.data??p?.data,S=Array.isArray(j?.programas)?j.programas:Array.isArray(j?.programa)?j.programa:Array.isArray(p?.data)?p?.data:[],W=new Map;S.forEach(k=>{k?.id&&k?.nombre&&W.set(Number(k.id),String(k.nombre))});const B=y.map(k=>({...k,programa_nombre:k.programa_nombre||W.get(Number(k.id_programa))||k.programa||"No especificado"})),P=L?B.filter(k=>k.id_programa===L):B;d(P);const w=(await M.get(F.cuestionario.abiertos)).data,J=Array.isArray(w)?w:Array.isArray(w?.cuestionarios_abiertos)?w.cuestionarios_abiertos:Array.isArray(w?.abiertos)?w.abiertos:Array.isArray(w?.data?.cuestionarios_abiertos)?w.data.cuestionarios_abiertos:Array.isArray(w?.data?.cuestionarios)?w.data.cuestionarios:Array.isArray(w?.data)?w.data:[];c(J)}catch(A){console.error("Error al cargar cuestionarios:",A),d([]),c([])}finally{f(!1)}}},[o,L]),D=a.useCallback(async()=>{if(o)try{const p=(await M.get(F.estudiante.base).catch(S=>{if(S?.response?.status===404)return{data:{estudiantes:[]}};throw S}))?.data,y=[Array.isArray(p?.estudiantes)?p?.estudiantes:void 0,Array.isArray(p?.data?.estudiantes)?p?.data?.estudiantes:void 0,Array.isArray(p)?p:void 0].filter(Boolean)[0]||[];let j=y;if(L){const S=["id_programa","programa_id","idPrograma","programaId"];y.some(B=>S.some(P=>B?.[P]!=null))&&(j=y.filter(B=>S.some(P=>Number(B?.[P])===Number(L))))}r(j.length),z(0)}catch(A){console.error("Error al cargar estadísticas:",A),r(0),z(0)}},[o,L]),O=a.useRef(!1);a.useEffect(()=>{!o||O.current||(O.current=!0,I(),D())},[o,I,D]);const X=(A,p)=>{n(A),m(p),v(!0)},q=()=>{v(!1),n(void 0),m(void 0)};return{misCuestionarios:t,abiertos:h,activeTab:b,loading:N,modalAperturaOpen:u,selectedCuestionarioId:s,selectedCuestionarioTitulo:i,totalEstudiantes:g,respuestasPendientes:l,setActiveTab:_,handleAperturaClick:X,handleModalClose:q,handleModalSuccess:()=>{I(),q()},handleCerrarApertura:async(A,p)=>{try{const j=(await M.get(F.asignacion.obtener($?.id||"me")).catch(()=>({data:{asignaciones:[]}})))?.data,B=([Array.isArray(j?.asignaciones)?j?.asignaciones:void 0,Array.isArray(j?.data?.asignaciones)?j?.data?.asignaciones:void 0,Array.isArray(j)?j:void 0].filter(Boolean)[0]||[]).filter(P=>Number(P?.id_apertura)===Number(A)).length;if(B>0){await E.fire({icon:"warning",title:"No se puede cerrar la apertura",text:`Esta apertura tiene ${B} asignación(es) activa(s). Elimine las asignaciones antes de cerrar la apertura.`,confirmButtonColor:"#f59e0b"});return}}catch(y){console.error("Error verificando asignaciones antes de cerrar:",y),await E.fire({icon:"error",title:"Error",text:"No se pudo verificar las asignaciones. Inténtalo nuevamente."});return}if((await E.fire({title:"¿Cerrar apertura?",text:`¿Estás seguro de que deseas cerrar la apertura del cuestionario "${p}"? Los estudiantes no podrán realizar este cuestionario una vez cerrado.`,icon:"warning",showCancelButton:!0,confirmButtonColor:"#ef4444",cancelButtonColor:"#6b7280",confirmButtonText:"Sí, cerrar",cancelButtonText:"Cancelar"})).isConfirmed)try{f(!0);const y=await M.delete(`/aperturas/${A}`);if(y.data.success)await E.fire({title:"¡Apertura cerrada!",text:"La apertura ha sido cerrada exitosamente.",icon:"success",confirmButtonColor:"#22c55e"}),await I();else throw new Error(y.data.error||"Error al cerrar la apertura")}catch(y){console.error("Error al cerrar apertura:",y),await E.fire({title:"Error",text:y.message||"Error de conexión al cerrar la apertura",icon:"error",confirmButtonColor:"#ef4444"})}finally{f(!1)}},cargarCuestionarios:I,cargarEstadisticas:D}}const Re=()=>{const{user:o,isAuthenticated:t}=Y(),{misCuestionarios:d,abiertos:h,activeTab:c,loading:b,modalAperturaOpen:_,selectedCuestionarioId:N,selectedCuestionarioTitulo:f,totalEstudiantes:u,setActiveTab:v,handleAperturaClick:s,handleModalClose:n,handleModalSuccess:i,handleCerrarApertura:m}=ke({userId:o?.id}),g=()=>{if(b)return e.jsx(Ae,{});if(!o)return e.jsx("div",{className:"text-center text-muted",children:"No hay usuario autenticado"});const r=c==="mis"?d:h;return r.length===0?e.jsx(_e,{tipo:c}):e.jsx(Ne,{cuestionarios:r,tipo:c,onAperturaClick:c==="mis"?s:void 0,onCerrarApertura:c==="abiertos"?m:void 0})};return t?e.jsx(Z,{children:e.jsxs("div",{className:"d-flex flex-column",style:{marginTop:"0",paddingTop:"0",backgroundColor:"white",minHeight:"100vh"},children:[e.jsxs("div",{className:"container-fluid d-flex flex-column",style:{margin:"0",padding:"20px"},children:[e.jsxs("div",{className:"row g-4 mb-4",children:[e.jsx("div",{className:"col-12 col-sm-6 col-md-4",children:e.jsx("div",{className:"card border-0 shadow-sm cursor-pointer h-100",title:"Cuestionarios que has creado",style:{cursor:"pointer",backgroundColor:"#ffffff",border:"1px solid rgba(34, 197, 94, 0.1)"},children:e.jsxs("div",{className:"card-body d-flex align-items-center justify-content-between py-4",children:[e.jsx("div",{className:"rounded-circle d-flex align-items-center justify-content-center",style:{width:"80px",height:"80px",backgroundColor:"rgba(34, 197, 94, 0.1)"},children:e.jsx(ee,{style:{color:"#22c55e"},size:32})}),e.jsxs("div",{className:"d-flex flex-column text-end",children:[e.jsx("h4",{className:"mb-1 fw-bold",style:{color:"#ffffff",fontSize:"2rem"},children:d.length}),e.jsx("p",{className:"text-muted mb-0 small",children:"Mis Cuestionarios"})]})]})})}),e.jsx("div",{className:"col-12 col-sm-6 col-md-4",children:e.jsx("div",{className:"card border-0 shadow-sm cursor-pointer h-100",title:"Cuestionarios abiertos para resolver",style:{cursor:"pointer",backgroundColor:"#ffffff",border:"1px solid rgba(59, 130, 246, 0.1)"},children:e.jsxs("div",{className:"card-body d-flex align-items-center justify-content-between py-4",children:[e.jsx("div",{className:"rounded-circle d-flex align-items-center justify-content-center",style:{width:"80px",height:"80px",backgroundColor:"rgba(59, 130, 246, 0.1)"},children:e.jsx(se,{className:"mb-1",style:{color:"#3b82f6"},size:32})}),e.jsxs("div",{className:"d-flex flex-column text-end",children:[e.jsx("h4",{className:"mb-1 fw-bold",style:{color:"#ffffff",fontSize:"2rem"},children:h.length}),e.jsx("p",{className:"text-muted mb-0 small",children:"Cuestionarios Abiertos"})]})]})})}),e.jsx("div",{className:"col-12 col-sm-12 col-md-4",children:e.jsx("div",{className:"card border-0 shadow-sm cursor-pointer h-100",title:"Estudiantes del programa",style:{cursor:"pointer",backgroundColor:"#ffffff",border:"1px solid rgba(245, 158, 11, 0.1)"},children:e.jsxs("div",{className:"card-body d-flex align-items-center justify-content-between py-4",children:[e.jsx("div",{className:"rounded-circle d-flex align-items-center justify-content-center",style:{width:"80px",height:"80px",backgroundColor:"rgba(245, 158, 11, 0.1)"},children:e.jsx(re,{style:{color:"#f59e0b"},size:32})}),e.jsxs("div",{className:"d-flex flex-column text-end",children:[e.jsx("h4",{className:"mb-1 fw-bold",style:{color:"#f59e0b",fontSize:"2rem"},children:u}),e.jsx("p",{className:"text-muted mb-0 small",children:"Estudiantes"})]})]})})})]}),e.jsx("div",{className:"row g-4 mb-4"}),e.jsx("div",{className:"row flex-grow-1",style:{margin:"0"},children:e.jsx("div",{className:"col-12 d-flex flex-column",children:e.jsxs("div",{className:"card border-0 shadow-sm flex-grow-1 d-flex flex-column",style:{backgroundColor:"#ffffff",border:"1px solid rgba(59, 130, 246, 0.1)"},children:[e.jsx("div",{className:"card-header border-0 py-3",style:{backgroundColor:"transparent"},children:e.jsx(ve,{activeTab:c,onTabChange:v,misCuestionariosCount:d.length,abiertosCount:h.length})}),e.jsx("div",{className:"card-body p-0 flex-grow-1 d-flex flex-column",children:g()})]})})})]}),e.jsx(je,{isOpen:_,onClose:n,cuestionarioId:N,cuestionarioTitulo:f,onSuccess:i})]})}):e.jsx("div",{style:{minHeight:"100vh",display:"flex",justifyContent:"center",alignItems:"center",backgroundColor:"#f8f9fa"},children:e.jsxs("div",{className:"text-center",children:[e.jsx("h3",{children:"No estás autenticado"}),e.jsx("p",{children:"Redirigiendo al login..."})]})})};export{Re as default};
