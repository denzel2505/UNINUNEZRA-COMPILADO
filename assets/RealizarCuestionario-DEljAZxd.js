import{j as e,r as t,S as O,a as Ne,b as fe,A as ge,e as ke}from"./index-D_5yPiNa.js";import{u as Se}from"./useAuthentication-ByJgdbzj.js";import{b as Me,c as _e,d as we,e as Ie,f as Ae}from"./index-BeF2Au6k.js";import"./iconBase-DP8UkxFN.js";function Ee({title:p,docente:o,programa:j,nivel:d}){return e.jsxs("div",{className:"exam-header text-white mt-3 mb-1",children:[e.jsxs("div",{className:"d-none d-md-block",children:[e.jsx("h1",{className:"exam-header-title h6",children:e.jsx("span",{className:"text-white",children:p})}),e.jsxs("div",{className:"exam-header-info",children:[e.jsxs("div",{className:"exam-header-field",children:[e.jsx("span",{className:"exam-header-label",children:"Docente:"}),e.jsx("span",{className:"exam-header-value",children:o})]}),e.jsxs("div",{className:"exam-header-field",children:[e.jsx("span",{className:"exam-header-label",children:"Programa:"}),e.jsx("span",{className:"exam-header-value",children:j})]}),e.jsxs("div",{className:"exam-header-field",children:[e.jsx("span",{className:"exam-header-label",children:"Nivel:"}),e.jsx("span",{className:"exam-header-value",children:d})]})]})]}),e.jsxs("div",{className:"d-block d-md-none",children:[e.jsx("h1",{className:"exam-header-title-mobile",style:{fontSize:"24px",fontWeight:"600",marginBottom:"16px",lineHeight:"1.1"},children:e.jsx("span",{className:"text-white",children:p})}),e.jsxs("div",{className:"exam-header-info",children:[e.jsxs("div",{className:"exam-header-field",children:[e.jsx("span",{className:"exam-header-label",children:"Docente:"}),e.jsx("span",{className:"exam-header-value",children:o})]}),e.jsxs("div",{className:"exam-header-field",children:[e.jsx("span",{className:"exam-header-label",children:"Programa:"}),e.jsx("span",{className:"exam-header-value",children:j})]}),e.jsxs("div",{className:"exam-header-field",children:[e.jsx("span",{className:"exam-header-label",children:"Nivel:"}),e.jsx("span",{className:"exam-header-value",children:d})]})]})]})]})}function Te({totalQuestions:p,answeredQuestions:o,currentQuestion:j,onQuestionSelect:d}){const m=Array.from({length:p},(i,l)=>l+1),c=i=>i===1?!0:o.includes(i-1);return e.jsxs("div",{className:"bg-white rounded-3 p-3 p-md-4 shadow-sm question-navigation-mobile-hidden",style:{margin:"0"},children:[e.jsx("h5",{className:"mb-3 text-dark",children:"NavegaciÃ³n del Cuestionario"}),e.jsx("hr",{className:"mb-3",style:{borderColor:"#dee2e6",borderWidth:"1px"}}),e.jsx("div",{className:"d-flex flex-wrap gap-1 gap-md-2 justify-content-center",children:m.map(i=>{const l=o.includes(i),w=c(i),E=i===j;return e.jsx("button",{className:`btn btn-sm rounded-2 d-flex align-items-center justify-content-center ${l?"text-white":w?"btn-outline-success":"btn-outline-secondary"}`,style:{backgroundColor:E?"#8BD8BF":l?"#78bda7":w?"#F8FAFC":"#C7CBD1",borderColor:E?"#6ba89c":l?"#5a9b85":w?"#e2e6ea":"#a8b0b8",width:"36px",height:"36px",color:E?"white":l?"black":w?"#6c757d":"#adb5bd",cursor:w?"pointer":"not-allowed",opacity:w?1:.7,borderWidth:"1px",fontSize:"12px"},onClick:()=>w&&d(i),disabled:!w,children:e.jsxs("div",{className:"d-flex align-items-center justify-content-center gap-1",children:[e.jsx("span",{children:i}),l&&e.jsx("svg",{width:"4",height:"4",viewBox:"0 0 24 24",fill:"currentColor",style:{marginLeft:"3px"},children:e.jsx("circle",{cx:"12",cy:"12",r:"12"})}),!w&&i>1&&e.jsx("svg",{width:"8",height:"8",viewBox:"0 0 24 24",fill:"currentColor",style:{marginLeft:"2px"},children:e.jsx("path",{d:"M18,8h-1V6c0-2.76-2.24-5-5-5S7,3.24,7,6v2H6c-1.1,0-2,0.9-2,2v10c0,1.1,0.9,2,2,2h12c1.1,0,2-0.9,2-2V10C20,8.9,19.1,8,18,8z M12,17c-1.1,0-2-0.9-2-2s0.9-2,2-2s2,0.9,2,2S13.1,17,12,17z M15.1,8H8.9V6c0-1.71,1.39-3.1,3.1-3.1s3.1,1.39,3.1,3.1V8z"})})]})},i)})})]})}function $e({timeRemaining:p,timePercent:o,progress:j}){const d=t.useRef(null),m=t.useRef(null),[c,i]=t.useState(!1),l=o<=25?"#ef4444":o<=50?"#f1995a":"#10b981",w=100-o;t.useEffect(()=>{if(!m.current)return;const r=new IntersectionObserver(([h])=>{i(!h.isIntersecting)},{root:null,threshold:0});return r.observe(m.current),()=>r.disconnect()},[]),t.useEffect(()=>{const r="questiondisplay-alert-animations";if(!document.getElementById(r)){const h=document.createElement("style");h.id=r,h.innerHTML=`
        @keyframes timer-alert-enter { from { opacity: 0; transform: translateX(8px) scale(0.98); } to { opacity: 1; transform: translateX(0) scale(1); } }
        @keyframes timer-alert-pulse { 0% { transform: translateX(0) scale(1); } 50% { transform: translateX(0) scale(1.03); } 100% { transform: translateX(0) scale(1); } }
      `,document.head.appendChild(h)}},[]);const E=o<=10?"critical":o<=25?"low":o<=50?"mid":"none";return e.jsxs("div",{ref:d,className:"bg-white rounded-3 p-3 p-md-4 shadow-sm",style:{margin:"0",overflow:"visible",position:"relative"},children:[e.jsx("div",{ref:m,className:"d-block d-md-none",style:{position:"absolute",top:0,left:0,width:1,height:1}}),e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-2",children:[e.jsx("h6",{className:"mb-0 text-dark",style:{fontWeight:600},children:"Progreso del cuestionario"}),e.jsxs("div",{className:"d-flex align-items-center gap-2",children:[o<=50&&e.jsx("div",{className:"d-block d-md-none",style:c?{position:"fixed",right:92,top:30,zIndex:1090}:{position:"relative"},children:e.jsxs("div",{style:{position:"relative",backgroundColor:l,color:"#fff",padding:"6px 10px",borderRadius:8,fontSize:13,fontWeight:600,boxShadow:"0 6px 16px rgba(0,0,0,0.12)",animation:"timer-alert-enter 220ms ease-out, timer-alert-pulse 1600ms ease-in-out 220ms infinite",willChange:"transform, opacity"},children:[o<=10?"Tiempo crÃ­tico":o<=25?"Queda poco tiempo":"Mitad del cuestionario",e.jsx("span",{"aria-hidden":!0,style:{position:"absolute",right:-8,top:"50%",transform:"translateY(-50%)",width:0,height:0,borderTop:"8px solid transparent",borderBottom:"8px solid transparent",borderLeft:`8px solid ${l}`}})]})},`mob-alert-${E}`),e.jsx("div",{className:"d-flex d-md-none",style:c?{position:"fixed",top:12,right:12,zIndex:1100}:{position:"relative"},children:e.jsx("div",{style:{color:"white",display:"flex",alignItems:"center",justifyContent:"center",width:72,height:72,borderRadius:"50%",background:`conic-gradient(rgba(0,0,0,0.18) ${w}%, rgba(0,0,0,0.06) 0)`},"aria-label":`Tiempo restante ${p}`,title:`Tiempo restante ${p}`,children:e.jsxs("div",{style:{width:64,height:64,borderRadius:"50%",backgroundColor:l,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",gap:2,boxShadow:"inset 0 0 0 2px rgba(255,255,255,0.15)"},children:[e.jsx("i",{className:"bi bi-stopwatch","aria-hidden":"true",style:{fontSize:16,lineHeight:1,color:"#ffffff"}}),e.jsx("span",{style:{fontSize:16,lineHeight:1,fontWeight:800,color:"#ffffff"},children:p})]})})}),c&&e.jsx("div",{className:"d-block d-md-none",style:{width:o<=50?170:80}})]})]}),c&&e.jsx("div",{className:"d-block d-md-none",style:{height:84}}),e.jsx("div",{className:"mb-4",children:e.jsxs("div",{className:"progress position-relative",style:{height:"20px"},children:[e.jsx("div",{className:"progress-bar",role:"progressbar",style:{width:`${j}%`,backgroundColor:"#8bd8bf"}}),e.jsxs("small",{className:"position-absolute w-100 text-center text-muted",style:{top:"50%",transform:"translateY(-50%)",fontSize:"14px",fontWeight:"600"},children:[j,"%"]})]})})]})}const Re="_imageContainer_1mtic_7",ze="_examContainer_1mtic_29",De="_examHeader_1mtic_36",We="_examNavigation_1mtic_40",Pe="_examQuestion_1mtic_44",Fe="_examAnswers_1mtic_48",Oe="_examButtons_1mtic_52",Be="_componentCard_1mtic_61",Le="_questionImageResponsive_1mtic_130",He="_optionContainer_1mtic_150",Ue="_optionImageTopRight_1mtic_158",qe="_optionTextWithImage_1mtic_176",A={imageContainer:Re,examContainer:ze,examHeader:De,examNavigation:We,examQuestion:Pe,examAnswers:Fe,examButtons:Oe,componentCard:Be,questionImageResponsive:Le,optionContainer:He,optionImageTopRight:Ue,optionTextWithImage:qe};function Ve({answers:p,selectedAnswer:o,onAnswerSelect:j,questionText:d,weight:m,questionImage:c,onImageClick:i,orientation:l=1,currentQuestion:w}){return l===0?e.jsxs("div",{className:"col-12",children:[e.jsxs("div",{className:"d-flex flex-row flex-md-row justify-content-between align-items-center mb-2",children:[e.jsxs("h5",{className:"mb-0 text-dark d-none d-md-block",children:["Pregunta ",w]}),e.jsxs("span",{className:"badge text-white d-none d-md-inline-block",style:{backgroundColor:"#2C3E50",color:"white",whiteSpace:"nowrap",zIndex:2},"aria-label":`Peso de la pregunta: ${m}`,children:["Peso: ",m]})]}),e.jsxs("div",{className:"row g-4",children:[e.jsxs("div",{className:"d-block d-md-none",children:[e.jsxs("div",{className:"col-12 mb-4",children:[e.jsx("div",{className:"mb-3",children:e.jsxs("div",{className:"d-block d-md-none",children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-2",children:[e.jsxs("h6",{className:"mb-0 text-dark",children:["Pregunta ",w]}),e.jsxs("span",{className:"badge text-white",style:{backgroundColor:"#2C3E50",color:"white",whiteSpace:"nowrap"},children:["Peso: ",m]})]}),e.jsx("p",{className:"text-dark lh-base mb-0",style:{fontWeight:"500"},children:d})]})}),c&&e.jsx("div",{className:`mt-3 mb-3 ${A.imageContainer}`,children:e.jsx("img",{src:c,alt:"Imagen de la pregunta",className:A.questionImageResponsive,onClick:()=>i&&i(c),title:"Click para ampliar imagen"})}),e.jsx("hr",{className:"mt-3 mb-0",style:{borderColor:"#dee2e6",borderWidth:"1px"}})]}),e.jsx("div",{className:"mb-3",children:e.jsx("span",{children:"Opciones de respuesta"})}),p.map(r=>e.jsx("div",{className:"col-12 mb-3",children:e.jsxs("div",{className:`p-2 p-md-3 rounded-3 border cursor-pointer m-auto ${o===r.id?"border-success":"border-secondary"} ${A.optionContainer}`,style:{backgroundColor:o===r.id?"#d4edda":"#ffffff",cursor:"pointer",borderWidth:"2px"},onClick:()=>j(r.id),children:[r.imagen&&e.jsx("img",{src:r.imagen,alt:`Imagen de la opciÃ³n ${r.id}`,className:A.optionImageTopRight,onClick:h=>{h.stopPropagation(),i&&i(r.imagen)},title:"Click para ampliar imagen"}),e.jsxs("div",{className:"d-flex align-items-start gap-3",children:[e.jsx("span",{className:"rounded-circle d-flex align-items-center justify-content-center flex-shrink-0",style:{width:"32px",height:"32px",fontSize:"14px",backgroundColor:o===r.id?"#28a745":"#F1995A",border:o===r.id?"2px solid #28a745":"2px solid #F1995A",color:"white",fontWeight:"600",objectFit:"cover",display:"flex",alignItems:"center",justifyContent:"center",minWidth:"32px",minHeight:"32px"},children:r.id}),e.jsx("div",{className:`flex-grow-1 ${r.imagen?A.optionTextWithImage:""}`,children:e.jsx("span",{className:"text-dark d-block",style:{fontSize:"15px",lineHeight:"1.4"},children:r.text})})]})]})},r.id))]}),e.jsxs("div",{className:"d-none d-md-flex justify-content-between align-items-start w-100",children:[e.jsxs("div",{className:"pe-3",style:{flex:"0 0 58%"},children:[e.jsx("div",{className:"mb-3 d-flex justify-content-between align-items-start",children:e.jsx("p",{className:"text-dark lh-base mb-0",style:{flex:1,marginRight:"16px",fontWeight:"500"},children:d})}),c&&e.jsx("div",{className:`mt-3 ${A.imageContainer}`,children:e.jsx("img",{src:c,alt:"Imagen de la pregunta",className:A.questionImageResponsive,onClick:()=>i&&i(c),title:"Click para ampliar imagen"})})]}),e.jsxs("div",{className:"ps-3",style:{flex:"0 0 40%"},children:[e.jsx("div",{className:"mb-3 text-end",children:e.jsx("span",{children:"Opciones de respuesta"})}),e.jsx("div",{className:"row g-3",children:p.map(r=>e.jsx("div",{className:"col-12",children:e.jsxs("div",{className:`p-2 p-md-3 rounded-3 border cursor-pointer ${o===r.id?"border-success":"border-secondary"} ${A.optionContainer}`,style:{backgroundColor:o===r.id?"#d4edda":"#ffffff",cursor:"pointer",borderWidth:"2px"},onClick:()=>j(r.id),children:[r.imagen&&e.jsx("img",{src:r.imagen,alt:`Imagen de la opciÃ³n ${r.id}`,className:A.optionImageTopRight,onClick:h=>{h.stopPropagation(),i&&i(r.imagen)},title:"Click para ampliar imagen"}),e.jsxs("div",{className:"d-flex align-items-start gap-3",children:[e.jsx("span",{className:"rounded-circle d-flex align-items-center justify-content-center flex-shrink-0",style:{width:"32px",height:"32px",fontSize:"14px",backgroundColor:o===r.id?"#28a745":"#F1995A",border:o===r.id?"2px solid #28a745":"2px solid #F1995A",color:"white",fontWeight:"600",objectFit:"cover",display:"flex",alignItems:"center",justifyContent:"center",minWidth:"32px",minHeight:"32px"},children:r.id}),e.jsx("div",{className:`flex-grow-1 ${r.imagen?A.optionTextWithImage:""}`,children:e.jsx("span",{className:"text-dark d-block",style:{fontSize:"15px",lineHeight:"1.4"},children:r.text})})]})]})},r.id))})]})]})]})]}):e.jsxs("div",{className:"row g-3 justify-content-center",children:[e.jsxs("div",{className:"col-12 mb-2 d-flex justify-content-between align-items-center",children:[e.jsxs("h5",{className:"mb-0 text-dark d-none d-md-block",children:["Pregunta ",w]}),e.jsxs("span",{className:"badge text-white d-none d-md-inline-block",style:{backgroundColor:"#2C3E50",color:"white",whiteSpace:"nowrap"},children:["Peso: ",m]})]}),e.jsxs("div",{className:"col-12 mb-4",children:[e.jsxs("div",{className:"mb-3",children:[e.jsxs("div",{className:"d-block d-md-none",children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-2",children:[e.jsxs("h6",{className:"mb-0 text-dark",children:["Pregunta ",w]}),e.jsxs("span",{className:"badge text-white",style:{backgroundColor:"#2C3E50",color:"white",whiteSpace:"nowrap"},children:["Peso: ",m]})]}),e.jsx("p",{className:"text-dark lh-base mb-0",style:{fontWeight:"500"},children:d})]}),e.jsx("div",{className:"d-none d-md-flex justify-content-between align-items-start",children:e.jsx("p",{className:"text-dark lh-base mb-0",style:{flex:1,marginRight:"16px",fontWeight:"500"},children:d})})]}),c&&e.jsx("div",{className:`mt-3 mb-3 ${A.imageContainer}`,children:e.jsx("img",{src:c,alt:"Imagen de la pregunta",className:A.questionImageResponsive,onClick:()=>i&&i(c),title:"Click para ampliar imagen"})}),e.jsx("hr",{className:"mt-3 mb-0",style:{borderColor:"#dee2e6",borderWidth:"1px"}})]}),e.jsx("div",{className:"mb-3",children:e.jsx("span",{children:"Opciones de respuesta"})}),p.map(r=>e.jsx("div",{className:"col-12 col-md-6",children:e.jsxs("div",{className:`p-2 p-md-3 rounded-3 border cursor-pointer m-auto ${o===r.id?"border-success":"border-secondary"} ${A.optionContainer}`,style:{backgroundColor:o===r.id?"#d4edda":"#ffffff",cursor:"pointer",borderWidth:"2px"},onClick:()=>j(r.id),children:[r.imagen&&e.jsx("img",{src:r.imagen,alt:`Imagen de la opciÃ³n ${r.id}`,className:A.optionImageTopRight,onClick:h=>{h.stopPropagation(),i&&i(r.imagen)},title:"Click para ampliar imagen"}),e.jsxs("div",{className:"d-flex align-items-start gap-3",children:[e.jsx("span",{className:"rounded-circle d-flex align-items-center justify-content-center flex-shrink-0",style:{width:"32px",height:"32px",fontSize:"14px",backgroundColor:o===r.id?"#28a745":"#F1995A",border:o===r.id?"2px solid #28a745":"2px solid #F1995A",color:"white",fontWeight:"600",objectFit:"cover",display:"flex",alignItems:"center",justifyContent:"center",minWidth:"32px",minHeight:"32px"},children:r.id}),e.jsx("div",{className:`flex-grow-1 ${r.imagen?A.optionTextWithImage:""}`,children:e.jsx("span",{className:"text-dark d-block",style:{fontSize:"15px",lineHeight:"1.4"},children:r.text})})]})]})},r.id))]})}function Qe({currentQuestion:p,onPrevious:o,onNext:j,isLastPage:d=!1,onSubmit:m,isSubmitting:c=!1}){const i=()=>{d&&m?m():j()};return e.jsxs("div",{className:"d-flex justify-content-between gap-2",style:{margin:"0"},children:[e.jsx("button",{className:"btn btn-secondary px-3 px-md-4 py-2 flex-grow-1 flex-md-grow-0",disabled:p===1,onClick:o,style:{maxWidth:"150px"},children:"Anterior"}),e.jsx("button",{className:"btn text-white px-3 px-md-4 py-2 flex-grow-1 flex-md-grow-0",style:{backgroundColor:"#2c3e50",maxWidth:"150px"},onClick:i,disabled:c,children:c?"Enviando...":d?"Finalizar":"Siguiente"})]})}const U={normal:"normal",warning:"warning",danger:"danger"},Ye=({preguntas:p,cuestionario:o,isLoading:j,onTimeUp:d,elapsedMs:m=0})=>{const c=t.useCallback(()=>`examTimer:${(o?.id||(typeof window<"u"?window.location.pathname.split("/").pop():"unknown"))??"unknown"}`,[o]),i=()=>typeof window>"u"?!1:window.innerWidth>=768,[l,w]=t.useState(3600),[E,r]=t.useState(3600),[h,b]=t.useState(0),[F,L]=t.useState(U.normal),[J,se]=t.useState(!1),ae=t.useRef(!1),ne=t.useRef(0),le=t.useRef(d);t.useEffect(()=>{le.current=d},[d]);const ce=t.useCallback(f=>{if(!f)return 0;if(typeof f=="number")return f;if(typeof f=="string"){const u=f.split(":").map(v=>parseInt(v,10));if(u.length===3){const[v,k,P]=u;return v*3600+k*60+P}else if(u.length===2){const[v,k]=u;return v*60+k}}return 0},[]);t.useEffect(()=>{if(!o?.tiempo_limite){console.log("âš ï¸ No hay tiempo_limite en el cuestionario, usando tiempo por defecto");return}const f=o.tiempo_limite,u=ce(f);console.log(`âœ… TIEMPO_LIMITE OBTENIDO DEL CUESTIONARIO: "${f}" â†’ ${u} segundos (${Math.floor(u/60)} minutos)`),u>0?(w(u),r(u)):console.log("âš ï¸ Tiempo convertido es 0, usando tiempo por defecto")},[o?.tiempo_limite,ce]);const oe=t.useCallback(f=>{const u=f/l*100;return u<=25?U.danger:u<=50?U.warning:U.normal},[l]),H=t.useCallback(f=>{i()&&(f===U.warning?O.fire({position:"top-end",icon:"warning",title:"â° Tiempo: Mitad del cuestionario",text:"Te queda la mitad del tiempo disponible",toast:!0,showConfirmButton:!1,timer:4e3,timerProgressBar:!0,didOpen:u=>{u.addEventListener("mouseenter",O.stopTimer),u.addEventListener("mouseleave",O.resumeTimer)},customClass:{popup:"swal-warning-toast"}}):f===U.danger&&O.fire({position:"top-end",icon:"error",title:"ðŸš¨ Tiempo crÃ­tico: Ãšltimos minutos",text:"ApÃºrate, te queda poco tiempo",toast:!0,showConfirmButton:!1,timer:5e3,timerProgressBar:!0,didOpen:u=>{u.addEventListener("mouseenter",O.stopTimer),u.addEventListener("mouseleave",O.resumeTimer)},customClass:{popup:"swal-danger-toast"}}))},[]),D=t.useCallback(f=>{const u=Math.floor(f/60),v=f%60;return`${u}:${v<10?"0":""}${v}`},[]),V=t.useCallback(f=>{const u=E/l*100;return u<=25?`${f.timer} ${f.timerDanger}`:u<=50?`${f.timer} ${f.timerWarning}`:f.timer},[E,l]),me=t.useCallback(()=>{const f=(l-E)/l*100;let u="";if(f<=0)u="polygon(50% 50%, 50% 0%, 50% 0%, 50% 0%)";else if(f>=100)u="circle(50% at 50% 50%)";else{const v=[];v.push("50% 50%"),v.push("50% 0%");const k=f/100*360,P=36,y=Math.ceil(k/360*P);for(let Z=1;Z<=y;Z++){const he=Z/P*2*Math.PI,pe=50+50*Math.sin(he),N=50-50*Math.cos(he);v.push(`${pe.toFixed(1)}% ${N.toFixed(1)}%`)}u=`polygon(${v.join(", ")})`}return{clipPath:u}},[E,l]),W=t.useCallback(()=>{console.log(`ðŸš€ Iniciando temporizador con ${l} segundos (${Math.floor(l/60)} minutos)`);try{const f=typeof window<"u"?localStorage.getItem(c()):null;if(f){const u=JSON.parse(f),v=typeof u?.remaining=="number"?Math.max(0,Math.min(l,u.remaining)):null;if(v!==null){r(v);const k=l-v;b(Date.now()-k*1e3)}else r(l),b(Date.now())}else r(l),b(Date.now())}catch{r(l),b(Date.now())}L(U.normal),se(!1),ae.current=!1,ne.current=0},[l,c]),Q=t.useCallback(()=>{r(l),b(0),L(U.normal),se(!1);try{typeof window<"u"&&localStorage.removeItem(c())}catch{}},[l]),ue=t.useCallback(()=>{if(m>0&&l>0){const f=Math.max(0,l-Math.floor(m/1e3));r(f);const u=Date.now()-m;b(u),console.log(`ðŸ”„ Timer configurado por restauraciÃ³n: ${m}ms transcurridos, ${f}s restantes`)}},[m,l]);return t.useEffect(()=>{if(j||!o||h===0)return;const f=setInterval(()=>{const u=Date.now(),v=Math.floor((u-h)/1e3),k=Math.max(0,l-v),P=oe(k);P!==F&&(P===U.warning&&F===U.normal?H(U.warning):P===U.danger&&F===U.warning&&H(U.danger),L(P)),k<=60&&k>55&&!J&&(se(!0),i()&&O.fire({position:"top-end",icon:"warning",title:"ðŸš¨ Â¡Ãšltimo minuto!",text:"Solo te queda 1 minuto para terminar",toast:!0,showConfirmButton:!1,timer:6e3,timerProgressBar:!0,didOpen:y=>{y.addEventListener("mouseenter",O.stopTimer),y.addEventListener("mouseleave",O.resumeTimer)},customClass:{popup:"swal-final-warning"}})),r(k);try{typeof window<"u"&&(!ne.current||u-ne.current>=1e3)&&(localStorage.setItem(c(),JSON.stringify({total:l,remaining:k,savedAt:u})),ne.current=u)}catch{}if(k<=0&&!ae.current){clearInterval(f),ae.current=!0;try{typeof window<"u"&&localStorage.removeItem(c())}catch{}O.fire({position:"center",icon:"info",title:"â° Tiempo agotado",text:"El tiempo ha terminado. Enviando tu cuestionario...",toast:!1,showConfirmButton:!1,timer:2e3,timerProgressBar:!0,allowOutsideClick:!1,customClass:{popup:"swal-time-up"}}).then(()=>{le.current&&le.current()})}},100);return()=>clearInterval(f)},[j,o,h,l,F,J,oe,H]),t.useEffect(()=>{},[p.length,o,h]),t.useEffect(()=>{m>0&&l>0&&ue()},[m,l,ue]),{tiempoRestante:E,tiempoTotalCuestionario:l,formatearTiempo:D,getTimerClass:V,getTimerProgressStyle:me,iniciarTimer:W,resetTimer:Q,configurarTimer:ue}},Xe=({preguntas:p,respuestas:o,preguntasPorPagina:j=1})=>{const[d,m]=t.useState(1),c=t.useMemo(()=>{const h=Math.ceil(p.length/j),b=(d-1)*j,F=b+j,L=p.slice(b,F),J=Object.keys(o).length,se=Math.round(J/p.length*100);return{totalPaginas:h,indiceInicio:b,indiceFin:F,preguntasActuales:L,preguntasRespondidas:J,porcentajeCompletado:se}},[p,d,j,o]),i=t.useCallback(h=>{if(h===1)return!1;const b=p[h-1]?.id;if(o.hasOwnProperty(b))return!1;const F=p[h-2]?.id;return!o.hasOwnProperty(F)},[p,o]),l=t.useCallback(h=>{h<1||h>c.totalPaginas||i(h)||(m(h),window.scrollTo({top:0,behavior:"smooth"}))},[c.totalPaginas,i]),w=t.useCallback(()=>{l(d+1)},[d,l]),E=t.useCallback(()=>{l(d-1)},[d,l]),r=t.useMemo(()=>{const h=d===1,b=d===c.totalPaginas,F=!h,L=!b&&!i(d+1);return{isFirstPage:h,isLastPage:b,canNavigatePrevious:F,canNavigateNext:L}},[d,c.totalPaginas,i]);return{paginaActual:d,...c,cambiarPagina:l,irSiguiente:w,irAnterior:E,isPreguntaBloqueada:i,...r}},Je=({cuestionarioId:p})=>{const o=Ne(),{isAuthenticated:j,user:d}=Se(),[m,c]=t.useState(null),[i,l]=t.useState([]),[w,E]=t.useState({}),[r,h]=t.useState(0),[b,F]=t.useState(null),[L,J]=t.useState(!0),[se,ae]=t.useState(null),[ne,le]=t.useState(!1),ce=t.useRef(!1),oe=t.useRef(!1),H=t.useRef(!1),D=t.useRef(null),V=t.useRef(0),me=t.useRef(!1),W=t.useRef(null),[Q,ue]=t.useState(!0),f=t.useCallback((N,S)=>{if(!S)return"";const R=Number(S);return`http://localhost/cuestionario-api/api/obtenerImagen_api.php?tipo=${encodeURIComponent(N)}&id=${encodeURIComponent(String(R))}`},[]),u=typeof window<"u"?localStorage.getItem("rol"):null,v=d?.rol==="estudiante"||d?.rol==="2"||u==="2",k=t.useCallback(()=>{if(!v)return null;const N=typeof window<"u"?localStorage.getItem("user"):null,S=N?JSON.parse(N)?.id:void 0,R=d?.id??S;return R&&p?`quiz_progress:${R}:${p}`:null},[d?.id,p,v]),P=t.useCallback(()=>{const N=k();if(!N)return null;try{const S=localStorage.getItem(N);return S?JSON.parse(S):null}catch{return null}},[k]),y=t.useCallback(N=>{const S=k();if(!S)return;const R=P()||{answers:{},elapsedMs:0,startedAt:Date.now()},g={answers:N.answers??R.answers,elapsedMs:N.elapsedMs??R.elapsedMs,startedAt:N.startedAt??R.startedAt,lastUpdated:Date.now()};localStorage.setItem(S,JSON.stringify(g))},[k,P]),Z=t.useCallback(()=>{const N=k();N&&localStorage.removeItem(N)},[k]),he=t.useCallback((N,S)=>{E(R=>{const g={...R,[N]:S},T=Date.now();return T-V.current>500&&(y({answers:g}),V.current=T),g})},[y]),pe=t.useCallback(async N=>{if(ne||ce.current||!p)return;const S=i.length,R=Object.keys(w).length;if(!N?.forceIncomplete&&R<S){await O.fire({icon:"warning",title:"Faltan respuestas",text:"Por favor responde todas las preguntas antes de enviar.",confirmButtonText:"Entendido"});return}if(!(!N?.skipConfirm&&!(await O.fire({title:"Â¿Enviar respuestas?",text:"Una vez enviadas, no podrÃ¡s modificar tus respuestas.",icon:"question",showCancelButton:!0,confirmButtonText:"Enviar",cancelButtonText:"Cancelar"})).isConfirmed))try{le(!0),ce.current=!0;const g=i.map(ee=>({pregunta_id:Number(ee.id),opcion_id:w[ee.id]??null})).filter(ee=>ee.opcion_id!==null&&ee.opcion_id!==void 0),T=typeof window<"u"?localStorage.getItem("user"):null,G=T?JSON.parse(T)?.id:void 0,K=d?.id??G,q={estudiante_id:K,respuestas:g,tiempo_utilizado:Math.max(0,Math.floor((r||0)/1e3))};if(console.log("Payload enviado a guardar-intento:",q),console.log("Contenido de respuestas:",g,"Total:",g.length),!N?.forceIncomplete&&(!g||g.length===0)){await O.fire({icon:"warning",title:"Faltan respuestas",text:"Debes responder al menos una pregunta antes de enviar.",confirmButtonText:"Entendido"});return}if(!K){await O.fire({icon:"error",title:"Error",text:"No se pudo identificar al estudiante. Inicia sesiÃ³n nuevamente.",confirmButtonText:"Entendido"});return}const re=await fe.post(`${ge.cuestionario.resolver.guardarIntento(p)}`,q);if(!re||re.data.error){if(re?.data?.error?.includes("sesiÃ³n")||re?.data?.error?.includes("acceso")){window.location.href="/login-estudiante";return}throw new Error(re?.data?.error||"Error al enviar respuestas")}await O.fire({icon:"success",title:"Â¡Listo!",text:"Tus respuestas fueron enviadas correctamente.",confirmButtonText:"Ver resultados"}),H.current||(H.current=!0,o(`/resultado/${p}`)),Z()}catch(g){console.error("Error al enviar cuestionario:",g);const T=g;T?.response?.data&&console.error("Respuesta del backend:",T.response.data),await O.fire({icon:"error",title:"Error",text:"No se pudo enviar el cuestionario.",confirmButtonText:"Volver a intentar"})}finally{le(!1),ce.current=!1}},[ne,p,i.length,i,w,o,d?.id,Z]);return t.useEffect(()=>!Q||oe.current?void 0:((async()=>{if(oe.current=!0,!p||isNaN(Number(p))){ae("ID de cuestionario no vÃ¡lido"),J(!1),oe.current=!1;return}const S=typeof window<"u"?localStorage.getItem("token"):null;if(!(j||!!S)||!v){ae("Debes iniciar sesiÃ³n como estudiante para resolver el cuestionario."),J(!1);return}try{const g=await fe.get(`${ge.cuestionario.resolver.preguntasOpciones(p)}`);console.log("[realizar] preguntas-opciones raw:",g?.data);let T=g?.data?.cuestionario??g?.data?.data?.cuestionario??g?.data?.cuestionario_info??null,G=Array.isArray(g?.data?.data)?g?.data?.data:g?.data?.preguntas??g?.data?.data?.preguntas??g?.data?.preguntas_opciones??g?.data?.data?.preguntas_opciones??[];if(!T||Array.isArray(G)&&G.length===0)try{const B=await fe.get(`${ge.cuestionario.resolver.verificar(p)}`);console.log("[realizar] base raw:",B?.data),T=(B?.data?.data??B?.data??{})?.cuestionario??T,console.log("[realizar] cuestionario extraÃ­do:",T),console.log("[realizar] tiempo_limite extraÃ­do:",T?.tiempo_limite);const te=B?.data?.preguntas??B?.data?.data?.preguntas??[];Array.isArray(te)&&te.length>0&&(G=te)}catch(B){console.warn("[realizar] fallback /cuestionario/:id fallÃ³",B)}if(!Q)return;const K=g?.data?.error||void 0;if(!Array.isArray(G)||G.length===0||K)throw K?.includes("sesiÃ³n")||K?.includes("acceso")?(ae("Tu sesiÃ³n no es vÃ¡lida o no tienes acceso a este cuestionario."),new Error(K||"SesiÃ³n invÃ¡lida o sin acceso")):new Error(K||"Cuestionario no disponible");const re=(B=>(B||[]).map((x,te)=>{const xe=((Array.isArray(x?.opciones)?x.opciones:Array.isArray(x?.opcion)?x.opcion:Array.isArray(x?.opciones_pregunta)?x.opciones_pregunta:Array.isArray(x?.opcionesPregunta)?x.opcionesPregunta:[])||[]).map((a,s)=>{const z=Number(a?.id??a?.opcion_id??a?.id_opcion??s+1);return{...a,id:z,opcion_id:Number(a?.opcion_id??a?.id_opcion??z)}}),n=Number(x?.id??x?.pregunta_id??x?.id_pregunta??te+1);return{...x,id:n,pregunta_id:Number(x?.pregunta_id??x?.id_pregunta??n),opciones:xe}}))(Array.isArray(G)?G:[]);c(T??null),l(re);const ee=Number(T?.tiempo_limite);!isNaN(ee)&&ee>0?F(ee*60*1e3):F(null);try{const B=await fe.post(ge.cuestionario.resolver.mostrarEstado,{cuestionario_id:Number(p)}),x=B?.data?.data??B?.data??null,te=x?.pregunta_opcion_guardado,ve=x?.tiempo_guardado,xe=C=>{if(!C||typeof C!="string")return 0;const M=C.match(/^(\d{2}):(\d{2}):(\d{2})$/);if(!M)return 0;const $=Number(M[1]||0),I=Number(M[2]||0),Y=Number(M[3]||0);return($*3600+I*60+Y)*1e3},n={};if(te&&typeof te=="object"){const C=new Set(re.map(M=>Number(M.id)));for(const[M,$]of Object.entries(te)){const I=Number(M),Y=Number($);C.has(I)&&!isNaN(Y)&&(n[I]=Y)}}const a=xe(ve),s=P();let z=0;if(s){const C=typeof s.lastUpdated=="number"?s.lastUpdated:Date.now(),M=Math.max(0,Date.now()-C);z=Math.max(0,Number(s.elapsedMs||0)+M)}let _=Math.max(a||0,z||0);if(b&&_>b&&(_=b),Object.keys(n).length>0||_>0)Object.keys(n).length>0&&E(n),_>0&&h(_),W.current=Date.now()-(_||0),y({answers:n,elapsedMs:_,startedAt:W.current});else{const C=P();C?(C.answers&&Object.keys(C.answers).length>0&&E(C.answers),typeof C.elapsedMs=="number"&&C.elapsedMs>=0&&h(C.elapsedMs),typeof C.startedAt=="number"&&C.startedAt>0?W.current=C.startedAt:(W.current=Date.now()-(C.elapsedMs||0),y({startedAt:W.current}))):(W.current=Date.now(),y({startedAt:W.current,elapsedMs:0,answers:{}}))}}catch{const x=P();x?(x.answers&&Object.keys(x.answers).length>0&&E(x.answers),typeof x.elapsedMs=="number"&&x.elapsedMs>=0&&h(x.elapsedMs),typeof x.startedAt=="number"&&x.startedAt>0?W.current=x.startedAt:(W.current=Date.now()-(x.elapsedMs||0),y({startedAt:W.current}))):(W.current=Date.now(),y({startedAt:W.current,elapsedMs:0,answers:{}}))}}catch(g){if(!Q)return;const T=g instanceof Error?g.message:"Error al cargar el cuestionario";ae(T),console.error("Error al cargar cuestionario:",g)}finally{Q&&J(!1)}})().finally(()=>{oe.current=!1}),D.current&&window.clearInterval(D.current),v&&(D.current=window.setInterval(()=>{const S=W.current??Date.now();let g=Date.now()-S;b&&g>=b&&(g=b,D.current&&(window.clearInterval(D.current),D.current=null)),h(g),y({elapsedMs:g})},1e3)),()=>{ue(!1),D.current&&(window.clearInterval(D.current),D.current=null)}),[p,j,d?.rol,Q,o,d?.id,P,y,b,v]),t.useEffect(()=>{if(!v&&typeof window<"u"){const N=[];for(let S=0;S<localStorage.length;S++){const R=localStorage.key(S);R&&R.startsWith("quiz_progress:")&&N.push(R)}N.forEach(S=>localStorage.removeItem(S))}},[v]),t.useEffect(()=>{b&&(me.current||r>=b&&(me.current=!0,pe({forceIncomplete:!0,skipConfirm:!0})))},[r,b,pe]),{cuestionario:m,preguntas:i,respuestas:w,elapsedMs:r,isLoading:L,error:se,handleChange:he,handleSubmit:pe,getImageUrl:f,isSubmitting:ne}};function Ze(){const p=ke(),o=Ne(),j=p.id,{user:d}=Se(),{cuestionario:m,preguntas:c,respuestas:i,isLoading:l,error:w,handleChange:E,handleSubmit:r,isSubmitting:h,elapsedMs:b}=Je({cuestionarioId:j}),{paginaActual:F,preguntasActuales:L,porcentajeCompletado:J,cambiarPagina:se,irSiguiente:ae,irAnterior:ne,isLastPage:le,canNavigateNext:ce,canNavigatePrevious:oe}=Xe({preguntas:c,respuestas:i,preguntasPorPagina:1}),{tiempoRestante:H,tiempoTotalCuestionario:D,formatearTiempo:V,iniciarTimer:me,configurarTimer:W}=Ye({preguntas:c,cuestionario:m,isLoading:l,onTimeUp:()=>r({forceIncomplete:!0,skipConfirm:!0}),elapsedMs:b||0}),Q=Math.max(0,Math.min(100,Math.round(H/Math.max(1,D)*100))),ue=Q<=25?"#ef4444":Q<=50?"#f1995a":"#10b981",f=100-Q;t.useEffect(()=>{c.length>0&&m&&me()},[c,m,me,b]),t.useEffect(()=>{c.length>0&&m&&b>0&&W()},[b,c,m,W]),t.useEffect(()=>{const n="timer-toast-offset-style";if(!document.getElementById(n)){const s=document.createElement("style");s.id=n,s.innerHTML=`
        /* SweetAlert2: contenedores en esquina superior derecha */
        .swal2-container.swal2-top-end, .swal2-container.swal2-top-right { 
          padding-top: 110px !important; /* altura del timer + margen */
        }
        /* Bootstrap toast container fijo arriba derecha */
        .toast-container.position-fixed.top-0.end-0 { 
          margin-top: 110px !important; 
          z-index: 1000; /* por debajo del timer (1100) */
        }

        /* --- Modo mÃ³vil: evitar estorbar al usuario --- */
        @media (max-width: 767.98px) {
          /* Mover SweetAlert2 a la parte inferior y expandir a ancho legible */
          .swal2-container.swal2-top-end, .swal2-container.swal2-top-right {
            padding-top: 0 !important;
            align-items: flex-end !important; /* derecha */
            justify-content: flex-end !important; /* abajo */
            padding: 0 12px 12px 12px !important;
          }
          .swal2-container.swal2-top-end .swal2-popup,
          .swal2-container.swal2-top-right .swal2-popup {
            width: min(440px, calc(100vw - 24px)) !important;
            margin: 0 !important;
            border-radius: 12px !important;
          }

          /* Reubicar toasts de Bootstrap a la parte inferior derecha */
          .toast-container.position-fixed.top-0.end-0 {
            top: auto !important;
            bottom: 12px !important;
            margin-top: 0 !important;
            right: 12px !important;
            z-index: 1000 !important; /* debajo del timer mÃ³vil (1100) */
          }
          .toast-container .toast {
            max-width: min(440px, calc(100vw - 24px));
            border-radius: 12px;
          }
        }
      `,document.head.appendChild(s)}return()=>{}},[]);const[u,v]=t.useState(""),[k,P]=t.useState(1),[y,Z]=t.useState(null),[he,pe]=t.useState("Docente"),[N,S]=t.useState("Programa"),[R,g]=t.useState("Nivel");t.useEffect(()=>{const n=m?.creador_nombre||m?.docente_nombre||m?.autor||"Docente";pe(String(n));const a=m?.programa_nombre||m?.programa||m?.programa_estudiante||m?.programaAsignado||m?.nombre_programa;a&&S(String(a));const s=m?.nivel_nombre||m?.nivel;s&&g(String(s)),(!a||!s)&&(async()=>{try{const _=d?.programa_id||d?.programa?.id;if(!_)return;const M=(await fe.get(ge.programas.byId(_)))?.data,$=M?.data?.programa?.nombre||M?.programa?.nombre||M?.nombre||M?.programa_nombre,I=M?.data?.programa?.nivel_nombre||M?.programa?.nivel_nombre||M?.nivel_nombre;!a&&$&&S(String($)),!s&&I&&g(String(I))}catch{}})()},[m,d]),t.useEffect(()=>{const n=a=>{a.key==="Escape"&&y&&Z(null)};return y&&(document.addEventListener("keydown",n),document.body.style.overflow="hidden"),()=>{document.removeEventListener("keydown",n),document.body.style.overflow="unset"}},[y]);const T=n=>{if(!n)return null;const a=String(n).trim();if(!a)return null;if(/^data:image\//i.test(a))return a;let s="png";return a.startsWith("/9j")?s="jpeg":a.startsWith("iVBOR")?s="png":a.startsWith("R0lG")?s="gif":a.startsWith("UklGR")?s="webp":a.startsWith("Qk")?s="bmp":(a.startsWith("PHN2Zy")||a.startsWith("PD94"))&&(s="svg+xml"),`data:image/${s};base64,${a}`};t.useEffect(()=>{P(F)},[F]),t.useEffect(()=>{if(L.length>0){const n=L[0],a=i[n.id];if(a){const s=n.opciones?.find(z=>z.id===a);if(s){const z=n.opciones?.indexOf(s)||0;v(String.fromCharCode(65+z))}}else v("")}},[L,i]);const G=c.map((n,a)=>a+1).filter(n=>{const a=c[n-1];return a&&i[a.id]!==void 0&&i[a.id]!==null}),K=c.length||20,q=L[0],re=q?.texto_pregunta||"Cargando pregunta...",ee=q?.peso_pregunta||0,B=q?.opciones?.map((n,a)=>({id:String.fromCharCode(65+a),text:n.texto_opcion,isCorrect:n.opcion_correcta,originalId:n.id,imagen:T(n.imagen_opcion)||void 0}))||[],x=n=>{se(n)},te=n=>{v(n);const a=n.charCodeAt(0)-65,s=q?.opciones?.[a];s&&q&&E(q.id,s.id)},ve=()=>{oe&&ne()},xe=()=>{(async()=>{try{const a=X=>{const ie=Math.max(0,Math.floor(X)),ye=String(Math.floor(ie/3600)).padStart(2,"0"),je=String(Math.floor(ie%3600/60)).padStart(2,"0"),Ce=String(ie%60).padStart(2,"0");return`${ye}:${je}:${Ce}`},s=Math.max(0,Math.floor(D)),z=Math.max(0,Math.floor(s-Math.max(0,Math.floor(H)))),_={};c.forEach(X=>{const ie=i[X.id];ie!=null&&(_[X.id]=Number(ie))});const C=typeof window<"u"?localStorage.getItem("user"):null,M=C?JSON.parse(C)?.id:void 0,$=d?.id??M,I=new Date,Y=`${I.getFullYear()}-${String(I.getMonth()+1).padStart(2,"0")}-${String(I.getDate()).padStart(2,"0")} ${String(I.getHours()).padStart(2,"0")}:${String(I.getMinutes()).padStart(2,"0")}:${String(I.getSeconds()).padStart(2,"0")}`,be=`${I.getFullYear()}-${String(I.getMonth()+1).padStart(2,"0")}-${String(I.getDate()).padStart(2,"0")}`,de={cuestionario_id:Number(j),estudiante_id:$,fecha_realizado:Y,fecha_inicio:be,tiempo_total:a(s),tiempo_guardado:a(z),pregunta_opcion_guardado:_};await fe.post(ge.cuestionario.resolver.guardarEstado,de)}catch(a){console.warn("[realizar] guardar-estado (siguiente) fallÃ³",a)}finally{ce&&ae()}})()};return l?e.jsx("div",{className:"container-fluid p-0",children:e.jsx("div",{style:{textAlign:"center",padding:"2rem"},children:e.jsx("h2",{children:"Cargando cuestionario..."})})}):w?e.jsx("div",{className:"container-fluid p-0",children:e.jsxs("div",{style:{textAlign:"center",padding:"2rem"},children:[e.jsx("h2",{children:"Error"}),e.jsx("p",{children:w}),e.jsx("button",{onClick:()=>o("/estudiante"),children:"Volver al Dashboard"})]})}):m?e.jsxs("div",{className:"container-fluid p-0",children:[e.jsx("div",{className:"d-none d-md-flex",style:{position:"fixed",top:y?"auto":12,right:y?"auto":12,bottom:y?12:"auto",left:y?12:"auto",zIndex:2e3,color:y?"#111827":"white",boxShadow:"0 6px 18px rgba(0,0,0,0.2)",fontWeight:700,letterSpacing:.3,display:"flex",alignItems:"center",justifyContent:"center",width:88,height:88,borderRadius:"50%",background:`conic-gradient(rgba(0,0,0,0.18) ${f}%, rgba(0,0,0,0.06) 0)`},"aria-label":`Tiempo restante ${V(H)} de ${V(D)}`,title:`Tiempo restante ${V(H)} de ${V(D)}`,children:e.jsxs("div",{style:{position:"relative",inset:0,width:78,height:78,borderRadius:"50%",backgroundColor:y?"#ffffff":ue,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",gap:2,boxShadow:y?"inset 0 0 0 2px rgba(0,0,0,0.08)":"inset 0 0 0 2px rgba(255,255,255,0.15)"},children:[e.jsx("i",{className:"bi bi-stopwatch","aria-hidden":"true",style:{fontSize:18,lineHeight:1,color:y?"#111827":"#ffffff"}}),e.jsx("span",{style:{fontSize:18,lineHeight:1,fontWeight:800,color:y?"#111827":"#ffffff"},children:V(H)})]})}),e.jsxs("div",{className:"px-2 px-md-2 px-lg-1 px-xl-1",style:{maxWidth:"98%",margin:"0 auto"},children:[e.jsx("div",{className:A.examHeader,children:e.jsx(Ee,{title:m?.titulo||"Cargando...",docente:he,programa:N,nivel:R})}),e.jsx("div",{className:A.examNavigation,children:e.jsx(Te,{totalQuestions:K,answeredQuestions:G,currentQuestion:k,onQuestionSelect:x})}),e.jsx("div",{className:A.examQuestion,children:e.jsx($e,{timeRemaining:V(H),totalTime:V(D),timePercent:Q,progress:Math.round(J)})}),e.jsx("div",{className:A.examAnswers,children:e.jsx("div",{className:A.componentCard,children:e.jsx(Ve,{questionText:re,weight:ee,answers:B,selectedAnswer:u,onAnswerSelect:te,questionImage:T(q?.imagen_pregunta)||void 0,orientation:typeof q?.orientacion=="number"?q.orientacion:1,onImageClick:Z,currentQuestion:k})})}),e.jsx("div",{className:A.examButtons,children:e.jsx(Qe,{currentQuestion:k,totalQuestions:K,onPrevious:ve,onNext:xe,isLastPage:le,onSubmit:async()=>{try{const n=de=>{const X=Math.max(0,Math.floor(de)),ie=String(Math.floor(X/3600)).padStart(2,"0"),ye=String(Math.floor(X%3600/60)).padStart(2,"0"),je=String(X%60).padStart(2,"0");return`${ie}:${ye}:${je}`},a=Math.max(0,Math.floor(D)),s=Math.max(0,Math.floor(a-Math.max(0,Math.floor(H)))),z={};c.forEach(de=>{const X=i[de.id];X!=null&&(z[Number(de.id)]=Number(X))});const _=typeof window<"u"?localStorage.getItem("user"):null,C=_?JSON.parse(_)?.id:void 0,M=d?.id??C,$=new Date,I=`${$.getFullYear()}-${String($.getMonth()+1).padStart(2,"0")}-${String($.getDate()).padStart(2,"0")} ${String($.getHours()).padStart(2,"0")}:${String($.getMinutes()).padStart(2,"0")}:${String($.getSeconds()).padStart(2,"0")}`,Y=`${$.getFullYear()}-${String($.getMonth()+1).padStart(2,"0")}-${String($.getDate()).padStart(2,"0")}`,be={estudiante_id:M,cuestionario_id:Number(j),fecha_realizado:I,fecha_inicio:Y,tiempo_total:n(a),tiempo_guardado:n(s),pregunta_opcion_guardado:z};await fe.post(ge.cuestionario.resolver.guardarEstado,be)}catch(n){console.warn("[realizar] guardar-estado (finalizar) fallÃ³",n)}await r()},isSubmitting:h})}),y&&e.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0, 0, 0, 0.9)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3,padding:"1rem"},onClick:()=>Z(null),children:e.jsxs("div",{style:{position:"relative",width:"95vw",height:"90vh",background:"white",borderRadius:16,boxShadow:"0 25px 50px rgba(0,0,0,0.4)",display:"flex",flexDirection:"column",overflow:"hidden"},onClick:n=>n.stopPropagation(),children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"1rem 1.5rem",background:"#2C3E50",color:"white"},children:[e.jsx("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:e.jsx("h3",{style:{margin:0,fontSize:"1.3rem",fontWeight:600,color:"white"},children:"Ampliar Imagen"})}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsxs("span",{style:{fontSize:"0.9rem",opacity:.9,color:"white"},children:["Pregunta ",k," de ",c.length]}),e.jsx("button",{onClick:()=>Z(null),style:{background:"rgba(255,255,255,0.2)",color:"white",objectFit:"cover",border:"1px solid rgba(255,255,255,0.3)",borderRadius:"50%",width:"36px",height:"36px",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",fontSize:18,fontWeight:"bold",transition:"all 0.2s ease"},title:"Cerrar (ESC)",type:"button",onMouseEnter:n=>{n.currentTarget.style.background="rgba(255,255,255,0.3)"},onMouseLeave:n=>{n.currentTarget.style.background="rgba(255,255,255,0.2)"},children:e.jsx(Me,{size:18})})]})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"0.75rem 1.5rem",background:"#f8fafc",borderBottom:"1px solid #e2e8f0"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"1rem"},children:[e.jsx("button",{onClick:()=>{const n=document.querySelector('img[alt="Imagen ampliada"]'),a=document.querySelector('input[type="range"]');if(n&&a){const s=Math.max(.5,parseFloat(a.value)-.2);n.style.transform=`scale(${s})`,a.value=s.toString()}},style:{background:"#3b82f6",color:"white",border:"none",borderRadius:8,padding:"0.5rem 0.75rem",cursor:"pointer",fontSize:14,fontWeight:500,display:"flex",alignItems:"center",gap:"0.25rem"},title:"Alejar (Zoom Out)",type:"button",children:e.jsx(_e,{size:16})}),e.jsx("button",{onClick:()=>{const n=document.querySelector('img[alt="Imagen ampliada"]'),a=document.querySelector('input[type="range"]');if(n&&a){const s=Math.min(3,parseFloat(a.value)+.2);n.style.transform=`scale(${s})`,a.value=s.toString()}},style:{background:"#3b82f6",color:"white",border:"none",borderRadius:8,padding:"0.5rem 0.75rem",cursor:"pointer",fontSize:14,fontWeight:500,display:"flex",alignItems:"center",gap:"0.25rem"},title:"Acercar (Zoom In)",type:"button",children:e.jsx(we,{size:16})}),e.jsxs("button",{onClick:()=>{const n=document.querySelector('img[alt="Imagen ampliada"]'),a=document.querySelector('input[type="range"]'),s=document.querySelector("[data-image-container]");n&&a&&s&&(n.style.transform="scale(1)",a.value="1",s.scrollLeft=0,s.scrollTop=0)},style:{background:"#10b981",color:"white",border:"none",borderRadius:8,padding:"0.5rem 0.75rem",cursor:"pointer",fontSize:14,fontWeight:500,display:"flex",alignItems:"center",gap:"0.25rem"},title:"Ajustar a ventana",type:"button",children:[e.jsx(Ie,{size:16})," ",e.jsx("span",{style:{marginLeft:6},children:"Ajustar"})]})]}),e.jsx("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",fontSize:"0.85rem",color:"#64748b"},children:e.jsxs("span",{style:{display:"inline-flex",alignItems:"center",gap:6},children:[e.jsx(Ae,{})," Arrastra para mover â€¢ Rueda del mouse para zoom"]})})]}),e.jsx("div",{"data-image-container":!0,style:{flex:1,overflow:"auto",display:"flex",alignItems:"center",justifyContent:"center",background:"linear-gradient(45deg, #f1f5f9 25%, transparent 25%), linear-gradient(-45deg, #f1f5f9 25%, transparent 25%), linear-gradient(45deg, transparent 75%, #f1f5f9 75%), linear-gradient(-45deg, transparent 75%, #f1f5f9 75%)",backgroundSize:"20px 20px",backgroundPosition:"0 0, 0 10px, 10px -10px, -10px 0px",padding:"2rem",cursor:"grab",userSelect:"none",WebkitUserSelect:"none",MozUserSelect:"none",msUserSelect:"none",position:"relative"},onMouseDown:n=>{n.preventDefault();const a=n.currentTarget;let s=!0,z=n.clientX,_=n.clientY,C=a.scrollLeft,M=a.scrollTop;a.style.cursor="grabbing";const $=Y=>{if(!s)return;Y.preventDefault();const be=Y.clientX-z,de=Y.clientY-_;a.scrollLeft=C-be,a.scrollTop=M-de},I=()=>{s=!1,a.style.cursor="grab",document.removeEventListener("mousemove",$),document.removeEventListener("mouseup",I)};document.addEventListener("mousemove",$),document.addEventListener("mouseup",I)},onWheel:n=>{n.preventDefault();const a=document.querySelector('img[alt="Imagen ampliada"]'),s=document.querySelector('input[type="range"]');if(a&&s){const z=n.deltaY>0?-.1:.1,_=Math.max(.5,Math.min(3,parseFloat(s.value)+z));a.style.transform=`scale(${_})`,s.value=_.toString()}},onDragStart:n=>n.preventDefault(),children:e.jsx("img",{src:y,alt:"Imagen ampliada",style:{maxWidth:"none",maxHeight:"none",width:"auto",height:"auto",objectFit:"contain",borderRadius:12,display:"block",userSelect:"none",WebkitUserSelect:"none",MozUserSelect:"none",msUserSelect:"none",pointerEvents:"none",WebkitTouchCallout:"none",boxShadow:"0 8px 32px rgba(0,0,0,0.2)",transition:"transform 0.1s ease-out"},draggable:!1,onDragStart:n=>n.preventDefault()})}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"1rem",padding:"1rem 1.5rem",background:"#f8fafc",borderTop:"1px solid #e2e8f0"},children:[e.jsx("div",{style:{display:"flex",alignItems:"center",gap:"1rem",justifyContent:"center",flexWrap:"wrap"},children:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem"},children:[e.jsxs("span",{style:{display:"inline-flex",alignItems:"center",gap:6,fontSize:"14px",fontWeight:600,color:"#374151",minWidth:"60px"},children:[e.jsx(we,{})," Zoom:"]}),e.jsx("span",{id:"zoom-value",style:{fontSize:"13px",fontWeight:500,color:"#6366f1",minWidth:"40px",textAlign:"center"},children:"100%"}),e.jsx("input",{type:"range",min:"0.5",max:"3",step:"0.1",defaultValue:"1",style:{width:"200px",height:"8px",borderRadius:"4px",background:"linear-gradient(to right, #e2e8f0 0%, #6366f1 50%, #e2e8f0 100%)",outline:"none",cursor:"pointer",WebkitAppearance:"none",appearance:"none"},onChange:n=>{const a=document.querySelector('img[alt="Imagen ampliada"]'),s=document.getElementById("zoom-value");a&&s&&(a.style.transform=`scale(${n.target.value})`,s.textContent=`${Math.round(parseFloat(n.target.value)*100)}%`)}})]})}),e.jsx("div",{style:{display:"flex",justifyContent:"center",gap:"0.5rem",fontSize:"0.8rem",color:"#64748b",flexWrap:"wrap"}})]})]})})]})]}):e.jsx("div",{className:"container-fluid p-0",children:e.jsxs("div",{style:{textAlign:"center",padding:"2rem"},children:[e.jsx("h2",{children:"Cuestionario no encontrado"}),e.jsx("button",{onClick:()=>o("/estudiante"),children:"Volver al Dashboard"})]})})}function at(){return e.jsx("div",{className:"min-vh-100 w-100",style:{backgroundColor:"#F8F9FA",overflowX:"hidden"},children:e.jsx("div",{className:A.examContainer,children:e.jsx(Ze,{})})})}export{at as default};
