import{e as de,a as ue,r as v,b as W,A as $,S as ge,j as r}from"./index-DaOhVVWd.js";import{P as B}from"./PageTransition-Couod70-.js";const G="3.7.8",me=G,j=typeof Buffer=="function",H=typeof TextDecoder=="function"?new TextDecoder:void 0,L=typeof TextEncoder=="function"?new TextEncoder:void 0,pe="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",N=Array.prototype.slice.call(pe),k=(e=>{let t={};return e.forEach((n,x)=>t[n]=x),t})(N),xe=/^(?:[A-Za-z\d+\/]{4})*?(?:[A-Za-z\d+\/]{2}(?:==)?|[A-Za-z\d+\/]{3}=?)?$/,d=String.fromCharCode.bind(String),Z=typeof Uint8Array.from=="function"?Uint8Array.from.bind(Uint8Array):e=>new Uint8Array(Array.prototype.slice.call(e,0)),K=e=>e.replace(/=/g,"").replace(/[+\/]/g,t=>t=="+"?"-":"_"),J=e=>e.replace(/[^A-Za-z0-9\+\/]/g,""),Q=e=>{let t,n,x,f,h="";const b=e.length%3;for(let A=0;A<e.length;){if((n=e.charCodeAt(A++))>255||(x=e.charCodeAt(A++))>255||(f=e.charCodeAt(A++))>255)throw new TypeError("invalid character found");t=n<<16|x<<8|f,h+=N[t>>18&63]+N[t>>12&63]+N[t>>6&63]+N[t&63]}return b?h.slice(0,b-3)+"===".substring(b):h},D=typeof btoa=="function"?e=>btoa(e):j?e=>Buffer.from(e,"binary").toString("base64"):Q,R=j?e=>Buffer.from(e).toString("base64"):e=>{let n=[];for(let x=0,f=e.length;x<f;x+=4096)n.push(d.apply(null,e.subarray(x,x+4096)));return D(n.join(""))},V=(e,t=!1)=>t?K(R(e)):R(e),fe=e=>{if(e.length<2){var t=e.charCodeAt(0);return t<128?e:t<2048?d(192|t>>>6)+d(128|t&63):d(224|t>>>12&15)+d(128|t>>>6&63)+d(128|t&63)}else{var t=65536+(e.charCodeAt(0)-55296)*1024+(e.charCodeAt(1)-56320);return d(240|t>>>18&7)+d(128|t>>>12&63)+d(128|t>>>6&63)+d(128|t&63)}},he=/[\uD800-\uDBFF][\uDC00-\uDFFFF]|[^\x00-\x7F]/g,q=e=>e.replace(he,fe),M=j?e=>Buffer.from(e,"utf8").toString("base64"):L?e=>R(L.encode(e)):e=>D(q(e)),C=(e,t=!1)=>t?K(M(e)):M(e),Y=e=>C(e,!0),ye=/[\xC0-\xDF][\x80-\xBF]|[\xE0-\xEF][\x80-\xBF]{2}|[\xF0-\xF7][\x80-\xBF]{3}/g,be=e=>{switch(e.length){case 4:var t=(7&e.charCodeAt(0))<<18|(63&e.charCodeAt(1))<<12|(63&e.charCodeAt(2))<<6|63&e.charCodeAt(3),n=t-65536;return d((n>>>10)+55296)+d((n&1023)+56320);case 3:return d((15&e.charCodeAt(0))<<12|(63&e.charCodeAt(1))<<6|63&e.charCodeAt(2));default:return d((31&e.charCodeAt(0))<<6|63&e.charCodeAt(1))}},X=e=>e.replace(ye,be),ee=e=>{if(e=e.replace(/\s+/g,""),!xe.test(e))throw new TypeError("malformed base64.");e+="==".slice(2-(e.length&3));let t,n,x,f=[];for(let h=0;h<e.length;)t=k[e.charAt(h++)]<<18|k[e.charAt(h++)]<<12|(n=k[e.charAt(h++)])<<6|(x=k[e.charAt(h++)]),n===64?f.push(d(t>>16&255)):x===64?f.push(d(t>>16&255,t>>8&255)):f.push(d(t>>16&255,t>>8&255,t&255));return f.join("")},F=typeof atob=="function"?e=>atob(J(e)):j?e=>Buffer.from(e,"base64").toString("binary"):ee,te=j?e=>Z(Buffer.from(e,"base64")):e=>Z(F(e).split("").map(t=>t.charCodeAt(0))),re=e=>te(oe(e)),_e=j?e=>Buffer.from(e,"base64").toString("utf8"):H?e=>H.decode(te(e)):e=>X(F(e)),oe=e=>J(e.replace(/[-_]/g,t=>t=="-"?"+":"/")),z=e=>_e(oe(e)),Ae=e=>{if(typeof e!="string")return!1;const t=e.replace(/\s+/g,"").replace(/={0,2}$/,"");return!/[^\s0-9a-zA-Z\+/]/.test(t)||!/[^\s0-9a-zA-Z\-_]/.test(t)},ae=e=>({value:e,enumerable:!1,writable:!0,configurable:!0}),ne=function(){const e=(t,n)=>Object.defineProperty(String.prototype,t,ae(n));e("fromBase64",function(){return z(this)}),e("toBase64",function(t){return C(this,t)}),e("toBase64URI",function(){return C(this,!0)}),e("toBase64URL",function(){return C(this,!0)}),e("toUint8Array",function(){return re(this)})},se=function(){const e=(t,n)=>Object.defineProperty(Uint8Array.prototype,t,ae(n));e("toBase64",function(t){return V(this,t)}),e("toBase64URI",function(){return V(this,!0)}),e("toBase64URL",function(){return V(this,!0)})},Ce=()=>{ne(),se()},je={version:G,VERSION:me,atob:F,atobPolyfill:ee,btoa:D,btoaPolyfill:Q,fromBase64:z,toBase64:C,encode:C,encodeURI:Y,encodeURL:Y,utob:q,btou:X,decode:z,isValid:Ae,fromUint8Array:V,toUint8Array:re,extendString:ne,extendUint8Array:se,extendBuiltins:Ce},E={},P={},we=()=>{const{id:e}=de(),t=ue(),[n,x]=v.useState(null),[f,h]=v.useState(!0),[b,A]=v.useState(null),[O,w]=v.useState(null),y=a=>{if(!a)return null;const i=String(a).trim();if(!i)return null;if(/^data:image\//i.test(i))return i;let s="png";return i.startsWith("/9j")?s="jpeg":i.startsWith("iVBOR")?s="png":i.startsWith("R0lG")?s="gif":i.startsWith("UklGR")?s="webp":i.startsWith("Qk")?s="bmp":(i.startsWith("PHN2Zy")||i.startsWith("PD94"))&&(s="svg+xml"),`data:image/${s};base64,${i}`};v.useEffect(()=>{ie()},[e]);const ie=async()=>{try{const a=(()=>{try{return JSON.parse(localStorage.getItem("usuario")||localStorage.getItem("user")||"{}")?.id}catch{return}})(),i=`${e??""}:${a??""}:ver.obtener`;E[i]||(E[i]=W.get($.ver.obtener(e||""),{params:a?{usuario_id:a}:void 0}).finally(()=>{delete E[i]}));const s=await E[i];if(!s.data.success)throw new Error(s.data.message||"Error al cargar el cuestionario");const l=s.data;try{console.log("[VerCuestionario] ver.obtener resp:",l)}catch{}if(l.success){const g=l?.data?.cuestionario??l?.data??l,_=l?.data?.preguntas;let u=[];console.log("[VerCuestionario] Estructura completa de cuestionarioData:",g),console.log("[VerCuestionario] Estructura completa de preguntasData:",_),console.log("[VerCuestionario] cuestionarioData.preguntas:",g?.preguntas),console.log("[VerCuestionario] data.data completo:",l?.data),console.log("[VerCuestionario] data.data.preguntas:",l?.data?.preguntas),console.log("[VerCuestionario] data.data.cuestionario:",l?.data?.cuestionario);const S=[_,g?.preguntas,g?.pregunta,g?.preguntas_opciones,l?.data?.pregunta,l?.data?.preguntas_opciones,l?.data?.imagen_pregunta,l?.data?.imagen_opcion];console.log("[VerCuestionario] Candidates para preguntas:",S);for(const o of S)if(console.log("[VerCuestionario] Evaluando candidato:",o,"¿Es array?",Array.isArray(o),"¿Tiene longitud?",o?.length),Array.isArray(o)&&o.length){console.log("[VerCuestionario] Preguntas encontradas en:",o),u=o;break}if(console.log(s.data),!Array.isArray(u)||u.length===0){const o=[g?.preguntas,g?.data?.preguntas];for(const c of o)if(c&&typeof c=="object"&&!Array.isArray(c)){const m=Object.values(c);if(Array.isArray(m)&&m.length){u=m;break}}if(!Array.isArray(u)||u.length===0){const c=g?.preguntas_respuestas??g?.preguntasYRespuestas??g?.data?.preguntas_respuestas??g?.data?.preguntasYRespuestas;Array.isArray(c)&&c.length&&(u=c.map(m=>({...m,opciones:m?.opciones??m?.respuestas??m?.alternativas??[]})))}}if(!u.length&&e)try{const o=`${e??""}:${a??""}:cuestionario.resolver.preguntasOpciones`;P[o]||(P[o]=W.get($.cuestionario.resolver.preguntasOpciones(e),{params:a?{usuario_id:a}:void 0}).finally(()=>{delete P[o]}));const c=await P[o],m=c?.data?.data??c?.data;try{console.log("[VerCuestionario] preguntas-opciones resp:",c?.data)}catch{}if(Array.isArray(m)&&m.length)u=m;else{const U=[m?.preguntas,m?.pregunta,c?.data];for(const p of U)if(Array.isArray(p)&&p.length){u=p;break}}}catch{}const I=(Array.isArray(u)?u:[]).map((o,c)=>{const U=((Array.isArray(o?.opciones)?o.opciones:Array.isArray(o?.opcion)?o.opcion:Array.isArray(o?.opciones_pregunta)?o.opciones_pregunta:Array.isArray(o?.opcionesPregunta)?o.opcionesPregunta:[])||[]).map((p,le)=>({...p,imagen_opcion:p?.imagen_opcion??p?.imagen??p?.imagenOpcion??"",texto_opcion:p?.texto_opcion??p?.texto??p?.textoOpcion??"",opcion_correcta:p?.opcion_correcta??p?.es_correcta??p?.correcta??0,orden:p?.orden??le+1}));return{id:Number(o?.id??c+1),texto_pregunta:o?.texto_pregunta??o?.texto??o?.pregunta??o?.textoPregunta??"",peso_pregunta:Number(o?.peso_pregunta??o?.peso??o?.pesoPregunta??0),imagen_pregunta:o?.imagen_pregunta??o?.imagen??o?.imagenPregunta??"",orden_pregunta:Number(o?.orden_pregunta??o?.orden??o?.ordenPregunta??c+1),tiene_imagen:!!o?.tiene_imagen,opciones_imagen:je.decode(o?.opciones_imagen??o?.opcionesImagen??o?.opciones_imagen_pregunta??o?.opcionesImagenPregunta??""),nombre_imagen_pregunta:o?.nombre_imagen_pregunta??o?.nombre_imagen??o?.nombreImagenPregunta??null,opciones:U}}),T={...g,preguntas:I};console.log("[VerCuestionario] Cuestionario normalizado:",T),console.log("[VerCuestionario] Preguntas normalizadas:",I),x(T);try{const o=T?.preguntas?.[0],c=o?.opciones?.[0];console.debug("[VerCuestionario] img debug:",{p0_img_len:(o?.imagen_pregunta||"").length,p0_img_src_len:(y(o?.imagen_pregunta)||"").length,o0_img_len:(c?.imagen_opcion||"").length,o0_img_src_len:(y(c?.imagen_opcion)||"").length})}catch{}}else throw new Error(l.message||"Error al cargar el cuestionario")}catch(a){console.error("Error:",a),ge.fire({icon:"error",title:"Error",text:a?.response?.data?.message||a?.message||"Error al cargar el cuestionario"})}finally{h(!1)}},ce=a=>{A(b===a?null:a)};return f?r.jsx(B,{children:r.jsxs("div",{className:"d-flex align-items-center justify-content-center",style:{minHeight:"70vh",padding:"1.5rem"},children:[r.jsx("div",{className:"text-center",children:r.jsx("h2",{style:{color:"#0f172a ",fontSize:"1.5rem",marginBottom:"1rem"},children:"Cargando..."})}),r.jsx("div",{className:"text-center",children:r.jsx("i",{className:"fas fa-spinner fa-spin"})})]})}):n?(console.log("[VerCuestionario] Estado actual del cuestionario:",n),console.log("[VerCuestionario] Preguntas en estado:",n?.preguntas),console.log("[VerCuestionario] ¿Es array?",Array.isArray(n?.preguntas)),console.log("[VerCuestionario] Longitud:",n?.preguntas?.length),n&&(!Array.isArray(n.preguntas)||n.preguntas.length===0)?r.jsx(B,{children:r.jsx("div",{className:"d-flex align-items-center justify-content-center",style:{minHeight:"70vh",padding:"1.5rem"},children:r.jsxs("div",{className:"text-center",children:[r.jsx("h2",{style:{color:"#0f172a",fontSize:"1.2rem",marginBottom:"0.75rem"},children:"Este cuestionario no tiene preguntas"}),r.jsx("button",{onClick:()=>t("/dashboard"),className:"btn btn-outline-secondary",style:{borderColor:"#00a19B",color:"#00a19B"},children:"Volver"})]})})}):r.jsx(B,{children:r.jsx("div",{className:"container-fluid py-3",style:{backgroundColor:"#f8fafc",minHeight:"100vh"},children:r.jsx("div",{className:"row justify-content-center",children:r.jsxs("div",{className:"col-12 col-xl-10",children:[r.jsx("div",{className:"card border-0 mb-4",style:{background:"linear-gradient(135deg, #00a19b 0%, #008f89 100%)",color:"white",borderRadius:"12px",boxShadow:"0 4px 15px rgba(0,0,0,0.03)",position:"relative",overflow:"hidden"},children:r.jsxs("div",{className:"card-body p-4",children:[r.jsx("h1",{className:"mb-2 text-white",style:{fontSize:"1.3rem",fontWeight:"700"},children:n.titulo}),r.jsx("p",{className:"mb-0 text-white",style:{fontSize:"0.9rem",lineHeight:"1.4"},children:n.descripcion})]})}),r.jsx("div",{className:"accordion",id:"preguntasAccordion",children:(n.preguntas||[]).map((a,i)=>r.jsxs("div",{className:"accordion-item mb-2",style:{backgroundColor:"white",borderRadius:"12px",boxShadow:"0 4px 15px rgba(0,0,0,0.03)",border:"1px solid #e2e8f0"},children:[r.jsx("h2",{className:"accordion-header",children:r.jsx("button",{className:`accordion-button ${b===i?"":"collapsed"}`,type:"button",onClick:()=>ce(i),style:{backgroundColor:"#f8fafc",border:"none",padding:"0.6rem 0.8rem",fontSize:"0.9rem",fontWeight:"500",color:"#0f172a"},children:r.jsxs("div",{className:"d-flex justify-content-between align-items-center w-100 me-3",children:[r.jsxs("span",{style:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:["P",i+1,": ",a.texto_pregunta]}),r.jsxs("span",{className:"badge",style:{backgroundColor:"#f97316",color:"white",padding:"0.15rem 0.4rem",borderRadius:"50px",fontSize:"0.7rem",fontWeight:"600"},children:[a.peso_pregunta,"p"]})]})})}),b===i&&r.jsx("div",{className:"accordion-collapse collapse show",children:r.jsxs("div",{className:"accordion-body p-3",children:[!!y(a.imagen_pregunta)&&r.jsxs("div",{className:"mb-3 text-center",style:{position:"relative"},children:[r.jsx("img",{src:y(a.imagen_pregunta)||void 0,alt:`Imagen P${i+1}`,className:"img-fluid rounded",style:{maxHeight:"250px",boxShadow:"0 4px 15px rgba(0,0,0,0.03)",cursor:"pointer"},onError:s=>{s.currentTarget.style.display="none"},onClick:()=>w(y(a.imagen_pregunta))}),r.jsx("button",{className:"btn btn-light btn-sm",style:{position:"absolute",bottom:"8px",right:"8px",borderRadius:"50%",width:"32px",height:"32px",padding:"0",display:"flex",alignItems:"center",justifyContent:"center",boxShadow:"0 2px 8px rgba(0,0,0,0.12)"},onClick:s=>{s.stopPropagation(),w(y(a.imagen_pregunta))},title:"Ampliar imagen",type:"button",children:r.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[r.jsx("circle",{cx:"11",cy:"11",r:"8"}),r.jsx("line",{x1:"21",y1:"21",x2:"16.65",y2:"16.65"})]})})]}),r.jsx("div",{className:"d-flex flex-column gap-2",children:(Array.isArray(a.opciones)?a.opciones:[]).map((s,l)=>{const g={...s,texto_opcion:s.texto_opcion&&s.texto_opcion!=="0"?s.texto_opcion:""},_=s.opcion_correcta??s.es_correcta??s.correcta??0,u=_===1||_==="1"||_===!0||_==="true";return r.jsxs("div",{className:`p-3 rounded ${u?"bg-success bg-opacity-10 border border-success":"bg-light border"}`,style:{transition:"all 0.2s ease"},children:[r.jsxs("div",{className:"d-flex  align-items-start gap-3",children:[r.jsx("div",{className:"badge rounded-circle d-flex align-items-center justify-content-center",style:{width:"20px",height:"20px",fontSize:"0.75rem",fontWeight:"600",backgroundColor:u?"#22c55e":"#f97316",color:"white",flexShrink:0},children:String.fromCharCode(65+l)}),r.jsxs("div",{className:"flex-grow-1",children:[r.jsx("p",{className:"mb-1",style:{fontSize:"0.85rem",lineHeight:"1.4",color:"#334155"},children:g.texto_opcion}),u&&r.jsx("span",{className:"badge bg-success",style:{fontSize:"0.7rem"},children:"Correcta"})]})]}),!!y(s.imagen_opcion)&&r.jsx("div",{className:"mt-2 text-center",children:r.jsx("img",{src:y(s.imagen_opcion)||void 0,alt:`Imagen opción ${String.fromCharCode(65+l)}`,className:"img-fluid rounded",style:{maxHeight:"150px",boxShadow:"0 4px 15px rgba(0,0,0,0.03)"},onError:S=>{S.currentTarget.style.display="none"}})})]},s.id)})})]})})]},a.id))}),O&&r.jsx("div",{className:"modal fade show d-block",style:{backgroundColor:"rgba(0,0,0,0.6)"},onClick:()=>w(null),children:r.jsx("div",{className:"modal-dialog modal-dialog-centered modal-lg",children:r.jsxs("div",{className:"modal-content",onClick:a=>a.stopPropagation(),children:[r.jsx("div",{className:"modal-header border-0 pb-0",children:r.jsx("button",{type:"button",className:"btn-close",onClick:()=>w(null),"aria-label":"Cerrar"})}),r.jsx("div",{className:"modal-body text-center p-4",children:r.jsx("img",{src:O,alt:"Imagen ampliada",className:"img-fluid rounded",style:{maxWidth:"80vw",maxHeight:"70vh",boxShadow:"0 2px 16px rgba(0,0,0,0.18)"}})})]})})}),r.jsx("div",{className:"text-center mt-4",children:r.jsx("button",{onClick:()=>t("/dashboard"),className:"btn btn-outline-secondary",style:{borderColor:"#00a19B",color:"#00a19B",fontWeight:"600",transition:"all 0.3s ease",boxShadow:"0 4px 15px rgba(0,0,0,0.03)"},onMouseOver:a=>{a.currentTarget.style.backgroundColor="#00a19B",a.currentTarget.style.color="white",a.currentTarget.style.transform="translateY(-2px)",a.currentTarget.style.boxShadow="0 8px 30px rgba(0,0,0,0.06)"},onMouseOut:a=>{a.currentTarget.style.backgroundColor="transparent",a.currentTarget.style.color="#00a19B",a.currentTarget.style.transform="translateY(0)",a.currentTarget.style.boxShadow="0 4px 15px rgba(0,0,0,0.03)"},children:"Volver"})})]})})})})):r.jsx(B,{children:r.jsx("div",{className:"d-flex align-items-center justify-content-center",style:{minHeight:"70vh",padding:"1.5rem"},children:r.jsxs("div",{className:"text-center",children:[r.jsx("h2",{style:{color:"#ef4444",fontSize:"1.5rem",marginBottom:"1rem"},children:"Cuestionario no encontrado"}),r.jsx("button",{onClick:()=>t("/dashboard"),className:"btn btn-outline-secondary",style:{borderColor:"#00a19B",color:"#00a19B",transition:"all 0.3s ease"},onMouseOver:a=>{a.currentTarget.style.backgroundColor="#00a19B",a.currentTarget.style.color="white"},onMouseOut:a=>{a.currentTarget.style.backgroundColor="transparent",a.currentTarget.style.color="#00a19B"},children:"Volver"})]})})})};export{we as default};
