import{e as ge,a as ue,r as N,b as V,A as L,S as me,j as t}from"./index-BTkTQ1Fh.js";import{P as S}from"./PageTransition-Dz2EIat_.js";import{m as he}from"./index-DLtsYAVg.js";import"./iconBase-QLClNUbn.js";const G="3.7.8",xe=G,v=typeof Buffer=="function",W=typeof TextDecoder=="function"?new TextDecoder:void 0,q=typeof TextEncoder=="function"?new TextEncoder:void 0,fe="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",B=Array.prototype.slice.call(fe),E=(e=>{let r={};return e.forEach((s,h)=>r[s]=h),r})(B),pe=/^(?:[A-Za-z\d+\/]{4})*?(?:[A-Za-z\d+\/]{2}(?:==)?|[A-Za-z\d+\/]{3}=?)?$/,d=String.fromCharCode.bind(String),H=typeof Uint8Array.from=="function"?Uint8Array.from.bind(Uint8Array):e=>new Uint8Array(Array.prototype.slice.call(e,0)),K=e=>e.replace(/=/g,"").replace(/[+\/]/g,r=>r=="+"?"-":"_"),Y=e=>e.replace(/[^A-Za-z0-9\+\/]/g,""),J=e=>{let r,s,h,p,_="";const y=e.length%3;for(let A=0;A<e.length;){if((s=e.charCodeAt(A++))>255||(h=e.charCodeAt(A++))>255||(p=e.charCodeAt(A++))>255)throw new TypeError("invalid character found");r=s<<16|h<<8|p,_+=B[r>>18&63]+B[r>>12&63]+B[r>>6&63]+B[r&63]}return y?_.slice(0,y-3)+"===".substring(y):_},D=typeof btoa=="function"?e=>btoa(e):v?e=>Buffer.from(e,"binary").toString("base64"):J,U=v?e=>Buffer.from(e).toString("base64"):e=>{let s=[];for(let h=0,p=e.length;h<p;h+=4096)s.push(d.apply(null,e.subarray(h,h+4096)));return D(s.join(""))},I=(e,r=!1)=>r?K(U(e)):U(e),_e=e=>{if(e.length<2){var r=e.charCodeAt(0);return r<128?e:r<2048?d(192|r>>>6)+d(128|r&63):d(224|r>>>12&15)+d(128|r>>>6&63)+d(128|r&63)}else{var r=65536+(e.charCodeAt(0)-55296)*1024+(e.charCodeAt(1)-56320);return d(240|r>>>18&7)+d(128|r>>>12&63)+d(128|r>>>6&63)+d(128|r&63)}},ye=/[\uD800-\uDBFF][\uDC00-\uDFFFF]|[^\x00-\x7F]/g,Q=e=>e.replace(ye,_e),Z=v?e=>Buffer.from(e,"utf8").toString("base64"):q?e=>U(q.encode(e)):e=>D(Q(e)),C=(e,r=!1)=>r?K(Z(e)):Z(e),M=e=>C(e,!0),be=/[\xC0-\xDF][\x80-\xBF]|[\xE0-\xEF][\x80-\xBF]{2}|[\xF0-\xF7][\x80-\xBF]{3}/g,Ae=e=>{switch(e.length){case 4:var r=(7&e.charCodeAt(0))<<18|(63&e.charCodeAt(1))<<12|(63&e.charCodeAt(2))<<6|63&e.charCodeAt(3),s=r-65536;return d((s>>>10)+55296)+d((s&1023)+56320);case 3:return d((15&e.charCodeAt(0))<<12|(63&e.charCodeAt(1))<<6|63&e.charCodeAt(2));default:return d((31&e.charCodeAt(0))<<6|63&e.charCodeAt(1))}},X=e=>e.replace(be,Ae),ee=e=>{if(e=e.replace(/\s+/g,""),!pe.test(e))throw new TypeError("malformed base64.");e+="==".slice(2-(e.length&3));let r,s,h,p=[];for(let _=0;_<e.length;)r=E[e.charAt(_++)]<<18|E[e.charAt(_++)]<<12|(s=E[e.charAt(_++)])<<6|(h=E[e.charAt(_++)]),s===64?p.push(d(r>>16&255)):h===64?p.push(d(r>>16&255,r>>8&255)):p.push(d(r>>16&255,r>>8&255,r&255));return p.join("")},F=typeof atob=="function"?e=>atob(Y(e)):v?e=>Buffer.from(e,"base64").toString("binary"):ee,te=v?e=>H(Buffer.from(e,"base64")):e=>H(F(e).split("").map(r=>r.charCodeAt(0))),re=e=>te(ne(e)),je=v?e=>Buffer.from(e,"base64").toString("utf8"):W?e=>W.decode(te(e)):e=>X(F(e)),ne=e=>Y(e.replace(/[-_]/g,r=>r=="-"?"+":"/")),R=e=>je(ne(e)),Ce=e=>{if(typeof e!="string")return!1;const r=e.replace(/\s+/g,"").replace(/={0,2}$/,"");return!/[^\s0-9a-zA-Z\+/]/.test(r)||!/[^\s0-9a-zA-Z\-_]/.test(r)},ae=e=>({value:e,enumerable:!1,writable:!0,configurable:!0}),oe=function(){const e=(r,s)=>Object.defineProperty(String.prototype,r,ae(s));e("fromBase64",function(){return R(this)}),e("toBase64",function(r){return C(this,r)}),e("toBase64URI",function(){return C(this,!0)}),e("toBase64URL",function(){return C(this,!0)}),e("toUint8Array",function(){return re(this)})},se=function(){const e=(r,s)=>Object.defineProperty(Uint8Array.prototype,r,ae(s));e("toBase64",function(r){return I(this,r)}),e("toBase64URI",function(){return I(this,!0)}),e("toBase64URL",function(){return I(this,!0)})},ve=()=>{oe(),se()},Ne={version:G,VERSION:xe,atob:F,atobPolyfill:ee,btoa:D,btoaPolyfill:J,fromBase64:R,toBase64:C,encode:C,encodeURI:M,encodeURL:M,utob:Q,btou:X,decode:R,isValid:Ce,fromUint8Array:I,toUint8Array:re,extendString:oe,extendUint8Array:se,extendBuiltins:ve},Be="_pageContainer_mg7ht_67",we="_headerCard_mg7ht_77",Se="_headerTitle_mg7ht_95",Ee="_headerDesc_mg7ht_105",ke="_accordionItem_mg7ht_115",Te="_accordionButton_mg7ht_129",Ie="_headerRow_mg7ht_149",Pe="_questionText_mg7ht_167",$e="_textCollapsed_mg7ht_175",Ue="_textExpanded_mg7ht_187",Re="_weightBadge_mg7ht_201",De="_imageContainer_mg7ht_221",Fe="_questionImage_mg7ht_229",Oe="_zoomBtn_mg7ht_241",ze="_modalOverlay_mg7ht_269",Ve="_modalImage_mg7ht_277",Le="_backButton_mg7ht_289",We="_preguntaTitulo_mg7ht_317",l={pageContainer:Be,headerCard:we,headerTitle:Se,headerDesc:Ee,accordionItem:ke,accordionButton:Te,headerRow:Ie,questionText:Pe,textCollapsed:$e,textExpanded:Ue,weightBadge:Re,imageContainer:De,questionImage:Fe,zoomBtn:Oe,modalOverlay:ze,modalImage:Ve,backButton:Le,preguntaTitulo:We},k={},T={},Ge=()=>{const{id:e}=ge(),r=ue(),[s,h]=N.useState(null),[p,_]=N.useState(!0),[y,A]=N.useState(null),[O,w]=N.useState(null),b=a=>{if(!a)return null;const i=String(a).trim();if(!i)return null;if(/^data:image\//i.test(i))return i;let o="png";return i.startsWith("/9j")?o="jpeg":i.startsWith("iVBOR")?o="png":i.startsWith("R0lG")?o="gif":i.startsWith("UklGR")?o="webp":i.startsWith("Qk")?o="bmp":(i.startsWith("PHN2Zy")||i.startsWith("PD94"))&&(o="svg+xml"),`data:image/${o};base64,${i}`};N.useEffect(()=>{ie()},[e]);const ie=async()=>{try{const a=(()=>{try{return JSON.parse(localStorage.getItem("usuario")||localStorage.getItem("user")||"{}")?.id}catch{return}})(),i=`${e??""}:${a??""}:ver.obtener`;k[i]||(k[i]=V.get(L.ver.obtener(e||""),{params:a?{usuario_id:a}:void 0}).finally(()=>{delete k[i]}));const o=await k[i];if(!o.data.success)throw new Error(o.data.message||"Error al cargar el cuestionario");const x=o.data;if(x.success){const f=x?.data?.cuestionario??x?.data??x,j=x?.data?.preguntas;let g=[];const P=[j,f?.preguntas,f?.pregunta,f?.preguntas_opciones,x?.data?.pregunta,x?.data?.preguntas_opciones,x?.data?.imagen_pregunta,x?.data?.imagen_opcion];for(const n of P)if(Array.isArray(n)&&n.length){g=n;break}if(!Array.isArray(g)||g.length===0){const n=[f?.preguntas,f?.data?.preguntas];for(const c of n)if(c&&typeof c=="object"&&!Array.isArray(c)){const u=Object.values(c);if(Array.isArray(u)&&u.length){g=u;break}}if(!Array.isArray(g)||g.length===0){const c=f?.preguntas_respuestas??f?.preguntasYRespuestas??f?.data?.preguntas_respuestas??f?.data?.preguntasYRespuestas;Array.isArray(c)&&c.length&&(g=c.map(u=>({...u,opciones:u?.opciones??u?.respuestas??u?.alternativas??[]})))}}if(!g.length&&e)try{const n=`${e??""}:${a??""}:cuestionario.resolver.preguntasOpciones`;T[n]||(T[n]=V.get(L.cuestionario.resolver.preguntasOpciones(e),{params:a?{usuario_id:a}:void 0}).finally(()=>{delete T[n]}));const c=await T[n],u=c?.data?.data??c?.data;if(Array.isArray(u)&&u.length)g=u;else{const $=[u?.preguntas,u?.pregunta,c?.data];for(const m of $)if(Array.isArray(m)&&m.length){g=m;break}}}catch{}const le=(Array.isArray(g)?g:[]).map((n,c)=>{const $=((Array.isArray(n?.opciones)?n.opciones:Array.isArray(n?.opcion)?n.opcion:Array.isArray(n?.opciones_pregunta)?n.opciones_pregunta:Array.isArray(n?.opcionesPregunta)?n.opcionesPregunta:[])||[]).map((m,de)=>({...m,imagen_opcion:m?.imagen_opcion??m?.imagen??m?.imagenOpcion??"",texto_opcion:m?.texto_opcion??m?.texto??m?.textoOpcion??"",opcion_correcta:m?.opcion_correcta??m?.es_correcta??m?.correcta??0,orden:m?.orden??de+1}));return{id:Number(n?.id??c+1),texto_pregunta:n?.texto_pregunta??n?.texto??n?.pregunta??n?.textoPregunta??"",peso_pregunta:Number(n?.peso_pregunta??n?.peso??n?.pesoPregunta??0),imagen_pregunta:n?.imagen_pregunta??n?.imagen??n?.imagenPregunta??"",orden_pregunta:Number(n?.orden_pregunta??n?.orden??n?.ordenPregunta??c+1),tiene_imagen:!!n?.tiene_imagen,opciones_imagen:Ne.decode(n?.opciones_imagen??n?.opcionesImagen??n?.opciones_imagen_pregunta??n?.opcionesImagenPregunta??""),nombre_imagen_pregunta:n?.nombre_imagen_pregunta??n?.nombre_imagen??n?.nombreImagenPregunta??null,opciones:$}}),z={...f,preguntas:le};h(z);try{const n=z?.preguntas?.[0],c=n?.opciones?.[0];console.debug("[VerCuestionario] img debug:",{p0_img_len:(n?.imagen_pregunta||"").length,p0_img_src_len:(b(n?.imagen_pregunta)||"").length,o0_img_len:(c?.imagen_opcion||"").length,o0_img_src_len:(b(c?.imagen_opcion)||"").length})}catch{}}else throw new Error(x.message||"Error al cargar el cuestionario")}catch(a){console.error("Error:",a),me.fire({icon:"error",title:"Error",text:a?.response?.data?.message||a?.message||"Error al cargar el cuestionario"})}finally{_(!1)}},ce=a=>{A(y===a?null:a)};return p?t.jsx(S,{children:t.jsxs("div",{className:"d-flex align-items-center justify-content-center",style:{minHeight:"70vh",padding:"1.5rem"},children:[t.jsx("div",{className:"text-center",children:t.jsx("h2",{style:{color:"#0f172a ",fontSize:"1.5rem",marginBottom:"1rem"},children:"Cargando..."})}),t.jsx("div",{className:"text-center",children:t.jsx("i",{className:"fas fa-spinner fa-spin"})})]})}):s?s&&(!Array.isArray(s.preguntas)||s.preguntas.length===0)?t.jsx(S,{children:t.jsx("div",{className:"d-flex align-items-center justify-content-center",style:{minHeight:"70vh",padding:"1.5rem"},children:t.jsxs("div",{className:"text-center",children:[t.jsx("h2",{style:{color:"#0f172a",fontSize:"1.2rem",marginBottom:"0.75rem"},children:"Este cuestionario no tiene preguntas"}),t.jsx("button",{onClick:()=>r("/dashboard"),className:"btn btn-outline-secondary",style:{borderColor:"#00a19B",color:"#00a19B"},children:"Volver"})]})})}):t.jsx(S,{children:t.jsx("div",{className:`container-fluid py-3 ${l.pageContainer}`,children:t.jsx("div",{className:"row justify-content-center",children:t.jsxs("div",{className:"col-12 col-xl-10",children:[t.jsxs("div",{className:`card border-0 mb-4 ${l.headerCard} d-flex justify-content-between align-items-center flex-row`,children:[t.jsxs("div",{className:"card-body p-4 w-50",children:[t.jsx("h1",{className:`mb-2 text-white ${l.headerTitle}`,children:s.titulo}),t.jsx("div",{className:`mb-0 text-white ${l.headerDesc}`,dangerouslySetInnerHTML:{__html:s.descripcion}})]}),t.jsx("div",{className:"card-body d-flex justify-content-end",children:t.jsxs("button",{onClick:()=>r("/dashboard"),className:"btn btn-outline-secondary ml-2",children:[t.jsx(he,{})," Volver"]})})]}),t.jsx("div",{className:"accordion",id:"preguntasAccordion",children:(s.preguntas||[]).map((a,i)=>t.jsxs("div",{className:`accordion-item mb-2 ${l.accordionItem}`,children:[t.jsx("h2",{className:"accordion-header",children:t.jsx("button",{className:`accordion-button ${y===i?"":"collapsed"} ${l.accordionButton}`,type:"button",onClick:()=>ce(i),children:t.jsxs("div",{className:`w-100 me-3 ${l.headerRow}`,children:[t.jsxs("span",{className:`${l.questionText} ${y===i?l.textExpanded:l.textCollapsed}`,children:[t.jsxs("p",{className:l.preguntaTitulo,children:["Pregunta ",i+1,":"]})," ",a.texto_pregunta]}),t.jsxs("span",{className:`badge ${l.weightBadge} text-white`,children:["Peso: ",a.peso_pregunta]})]})})}),y===i&&t.jsx("div",{className:"accordion-collapse collapse show",children:t.jsxs("div",{className:"accordion-body p-3",children:[!!b(a.imagen_pregunta)&&t.jsxs("div",{className:`mb-3 text-center ${l.imageContainer}`,children:[t.jsx("img",{src:b(a.imagen_pregunta)||void 0,alt:`Imagen P${i+1}`,className:`img-fluid rounded ${l.questionImage}`,onError:o=>{o.currentTarget.style.display="none"},onClick:()=>w(b(a.imagen_pregunta))}),t.jsx("button",{className:`btn btn-light btn-sm ${l.zoomBtn}`,onClick:o=>{o.stopPropagation(),w(b(a.imagen_pregunta))},title:"Ampliar imagen",type:"button",children:t.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[t.jsx("circle",{cx:"11",cy:"11",r:"8"}),t.jsx("line",{x1:"21",y1:"21",x2:"16.65",y2:"16.65"})]})})]}),t.jsx("div",{className:"d-flex flex-column gap-2",children:(Array.isArray(a.opciones)?a.opciones:[]).map((o,x)=>{const f={...o,texto_opcion:o.texto_opcion&&o.texto_opcion!=="0"?o.texto_opcion:""},j=o.opcion_correcta??o.es_correcta??o.correcta??0,g=j===1||j==="1"||j===!0||j==="true";return t.jsxs("div",{className:`p-3 rounded ${g?"bg-success bg-opacity-10 border border-success":"bg-light border"}`,style:{transition:"all 0.2s ease"},children:[t.jsxs("div",{className:"d-flex  align-items-center gap-3",children:[t.jsx("div",{className:"badge rounded-circle d-flex align-items-center justify-content-center",style:{width:"30px",height:"30px",objectFit:"cover",fontSize:"0.75rem",fontWeight:"600",backgroundColor:g?"#22c55e":"#f1995a",flexShrink:0},children:String.fromCharCode(65+x)}),t.jsxs("div",{className:"flex-grow-1",children:[t.jsx("p",{className:"mb-1 d-inline",style:{fontSize:"0.85rem",lineHeight:"1.4",color:"#334155"},children:f.texto_opcion}),g&&t.jsx("span",{className:"badge bg-success text-white",style:{fontSize:"0.7rem",float:"right"},children:"Correcta"})]})]}),!!b(o.imagen_opcion)&&t.jsx("div",{className:"mt-2 text-center",children:t.jsx("img",{src:b(o.imagen_opcion)||void 0,alt:`Imagen opciÃ³n ${String.fromCharCode(65+x)}`,className:"img-fluid rounded",style:{maxHeight:"150px",boxShadow:"0 4px 15px rgba(0,0,0,0.03)"},onError:P=>{P.currentTarget.style.display="none"}})})]},o.id)})})]})})]},a.id))}),O&&t.jsx("div",{className:`modal fade show d-block ${l.modalOverlay}`,onClick:()=>w(null),children:t.jsx("div",{className:"modal-dialog modal-dialog-centered modal-lg",children:t.jsxs("div",{className:"modal-content",onClick:a=>a.stopPropagation(),children:[t.jsx("div",{className:"modal-header border-0 pb-0",children:t.jsx("button",{type:"button",className:"btn-close",onClick:()=>w(null),"aria-label":"Cerrar"})}),t.jsx("div",{className:"modal-body text-center p-4",children:t.jsx("img",{src:O,alt:"Imagen ampliada",className:`img-fluid rounded ${l.modalImage}`})})]})})}),t.jsx("div",{className:"text-center mt-4",children:t.jsx("button",{onClick:()=>r("/dashboard"),className:`btn btn-outline-secondary ${l.backButton}`,children:"Volver"})})]})})})}):t.jsx(S,{children:t.jsx("div",{className:"d-flex align-items-center justify-content-center",style:{minHeight:"70vh",padding:"1.5rem"},children:t.jsxs("div",{className:"text-center",children:[t.jsx("h2",{style:{color:"#ef4444",fontSize:"1.5rem",marginBottom:"1rem"},children:"Cuestionario no encontrado"}),t.jsx("button",{onClick:()=>r("/dashboard"),className:"btn btn-outline-secondary",style:{borderColor:"#00a19B",color:"#00a19B",transition:"all 0.3s ease"},onMouseOver:a=>{a.currentTarget.style.backgroundColor="#00a19B",a.currentTarget.style.color="white"},onMouseOut:a=>{a.currentTarget.style.backgroundColor="transparent",a.currentTarget.style.color="#00a19B"},children:"Volver"})]})})})};export{Ge as default};
