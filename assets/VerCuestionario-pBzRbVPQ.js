import{e as le,a as de,r as B,c as O,A as z,S as ue,j as r}from"./index-4_f5pIIv.js";import{P as w}from"./PageTransition-BlxOQiVy.js";import{n as ge}from"./index-O__zhACk.js";import"./iconBase-BPqFUofc.js";const Z="3.7.8",me=Z,v=typeof Buffer=="function",V=typeof TextDecoder=="function"?new TextDecoder:void 0,W=typeof TextEncoder=="function"?new TextEncoder:void 0,he="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",N=Array.prototype.slice.call(he),S=(e=>{let t={};return e.forEach((o,h)=>t[o]=h),t})(N),fe=/^(?:[A-Za-z\d+\/]{4})*?(?:[A-Za-z\d+\/]{2}(?:==)?|[A-Za-z\d+\/]{3}=?)?$/,l=String.fromCharCode.bind(String),q=typeof Uint8Array.from=="function"?Uint8Array.from.bind(Uint8Array):e=>new Uint8Array(Array.prototype.slice.call(e,0)),M=e=>e.replace(/=/g,"").replace(/[+\/]/g,t=>t=="+"?"-":"_"),G=e=>e.replace(/[^A-Za-z0-9\+\/]/g,""),K=e=>{let t,o,h,p,_="";const y=e.length%3;for(let b=0;b<e.length;){if((o=e.charCodeAt(b++))>255||(h=e.charCodeAt(b++))>255||(p=e.charCodeAt(b++))>255)throw new TypeError("invalid character found");t=o<<16|h<<8|p,_+=N[t>>18&63]+N[t>>12&63]+N[t>>6&63]+N[t&63]}return y?_.slice(0,y-3)+"===".substring(y):_},I=typeof btoa=="function"?e=>btoa(e):v?e=>Buffer.from(e,"binary").toString("base64"):K,R=v?e=>Buffer.from(e).toString("base64"):e=>{let o=[];for(let h=0,p=e.length;h<p;h+=4096)o.push(l.apply(null,e.subarray(h,h+4096)));return I(o.join(""))},P=(e,t=!1)=>t?M(R(e)):R(e),xe=e=>{if(e.length<2){var t=e.charCodeAt(0);return t<128?e:t<2048?l(192|t>>>6)+l(128|t&63):l(224|t>>>12&15)+l(128|t>>>6&63)+l(128|t&63)}else{var t=65536+(e.charCodeAt(0)-55296)*1024+(e.charCodeAt(1)-56320);return l(240|t>>>18&7)+l(128|t>>>12&63)+l(128|t>>>6&63)+l(128|t&63)}},pe=/[\uD800-\uDBFF][\uDC00-\uDFFFF]|[^\x00-\x7F]/g,Y=e=>e.replace(pe,xe),H=v?e=>Buffer.from(e,"utf8").toString("base64"):W?e=>R(W.encode(e)):e=>I(Y(e)),C=(e,t=!1)=>t?M(H(e)):H(e),L=e=>C(e,!0),_e=/[\xC0-\xDF][\x80-\xBF]|[\xE0-\xEF][\x80-\xBF]{2}|[\xF0-\xF7][\x80-\xBF]{3}/g,ye=e=>{switch(e.length){case 4:var t=(7&e.charCodeAt(0))<<18|(63&e.charCodeAt(1))<<12|(63&e.charCodeAt(2))<<6|63&e.charCodeAt(3),o=t-65536;return l((o>>>10)+55296)+l((o&1023)+56320);case 3:return l((15&e.charCodeAt(0))<<12|(63&e.charCodeAt(1))<<6|63&e.charCodeAt(2));default:return l((31&e.charCodeAt(0))<<6|63&e.charCodeAt(1))}},J=e=>e.replace(_e,ye),Q=e=>{if(e=e.replace(/\s+/g,""),!fe.test(e))throw new TypeError("malformed base64.");e+="==".slice(2-(e.length&3));let t,o,h,p=[];for(let _=0;_<e.length;)t=S[e.charAt(_++)]<<18|S[e.charAt(_++)]<<12|(o=S[e.charAt(_++)])<<6|(h=S[e.charAt(_++)]),o===64?p.push(l(t>>16&255)):h===64?p.push(l(t>>16&255,t>>8&255)):p.push(l(t>>16&255,t>>8&255,t&255));return p.join("")},F=typeof atob=="function"?e=>atob(G(e)):v?e=>Buffer.from(e,"base64").toString("binary"):Q,X=v?e=>q(Buffer.from(e,"base64")):e=>q(F(e).split("").map(t=>t.charCodeAt(0))),ee=e=>X(te(e)),be=v?e=>Buffer.from(e,"base64").toString("utf8"):V?e=>V.decode(X(e)):e=>J(F(e)),te=e=>G(e.replace(/[-_]/g,t=>t=="-"?"+":"/")),D=e=>be(te(e)),Ae=e=>{if(typeof e!="string")return!1;const t=e.replace(/\s+/g,"").replace(/={0,2}$/,"");return!/[^\s0-9a-zA-Z\+/]/.test(t)||!/[^\s0-9a-zA-Z\-_]/.test(t)},re=e=>({value:e,enumerable:!1,writable:!0,configurable:!0}),ne=function(){const e=(t,o)=>Object.defineProperty(String.prototype,t,re(o));e("fromBase64",function(){return D(this)}),e("toBase64",function(t){return C(this,t)}),e("toBase64URI",function(){return C(this,!0)}),e("toBase64URL",function(){return C(this,!0)}),e("toUint8Array",function(){return ee(this)})},ae=function(){const e=(t,o)=>Object.defineProperty(Uint8Array.prototype,t,re(o));e("toBase64",function(t){return P(this,t)}),e("toBase64URI",function(){return P(this,!0)}),e("toBase64URL",function(){return P(this,!0)})},je=()=>{ne(),ae()},Ce={version:Z,VERSION:me,atob:F,atobPolyfill:Q,btoa:I,btoaPolyfill:K,fromBase64:D,toBase64:C,encode:C,encodeURI:L,encodeURL:L,utob:Y,btou:J,decode:D,isValid:Ae,fromUint8Array:P,toUint8Array:ee,extendString:ne,extendUint8Array:ae,extendBuiltins:je},ve="_pageContainer_mg7ht_67",Ne="_headerCard_mg7ht_77",Be="_headerTitle_mg7ht_95",we="_headerDesc_mg7ht_105",Se="_accordionItem_mg7ht_115",Ee="_accordionButton_mg7ht_129",Te="_headerRow_mg7ht_149",Pe="_questionText_mg7ht_167",Ue="_textCollapsed_mg7ht_175",$e="_textExpanded_mg7ht_187",Re="_weightBadge_mg7ht_201",De="_imageContainer_mg7ht_221",Ie="_questionImage_mg7ht_229",Fe="_backButton_mg7ht_289",ke="_preguntaTitulo_mg7ht_317",m={pageContainer:ve,headerCard:Ne,headerTitle:Be,headerDesc:we,accordionItem:Se,accordionButton:Ee,headerRow:Te,questionText:Pe,textCollapsed:Ue,textExpanded:$e,weightBadge:Re,imageContainer:De,questionImage:Ie,backButton:Fe,preguntaTitulo:ke},E={},T={},qe=()=>{const{id:e}=le(),t=de(),[o,h]=B.useState(null),[p,_]=B.useState(!0),[y,b]=B.useState(null),A=a=>{if(!a)return null;const i=String(a).trim();if(!i)return null;if(/^data:image\//i.test(i))return i;let s="png";return i.startsWith("/9j")?s="jpeg":i.startsWith("iVBOR")?s="png":i.startsWith("R0lG")?s="gif":i.startsWith("UklGR")?s="webp":i.startsWith("Qk")?s="bmp":(i.startsWith("PHN2Zy")||i.startsWith("PD94"))&&(s="svg+xml"),`data:image/${s};base64,${i}`};B.useEffect(()=>{oe()},[e]);const oe=async()=>{try{const a=(()=>{try{return JSON.parse(localStorage.getItem("usuario")||localStorage.getItem("user")||"{}")?.id}catch{return}})(),i=`${e??""}:${a??""}:ver.obtener`;E[i]||(E[i]=O.get(z.ver.obtener(e||""),{params:a?{usuario_id:a}:void 0}).finally(()=>{delete E[i]}));const s=await E[i];if(!s.data.success)throw new Error(s.data.message||"Error al cargar el cuestionario");const f=s.data;if(f.success){const x=f?.data?.cuestionario??f?.data??f,j=f?.data?.preguntas;let d=[];const U=[j,x?.preguntas,x?.pregunta,x?.preguntas_opciones,f?.data?.pregunta,f?.data?.preguntas_opciones,f?.data?.imagen_pregunta,f?.data?.imagen_opcion];for(const n of U)if(Array.isArray(n)&&n.length){d=n;break}if(!Array.isArray(d)||d.length===0){const n=[x?.preguntas,x?.data?.preguntas];for(const c of n)if(c&&typeof c=="object"&&!Array.isArray(c)){const u=Object.values(c);if(Array.isArray(u)&&u.length){d=u;break}}if(!Array.isArray(d)||d.length===0){const c=x?.preguntas_respuestas??x?.preguntasYRespuestas??x?.data?.preguntas_respuestas??x?.data?.preguntasYRespuestas;Array.isArray(c)&&c.length&&(d=c.map(u=>({...u,opciones:u?.opciones??u?.respuestas??u?.alternativas??[]})))}}if(!d.length&&e)try{const n=`${e??""}:${a??""}:cuestionario.resolver.preguntasOpciones`;T[n]||(T[n]=O.get(z.cuestionario.resolver.preguntasOpciones(e),{params:a?{usuario_id:a}:void 0}).finally(()=>{delete T[n]}));const c=await T[n],u=c?.data?.data??c?.data;if(Array.isArray(u)&&u.length)d=u;else{const $=[u?.preguntas,u?.pregunta,c?.data];for(const g of $)if(Array.isArray(g)&&g.length){d=g;break}}}catch{}const ie=(Array.isArray(d)?d:[]).map((n,c)=>{const $=((Array.isArray(n?.opciones)?n.opciones:Array.isArray(n?.opcion)?n.opcion:Array.isArray(n?.opciones_pregunta)?n.opciones_pregunta:Array.isArray(n?.opcionesPregunta)?n.opcionesPregunta:[])||[]).map((g,ce)=>({...g,imagen_opcion:g?.imagen_opcion??g?.imagen??g?.imagenOpcion??"",texto_opcion:g?.texto_opcion??g?.texto??g?.textoOpcion??"",opcion_correcta:g?.opcion_correcta??g?.es_correcta??g?.correcta??0,orden:g?.orden??ce+1}));return{id:Number(n?.id??c+1),texto_pregunta:n?.texto_pregunta??n?.texto??n?.pregunta??n?.textoPregunta??"",peso_pregunta:Number(n?.peso_pregunta??n?.peso??n?.pesoPregunta??0),imagen_pregunta:n?.imagen_pregunta??n?.imagen??n?.imagenPregunta??"",orden_pregunta:Number(n?.orden_pregunta??n?.orden??n?.ordenPregunta??c+1),tiene_imagen:!!n?.tiene_imagen,opciones_imagen:Ce.decode(n?.opciones_imagen??n?.opcionesImagen??n?.opciones_imagen_pregunta??n?.opcionesImagenPregunta??""),nombre_imagen_pregunta:n?.nombre_imagen_pregunta??n?.nombre_imagen??n?.nombreImagenPregunta??null,opciones:$}}),k={...x,preguntas:ie};h(k);try{const n=k?.preguntas?.[0],c=n?.opciones?.[0];console.debug("[VerCuestionario] img debug:",{p0_img_len:(n?.imagen_pregunta||"").length,p0_img_src_len:(A(n?.imagen_pregunta)||"").length,o0_img_len:(c?.imagen_opcion||"").length,o0_img_src_len:(A(c?.imagen_opcion)||"").length})}catch{}}else throw new Error(f.message||"Error al cargar el cuestionario")}catch(a){console.error("Error:",a),ue.fire({icon:"error",title:"Error",text:a?.response?.data?.message||a?.message||"Error al cargar el cuestionario"})}finally{_(!1)}},se=a=>{b(y===a?null:a)};return p?r.jsx(w,{children:r.jsxs("div",{className:"d-flex align-items-center justify-content-center",style:{minHeight:"70vh",padding:"1.5rem"},children:[r.jsx("div",{className:"text-center",children:r.jsx("h2",{style:{color:"#0f172a ",fontSize:"1.5rem",marginBottom:"1rem"},children:"Cargando..."})}),r.jsx("div",{className:"text-center",children:r.jsx("i",{className:"fas fa-spinner fa-spin"})})]})}):o?o&&(!Array.isArray(o.preguntas)||o.preguntas.length===0)?r.jsx(w,{children:r.jsx("div",{className:"d-flex align-items-center justify-content-center",style:{minHeight:"70vh",padding:"1.5rem"},children:r.jsxs("div",{className:"text-center",children:[r.jsx("h2",{style:{color:"#0f172a",fontSize:"1.2rem",marginBottom:"0.75rem"},children:"Este cuestionario no tiene preguntas"}),r.jsx("button",{onClick:()=>t("/dashboard"),className:"btn btn-outline-secondary",style:{borderColor:"#00a19B",color:"#00a19B"},children:"Volver"})]})})}):r.jsx(w,{children:r.jsx("div",{className:`container-fluid py-3 ${m.pageContainer}`,children:r.jsx("div",{className:"row justify-content-center",children:r.jsxs("div",{className:"col-12 col-xl-10",children:[r.jsxs("div",{className:`card border-0 mb-4 ${m.headerCard} d-flex justify-content-between align-items-center flex-row`,children:[r.jsxs("div",{className:"card-body p-4 w-50",children:[r.jsx("h1",{className:`mb-2 text-white ${m.headerTitle}`,children:o.titulo}),r.jsx("div",{className:`mb-0 text-white ${m.headerDesc}`,dangerouslySetInnerHTML:{__html:o.descripcion}})]}),r.jsx("div",{className:"card-body d-flex justify-content-end",children:r.jsxs("button",{onClick:()=>t("/dashboard"),className:"btn btn-outline-secondary ml-2",children:[r.jsx(ge,{})," Volver"]})})]}),r.jsx("div",{className:"accordion",id:"preguntasAccordion",children:(o.preguntas||[]).map((a,i)=>r.jsxs("div",{className:`accordion-item mb-2 ${m.accordionItem}`,children:[r.jsx("h2",{className:"accordion-header",children:r.jsxs("button",{className:` accordion-button ${y===i?"":"collapsed"} ${m.accordionButton}`,type:"button",onClick:()=>se(i),children:[r.jsx("div",{className:`d-flex ${m.headerRow}`,children:r.jsxs("span",{className:`${m.questionText} ${y===i?m.textExpanded:m.textCollapsed}`,style:{maxWidth:"60rem"},children:[r.jsxs("p",{className:m.preguntaTitulo,children:["Pregunta ",i+1,":"]})," ",a.texto_pregunta]})}),r.jsx("div",{className:"d-flex m-auto justify-content-end me-3",children:r.jsxs("span",{className:`badge ${m.weightBadge} text-white`,children:["Peso: ",a.peso_pregunta]})})]})}),y===i&&r.jsx("div",{className:"accordion-collapse collapse show",children:r.jsxs("div",{className:"accordion-body p-3",children:[!!A(a.imagen_pregunta)&&r.jsx("div",{className:`mb-3 text-center ${m.imageContainer}`,children:r.jsx("img",{src:A(a.imagen_pregunta)||void 0,alt:`Imagen P${i+1}`,className:`img-fluid rounded ${m.questionImage}`,onError:s=>{s.currentTarget.style.display="none"}})}),r.jsx("div",{className:"d-flex flex-column gap-2",children:(Array.isArray(a.opciones)?a.opciones:[]).map((s,f)=>{const x={...s,texto_opcion:s.texto_opcion&&s.texto_opcion!=="0"?s.texto_opcion:""},j=s.opcion_correcta??s.es_correcta??s.correcta??0,d=j===1||j==="1"||j===!0||j==="true";return r.jsxs("div",{className:`p-3 rounded ${d?"bg-success bg-opacity-10 border border-success":"bg-light border"}`,style:{transition:"all 0.2s ease"},children:[r.jsxs("div",{className:"d-flex  align-items-center gap-3",children:[r.jsx("div",{className:"badge rounded-circle d-flex align-items-center justify-content-center",style:{width:"30px",height:"30px",objectFit:"cover",fontSize:"0.75rem",fontWeight:"600",backgroundColor:d?"#22c55e":"#f1995a",flexShrink:0},children:String.fromCharCode(65+f)}),r.jsxs("div",{className:"flex-grow-1",children:[r.jsx("p",{className:"mb-1 d-inline",style:{fontSize:"0.85rem",lineHeight:"1.4",color:"#334155"},children:x.texto_opcion}),d&&r.jsx("span",{className:"badge bg-success text-white",style:{fontSize:"0.7rem",float:"right"},children:"Correcta"})]})]}),!!A(s.imagen_opcion)&&r.jsx("div",{className:"mt-2 text-center",children:r.jsx("img",{src:A(s.imagen_opcion)||void 0,alt:`Imagen opción ${String.fromCharCode(65+f)}`,className:"img-fluid rounded",style:{maxHeight:"150px",boxShadow:"0 4px 15px rgba(0,0,0,0.03)"},onError:U=>{U.currentTarget.style.display="none"}})})]},s.id)})})]})})]},a.id))}),r.jsx("div",{className:"text-center mt-4",children:r.jsx("button",{onClick:()=>t("/dashboard"),className:`btn btn-outline-secondary ${m.backButton}`,children:"Volver"})})]})})})}):r.jsx(w,{children:r.jsx("div",{className:"d-flex align-items-center justify-content-center",style:{minHeight:"70vh",padding:"1.5rem"},children:r.jsxs("div",{className:"text-center",children:[r.jsx("h2",{style:{color:"#ef4444",fontSize:"1.5rem",marginBottom:"1rem"},children:"Cuestionario no encontrado"}),r.jsx("button",{onClick:()=>t("/dashboard"),className:"btn btn-outline-secondary",style:{borderColor:"#00a19B",color:"#00a19B",transition:"all 0.3s ease"},onMouseOver:a=>{a.currentTarget.style.backgroundColor="#00a19B",a.currentTarget.style.color="white"},onMouseOut:a=>{a.currentTarget.style.backgroundColor="transparent",a.currentTarget.style.color="#00a19B"},children:"Volver"})]})})})};export{qe as default};
