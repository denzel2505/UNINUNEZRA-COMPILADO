import{e as ue,a as me,r as N,b as V,A as W,S as ge,j as t}from"./index-DzgdolRr.js";import{P as w}from"./PageTransition-CYHo0rrb.js";import{m as pe}from"./index-BglOwyC0.js";import"./iconBase-L-zE4WbR.js";const G="3.7.8",xe=G,v=typeof Buffer=="function",q=typeof TextDecoder=="function"?new TextDecoder:void 0,L=typeof TextEncoder=="function"?new TextEncoder:void 0,he="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",B=Array.prototype.slice.call(he),S=(e=>{let r={};return e.forEach((s,p)=>r[s]=p),r})(B),fe=/^(?:[A-Za-z\d+\/]{4})*?(?:[A-Za-z\d+\/]{2}(?:==)?|[A-Za-z\d+\/]{3}=?)?$/,d=String.fromCharCode.bind(String),Z=typeof Uint8Array.from=="function"?Uint8Array.from.bind(Uint8Array):e=>new Uint8Array(Array.prototype.slice.call(e,0)),K=e=>e.replace(/=/g,"").replace(/[+\/]/g,r=>r=="+"?"-":"_"),Y=e=>e.replace(/[^A-Za-z0-9\+\/]/g,""),J=e=>{let r,s,p,f,_="";const y=e.length%3;for(let A=0;A<e.length;){if((s=e.charCodeAt(A++))>255||(p=e.charCodeAt(A++))>255||(f=e.charCodeAt(A++))>255)throw new TypeError("invalid character found");r=s<<16|p<<8|f,_+=B[r>>18&63]+B[r>>12&63]+B[r>>6&63]+B[r&63]}return y?_.slice(0,y-3)+"===".substring(y):_},D=typeof btoa=="function"?e=>btoa(e):v?e=>Buffer.from(e,"binary").toString("base64"):J,U=v?e=>Buffer.from(e).toString("base64"):e=>{let s=[];for(let p=0,f=e.length;p<f;p+=4096)s.push(d.apply(null,e.subarray(p,p+4096)));return D(s.join(""))},I=(e,r=!1)=>r?K(U(e)):U(e),_e=e=>{if(e.length<2){var r=e.charCodeAt(0);return r<128?e:r<2048?d(192|r>>>6)+d(128|r&63):d(224|r>>>12&15)+d(128|r>>>6&63)+d(128|r&63)}else{var r=65536+(e.charCodeAt(0)-55296)*1024+(e.charCodeAt(1)-56320);return d(240|r>>>18&7)+d(128|r>>>12&63)+d(128|r>>>6&63)+d(128|r&63)}},ye=/[\uD800-\uDBFF][\uDC00-\uDFFFF]|[^\x00-\x7F]/g,Q=e=>e.replace(ye,_e),H=v?e=>Buffer.from(e,"utf8").toString("base64"):L?e=>U(L.encode(e)):e=>D(Q(e)),C=(e,r=!1)=>r?K(H(e)):H(e),M=e=>C(e,!0),be=/[\xC0-\xDF][\x80-\xBF]|[\xE0-\xEF][\x80-\xBF]{2}|[\xF0-\xF7][\x80-\xBF]{3}/g,Ae=e=>{switch(e.length){case 4:var r=(7&e.charCodeAt(0))<<18|(63&e.charCodeAt(1))<<12|(63&e.charCodeAt(2))<<6|63&e.charCodeAt(3),s=r-65536;return d((s>>>10)+55296)+d((s&1023)+56320);case 3:return d((15&e.charCodeAt(0))<<12|(63&e.charCodeAt(1))<<6|63&e.charCodeAt(2));default:return d((31&e.charCodeAt(0))<<6|63&e.charCodeAt(1))}},X=e=>e.replace(be,Ae),ee=e=>{if(e=e.replace(/\s+/g,""),!fe.test(e))throw new TypeError("malformed base64.");e+="==".slice(2-(e.length&3));let r,s,p,f=[];for(let _=0;_<e.length;)r=S[e.charAt(_++)]<<18|S[e.charAt(_++)]<<12|(s=S[e.charAt(_++)])<<6|(p=S[e.charAt(_++)]),s===64?f.push(d(r>>16&255)):p===64?f.push(d(r>>16&255,r>>8&255)):f.push(d(r>>16&255,r>>8&255,r&255));return f.join("")},F=typeof atob=="function"?e=>atob(Y(e)):v?e=>Buffer.from(e,"base64").toString("binary"):ee,te=v?e=>Z(Buffer.from(e,"base64")):e=>Z(F(e).split("").map(r=>r.charCodeAt(0))),re=e=>te(ae(e)),je=v?e=>Buffer.from(e,"base64").toString("utf8"):q?e=>q.decode(te(e)):e=>X(F(e)),ae=e=>Y(e.replace(/[-_]/g,r=>r=="-"?"+":"/")),R=e=>je(ae(e)),Ce=e=>{if(typeof e!="string")return!1;const r=e.replace(/\s+/g,"").replace(/={0,2}$/,"");return!/[^\s0-9a-zA-Z\+/]/.test(r)||!/[^\s0-9a-zA-Z\-_]/.test(r)},ne=e=>({value:e,enumerable:!1,writable:!0,configurable:!0}),oe=function(){const e=(r,s)=>Object.defineProperty(String.prototype,r,ne(s));e("fromBase64",function(){return R(this)}),e("toBase64",function(r){return C(this,r)}),e("toBase64URI",function(){return C(this,!0)}),e("toBase64URL",function(){return C(this,!0)}),e("toUint8Array",function(){return re(this)})},se=function(){const e=(r,s)=>Object.defineProperty(Uint8Array.prototype,r,ne(s));e("toBase64",function(r){return I(this,r)}),e("toBase64URI",function(){return I(this,!0)}),e("toBase64URL",function(){return I(this,!0)})},ve=()=>{oe(),se()},Ne={version:G,VERSION:xe,atob:F,atobPolyfill:ee,btoa:D,btoaPolyfill:J,fromBase64:R,toBase64:C,encode:C,encodeURI:M,encodeURL:M,utob:Q,btou:X,decode:R,isValid:Ce,fromUint8Array:I,toUint8Array:re,extendString:oe,extendUint8Array:se,extendBuiltins:ve},Be="_pageContainer_kpr9m_34",ke="_headerCard_kpr9m_39",we="_headerTitle_kpr9m_48",Se="_headerDesc_kpr9m_53",Ee="_accordionItem_kpr9m_58",Te="_accordionButton_kpr9m_65",Ie="_headerRow_kpr9m_75",Pe="_questionText_kpr9m_84",$e="_textCollapsed_kpr9m_88",Ue="_textExpanded_kpr9m_94",Re="_weightBadge_kpr9m_101",De="_imageContainer_kpr9m_111",Fe="_questionImage_kpr9m_115",Oe="_zoomBtn_kpr9m_121",ze="_modalOverlay_kpr9m_135",Ve="_modalImage_kpr9m_139",We="_backButton_kpr9m_145",qe="_preguntaTitulo_kpr9m_159",l={pageContainer:Be,headerCard:ke,headerTitle:we,headerDesc:Se,accordionItem:Ee,accordionButton:Te,headerRow:Ie,questionText:Pe,textCollapsed:$e,textExpanded:Ue,weightBadge:Re,imageContainer:De,questionImage:Fe,zoomBtn:Oe,modalOverlay:ze,modalImage:Ve,backButton:We,preguntaTitulo:qe},E={},T={},Ge=()=>{const{id:e}=ue(),r=me(),[s,p]=N.useState(null),[f,_]=N.useState(!0),[y,A]=N.useState(null),[O,k]=N.useState(null),b=n=>{if(!n)return null;const i=String(n).trim();if(!i)return null;if(/^data:image\//i.test(i))return i;let o="png";return i.startsWith("/9j")?o="jpeg":i.startsWith("iVBOR")?o="png":i.startsWith("R0lG")?o="gif":i.startsWith("UklGR")?o="webp":i.startsWith("Qk")?o="bmp":(i.startsWith("PHN2Zy")||i.startsWith("PD94"))&&(o="svg+xml"),`data:image/${o};base64,${i}`};N.useEffect(()=>{ie()},[e]);const ie=async()=>{try{const n=(()=>{try{return JSON.parse(localStorage.getItem("usuario")||localStorage.getItem("user")||"{}")?.id}catch{return}})(),i=`${e??""}:${n??""}:ver.obtener`;E[i]||(E[i]=V.get(W.ver.obtener(e||""),{params:n?{usuario_id:n}:void 0}).finally(()=>{delete E[i]}));const o=await E[i];if(!o.data.success)throw new Error(o.data.message||"Error al cargar el cuestionario");const x=o.data;if(x.success){const h=x?.data?.cuestionario??x?.data??x,j=x?.data?.preguntas;let u=[];const P=[j,h?.preguntas,h?.pregunta,h?.preguntas_opciones,x?.data?.pregunta,x?.data?.preguntas_opciones,x?.data?.imagen_pregunta,x?.data?.imagen_opcion];for(const a of P)if(Array.isArray(a)&&a.length){u=a;break}if(!Array.isArray(u)||u.length===0){const a=[h?.preguntas,h?.data?.preguntas];for(const c of a)if(c&&typeof c=="object"&&!Array.isArray(c)){const m=Object.values(c);if(Array.isArray(m)&&m.length){u=m;break}}if(!Array.isArray(u)||u.length===0){const c=h?.preguntas_respuestas??h?.preguntasYRespuestas??h?.data?.preguntas_respuestas??h?.data?.preguntasYRespuestas;Array.isArray(c)&&c.length&&(u=c.map(m=>({...m,opciones:m?.opciones??m?.respuestas??m?.alternativas??[]})))}}if(!u.length&&e)try{const a=`${e??""}:${n??""}:cuestionario.resolver.preguntasOpciones`;T[a]||(T[a]=V.get(W.cuestionario.resolver.preguntasOpciones(e),{params:n?{usuario_id:n}:void 0}).finally(()=>{delete T[a]}));const c=await T[a],m=c?.data?.data??c?.data;if(Array.isArray(m)&&m.length)u=m;else{const $=[m?.preguntas,m?.pregunta,c?.data];for(const g of $)if(Array.isArray(g)&&g.length){u=g;break}}}catch{}const le=(Array.isArray(u)?u:[]).map((a,c)=>{const $=((Array.isArray(a?.opciones)?a.opciones:Array.isArray(a?.opcion)?a.opcion:Array.isArray(a?.opciones_pregunta)?a.opciones_pregunta:Array.isArray(a?.opcionesPregunta)?a.opcionesPregunta:[])||[]).map((g,de)=>({...g,imagen_opcion:g?.imagen_opcion??g?.imagen??g?.imagenOpcion??"",texto_opcion:g?.texto_opcion??g?.texto??g?.textoOpcion??"",opcion_correcta:g?.opcion_correcta??g?.es_correcta??g?.correcta??0,orden:g?.orden??de+1}));return{id:Number(a?.id??c+1),texto_pregunta:a?.texto_pregunta??a?.texto??a?.pregunta??a?.textoPregunta??"",peso_pregunta:Number(a?.peso_pregunta??a?.peso??a?.pesoPregunta??0),imagen_pregunta:a?.imagen_pregunta??a?.imagen??a?.imagenPregunta??"",orden_pregunta:Number(a?.orden_pregunta??a?.orden??a?.ordenPregunta??c+1),tiene_imagen:!!a?.tiene_imagen,opciones_imagen:Ne.decode(a?.opciones_imagen??a?.opcionesImagen??a?.opciones_imagen_pregunta??a?.opcionesImagenPregunta??""),nombre_imagen_pregunta:a?.nombre_imagen_pregunta??a?.nombre_imagen??a?.nombreImagenPregunta??null,opciones:$}}),z={...h,preguntas:le};p(z);try{const a=z?.preguntas?.[0],c=a?.opciones?.[0];console.debug("[VerCuestionario] img debug:",{p0_img_len:(a?.imagen_pregunta||"").length,p0_img_src_len:(b(a?.imagen_pregunta)||"").length,o0_img_len:(c?.imagen_opcion||"").length,o0_img_src_len:(b(c?.imagen_opcion)||"").length})}catch{}}else throw new Error(x.message||"Error al cargar el cuestionario")}catch(n){console.error("Error:",n),ge.fire({icon:"error",title:"Error",text:n?.response?.data?.message||n?.message||"Error al cargar el cuestionario"})}finally{_(!1)}},ce=n=>{A(y===n?null:n)};return f?t.jsx(w,{children:t.jsxs("div",{className:"d-flex align-items-center justify-content-center",style:{minHeight:"70vh",padding:"1.5rem"},children:[t.jsx("div",{className:"text-center",children:t.jsx("h2",{style:{color:"#0f172a ",fontSize:"1.5rem",marginBottom:"1rem"},children:"Cargando..."})}),t.jsx("div",{className:"text-center",children:t.jsx("i",{className:"fas fa-spinner fa-spin"})})]})}):s?s&&(!Array.isArray(s.preguntas)||s.preguntas.length===0)?t.jsx(w,{children:t.jsx("div",{className:"d-flex align-items-center justify-content-center",style:{minHeight:"70vh",padding:"1.5rem"},children:t.jsxs("div",{className:"text-center",children:[t.jsx("h2",{style:{color:"#0f172a",fontSize:"1.2rem",marginBottom:"0.75rem"},children:"Este cuestionario no tiene preguntas"}),t.jsx("button",{onClick:()=>r("/dashboard"),className:"btn btn-outline-secondary",style:{borderColor:"#00a19B",color:"#00a19B"},children:"Volver"})]})})}):t.jsx(w,{children:t.jsx("div",{className:`container-fluid py-3 ${l.pageContainer}`,children:t.jsx("div",{className:"row justify-content-center",children:t.jsxs("div",{className:"col-12 col-xl-10",children:[t.jsxs("div",{className:`card border-0 mb-4 ${l.headerCard} d-flex justify-content-between align-items-center flex-row`,children:[t.jsxs("div",{className:"card-body p-4 w-50",children:[t.jsx("h1",{className:`mb-2 text-white ${l.headerTitle}`,children:s.titulo}),t.jsx("p",{className:`mb-0 text-white ${l.headerDesc}`,children:s.descripcion})]}),t.jsx("div",{className:"card-body d-flex justify-content-end",children:t.jsxs("button",{onClick:()=>r("/dashboard"),className:"btn btn-outline-secondary ml-2",children:[t.jsx(pe,{})," Volver"]})})]}),t.jsx("div",{className:"accordion",id:"preguntasAccordion",children:(s.preguntas||[]).map((n,i)=>t.jsxs("div",{className:`accordion-item mb-2 ${l.accordionItem}`,children:[t.jsx("h2",{className:"accordion-header",children:t.jsx("button",{className:`accordion-button ${y===i?"":"collapsed"} ${l.accordionButton}`,type:"button",onClick:()=>ce(i),children:t.jsxs("div",{className:`w-100 me-3 ${l.headerRow}`,children:[t.jsxs("span",{className:`${l.questionText} ${y===i?l.textExpanded:l.textCollapsed}`,children:[t.jsxs("p",{className:l.preguntaTitulo,children:["Pregunta ",i+1,":"]})," ",n.texto_pregunta]}),t.jsxs("span",{className:`badge ${l.weightBadge} text-white`,children:["Peso: ",n.peso_pregunta]})]})})}),y===i&&t.jsx("div",{className:"accordion-collapse collapse show",children:t.jsxs("div",{className:"accordion-body p-3",children:[!!b(n.imagen_pregunta)&&t.jsxs("div",{className:`mb-3 text-center ${l.imageContainer}`,children:[t.jsx("img",{src:b(n.imagen_pregunta)||void 0,alt:`Imagen P${i+1}`,className:`img-fluid rounded ${l.questionImage}`,onError:o=>{o.currentTarget.style.display="none"},onClick:()=>k(b(n.imagen_pregunta))}),t.jsx("button",{className:`btn btn-light btn-sm ${l.zoomBtn}`,onClick:o=>{o.stopPropagation(),k(b(n.imagen_pregunta))},title:"Ampliar imagen",type:"button",children:t.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[t.jsx("circle",{cx:"11",cy:"11",r:"8"}),t.jsx("line",{x1:"21",y1:"21",x2:"16.65",y2:"16.65"})]})})]}),t.jsx("div",{className:"d-flex flex-column gap-2",children:(Array.isArray(n.opciones)?n.opciones:[]).map((o,x)=>{const h={...o,texto_opcion:o.texto_opcion&&o.texto_opcion!=="0"?o.texto_opcion:""},j=o.opcion_correcta??o.es_correcta??o.correcta??0,u=j===1||j==="1"||j===!0||j==="true";return t.jsxs("div",{className:`p-3 rounded ${u?"bg-success bg-opacity-10 border border-success":"bg-light border"}`,style:{transition:"all 0.2s ease"},children:[t.jsxs("div",{className:"d-flex  align-items-center gap-3",children:[t.jsx("div",{className:"badge rounded-circle d-flex align-items-center justify-content-center",style:{width:"30px",height:"30px",objectFit:"cover",fontSize:"0.75rem",fontWeight:"600",backgroundColor:u?"#22c55e":"#f1995a",flexShrink:0},children:String.fromCharCode(65+x)}),t.jsxs("div",{className:"flex-grow-1",children:[t.jsx("p",{className:"mb-1 d-inline",style:{fontSize:"0.85rem",lineHeight:"1.4",color:"#334155"},children:h.texto_opcion}),u&&t.jsx("span",{className:"badge bg-success text-white",style:{fontSize:"0.7rem",float:"right"},children:"Correcta"})]})]}),!!b(o.imagen_opcion)&&t.jsx("div",{className:"mt-2 text-center",children:t.jsx("img",{src:b(o.imagen_opcion)||void 0,alt:`Imagen opciÃ³n ${String.fromCharCode(65+x)}`,className:"img-fluid rounded",style:{maxHeight:"150px",boxShadow:"0 4px 15px rgba(0,0,0,0.03)"},onError:P=>{P.currentTarget.style.display="none"}})})]},o.id)})})]})})]},n.id))}),O&&t.jsx("div",{className:`modal fade show d-block ${l.modalOverlay}`,onClick:()=>k(null),children:t.jsx("div",{className:"modal-dialog modal-dialog-centered modal-lg",children:t.jsxs("div",{className:"modal-content",onClick:n=>n.stopPropagation(),children:[t.jsx("div",{className:"modal-header border-0 pb-0",children:t.jsx("button",{type:"button",className:"btn-close",onClick:()=>k(null),"aria-label":"Cerrar"})}),t.jsx("div",{className:"modal-body text-center p-4",children:t.jsx("img",{src:O,alt:"Imagen ampliada",className:`img-fluid rounded ${l.modalImage}`})})]})})}),t.jsx("div",{className:"text-center mt-4",children:t.jsx("button",{onClick:()=>r("/dashboard"),className:`btn btn-outline-secondary ${l.backButton}`,children:"Volver"})})]})})})}):t.jsx(w,{children:t.jsx("div",{className:"d-flex align-items-center justify-content-center",style:{minHeight:"70vh",padding:"1.5rem"},children:t.jsxs("div",{className:"text-center",children:[t.jsx("h2",{style:{color:"#ef4444",fontSize:"1.5rem",marginBottom:"1rem"},children:"Cuestionario no encontrado"}),t.jsx("button",{onClick:()=>r("/dashboard"),className:"btn btn-outline-secondary",style:{borderColor:"#00a19B",color:"#00a19B",transition:"all 0.3s ease"},onMouseOver:n=>{n.currentTarget.style.backgroundColor="#00a19B",n.currentTarget.style.color="white"},onMouseOut:n=>{n.currentTarget.style.backgroundColor="transparent",n.currentTarget.style.color="#00a19B"},children:"Volver"})]})})})};export{Ge as default};
