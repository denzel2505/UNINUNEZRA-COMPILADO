import{e as L,a as G,i as U,r as b,c as k,A as S,j as e}from"./index-4_f5pIIv.js";import{P as R}from"./PageTransition-BlxOQiVy.js";import{n as Q,S as Z,T as q,e as J}from"./index-O__zhACk.js";import"./iconBase-BPqFUofc.js";function K(){const n=L(),a=G(),c=U(),l=n.estudianteId,o=n.cuestionarioId,h=Number(l),i=Number(o),[z,C]=b.useState(null),[I,x]=b.useState(!0),[P,N]=b.useState(null),[A,B]=b.useState(0),$=b.useRef(!1),w=b.useRef(null);return b.useEffect(()=>{const _=async()=>{if(w.current){await w.current;return}if(!l||!o||isNaN(h)||isNaN(i)){N("Parámetros no válidos"),x(!1);return}try{x(!0),N(null);try{console.debug("[VerRespuesta] params -> estudianteId:",h,"cuestionarioId:",i)}catch{}let u={};try{const t=await k.get(S.ver.obtener(i));u=t?.data?.data||t?.data||{}}catch{}try{console.log("[useVerRespuestaData] params/state",{estudianteId:h,cuestionarioId:i,locationState:c?.state})}catch{}let p=null;try{const t={cuestionario_id:i,estudiante_id:h};try{console.log("[useVerRespuestaData] POST /ver/intento payload",t)}catch{}const r=await k.post(S.ver.obtenerintento(),t);try{console.log("[useVerRespuestaData] POST /ver/intento resp",r?.data)}catch{}p=r?.data?.data??r?.data}catch(t){const r=t?.response?.status;try{console.log("[useVerRespuestaData] intento error",{status:r,err:t})}catch{}if(r===404||r===400){N("Este estudiante aún no ha respondido"),x(!1);return}throw t}if(!p||p.error||!p.intento_id){try{console.log("[useVerRespuestaData] intento inválido",p)}catch{}N("Este estudiante aún no ha respondido"),x(!1);return}const T=await k.get(S.ver.obtenerrespuestas(p.intento_id));try{console.log("[useVerRespuestaData] GET /ver/respuestas/:id resp",T?.data)}catch{}const s=T?.data?.data||T?.data||{};let v=[];try{const t=await k.get(S.cuestionario.resolver.preguntasOpciones(i));try{console.log("[useVerRespuestaData] GET preguntas/opciones resp",t?.data)}catch{}const r=t?.data?.data??t?.data;Array.isArray(r)?v=r:Array.isArray(r?.preguntas)&&(v=r.preguntas)}catch{}const f=t=>{if(!t)return[];if(Array.isArray(t))return t;if(typeof t=="object"){const r=Object.values(t);if(r.length&&r.every(g=>typeof g=="object"))return r}return[]};let m=[];if(Array.isArray(s)&&(m=s),m.length||(m=f(s?.respuestas)),m.length||(m=f(s?.detalle)),m.length||(m=f(s?.data)),!m.length)for(const t of Object.keys(s||{})){const r=s[t],g=f(r);if(g.length){m=g;break}}if(!m.length&&s?.intento){const t=f(s.intento?.respuestas)||f(s.intento?.detalle)||[];t.length&&(m=t)}try{console.debug("[VerRespuesta] payload keys:",Object.keys(s||{}))}catch{}try{console.debug("[VerRespuesta] respuestas normalizadas:",m.length)}catch{}const V=new Map;v.forEach(t=>{V.set(Number(t.id||t.pregunta_id),t)});let j=m.map(t=>{const r=Number(t.pregunta_id||t.id_pregunta||t.id),g=V.get(r)||{},F=Array.isArray(t.opciones)?t.opciones:Array.isArray(g.opciones)?g.opciones:[];return{pregunta_id:r,texto_pregunta:t.texto_pregunta||g.texto_pregunta||g.texto||"",peso_pregunta:Number(t.peso_pregunta??g.peso_pregunta??0),imagen_pregunta:t.imagen_pregunta||g.imagen_pregunta,nombre_imagen_pregunta:t.nombre_imagen_pregunta||g.nombre_imagen_pregunta,id_opcion_seleccionada:Number(t.id_opcion_seleccionada||t.opcion_seleccionada_id||t.opcion_id||0),es_correcta:!!(t.es_correcta??t.correcta),opciones:(F||[]).map(y=>({id:Number(y.id),texto_opcion:y.texto_opcion||y.texto||"",es_correcta:!!y.es_correcta,imagen_opcion:y.imagen_opcion,nombre_imagen_opcion:y.nombre_imagen_opcion}))}});if(!j.length&&v.length){j=v.map(t=>({pregunta_id:Number(t.id||t.pregunta_id),texto_pregunta:t.texto_pregunta||t.texto||"",peso_pregunta:Number(t.peso_pregunta??0),imagen_pregunta:t.imagen_pregunta,nombre_imagen_pregunta:t.nombre_imagen_pregunta,id_opcion_seleccionada:0,es_correcta:!1,opciones:(Array.isArray(t.opciones)?t.opciones:[]).map(r=>({id:Number(r.id),texto_opcion:r.texto_opcion||r.texto||"",es_correcta:!!r.es_correcta,imagen_opcion:r.imagen_opcion,nombre_imagen_opcion:r.nombre_imagen_opcion}))}));try{console.debug("[VerRespuesta] Fallback: mostrando preguntas sin respuestas.")}catch{}}const D=j.length||Number(s?.total_preguntas)||0,H=j.filter(t=>!!t.es_correcta).length,E=c.state?.estudiante||s.estudiante||u.estudiante||{id:Number(l),nombre:s?.estudiante_nombre||s?.nombre_estudiante||s?.nombre||u?.estudiante_nombre||"Estudiante",email:s?.estudiante_email||s?.email_estudiante||s?.correo||s?.email||u?.estudiante_email||"",identificacion:s?.estudiante_identificacion||s?.identificacion_estudiante||s?.documento||s?.identificacion||u?.estudiante_identificacion||"",programa_nombre:s?.programa_nombre||s?.programa||u?.programa_nombre||""};try{console.debug("[VerRespuesta] estudiante:",E)}catch{}const M={estudiante:E,cuestionario:s.cuestionario||u.cuestionario||{id:i,titulo:u?.titulo||s?.cuestionario_titulo||"Cuestionario",descripcion:u?.descripcion||s?.cuestionario_descripcion||""},estadisticas:s.estadisticas||{fecha_respuesta:s?.fecha_respuesta||p?.fecha_respuesta||"",total_respondidas:Number(s?.total_respondidas??s?.respondidas??j.length??0),total_preguntas:Number(s?.total_preguntas??D),respuestas_correctas:Number(s?.respuestas_correctas??s?.correctas??H),puntaje_total:Number(s?.puntaje_total??p?.puntaje_total??0),puntaje_obtenido:Number(s?.puntaje_obtenido??s?.puntaje??p?.puntaje_obtenido??0),porcentaje:Number(s?.porcentaje??p?.porcentaje??0)},respuestas:j};C(M)}catch(u){const p=u instanceof Error?u.message:"Error al cargar las respuestas";N(p)}finally{x(!1)}};$.current||($.current=!0,w.current=_().finally(()=>{w.current=null}))},[l,o]),{data:z,isLoading:I,error:P,expandedAccordion:A,handleVolver:()=>{a(-1)},toggleAccordion:_=>{B(A===_?-1:_)},getImageUrl:(_,u)=>`http://localhost/cuestionario-api/api/obtenerImagen_api.php?tipo=${_}&id=${u}`,getPorcentajeColor:_=>_>=70?"success":_>=40?"warning":"danger"}}const X=({onVolver:n})=>e.jsxs("nav",{className:"d-flex flex-row-reverse justify-content-between align-items-center mb-4 p-3",style:{backgroundColor:"#00a19B",borderRadius:"0.375rem",color:"white"},children:[e.jsxs("button",{onClick:n,className:"btn btn-outline-light btn-sm d-flex align-items-center",style:{borderColor:"rgba(255, 255, 255, 0.3)",color:"white",transition:"all 0.2s ease"},onMouseOver:a=>{a.currentTarget.style.backgroundColor="rgba(255, 255, 255, 0.2)",a.currentTarget.style.borderColor="rgba(255, 255, 255, 0.5)"},onMouseOut:a=>{a.currentTarget.style.backgroundColor="transparent",a.currentTarget.style.borderColor="rgba(255, 255, 255, 0.3)"},children:[e.jsx(Q,{size:12,className:"ms-2"})," Volver"]}),e.jsx("h1",{className:"mb-0 text-white",style:{fontSize:"1rem",fontWeight:"600"},children:"Respuestas"})]}),Y=({estudiante:n,cuestionario:a,estadisticas:c,children:l})=>e.jsxs("div",{className:"card shadow-sm border-0 mb-3",children:[e.jsx("div",{className:"card-header",style:{backgroundColor:"#343a40",color:"white",borderRadius:"0.375rem 0.375rem 0 0"},children:e.jsxs("h3",{className:"mb-0 d-flex align-items-center",children:[e.jsx(Z,{size:14,className:"me-2"}),"Información"]})}),e.jsx("div",{className:"card-body",children:e.jsxs("div",{className:"row g-3",children:[e.jsxs("div",{className:"col-12 col-md-6",children:[e.jsx("h4",{className:"mb-3",style:{color:"#0f172a",fontSize:"1rem",fontWeight:"600"},children:n.nombre}),e.jsxs("div",{className:"d-flex mb-2",style:{fontSize:"0.8rem"},children:[e.jsx("span",{className:"fw-bold me-2",style:{minWidth:"90px",color:"#334155"},children:"ID:"}),e.jsx("span",{children:n.identificacion})]}),e.jsxs("div",{className:"d-flex mb-2",style:{fontSize:"0.8rem"},children:[e.jsx("span",{className:"fw-bold me-2",style:{minWidth:"90px",color:"#334155"},children:"Email:"}),e.jsx("span",{children:n.email})]}),e.jsxs("div",{className:"d-flex mb-2",style:{fontSize:"0.8rem"},children:[e.jsx("span",{className:"fw-bold me-2",style:{minWidth:"90px",color:"#334155"},children:"Programa:"}),e.jsx("span",{children:n.programa_nombre})]})]}),e.jsxs("div",{className:"col-12 col-md-6",children:[e.jsx("h5",{className:"mb-2",style:{color:"#0f172a",fontSize:"1rem",fontWeight:"600"},children:a.titulo}),e.jsx("p",{className:"text-muted mb-3",style:{fontSize:"0.8rem",fontStyle:"italic"},children:a.descripcion}),e.jsxs("div",{className:"d-flex mb-2",style:{fontSize:"0.8rem"},children:[e.jsx("span",{className:"fw-bold me-2",style:{minWidth:"90px",color:"#334155"},children:"Fecha:"}),e.jsx("span",{children:new Date(c.fecha_respuesta).toLocaleDateString()})]}),l]})]})})]}),ee=({estadisticas:n,getPorcentajeColor:a})=>{const c=a(n.porcentaje),l=o=>{switch(o){case"success":return"#22c55e";case"warning":return"#f59e0b";case"danger":return"#ef4444";default:return"#22c55e"}};return e.jsxs("div",{className:"mt-3",children:[e.jsxs("div",{className:"mb-2",style:{fontSize:"0.8rem",color:"#334155",fontWeight:"500"},children:[e.jsx("strong",{children:"Puntaje:"})," ",n.puntaje_obtenido,"/",n.puntaje_total," (",n.porcentaje,"%)"]}),e.jsx("div",{style:{width:"150px"},children:e.jsx("div",{className:"progress",style:{height:"12px"},children:e.jsx("div",{className:"progress-bar",style:{width:`${n.porcentaje}%`,backgroundColor:l(c),borderRadius:"6px"}})})})]})},te="_cardHeader_z0kry_63",se="_sectionCard_z0kry_75",ae="_accordionItem_z0kry_87",re="_preguntaTexto_z0kry_99",ne="_pesoPregunta_z0kry_111",oe="_accordionBtn_z0kry_119",ce="_preguntaHeader_z0kry_141",ie="_imgPregunta_z0kry_223",le="_imgOpcion_z0kry_233",de="_opcionItem_z0kry_245",ue="_opcionTexto_z0kry_251",me="_opcionBadges_z0kry_261",pe="_smallMuted_z0kry_285",ge="_alertSmall_z0kry_297",he="_badgeTiny_z0kry_305",d={cardHeader:te,sectionCard:se,accordionItem:ae,preguntaTexto:re,pesoPregunta:ne,accordionBtn:oe,preguntaHeader:ce,imgPregunta:ie,imgOpcion:le,opcionItem:de,opcionTexto:ue,opcionBadges:me,smallMuted:pe,alertSmall:ge,badgeTiny:he},O=n=>{if(!n)return null;const a=String(n).trim();if(!a)return null;if(/^data:image\//i.test(a))return a;let c="png";return a.startsWith("/9j")?c="jpeg":a.startsWith("iVBOR")?c="png":a.startsWith("R0lG")?c="gif":a.startsWith("UklGR")?c="webp":a.startsWith("Qk")?c="bmp":(a.startsWith("PHN2Zy")||a.startsWith("PD94"))&&(c="svg+xml"),`data:image/${c};base64,${a}`},_e=({respuestas:n,expandedAccordion:a,toggleAccordion:c,getImageUrl:l})=>e.jsxs("div",{className:`shadow-sm border-0 mb-3 ${d.sectionCard}`,children:[e.jsx("div",{className:`p-3 ${d.cardHeader}`,children:e.jsxs("h3",{className:"mb-0 d-flex align-items-center text-white",children:[e.jsx(q,{size:14,className:"me-2"}),"Respuestas"]})}),e.jsx("div",{className:"card-body",children:n.length===0?e.jsx("p",{className:"text-center text-muted py-4",children:"Sin respuestas disponibles."}):e.jsx("div",{className:"accordion",id:"respuestasAccordion",children:n.map((o,h)=>e.jsxs("div",{className:`accordion-item mb-4 ${d.accordionItem}`,children:[e.jsx("h2",{className:"accordion-header",children:e.jsx("button",{className:`accordion-button ${a!==h?"collapsed":""} ${d.accordionBtn}`,type:"button",onClick:()=>c(h),children:e.jsxs("div",{className:`w-100 me-3 ${d.preguntaHeader}`,children:[e.jsxs("div",{className:"",children:[e.jsxs("p",{className:`${d.preguntaTexto}`,children:["Pregunta ",h+1,":"]}),e.jsx("span",{children:o.texto_pregunta})]}),e.jsx("span",{className:`badge text-white ${o.es_correcta?"bg-success":"bg-danger"} ${d.badgeTiny}`,children:o.es_correcta?"Correcta":"Incorrecta"})]})})}),e.jsx("div",{className:`accordion-collapse collapse ${a===h?"show":""}`,children:e.jsxs("div",{className:"accordion-body",children:[o.imagen_pregunta&&e.jsx("div",{className:"mb-3 text-center",children:e.jsx("img",{src:O(o.imagen_pregunta)||l("pregunta",o.pregunta_id),alt:"Imagen pregunta",className:`img-fluid rounded ${d.imgPregunta}`})}),e.jsxs("p",{className:d.pesoPregunta,children:[e.jsx("strong",{children:"Peso:"})," ",o.peso_pregunta," pts"]}),!(Number(o.id_opcion_seleccionada)>0)||!o.opciones.some(i=>i.id===o.id_opcion_seleccionada)?e.jsx("div",{className:`alert alert-danger text-black py-2 px-3 mb-2 ${d.alertSmall}`,children:"El estudiante no respondió a esta pregunta"}):null,e.jsxs("div",{className:"mt-3",children:[e.jsx("p",{className:d.smallMuted,children:e.jsx("strong",{children:"Opciones:"})}),e.jsx("ul",{className:"list-unstyled",children:o.opciones.map(i=>e.jsxs("li",{className:`p-3 border rounded mb-2 ${d.opcionItem} ${i.id===o.id_opcion_seleccionada?i.es_correcta?"bg-success bg-opacity-10 border-success":"bg-danger bg-opacity-10 border-danger":i.es_correcta?"bg-success bg-opacity-10 border-success":""}`,children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-start",children:[e.jsx("span",{className:`${d.opcionTexto} flex-grow-1`,children:i.texto_opcion}),e.jsxs("div",{className:`d-flex flex-column gap-1 ${d.opcionBadges}`,children:[i.id===o.id_opcion_seleccionada&&e.jsx("span",{className:`badge bg-primary text-white ${d.badgeTiny}`,children:"Seleccionada"}),i.es_correcta&&e.jsx("span",{className:`badge bg-success text-white ${d.badgeTiny}`,children:"Correcta"})]})]}),i.imagen_opcion&&e.jsx("div",{className:"mt-2 text-center",children:e.jsx("img",{src:O(i.imagen_opcion)||l("opcion",i.id),alt:"Imagen opción",className:`img-fluid rounded ${d.imgOpcion}`})})]},i.id))})]})]})})]},o.pregunta_id))})})]}),W=({message:n,type:a="info",onVolver:c})=>e.jsx("div",{className:"d-flex align-items-center justify-content-center",style:{minHeight:"100vh",backgroundColor:"#f8fafc"},children:e.jsx("div",{className:"card shadow-sm border-0",style:{maxWidth:"500px",width:"90%"},children:e.jsxs("div",{className:"card-body text-center p-4",children:[a==="error"&&e.jsx("div",{style:{fontSize:"3rem",marginBottom:"1rem"},children:"⚠️"}),e.jsx("h2",{className:"mb-3",style:{fontSize:"1.5rem",color:a==="error"?"#ef4444":"#0f172a"},children:a==="error"?"Error":"Aviso"}),e.jsx("p",{className:"text-muted mb-4",style:{fontSize:"1rem",lineHeight:"1.5"},children:n}),c&&e.jsx("button",{onClick:c,className:"btn btn-outline-secondary",style:{borderColor:"#00a19B",color:"#00a19B",transition:"all 0.2s ease"},onMouseOver:l=>{l.currentTarget.style.backgroundColor="#00a19B",l.currentTarget.style.color="white"},onMouseOut:l=>{l.currentTarget.style.backgroundColor="transparent",l.currentTarget.style.color="#00a19B"},children:"Volver"})]})})}),xe=()=>e.jsx("div",{className:"d-flex align-items-center justify-content-center",style:{minHeight:"100vh",backgroundColor:"#f8fafc"},children:e.jsx("div",{className:"card shadow-sm border-0",style:{maxWidth:"500px",width:"90%"},children:e.jsxs("div",{className:"card-body text-center p-4",children:[e.jsx("div",{className:"mb-3",children:e.jsx(J,{className:"fa-spin",style:{fontSize:"3rem",color:"#00a19B"}})}),e.jsx("h2",{className:"mb-0",style:{color:"#0f172a"},children:"Cargando..."})]})})}),Re=()=>{const{data:n,isLoading:a,error:c,expandedAccordion:l,handleVolver:o,toggleAccordion:h,getImageUrl:i,getPorcentajeColor:z}=K();if(a)return e.jsx(R,{children:e.jsx(xe,{})});if(c)return e.jsx(R,{children:e.jsx(W,{message:c,type:"error",onVolver:o})});if(!n)return e.jsx(R,{children:e.jsx(W,{message:"No se encontraron respuestas para este estudiante.",type:"info",onVolver:o})});const{estudiante:C,cuestionario:I,estadisticas:x,respuestas:P}=n;return e.jsx(R,{children:e.jsx("div",{className:"container-fluid py-3",style:{backgroundColor:"#f8fafc",minHeight:"100vh"},children:e.jsx("div",{className:"row justify-content-center",children:e.jsxs("div",{className:"col-12 col-xl-10",children:[e.jsx(X,{onVolver:o}),e.jsxs("div",{className:"mt-4",children:[e.jsx(Y,{estudiante:C,cuestionario:I,estadisticas:x,children:e.jsx(ee,{estadisticas:x,getPorcentajeColor:z})}),e.jsx(_e,{respuestas:P,expandedAccordion:l,toggleAccordion:h,getImageUrl:i})]})]})})})})};export{Re as default};
