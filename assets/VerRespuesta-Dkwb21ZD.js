import{e as L,a as U,c as G,r as b,b as k,A as S,j as e}from"./index-W0ZSjH-A.js";import{P as z}from"./PageTransition-DHV3GPNa.js";import{m as Q,R as Z,S as q,e as J}from"./index-DfAB-zHd.js";import"./iconBase-BFfBqceE.js";function K(){const r=L(),a=U(),i=G(),l=r.estudianteId,n=r.cuestionarioId,h=Number(l),c=Number(n),[C,R]=b.useState(null),[I,x]=b.useState(!0),[A,N]=b.useState(null),[P,V]=b.useState(0),T=b.useRef(!1),w=b.useRef(null);return b.useEffect(()=>{const _=async()=>{if(w.current){await w.current;return}if(!l||!n||isNaN(h)||isNaN(c)){N("Parámetros no válidos"),x(!1);return}try{x(!0),N(null);try{console.debug("[VerRespuesta] params -> estudianteId:",h,"cuestionarioId:",c)}catch{}let m={};try{const t=await k.get(S.ver.obtener(c));m=t?.data?.data||t?.data||{}}catch{}let p=null;try{const t=await k.post(S.ver.obtenerintento(),{cuestionario_id:c,estudiante_id:h});p=t?.data?.data??t?.data}catch(t){const o=t?.response?.status;if(o===404||o===400){N("Este estudiante aún no ha respondido"),x(!1);return}throw t}if(!p||p.error||!p.intento_id){N("Este estudiante aún no ha respondido"),x(!1);return}const $=await k.get(S.ver.obtenerrespuestas(p.intento_id)),s=$?.data?.data||$?.data||{};let v=[];try{const t=await k.get(S.cuestionario.resolver.preguntasOpciones(c)),o=t?.data?.data??t?.data;Array.isArray(o)?v=o:Array.isArray(o?.preguntas)&&(v=o.preguntas)}catch{}const f=t=>{if(!t)return[];if(Array.isArray(t))return t;if(typeof t=="object"){const o=Object.values(t);if(o.length&&o.every(g=>typeof g=="object"))return o}return[]};let u=[];if(Array.isArray(s)&&(u=s),u.length||(u=f(s?.respuestas)),u.length||(u=f(s?.detalle)),u.length||(u=f(s?.data)),!u.length)for(const t of Object.keys(s||{})){const o=s[t],g=f(o);if(g.length){u=g;break}}if(!u.length&&s?.intento){const t=f(s.intento?.respuestas)||f(s.intento?.detalle)||[];t.length&&(u=t)}try{console.debug("[VerRespuesta] payload keys:",Object.keys(s||{}))}catch{}try{console.debug("[VerRespuesta] respuestas normalizadas:",u.length)}catch{}const W=new Map;v.forEach(t=>{W.set(Number(t.id||t.pregunta_id),t)});let j=u.map(t=>{const o=Number(t.pregunta_id||t.id_pregunta||t.id),g=W.get(o)||{},D=Array.isArray(t.opciones)?t.opciones:Array.isArray(g.opciones)?g.opciones:[];return{pregunta_id:o,texto_pregunta:t.texto_pregunta||g.texto_pregunta||g.texto||"",peso_pregunta:Number(t.peso_pregunta??g.peso_pregunta??0),imagen_pregunta:t.imagen_pregunta||g.imagen_pregunta,nombre_imagen_pregunta:t.nombre_imagen_pregunta||g.nombre_imagen_pregunta,id_opcion_seleccionada:Number(t.id_opcion_seleccionada||t.opcion_seleccionada_id||t.opcion_id||0),es_correcta:!!(t.es_correcta??t.correcta),opciones:(D||[]).map(y=>({id:Number(y.id),texto_opcion:y.texto_opcion||y.texto||"",es_correcta:!!y.es_correcta,imagen_opcion:y.imagen_opcion,nombre_imagen_opcion:y.nombre_imagen_opcion}))}});if(!j.length&&v.length){j=v.map(t=>({pregunta_id:Number(t.id||t.pregunta_id),texto_pregunta:t.texto_pregunta||t.texto||"",peso_pregunta:Number(t.peso_pregunta??0),imagen_pregunta:t.imagen_pregunta,nombre_imagen_pregunta:t.nombre_imagen_pregunta,id_opcion_seleccionada:0,es_correcta:!1,opciones:(Array.isArray(t.opciones)?t.opciones:[]).map(o=>({id:Number(o.id),texto_opcion:o.texto_opcion||o.texto||"",es_correcta:!!o.es_correcta,imagen_opcion:o.imagen_opcion,nombre_imagen_opcion:o.nombre_imagen_opcion}))}));try{console.debug("[VerRespuesta] Fallback: mostrando preguntas sin respuestas.")}catch{}}const H=j.length||Number(s?.total_preguntas)||0,M=j.filter(t=>!!t.es_correcta).length,B=i.state?.estudiante||s.estudiante||m.estudiante||{id:Number(l),nombre:s?.estudiante_nombre||s?.nombre_estudiante||s?.nombre||m?.estudiante_nombre||"Estudiante",email:s?.estudiante_email||s?.email_estudiante||s?.correo||s?.email||m?.estudiante_email||"",identificacion:s?.estudiante_identificacion||s?.identificacion_estudiante||s?.documento||s?.identificacion||m?.estudiante_identificacion||"",programa_nombre:s?.programa_nombre||s?.programa||m?.programa_nombre||""};try{console.debug("[VerRespuesta] estudiante:",B)}catch{}const F={estudiante:B,cuestionario:s.cuestionario||m.cuestionario||{id:c,titulo:m?.titulo||s?.cuestionario_titulo||"Cuestionario",descripcion:m?.descripcion||s?.cuestionario_descripcion||""},estadisticas:s.estadisticas||{fecha_respuesta:s?.fecha_respuesta||p?.fecha_respuesta||"",total_respondidas:Number(s?.total_respondidas??s?.respondidas??j.length??0),total_preguntas:Number(s?.total_preguntas??H),respuestas_correctas:Number(s?.respuestas_correctas??s?.correctas??M),puntaje_total:Number(s?.puntaje_total??p?.puntaje_total??0),puntaje_obtenido:Number(s?.puntaje_obtenido??s?.puntaje??p?.puntaje_obtenido??0),porcentaje:Number(s?.porcentaje??p?.porcentaje??0)},respuestas:j};R(F)}catch(m){const p=m instanceof Error?m.message:"Error al cargar las respuestas";N(p)}finally{x(!1)}};T.current||(T.current=!0,w.current=_().finally(()=>{w.current=null}))},[l,n]),{data:C,isLoading:I,error:A,expandedAccordion:P,handleVolver:()=>{a(-1)},toggleAccordion:_=>{V(P===_?-1:_)},getImageUrl:(_,m)=>`http://localhost/cuestionario-api/api/obtenerImagen_api.php?tipo=${_}&id=${m}`,getPorcentajeColor:_=>_>=70?"success":_>=40?"warning":"danger"}}const X=({onVolver:r})=>e.jsxs("nav",{className:"d-flex flex-row-reverse justify-content-between align-items-center mb-4 p-3",style:{backgroundColor:"#00a19B",borderRadius:"0.375rem",color:"white"},children:[e.jsxs("button",{onClick:r,className:"btn btn-outline-light btn-sm d-flex align-items-center",style:{borderColor:"rgba(255, 255, 255, 0.3)",color:"white",transition:"all 0.2s ease"},onMouseOver:a=>{a.currentTarget.style.backgroundColor="rgba(255, 255, 255, 0.2)",a.currentTarget.style.borderColor="rgba(255, 255, 255, 0.5)"},onMouseOut:a=>{a.currentTarget.style.backgroundColor="transparent",a.currentTarget.style.borderColor="rgba(255, 255, 255, 0.3)"},children:[e.jsx(Q,{size:12,className:"ms-2"})," Volver"]}),e.jsx("h1",{className:"mb-0 text-white",style:{fontSize:"1rem",fontWeight:"600"},children:"Respuestas"})]}),Y=({estudiante:r,cuestionario:a,estadisticas:i,children:l})=>e.jsxs("div",{className:"card shadow-sm border-0 mb-3",children:[e.jsx("div",{className:"card-header",style:{backgroundColor:"#343a40",color:"white",borderRadius:"0.375rem 0.375rem 0 0"},children:e.jsxs("h3",{className:"mb-0 d-flex align-items-center",children:[e.jsx(Z,{size:14,className:"me-2"}),"Información"]})}),e.jsx("div",{className:"card-body",children:e.jsxs("div",{className:"row g-3",children:[e.jsxs("div",{className:"col-12 col-md-6",children:[e.jsx("h4",{className:"mb-3",style:{color:"#0f172a",fontSize:"1rem",fontWeight:"600"},children:r.nombre}),e.jsxs("div",{className:"d-flex mb-2",style:{fontSize:"0.8rem"},children:[e.jsx("span",{className:"fw-bold me-2",style:{minWidth:"90px",color:"#334155"},children:"ID:"}),e.jsx("span",{children:r.identificacion})]}),e.jsxs("div",{className:"d-flex mb-2",style:{fontSize:"0.8rem"},children:[e.jsx("span",{className:"fw-bold me-2",style:{minWidth:"90px",color:"#334155"},children:"Email:"}),e.jsx("span",{children:r.email})]}),e.jsxs("div",{className:"d-flex mb-2",style:{fontSize:"0.8rem"},children:[e.jsx("span",{className:"fw-bold me-2",style:{minWidth:"90px",color:"#334155"},children:"Programa:"}),e.jsx("span",{children:r.programa_nombre})]})]}),e.jsxs("div",{className:"col-12 col-md-6",children:[e.jsx("h5",{className:"mb-2",style:{color:"#0f172a",fontSize:"1rem",fontWeight:"600"},children:a.titulo}),e.jsx("p",{className:"text-muted mb-3",style:{fontSize:"0.8rem",fontStyle:"italic"},children:a.descripcion}),e.jsxs("div",{className:"d-flex mb-2",style:{fontSize:"0.8rem"},children:[e.jsx("span",{className:"fw-bold me-2",style:{minWidth:"90px",color:"#334155"},children:"Fecha:"}),e.jsx("span",{children:new Date(i.fecha_respuesta).toLocaleDateString()})]}),l]})]})})]}),ee=({estadisticas:r,getPorcentajeColor:a})=>{const i=a(r.porcentaje),l=n=>{switch(n){case"success":return"#22c55e";case"warning":return"#f59e0b";case"danger":return"#ef4444";default:return"#22c55e"}};return e.jsxs("div",{className:"mt-3",children:[e.jsxs("div",{className:"mb-2",style:{fontSize:"0.8rem",color:"#334155",fontWeight:"500"},children:[e.jsx("strong",{children:"Puntaje:"})," ",r.puntaje_obtenido,"/",r.puntaje_total," (",r.porcentaje,"%)"]}),e.jsx("div",{style:{width:"150px"},children:e.jsx("div",{className:"progress",style:{height:"12px"},children:e.jsx("div",{className:"progress-bar",style:{width:`${r.porcentaje}%`,backgroundColor:l(i),borderRadius:"6px"}})})})]})},te="_cardHeader_z0kry_63",se="_sectionCard_z0kry_75",ae="_accordionItem_z0kry_87",re="_preguntaTexto_z0kry_99",ne="_pesoPregunta_z0kry_111",oe="_accordionBtn_z0kry_119",ie="_preguntaHeader_z0kry_141",ce="_imgPregunta_z0kry_223",le="_imgOpcion_z0kry_233",de="_opcionItem_z0kry_245",me="_opcionTexto_z0kry_251",ue="_opcionBadges_z0kry_261",ge="_smallMuted_z0kry_285",pe="_alertSmall_z0kry_297",he="_badgeTiny_z0kry_305",d={cardHeader:te,sectionCard:se,accordionItem:ae,preguntaTexto:re,pesoPregunta:ne,accordionBtn:oe,preguntaHeader:ie,imgPregunta:ce,imgOpcion:le,opcionItem:de,opcionTexto:me,opcionBadges:ue,smallMuted:ge,alertSmall:pe,badgeTiny:he},E=r=>{if(!r)return null;const a=String(r).trim();if(!a)return null;if(/^data:image\//i.test(a))return a;let i="png";return a.startsWith("/9j")?i="jpeg":a.startsWith("iVBOR")?i="png":a.startsWith("R0lG")?i="gif":a.startsWith("UklGR")?i="webp":a.startsWith("Qk")?i="bmp":(a.startsWith("PHN2Zy")||a.startsWith("PD94"))&&(i="svg+xml"),`data:image/${i};base64,${a}`},_e=({respuestas:r,expandedAccordion:a,toggleAccordion:i,getImageUrl:l})=>e.jsxs("div",{className:`shadow-sm border-0 mb-3 ${d.sectionCard}`,children:[e.jsx("div",{className:`p-3 ${d.cardHeader}`,children:e.jsxs("h3",{className:"mb-0 d-flex align-items-center text-white",children:[e.jsx(q,{size:14,className:"me-2"}),"Respuestas"]})}),e.jsx("div",{className:"card-body",children:r.length===0?e.jsx("p",{className:"text-center text-muted py-4",children:"Sin respuestas disponibles."}):e.jsx("div",{className:"accordion",id:"respuestasAccordion",children:r.map((n,h)=>e.jsxs("div",{className:`accordion-item mb-4 ${d.accordionItem}`,children:[e.jsx("h2",{className:"accordion-header",children:e.jsx("button",{className:`accordion-button ${a!==h?"collapsed":""} ${d.accordionBtn}`,type:"button",onClick:()=>i(h),children:e.jsxs("div",{className:`w-100 me-3 ${d.preguntaHeader}`,children:[e.jsxs("div",{className:"",children:[e.jsxs("p",{className:`${d.preguntaTexto}`,children:["Pregunta ",h+1,":"]}),e.jsx("span",{children:n.texto_pregunta})]}),e.jsx("span",{className:`badge text-white ${n.es_correcta?"bg-success":"bg-danger"} ${d.badgeTiny}`,children:n.es_correcta?"Correcta":"Incorrecta"})]})})}),e.jsx("div",{className:`accordion-collapse collapse ${a===h?"show":""}`,children:e.jsxs("div",{className:"accordion-body",children:[n.imagen_pregunta&&e.jsx("div",{className:"mb-3 text-center",children:e.jsx("img",{src:E(n.imagen_pregunta)||l("pregunta",n.pregunta_id),alt:"Imagen pregunta",className:`img-fluid rounded ${d.imgPregunta}`})}),e.jsxs("p",{className:d.pesoPregunta,children:[e.jsx("strong",{children:"Peso:"})," ",n.peso_pregunta," pts"]}),!(Number(n.id_opcion_seleccionada)>0)||!n.opciones.some(c=>c.id===n.id_opcion_seleccionada)?e.jsx("div",{className:`alert alert-danger text-black py-2 px-3 mb-2 ${d.alertSmall}`,children:"El estudiante no respondió a esta pregunta"}):null,e.jsxs("div",{className:"mt-3",children:[e.jsx("p",{className:d.smallMuted,children:e.jsx("strong",{children:"Opciones:"})}),e.jsx("ul",{className:"list-unstyled",children:n.opciones.map(c=>e.jsxs("li",{className:`p-3 border rounded mb-2 ${d.opcionItem} ${c.id===n.id_opcion_seleccionada?c.es_correcta?"bg-success bg-opacity-10 border-success":"bg-danger bg-opacity-10 border-danger":c.es_correcta?"bg-success bg-opacity-10 border-success":""}`,children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-start",children:[e.jsx("span",{className:`${d.opcionTexto} flex-grow-1`,children:c.texto_opcion}),e.jsxs("div",{className:`d-flex flex-column gap-1 ${d.opcionBadges}`,children:[c.id===n.id_opcion_seleccionada&&e.jsx("span",{className:`badge bg-primary text-white ${d.badgeTiny}`,children:"Seleccionada"}),c.es_correcta&&e.jsx("span",{className:`badge bg-success text-white ${d.badgeTiny}`,children:"Correcta"})]})]}),c.imagen_opcion&&e.jsx("div",{className:"mt-2 text-center",children:e.jsx("img",{src:E(c.imagen_opcion)||l("opcion",c.id),alt:"Imagen opción",className:`img-fluid rounded ${d.imgOpcion}`})})]},c.id))})]})]})})]},n.pregunta_id))})})]}),O=({message:r,type:a="info",onVolver:i})=>e.jsx("div",{className:"d-flex align-items-center justify-content-center",style:{minHeight:"100vh",backgroundColor:"#f8fafc"},children:e.jsx("div",{className:"card shadow-sm border-0",style:{maxWidth:"500px",width:"90%"},children:e.jsxs("div",{className:"card-body text-center p-4",children:[a==="error"&&e.jsx("div",{style:{fontSize:"3rem",marginBottom:"1rem"},children:"⚠️"}),e.jsx("h2",{className:"mb-3",style:{fontSize:"1.5rem",color:a==="error"?"#ef4444":"#0f172a"},children:a==="error"?"Error":"Aviso"}),e.jsx("p",{className:"text-muted mb-4",style:{fontSize:"1rem",lineHeight:"1.5"},children:r}),i&&e.jsx("button",{onClick:i,className:"btn btn-outline-secondary",style:{borderColor:"#00a19B",color:"#00a19B",transition:"all 0.2s ease"},onMouseOver:l=>{l.currentTarget.style.backgroundColor="#00a19B",l.currentTarget.style.color="white"},onMouseOut:l=>{l.currentTarget.style.backgroundColor="transparent",l.currentTarget.style.color="#00a19B"},children:"Volver"})]})})}),xe=()=>e.jsx("div",{className:"d-flex align-items-center justify-content-center",style:{minHeight:"100vh",backgroundColor:"#f8fafc"},children:e.jsx("div",{className:"card shadow-sm border-0",style:{maxWidth:"500px",width:"90%"},children:e.jsxs("div",{className:"card-body text-center p-4",children:[e.jsx("div",{className:"mb-3",children:e.jsx(J,{className:"fa-spin",style:{fontSize:"3rem",color:"#00a19B"}})}),e.jsx("h2",{className:"mb-0",style:{color:"#0f172a"},children:"Cargando..."})]})})}),ze=()=>{const{data:r,isLoading:a,error:i,expandedAccordion:l,handleVolver:n,toggleAccordion:h,getImageUrl:c,getPorcentajeColor:C}=K();if(a)return e.jsx(z,{children:e.jsx(xe,{})});if(i)return e.jsx(z,{children:e.jsx(O,{message:i,type:"error",onVolver:n})});if(!r)return e.jsx(z,{children:e.jsx(O,{message:"No se encontraron respuestas para este estudiante.",type:"info",onVolver:n})});const{estudiante:R,cuestionario:I,estadisticas:x,respuestas:A}=r;return e.jsx(z,{children:e.jsx("div",{className:"container-fluid py-3",style:{backgroundColor:"#f8fafc",minHeight:"100vh"},children:e.jsx("div",{className:"row justify-content-center",children:e.jsxs("div",{className:"col-12 col-xl-10",children:[e.jsx(X,{onVolver:n}),e.jsxs("div",{className:"mt-4",children:[e.jsx(Y,{estudiante:R,cuestionario:I,estadisticas:x,children:e.jsx(ee,{estadisticas:x,getPorcentajeColor:C})}),e.jsx(_e,{respuestas:A,expandedAccordion:l,toggleAccordion:h,getImageUrl:c})]})]})})})})};export{ze as default};
