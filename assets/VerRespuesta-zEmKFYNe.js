import{e as L,a as $,c as M,r as y,b as w,A as S,j as e}from"./index-DaOhVVWd.js";import{P as C}from"./PageTransition-Couod70-.js";import{m as U,S as G,T as Q,e as Z}from"./index-B8Flq_4W.js";import"./iconBase-Cr-ff6zs.js";function q(){const n=L(),a=$(),r=M(),l=n.estudianteId,o=n.cuestionarioId,g=Number(l),i=Number(o),[R,N]=y.useState(null),[A,x]=y.useState(!0),[z,k]=y.useState(null),[I,T]=y.useState(0);return y.useEffect(()=>{(async()=>{if(!l||!o||isNaN(g)||isNaN(i)){k("Parámetros no válidos"),x(!1);return}try{x(!0),k(null);try{console.debug("[VerRespuesta] params -> estudianteId:",g,"cuestionarioId:",i)}catch{}let d={};try{const t=await w.get(S.ver.obtener(i));d=t?.data?.data||t?.data||{}}catch{}const v=await w.post(S.ver.obtenerintento(),{cuestionario_id:i,estudiante_id:g}),p=v?.data?.data??v?.data;if(!p||p.error||!p.intento_id)throw new Error(p?.error||"No se encontró intento para este estudiante");const P=await w.get(S.ver.obtenerrespuestas(p.intento_id)),s=P?.data?.data||P?.data||{};let _=[];try{const t=await w.get(S.cuestionario.resolver.preguntasOpciones(i)),c=t?.data?.data??t?.data;Array.isArray(c)?_=c:Array.isArray(c?.preguntas)&&(_=c.preguntas)}catch{}const b=t=>{if(!t)return[];if(Array.isArray(t))return t;if(typeof t=="object"){const c=Object.values(t);if(c.length&&c.every(u=>typeof u=="object"))return c}return[]};let m=[];if(Array.isArray(s)&&(m=s),m.length||(m=b(s?.respuestas)),m.length||(m=b(s?.detalle)),m.length||(m=b(s?.data)),!m.length)for(const t of Object.keys(s||{})){const c=s[t],u=b(c);if(u.length){m=u;break}}if(!m.length&&s?.intento){const t=b(s.intento?.respuestas)||b(s.intento?.detalle)||[];t.length&&(m=t)}try{console.debug("[VerRespuesta] payload keys:",Object.keys(s||{}))}catch{}try{console.debug("[VerRespuesta] respuestas normalizadas:",m.length)}catch{}const W=new Map;_.forEach(t=>{W.set(Number(t.id||t.pregunta_id),t)});let f=m.map(t=>{const c=Number(t.pregunta_id||t.id_pregunta||t.id),u=W.get(c)||{},F=Array.isArray(t.opciones)?t.opciones:Array.isArray(u.opciones)?u.opciones:[];return{pregunta_id:c,texto_pregunta:t.texto_pregunta||u.texto_pregunta||u.texto||"",peso_pregunta:Number(t.peso_pregunta??u.peso_pregunta??0),imagen_pregunta:t.imagen_pregunta||u.imagen_pregunta,nombre_imagen_pregunta:t.nombre_imagen_pregunta||u.nombre_imagen_pregunta,id_opcion_seleccionada:Number(t.id_opcion_seleccionada||t.opcion_seleccionada_id||t.opcion_id||0),es_correcta:!!(t.es_correcta??t.correcta),opciones:(F||[]).map(j=>({id:Number(j.id),texto_opcion:j.texto_opcion||j.texto||"",es_correcta:!!j.es_correcta,imagen_opcion:j.imagen_opcion,nombre_imagen_opcion:j.nombre_imagen_opcion}))}});if(!f.length&&_.length){f=_.map(t=>({pregunta_id:Number(t.id||t.pregunta_id),texto_pregunta:t.texto_pregunta||t.texto||"",peso_pregunta:Number(t.peso_pregunta??0),imagen_pregunta:t.imagen_pregunta,nombre_imagen_pregunta:t.nombre_imagen_pregunta,id_opcion_seleccionada:0,es_correcta:!1,opciones:(Array.isArray(t.opciones)?t.opciones:[]).map(c=>({id:Number(c.id),texto_opcion:c.texto_opcion||c.texto||"",es_correcta:!!c.es_correcta,imagen_opcion:c.imagen_opcion,nombre_imagen_opcion:c.nombre_imagen_opcion}))}));try{console.debug("[VerRespuesta] Fallback: mostrando preguntas sin respuestas.")}catch{}}const B=f.length||Number(s?.total_preguntas)||0,D=f.filter(t=>!!t.es_correcta).length,V=r.state?.estudiante||s.estudiante||d.estudiante||{id:Number(l),nombre:s?.estudiante_nombre||s?.nombre_estudiante||s?.nombre||d?.estudiante_nombre||"Estudiante",email:s?.estudiante_email||s?.email_estudiante||s?.correo||s?.email||d?.estudiante_email||"",identificacion:s?.estudiante_identificacion||s?.identificacion_estudiante||s?.documento||s?.identificacion||d?.estudiante_identificacion||"",programa_nombre:s?.programa_nombre||s?.programa||d?.programa_nombre||""};try{console.debug("[VerRespuesta] estudiante:",V)}catch{}const H={estudiante:V,cuestionario:s.cuestionario||d.cuestionario||{id:i,titulo:d?.titulo||s?.cuestionario_titulo||"Cuestionario",descripcion:d?.descripcion||s?.cuestionario_descripcion||""},estadisticas:s.estadisticas||{fecha_respuesta:s?.fecha_respuesta||p?.fecha_respuesta||"",total_respondidas:Number(s?.total_respondidas??s?.respondidas??f.length??0),total_preguntas:Number(s?.total_preguntas??B),respuestas_correctas:Number(s?.respuestas_correctas??s?.correctas??D),puntaje_total:Number(s?.puntaje_total??p?.puntaje_total??0),puntaje_obtenido:Number(s?.puntaje_obtenido??s?.puntaje??p?.puntaje_obtenido??0),porcentaje:Number(s?.porcentaje??p?.porcentaje??0)},respuestas:f};N(H)}catch(d){const v=d instanceof Error?d.message:"Error al cargar las respuestas";k(v)}finally{x(!1)}})()},[l,o]),{data:R,isLoading:A,error:z,expandedAccordion:I,handleVolver:()=>{a(-1)},toggleAccordion:h=>{T(I===h?-1:h)},getImageUrl:(h,d)=>`http://localhost/cuestionario-api/api/obtenerImagen_api.php?tipo=${h}&id=${d}`,getPorcentajeColor:h=>h>=70?"success":h>=40?"warning":"danger"}}const J=({onVolver:n,usuario:a})=>e.jsxs("nav",{className:"d-flex justify-content-between align-items-center mb-4 p-3",style:{backgroundColor:"#00a19B",borderRadius:"0.375rem",color:"white"},children:[e.jsxs("button",{onClick:n,className:"btn btn-outline-light btn-sm d-flex align-items-center",style:{borderColor:"rgba(255, 255, 255, 0.3)",color:"white",transition:"all 0.2s ease"},onMouseOver:r=>{r.currentTarget.style.backgroundColor="rgba(255, 255, 255, 0.2)",r.currentTarget.style.borderColor="rgba(255, 255, 255, 0.5)"},onMouseOut:r=>{r.currentTarget.style.backgroundColor="transparent",r.currentTarget.style.borderColor="rgba(255, 255, 255, 0.3)"},children:[e.jsx(U,{size:12,className:"me-2"})," Volver"]}),e.jsx("h1",{className:"mb-0 text-white",style:{fontSize:"1rem",fontWeight:"600"},children:"Respuestas"}),e.jsx("div",{className:"text-white",style:{fontSize:"0.8rem",padding:"0.4rem 0.8rem",backgroundColor:"rgba(255, 255, 255, 0.1)",borderRadius:"0.375rem"},children:a})]}),K=({estudiante:n,cuestionario:a,estadisticas:r,children:l})=>e.jsxs("div",{className:"card shadow-sm border-0 mb-3",children:[e.jsx("div",{className:"card-header",style:{backgroundColor:"#343a40",color:"white",borderRadius:"0.375rem 0.375rem 0 0"},children:e.jsxs("h3",{className:"mb-0 d-flex align-items-center",children:[e.jsx(G,{size:14,className:"me-2"}),"Información"]})}),e.jsx("div",{className:"card-body",children:e.jsxs("div",{className:"row g-3",children:[e.jsxs("div",{className:"col-12 col-md-6",children:[e.jsx("h4",{className:"mb-3",style:{color:"#0f172a",fontSize:"1rem",fontWeight:"600"},children:n.nombre}),e.jsxs("div",{className:"d-flex mb-2",style:{fontSize:"0.8rem"},children:[e.jsx("span",{className:"fw-bold me-2",style:{minWidth:"90px",color:"#334155"},children:"ID:"}),e.jsx("span",{children:n.identificacion})]}),e.jsxs("div",{className:"d-flex mb-2",style:{fontSize:"0.8rem"},children:[e.jsx("span",{className:"fw-bold me-2",style:{minWidth:"90px",color:"#334155"},children:"Email:"}),e.jsx("span",{children:n.email})]}),e.jsxs("div",{className:"d-flex mb-2",style:{fontSize:"0.8rem"},children:[e.jsx("span",{className:"fw-bold me-2",style:{minWidth:"90px",color:"#334155"},children:"Programa:"}),e.jsx("span",{children:n.programa_nombre})]})]}),e.jsxs("div",{className:"col-12 col-md-6",children:[e.jsx("h5",{className:"mb-2",style:{color:"#0f172a",fontSize:"1rem",fontWeight:"600"},children:a.titulo}),e.jsx("p",{className:"text-muted mb-3",style:{fontSize:"0.8rem",fontStyle:"italic"},children:a.descripcion}),e.jsxs("div",{className:"d-flex mb-2",style:{fontSize:"0.8rem"},children:[e.jsx("span",{className:"fw-bold me-2",style:{minWidth:"90px",color:"#334155"},children:"Fecha:"}),e.jsx("span",{children:new Date(r.fecha_respuesta).toLocaleDateString()})]}),l]})]})})]}),X=({estadisticas:n,getPorcentajeColor:a})=>{const r=a(n.porcentaje),l=o=>{switch(o){case"success":return"#22c55e";case"warning":return"#f59e0b";case"danger":return"#ef4444";default:return"#22c55e"}};return e.jsxs("div",{className:"mt-3",children:[e.jsxs("div",{className:"mb-2",style:{fontSize:"0.8rem",color:"#334155",fontWeight:"500"},children:[e.jsx("strong",{children:"Puntaje:"})," ",n.puntaje_obtenido,"/",n.puntaje_total," (",n.porcentaje,"%)"]}),e.jsx("div",{style:{width:"150px"},children:e.jsx("div",{className:"progress",style:{height:"12px"},children:e.jsx("div",{className:"progress-bar",style:{width:`${n.porcentaje}%`,backgroundColor:l(r),borderRadius:"6px"}})})})]})},E=n=>{if(!n)return null;const a=String(n).trim();if(!a)return null;if(/^data:image\//i.test(a))return a;let r="png";return a.startsWith("/9j")?r="jpeg":a.startsWith("iVBOR")?r="png":a.startsWith("R0lG")?r="gif":a.startsWith("UklGR")?r="webp":a.startsWith("Qk")?r="bmp":(a.startsWith("PHN2Zy")||a.startsWith("PD94"))&&(r="svg+xml"),`data:image/${r};base64,${a}`},Y=({respuestas:n,expandedAccordion:a,toggleAccordion:r,getImageUrl:l})=>e.jsxs("div",{className:"card shadow-sm border-0 mb-3",children:[e.jsx("div",{className:"card-header",style:{backgroundColor:"#343a40",color:"white",borderRadius:"0.375rem 0.375rem 0 0"},children:e.jsxs("h3",{className:"mb-0 d-flex align-items-center",children:[e.jsx(Q,{size:14,className:"me-2"}),"Respuestas"]})}),e.jsx("div",{className:"card-body",children:n.length===0?e.jsx("p",{className:"text-center text-muted py-4",children:"Sin respuestas disponibles."}):e.jsx("div",{className:"accordion",id:"respuestasAccordion",children:n.map((o,g)=>e.jsxs("div",{className:"accordion-item",children:[e.jsx("h2",{className:"accordion-header",children:e.jsx("button",{className:`accordion-button ${a!==g?"collapsed":""}`,type:"button",onClick:()=>r(g),style:{fontSize:"0.8rem",padding:"0.6rem 0.75rem"},children:e.jsxs("div",{className:"d-flex justify-content-between align-items-start w-100 me-3",children:[e.jsxs("span",{className:"text-start",children:["P",g+1,": ",o.texto_pregunta]}),e.jsx("span",{className:`badge ${o.es_correcta?"bg-success":"bg-danger"}`,style:{fontSize:"0.7rem"},children:o.es_correcta?"Correcta":"Incorrecta"})]})})}),a===g&&e.jsx("div",{className:"accordion-collapse collapse show",children:e.jsxs("div",{className:"accordion-body",children:[e.jsx("p",{style:{fontSize:"0.9rem",lineHeight:"1.4",color:"#334155",marginBottom:"0.75rem",fontWeight:"500"},children:o.texto_pregunta}),o.imagen_pregunta&&e.jsx("div",{className:"mb-3 text-center",children:e.jsx("img",{src:E(o.imagen_pregunta)||l("pregunta",o.pregunta_id),alt:"Imagen pregunta",className:"img-fluid rounded",style:{maxHeight:"300px",border:"1px solid #dee2e6"}})}),e.jsxs("p",{style:{fontSize:"0.8rem",color:"#64748b",margin:"0.5rem 0"},children:[e.jsx("strong",{children:"Peso:"})," ",o.peso_pregunta," pts"]}),!(Number(o.id_opcion_seleccionada)>0)||!o.opciones.some(i=>i.id===o.id_opcion_seleccionada)?e.jsx("div",{className:"alert alert-danger text-black py-2 px-3 mb-2",style:{fontSize:"0.8rem"},children:"El estudiante no respondió a esta pregunta"}):null,e.jsxs("div",{className:"mt-3",children:[e.jsx("p",{style:{marginBottom:"0.5rem",fontSize:"0.8rem"},children:e.jsx("strong",{children:"Opciones:"})}),e.jsx("ul",{className:"list-unstyled",children:o.opciones.map(i=>e.jsxs("li",{className:`p-3 border rounded mb-2 ${i.id===o.id_opcion_seleccionada?i.es_correcta?"bg-success bg-opacity-10 border-success":"bg-danger bg-opacity-10 border-danger":i.es_correcta?"bg-success bg-opacity-10 border-success":""}`,style:{transition:"all 0.2s ease"},children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-start",children:[e.jsx("span",{style:{fontSize:"0.8rem",color:"#334155",marginRight:"0.5rem",flex:"1"},children:i.texto_opcion}),e.jsxs("div",{className:"d-flex flex-column gap-1",style:{minWidth:"80px"},children:[i.id===o.id_opcion_seleccionada&&e.jsx("span",{className:"badge bg-primary",style:{fontSize:"0.7rem"},children:"Seleccionada"}),i.es_correcta&&e.jsx("span",{className:"badge bg-success",style:{fontSize:"0.7rem"},children:"Correcta"})]})]}),i.imagen_opcion&&e.jsx("div",{className:"mt-2 text-center",children:e.jsx("img",{src:E(i.imagen_opcion)||l("opcion",i.id),alt:"Imagen opción",className:"img-fluid rounded",style:{maxHeight:"150px",border:"1px solid #dee2e6"}})})]},i.id))})]})]})})]},o.pregunta_id))})})]}),O=({message:n,type:a="info",onVolver:r})=>e.jsx("div",{className:"d-flex align-items-center justify-content-center",style:{minHeight:"100vh",backgroundColor:"#f8fafc"},children:e.jsx("div",{className:"card shadow-sm border-0",style:{maxWidth:"500px",width:"90%"},children:e.jsxs("div",{className:"card-body text-center p-4",children:[a==="error"&&e.jsx("div",{style:{fontSize:"3rem",marginBottom:"1rem"},children:"⚠️"}),e.jsx("h2",{className:"mb-3",style:{fontSize:"1.5rem",color:a==="error"?"#ef4444":"#0f172a"},children:a==="error"?"Error":"Aviso"}),e.jsx("p",{className:"text-muted mb-4",style:{fontSize:"1rem",lineHeight:"1.5"},children:n}),r&&e.jsx("button",{onClick:r,className:"btn btn-outline-secondary",style:{borderColor:"#00a19B",color:"#00a19B",transition:"all 0.2s ease"},onMouseOver:l=>{l.currentTarget.style.backgroundColor="#00a19B",l.currentTarget.style.color="white"},onMouseOut:l=>{l.currentTarget.style.backgroundColor="transparent",l.currentTarget.style.color="#00a19B"},children:"Volver"})]})})}),ee=()=>e.jsx("div",{className:"d-flex align-items-center justify-content-center",style:{minHeight:"100vh",backgroundColor:"#f8fafc"},children:e.jsx("div",{className:"card shadow-sm border-0",style:{maxWidth:"500px",width:"90%"},children:e.jsxs("div",{className:"card-body text-center p-4",children:[e.jsx("div",{className:"mb-3",children:e.jsx(Z,{className:"fa-spin",style:{fontSize:"3rem",color:"#00a19B"}})}),e.jsx("h2",{className:"mb-0",style:{color:"#0f172a"},children:"Cargando..."})]})})}),de=()=>{const{data:n,isLoading:a,error:r,expandedAccordion:l,handleVolver:o,toggleAccordion:g,getImageUrl:i,getPorcentajeColor:R}=q();if(a)return e.jsx(C,{children:e.jsx(ee,{})});if(r)return e.jsx(C,{children:e.jsx(O,{message:r,type:"error",onVolver:o})});if(!n)return e.jsx(C,{children:e.jsx(O,{message:"No se encontraron respuestas para este estudiante.",type:"info",onVolver:o})});const{estudiante:N,cuestionario:A,estadisticas:x,respuestas:z}=n;return e.jsx(C,{children:e.jsx("div",{className:"container-fluid py-3",style:{backgroundColor:"#f8fafc",minHeight:"100vh"},children:e.jsx("div",{className:"row justify-content-center",children:e.jsxs("div",{className:"col-12 col-xl-10",children:[e.jsx(J,{onVolver:o,usuario:N.nombre}),e.jsxs("div",{className:"mt-4",children:[e.jsx(K,{estudiante:N,cuestionario:A,estadisticas:x,children:e.jsx(X,{estadisticas:x,getPorcentajeColor:R})}),e.jsx(Y,{respuestas:z,expandedAccordion:l,toggleAccordion:g,getImageUrl:i})]})]})})})})};export{de as default};
