import{a as H,c as X,r as u,b as w,A as C,S as M,j as e}from"./index-DaOhVVWd.js";import{P as z}from"./PageTransition-Couod70-.js";import{m as Z,l as I,T as V,A as E,E as ee,U as te,j as se,V as re,Q as ae,e as ie,t as oe,W as ne}from"./index-B8Flq_4W.js";import"./iconBase-Cr-ff6zs.js";const ce=()=>{const o=H(),c=X(),[i,b]=u.useState([]),[p,f]=u.useState(null),[h,s]=u.useState([]),[d,n]=u.useState(null),[m,x]=u.useState(!0),[D,R]=u.useState(null),k=u.useRef(!1),g=u.useCallback(async()=>{try{x(!0),R(null);const r=await w.get(C.seguimiento.allquiz),l=r?.data?.data??r?.data??{},y=Array.isArray(l?.cuestionarios)?l.cuestionarios:Array.isArray(l?.data)?l.data:Array.isArray(r?.data)?r.data:Array.isArray(l)?l:[];b(y)}catch(r){console.error("Error al cargar cuestionarios:",r),R(r instanceof Error?r.message:"Error al cargar cuestionarios"),M.fire({icon:"error",title:"Error",text:"No se pudieron cargar los cuestionarios"})}finally{x(!1)}},[]);u.useEffect(()=>{k.current||(k.current=!0,g())},[g]),u.useEffect(()=>{const r=()=>{document.hidden||g()},l=()=>{g()};return document.addEventListener("visibilitychange",r),window.addEventListener("focus",l),()=>{document.removeEventListener("visibilitychange",r),window.removeEventListener("focus",l)}},[g]),u.useEffect(()=>{c.pathname.includes("/vista-resultado")&&g()},[c.pathname,g]);const O=async r=>{try{x(!0);const[l,y]=await Promise.all([w.get(C.seguimiento.info(r)),w.get(C.seguimiento.estudiantes(r))]),a=l?.data?.data??l?.data??{},j=y?.data?.data??y?.data??{},A=t=>{if(!t)return null;const v=new Date(String(t).replace(/\//g,"-"));return isNaN(v.getTime())?null:v},S=t=>t===1||t==="1"||t===!0||t==="true"||t==="activo"||t==="activa"||t==="abierto"||t==="abierta"||t==="open",F=A(a?.fecha_inicio??a?.inicio),B=A(a?.fecha_fin??a?.fin),P=new Date,U=F&&B?P>=F&&P<=B:!1,G=S(a?.apertura_activa)||S(a?.activo)||S(a?.estado),L=a?{apertura_id:Number(a.apertura_id??a.id??r),cuestionario_id:Number(a.cuestionario_id??a.id_cuestionario??a.cuestionario?.id??0),titulo:String(a.titulo??a.cuestionario_titulo??a.cuestionario?.titulo??"Cuestionario"),descripcion:String(a.descripcion??a.cuestionario_descripcion??a.cuestionario?.descripcion??""),programa_nombre:String(a.programa_nombre??a.programa??a.cuestionario?.programa_nombre??"No especificado"),periodo_nombre:String(a.periodo_nombre??a.periodo??"No especificado"),fecha_inicio:String(a.fecha_inicio??a.inicio??""),fecha_fin:String(a.fecha_fin??a.fin??""),apertura_activa:G||U?1:0}:null,_=(Array.isArray(j?.estudiantes)?j.estudiantes:Array.isArray(j)?j:Array.isArray(y?.data)?y.data:[]).map(t=>({estudiante_id:Number(t.estudiante_id??t.id??t.id_estudiante??0),estudiante_nombre:String(t.estudiante_nombre??t.nombre??""),identificacion:String(t.identificacion??t.cedula??""),email:String(t.email??t.correo??""),total_preguntas:Number(t.total_preguntas??0),respuestas_correctas:Number(t.respuestas_correctas??t.correctas??0),porcentaje:Number(t.porcentaje??t.puntaje??0),fecha_respuesta:t.fecha_respuesta??t.fecha??null,puntaje_total:Number(t.puntaje_total??t.total??0)})),N=_.length,K=N>0?Math.round(_.reduce((t,v)=>t+(v.porcentaje||0),0)/N):0,Q=N>0?Math.round(_.reduce((t,v)=>t+(v.respuestas_correctas||0),0)/N):0,J={total_estudiantes:Number(j?.total_estudiantes??N),promedio_porcentaje:Number(j?.promedio_porcentaje??K),promedio_respuestas_correctas:Number(j?.promedio_respuestas_correctas??Q),total_preguntas_cuestionario:(j?.total_preguntas_cuestionario??L,0)};f(L),s(_),n(J)}catch(l){console.error("Error al cargar detalles:",l),M.fire({icon:"error",title:"Error",text:"No se pudieron cargar los detalles del cuestionario"})}finally{x(!1)}},$=(r,l)=>{o(`/ver-respuesta/${r}/${l}`)},Y=r=>`${r.toFixed(1)}%`,q=r=>r>=80?"success":r>=60?"warning":"danger",T=r=>r===1?"activo":"cerrado",W=r=>r===1?"✅":"📋";return{cuestionarios:i,aperturaSeleccionada:p,resultadosEstudiantes:h,estadisticasApertura:d,loading:m,error:D,handleSeleccionarCuestionario:O,handleVerRespuestas:$,formatearPorcentaje:Y,getPorcentajeColor:q,getEstadoCuestionario:T,getIconoEstado:W,getEstadisticasRapidas:r=>({respondieron:r.total_estudiantes_respondieron,estado:T(r.apertura_activa),icono:W(r.apertura_activa)}),cargarCuestionarios:g,refrescarDatos:g}},le=()=>{const o=H(),c=()=>{o("/seguimiento")};return e.jsx("div",{className:"d-flex justify-content-between align-items-center mb-4 p-3",style:{backgroundColor:"#00a19B",borderRadius:"0.375rem",color:"white"},children:e.jsxs("div",{className:"d-flex align-items-center gap-3",children:[e.jsx("button",{className:"btn btn-outline-light btn-sm d-flex align-items-center justify-content-center",onClick:c,type:"button",title:"Volver al seguimiento",style:{borderColor:"rgba(255, 255, 255, 0.3)",color:"white",transition:"all 0.2s ease",width:"40px",height:"40px"},onMouseOver:i=>{i.currentTarget.style.backgroundColor="rgba(255, 255, 255, 0.2)",i.currentTarget.style.borderColor="rgba(255, 255, 255, 0.5)"},onMouseOut:i=>{i.currentTarget.style.backgroundColor="transparent",i.currentTarget.style.borderColor="rgba(255, 255, 255, 0.3)"},children:e.jsx(Z,{size:14})}),e.jsxs("h1",{className:"mb-0 text-white d-flex align-items-center gap-2",style:{fontSize:"1.5rem",fontWeight:"600"},children:[e.jsx(I,{style:{color:"#e67e22"}}),"Resultados de Cuestionarios"]})]})})},de=({cuestionarios:o,aperturaSeleccionada:c,onSeleccionar:i})=>{const b=s=>s==1?"text-success":"text-muted",p=s=>s==1?e.jsx(ee,{}):e.jsx(te,{}),f=s=>s==1?"Activo":"Cerrado",h=s=>c?.apertura_id===s;return o.length==0?e.jsxs("div",{className:"card border-0",style:{backgroundColor:"white",borderRadius:"12px",boxShadow:"0 4px 15px rgba(0,0,0,0.03)"},children:[e.jsx("div",{className:"card-header d-flex justify-content-between align-items-center",style:{backgroundColor:"#343a40",color:"white"},children:e.jsxs("h3",{className:"mb-0 d-flex align-items-center gap-2",style:{fontSize:"1rem",fontWeight:"600"},children:[e.jsx(V,{style:{color:"#e67e22"}}),"Mis Cuestionarios"]})}),e.jsx("div",{className:"card-body p-4",children:e.jsxs("div",{className:"text-center py-4",children:[e.jsx("div",{style:{fontSize:"4rem",marginBottom:"1rem",opacity:"0.6"},children:"📝"}),e.jsx("p",{className:"text-muted",children:"No hay cuestionarios con resultados disponibles."})]})})]}):e.jsxs("div",{className:"card border-0",style:{backgroundColor:"white",borderRadius:"12px",boxShadow:"0 4px 15px rgba(0,0,0,0.03)"},children:[e.jsxs("div",{className:"card-header d-flex justify-content-between align-items-center",style:{backgroundColor:"#343a40",color:"white"},children:[e.jsxs("h3",{className:"mb-0 d-flex align-items-center gap-2",style:{fontSize:"1rem",fontWeight:"600"},children:[e.jsx(V,{style:{color:"#e67e22"}}),"Mis Cuestionarios"]}),e.jsx("span",{className:"badge bg-secondary",children:o.length})]}),e.jsx("div",{className:"card-body p-0",children:e.jsx("div",{style:{maxHeight:"calc(100vh - 200px)",overflowY:"auto"},children:o.map(s=>e.jsxs("div",{className:`p-3 border-bottom ${h(s.apertura_id)?"bg-light":""}`,style:{cursor:"pointer",transition:"all 0.3s ease",borderLeft:h(s.apertura_id)?"4px solid #00a19B":"none"},onClick:()=>i(s.apertura_id),role:"button",tabIndex:0,onKeyDown:d=>{(d.key==="Enter"||d.key===" ")&&i(s.apertura_id)},onMouseOver:d=>{h(s.apertura_id)||(d.currentTarget.style.backgroundColor="#f8f9fa")},onMouseOut:d=>{h(s.apertura_id)||(d.currentTarget.style.backgroundColor="transparent")},children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-start mb-2",children:[e.jsxs("div",{className:"d-flex align-items-center gap-2 flex-1",children:[e.jsx("span",{className:b(s.apertura_activa),children:p(s.apertura_activa)}),e.jsx("h4",{className:"mb-0",style:{fontSize:"0.95rem",fontWeight:"600",color:"#2c3e50",lineHeight:"1.3"},children:s.titulo})]}),e.jsxs("div",{className:"d-flex align-items-center gap-1",style:{background:"#e3f2fd",color:"#1976d2",padding:"0.25rem 0.5rem",borderRadius:"12px",fontSize:"0.75rem",fontWeight:"500"},children:[e.jsx(E,{size:12}),e.jsx("span",{children:s.total_estudiantes_respondieron})]})]}),e.jsxs("div",{className:"d-flex flex-column gap-1",children:[e.jsx("p",{className:"mb-0",style:{fontSize:"0.8rem",color:"#6c757d",fontWeight:"500"},children:s.programa_nombre}),e.jsx("p",{className:"mb-0",style:{fontSize:"0.75rem",color:"#888"},children:s.periodo_nombre}),e.jsx("div",{className:"mt-1",children:e.jsx("span",{className:b(s.apertura_activa),style:{fontSize:"0.75rem",fontWeight:"500"},children:f(s.apertura_activa)})})]}),s.descripcion&&e.jsx("div",{className:"mt-2 pt-2",style:{borderTop:"1px solid #f0f0f0"},children:e.jsx("p",{className:"mb-0",style:{fontSize:"0.8rem",color:"#6c757d",lineHeight:"1.4"},children:s.descripcion})})]},s.apertura_id))})})]})},me=({apertura:o,estudiantes:c,estadisticas:i,onVerRespuestas:b,formatearPorcentaje:p,getPorcentajeColor:f})=>{const h=n=>n==1?e.jsx("span",{className:"badge bg-success",children:"✅ Activo"}):e.jsx("span",{className:"badge bg-secondary",children:"📋 Cerrado"}),s=n=>{const m=f(n);let x="badge ";return m==="success"?x+="bg-success":m==="warning"?x+="bg-warning text-dark":m==="danger"?x+="bg-danger":x+="bg-secondary",e.jsx("span",{className:x,children:p(n)})},d=[...c].sort((n,m)=>m.porcentaje-n.porcentaje);return e.jsxs("div",{className:"p-4",children:[e.jsx("div",{className:"mb-4 pb-3",style:{borderBottom:"2px solid #dee2e6"},children:e.jsxs("div",{className:"d-flex flex-column gap-3",children:[e.jsxs("div",{className:"d-flex align-items-center gap-3",children:[e.jsx("h2",{className:"mb-0",style:{color:"#2c3e50",fontSize:"1.4rem",fontWeight:"700"},children:o.titulo}),h(o.apertura_activa)]}),e.jsxs("div",{className:"d-flex flex-wrap gap-3",style:{color:"#6c757d",fontSize:"0.9rem"},children:[e.jsxs("div",{className:"d-flex align-items-center gap-1",children:[e.jsx("strong",{children:"Programa:"})," ",o.programa_nombre]}),e.jsxs("div",{className:"d-flex align-items-center gap-1",children:[e.jsx("strong",{children:"Periodo:"})," ",o.periodo_nombre]}),e.jsxs("div",{className:"d-flex align-items-center gap-1",children:[e.jsx(se,{}),e.jsxs("span",{children:[o.fecha_inicio," - ",o.fecha_fin]})]})]}),o.descripcion&&e.jsx("div",{children:e.jsx("p",{className:"mb-0",style:{color:"#6c757d",fontStyle:"italic",lineHeight:"1.5"},children:o.descripcion})})]})}),i&&e.jsxs("div",{className:"row g-3 mb-4",children:[e.jsx("div",{className:"col-12 col-md-6 col-lg-3",children:e.jsx("div",{className:"card border-0 h-100",style:{backgroundColor:"white",borderRadius:"12px",boxShadow:"0 4px 15px rgba(0,0,0,0.03)"},children:e.jsxs("div",{className:"card-body d-flex align-items-center gap-3",children:[e.jsx("div",{style:{width:"50px",height:"50px",borderRadius:"50%",background:"#e67e22",color:"white",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"1.2rem"},children:e.jsx(E,{})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{style:{fontSize:"1.5rem",fontWeight:"bold",color:"#2c3e50",marginBottom:"0.25rem"},children:i.total_estudiantes}),e.jsx("div",{style:{fontSize:"0.8rem",color:"#6c757d",textTransform:"uppercase",fontWeight:"600"},children:"Estudiantes"})]})]})})}),e.jsx("div",{className:"col-12 col-md-6 col-lg-3",children:e.jsx("div",{className:"card border-0 h-100",style:{backgroundColor:"white",borderRadius:"12px",boxShadow:"0 4px 15px rgba(0,0,0,0.03)"},children:e.jsxs("div",{className:"card-body d-flex align-items-center gap-3",children:[e.jsx("div",{style:{width:"50px",height:"50px",borderRadius:"50%",background:"#e67e22",color:"white",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"1.2rem"},children:e.jsx(re,{})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{style:{fontSize:"1.5rem",fontWeight:"bold",color:"#2c3e50",marginBottom:"0.25rem"},children:p(i.promedio_porcentaje)}),e.jsx("div",{style:{fontSize:"0.8rem",color:"#6c757d",textTransform:"uppercase",fontWeight:"600"},children:"Promedio General"})]})]})})}),e.jsx("div",{className:"col-12 col-md-6 col-lg-3",children:e.jsx("div",{className:"card border-0 h-100",style:{backgroundColor:"white",borderRadius:"12px",boxShadow:"0 4px 15px rgba(0,0,0,0.03)"},children:e.jsxs("div",{className:"card-body d-flex align-items-center gap-3",children:[e.jsx("div",{style:{width:"50px",height:"50px",borderRadius:"50%",background:"#e67e22",color:"white",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"1.2rem"},children:e.jsx(ae,{})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{style:{fontSize:"1.5rem",fontWeight:"bold",color:"#2c3e50",marginBottom:"0.25rem"},children:i.promedio_respuestas_correctas.toFixed(1)}),e.jsx("div",{style:{fontSize:"0.8rem",color:"#6c757d",textTransform:"uppercase",fontWeight:"600"},children:"Respuestas Correctas"})]})]})})}),e.jsx("div",{className:"col-12 col-md-6 col-lg-3",children:e.jsx("div",{className:"card border-0 h-100",style:{backgroundColor:"white",borderRadius:"12px",boxShadow:"0 4px 15px rgba(0,0,0,0.03)"},children:e.jsxs("div",{className:"card-body d-flex align-items-center gap-3",children:[e.jsx("div",{style:{width:"50px",height:"50px",borderRadius:"50%",background:"#e67e22",color:"white",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"1.2rem"},children:e.jsx(I,{})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{style:{fontSize:"1.5rem",fontWeight:"bold",color:"#2c3e50",marginBottom:"0.25rem"},children:Math.round(i.total_preguntas_cuestionario)}),e.jsx("div",{style:{fontSize:"0.8rem",color:"#6c757d",textTransform:"uppercase",fontWeight:"600"},children:"Total Preguntas"})]})]})})})]}),e.jsxs("div",{className:"card border-0",style:{backgroundColor:"white",borderRadius:"12px",boxShadow:"0 4px 15px rgba(0,0,0,0.03)"},children:[e.jsxs("div",{className:"card-header d-flex justify-content-between align-items-center",style:{backgroundColor:"#343a40",color:"white"},children:[e.jsxs("h3",{className:"mb-0 d-flex align-items-center gap-2",style:{fontSize:"1rem",fontWeight:"600"},children:[e.jsx(E,{style:{color:"#e67e22"}}),"Resultados por Estudiante"]}),e.jsx("span",{className:"badge bg-secondary",children:c.length})]}),e.jsx("div",{className:"card-body p-0",children:d.length==0?e.jsxs("div",{className:"text-center py-4",children:[e.jsx("div",{style:{fontSize:"4rem",marginBottom:"1rem",opacity:"0.6"},children:"📊"}),e.jsx("p",{className:"text-muted",children:"No hay estudiantes que hayan completado este cuestionario."})]}):e.jsx("div",{className:"table-responsive",children:e.jsxs("table",{className:"table table-hover mb-0",children:[e.jsx("thead",{className:"table-light",children:e.jsxs("tr",{children:[e.jsx("th",{style:{fontSize:"0.85rem",textTransform:"uppercase",color:"#2c3e50",fontWeight:"600"},children:"Ranking"}),e.jsx("th",{style:{fontSize:"0.85rem",textTransform:"uppercase",color:"#2c3e50",fontWeight:"600"},children:"Estudiante"}),e.jsx("th",{style:{fontSize:"0.85rem",textTransform:"uppercase",color:"#2c3e50",fontWeight:"600"},children:"Identificación"}),e.jsx("th",{style:{fontSize:"0.85rem",textTransform:"uppercase",color:"#2c3e50",fontWeight:"600"},children:"Email"}),e.jsx("th",{style:{fontSize:"0.85rem",textTransform:"uppercase",color:"#2c3e50",fontWeight:"600"},children:"Calificación"}),e.jsx("th",{style:{fontSize:"0.85rem",textTransform:"uppercase",color:"#2c3e50",fontWeight:"600"},children:"Fecha"})]})}),e.jsx("tbody",{children:d.map((n,m)=>e.jsxs("tr",{children:[e.jsx("td",{children:e.jsxs("div",{className:"d-flex align-items-center gap-2",children:[m<3&&e.jsx("span",{style:{fontSize:"1.1rem"},children:m==0?"🥇":m==1?"🥈":"🥉"}),e.jsxs("span",{style:{fontWeight:"600",color:"#6c757d",fontSize:"0.85rem"},children:["#",m+1]})]})}),e.jsx("td",{children:e.jsx("div",{children:e.jsx("strong",{style:{color:"#2c3e50"},children:n.estudiante_nombre})})}),e.jsx("td",{children:n.identificacion}),e.jsx("td",{children:e.jsx("div",{style:{color:"#6c757d",fontSize:"0.85rem"},children:n.email})}),e.jsx("td",{children:e.jsxs("div",{className:"d-flex flex-column align-items-start gap-1",children:[s(n.porcentaje),e.jsxs("div",{style:{fontSize:"0.75rem",color:"#6c757d"},children:[n.respuestas_correctas,"/",n.total_preguntas]})]})}),e.jsx("td",{children:e.jsx("div",{style:{fontSize:"0.85rem",color:"#6c757d"},children:n.fecha_respuesta||""})})]},n.estudiante_id))})]})})})]})]})},ue=()=>e.jsx("div",{className:"d-flex justify-content-center align-items-center",style:{minHeight:"400px",padding:"2rem"},children:e.jsxs("div",{className:"text-center",style:{maxWidth:"400px"},children:[e.jsx(ie,{className:"fa-spin",style:{fontSize:"2rem",color:"#e67e22",marginBottom:"1rem"}}),e.jsx("h2",{style:{color:"#2c3e50",fontSize:"1.5rem",marginBottom:"1rem"},children:"Cargando resultados..."}),e.jsx("p",{className:"text-muted",children:"Por favor espera mientras cargamos los datos."})]})}),he=({mensaje:o,onReintentar:c})=>e.jsx("div",{className:"d-flex justify-content-center align-items-center",style:{minHeight:"400px",padding:"2rem"},children:e.jsxs("div",{className:"text-center",style:{maxWidth:"400px"},children:[e.jsx(oe,{style:{fontSize:"3rem",color:"#e74c3c",marginBottom:"1rem"}}),e.jsx("h2",{style:{color:"#e74c3c",fontSize:"1.5rem",marginBottom:"1rem"},children:"Error al cargar resultados"}),e.jsx("p",{className:"text-muted mb-3",children:o}),c&&e.jsxs("button",{className:"btn btn-danger",onClick:c,type:"button",style:{transition:"all 0.2s ease"},onMouseOver:i=>{i.currentTarget.style.transform="translateY(-1px)"},onMouseOut:i=>{i.currentTarget.style.transform="translateY(0)"},children:[e.jsx(ne,{className:"me-2"})," Reintentar"]})]})}),xe=({mensaje:o,icono:c="📝",submensaje:i})=>e.jsx("div",{className:"d-flex justify-content-center align-items-center",style:{minHeight:"400px",padding:"2rem"},children:e.jsxs("div",{className:"text-center",style:{maxWidth:"400px"},children:[e.jsx("div",{style:{fontSize:"4rem",marginBottom:"1rem",opacity:"0.6"},children:c}),e.jsx("h3",{style:{color:"#6c757d",fontSize:"1.25rem",marginBottom:"1rem"},children:o}),i&&e.jsx("p",{className:"text-muted",children:i})]})}),ve=()=>{const{cuestionarios:o,aperturaSeleccionada:c,resultadosEstudiantes:i,estadisticasApertura:b,loading:p,error:f,handleSeleccionarCuestionario:h,handleVerRespuestas:s,formatearPorcentaje:d,getPorcentajeColor:n}=ce();return p?e.jsx(z,{children:e.jsx(ue,{})}):f?e.jsx(z,{children:e.jsx(he,{mensaje:f})}):e.jsx(z,{children:e.jsx("div",{className:"container-fluid py-3",style:{backgroundColor:"#f8fafc",minHeight:"100vh"},children:e.jsx("div",{className:"row justify-content-center",children:e.jsxs("div",{className:"col-12 col-xl-11",children:[e.jsx(le,{}),e.jsxs("div",{className:"row g-4 mt-3",children:[e.jsx("div",{className:"col-12 col-lg-4",children:e.jsx(de,{cuestionarios:o,aperturaSeleccionada:c,onSeleccionar:h})}),e.jsx("div",{className:"col-12 col-lg-8",children:c&&i?e.jsx(me,{apertura:c,estudiantes:i,estadisticas:b,onVerRespuestas:s,formatearPorcentaje:d,getPorcentajeColor:n}):e.jsx(xe,{mensaje:"Seleccione un cuestionario para ver los resultados",icono:"📊"})})]})]})})})})};export{ve as default};
